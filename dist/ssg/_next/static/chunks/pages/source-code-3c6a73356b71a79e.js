/*!
 * @architect Mark Jivko <mark@oglama.com>
 * @copyright Â© 2024-2025 Oglama (https://oglama.com)
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[887],{83366:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>tP});var l=n(37876),i=n(81373),r=n(7156),o=n(98311),s=n(22393),a=n(50033),c=n(39763),u=n.n(c);let d=e=>{var t;return null!=(t=({[s.ModuleSrc.K_SRC_FUNCTIONS]:"function",[s.ModuleSrc.K_SRC_INPUTS]:"input",[s.ModuleSrc.K_SRC_OUTPUTS]:"output",[s.ModuleSrc.K_SRC_STATE_MACHINE]:"state"})[e])?t:"state"},x=(e,t,n,l)=>{n=(0,o.Pt)(n);let i=(Array.isArray(t)?t:[]).filter(e=>(null==e?void 0:e.id)!==l).map(e=>null==e?void 0:e.key),r=1;for(;!(n.length>0)||i.includes(n);){if(!i.length&&s.ModuleSrc.K_SRC_STATE_MACHINE===e){n="start";break}n="".concat(d(e),"-").concat(r++)}return n},h=async function(e,t,n){var l;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>{};if("string"!=typeof e||"string"!=typeof n||"object"!=typeof t||null===t||!Array.isArray(t[n]))return;let c=t[n],h={[s.ModuleSrc.K_SRC_FUNCTIONS]:u().max.sourceCode.fnCount,[s.ModuleSrc.K_SRC_INPUTS]:u().max.sourceCode.ioCount,[s.ModuleSrc.K_SRC_OUTPUTS]:u().max.sourceCode.ioCount,[s.ModuleSrc.K_SRC_STATE_MACHINE]:u().max.sourceCode.smCount};if(l=c.length>=h[n],l)return;let p=(0,a.r)(),m={id:p,key:x(n,c,i,p)};switch(n){case s.ModuleSrc.K_SRC_FUNCTIONS:case s.ModuleSrc.K_SRC_STATE_MACHINE:m.code="";break;case s.ModuleSrc.K_SRC_INPUTS:case s.ModuleSrc.K_SRC_OUTPUTS:m.type="string",m.name="string ".concat(s.ModuleSrc.K_SRC_INPUTS===n?"input":"output"),m.desc="",m.max=u().max.sourceCode.ioFieldStringLength}t[n].push(m),r(e,t),o(e),setTimeout(()=>{let e=document.getElementById("".concat(d(n),"-").concat(p));null==e||e.focus(),null==e||e.click()},250)};var p=n(3362),m=n(14232),f=n(91040),g=n(38388),A=n(46367),y=n(55181),j=n(46202),S=n(50789),v=n(72978),C=n(29715),w=n(14632),b=n(35268),I=n(66703),_=n(15852),T=n(84812),R=n(91247);let M=(0,b.Ay)(T.A)(e=>{let{theme:t}=e;return{width:"50px",minWidth:"50px",height:"50px",borderRadius:0,position:"relative","&:before":{content:'""',display:"block",position:"absolute",top:"5px",left:"3px",borderRadius:"5px",width:"5px",height:"40px",background:"transparent",opacity:0,transform:"scaleY(0%)",transition:"transform 200ms linear"},"&.active:before":{background:t.palette.primary.main,transform:"scaleY(100%)",opacity:1}}}),k=(0,b.Ay)(R.A)(e=>{let{theme:t}=e;return{position:"absolute",right:"5px",bottom:"5px"}}),N=e=>{let{icons:t=[],agent:n,loaded:r=!1}=e,o=(0,I.A)(),{getSourceModified:a,onSourceModified:c,getSourceOrphans:u,onSourceOrphans:d,getSceSection:x,setSceSection:h,onSceSection:p}=(0,i.P)(),[f,A]=(0,m.useState)(s.ModuleSrc.K_SRC_STATE_MACHINE),[y,j]=(0,m.useState)(!1),[S,v]=(0,m.useState)({}),C="1px 0px 0px 0px ".concat((0,w.A)(o));return(0,m.useEffect)(()=>{if(null!==n){"string"==typeof(null==n?void 0:n.id)&&v(u(n.id));let e=d(e=>{let{agentId:t,orphans:l}=e;t===(null==n?void 0:n.id)&&v(l)});j(a(n.id));let t=c(e=>{let{agentId:t,modified:l}=e;t===n.id&&j(l)});A(x());let l=p(e=>{let{section:t}=e;A(t)});return()=>{t(),e(),l()}}},[n]),(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"50px",boxShadow:C},children:t.map(e=>{let{key:t,label:n,Icon:i}=e,o=t===f,s=null;do{if("source-control"===t&&y){s=(0,l.jsx)(k,{color:r?"primary":"disabled"});break}if(Array.isArray(S[t])&&S[t].length){s=(0,l.jsx)(k,{color:r?"warning":"disabled"});break}}while(!1);return(0,l.jsx)(_.A,{title:n||"",placement:"right",enterDelay:500,enterNextDelay:500,children:(0,l.jsx)(g.A,{sx:{width:"50px",height:"50px"},children:(0,l.jsxs)(M,{className:o?"active":"",disabled:!r,color:"inherit",onClick:()=>h(t),children:[i?(0,l.jsx)(i,{fontSize:"medium",color:o?"inherit":"action"}):null,s]})})},t)})})};var F=n(8628),K=n(13383),P=n(67906),E=n(80553),U=n(44395),O=n(71733),z=n(35003),D=n(38111),L=n(79270),W=n(51553),B=n(52894),H=n(42371),V=n(71608),$=n(31274),Y=n(41745),q=n(39e3),G=n(15751),X=n(23842),J=n(9282),Q=n(50321),Z=n(20302),ee=n(2136),et=n(45196),en=n(64879),el=n(32673),ei=n(36740),er=n(82343),eo=n(52782),es=n(51197),ea=n(60709),ec=n(55099),eu=n(73674),ed=n(80735),ex=n(96728),eh=n(71090),ep=n(88992),em=n(39091),ef=n(4728),eg=n(39467),eA=n(96571),ey=n(1912),ej=n(83384),eS=n(43400);let ev=e=>{let{isOpen:t=!1,version:n=null,description:i=null,onOpen:o=()=>{},onClose:s=()=>{},onRelease:a=async()=>{}}=e,{i18n:c}=(0,r.B)(),u=(0,m.useRef)(null),[d,x]=(0,m.useState)(!1),[h,p]=(0,m.useState)(!1),f="string"==typeof n?function(e){let t=e.split(".").map(Number);return t[t.length-1]++,t.join(".")}(n):"0.0.1",A={versionName:em.Yj().required(c.t("Release version is required")).matches(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/,c.t("Version name must follow the x.y.z format with no leading zeros")).test("is-greater-or-equal",c.t("Version must be greater than or equal to {{v}}",{v:f}),e=>e&&function(e,t){let n=e.split(".").map(Number),l=t.split(".").map(Number);for(;n.length<l.length;)n.push(0);for(;l.length<n.length;)l.push(0);for(let e=0;e<n.length&&!(n[e]>l[e]);e++)if(n[e]<l[e])return!1;return!0}(e,f)),changes:em.Yj().max(512,()=>c.t("Must be at most {{n}} characters long",{n:512}))},{reset:y,control:j,handleSubmit:S,formState:{errors:v}}=(0,ep.mN)({defaultValues:{versionName:f,changes:""},mode:"onChange",resolver:(0,eh.t)(em.Ik().shape(A))}),C=async e=>{let{versionName:t,changes:n}=e;p(!0),await a(t,n),p(!1),s()};(0,m.useEffect)(()=>{t&&"function"==typeof o&&o()},[t]);let w=()=>{t&&"function"==typeof s&&s(),y()},b=()=>{u.current&&u.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))};return t?(0,l.jsxs)(L.A,{open:!0,onClose:h?()=>{}:w,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[h?null:(0,l.jsx)(U.A,{children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(z.A,{variant:"h4",sx:{ml:4},children:c.t("Create a release")}),(0,l.jsx)(O.A,{"aria-label":c.t("More information"),sx:{ml:2},color:"default",onClick:()=>x(!d),size:"large",children:d?(0,l.jsx)(J.A,{}):(0,l.jsx)(V.A,{})})]})}),(0,l.jsxs)(E.A,{children:[!h&&i&&d?(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",children:i})}):null,!h&&d?(0,l.jsxs)(B.A,{severity:"warning",sx:{mb:6},children:[c.t("Please make sure you have tested your code thouroughly before releasing it!"),(0,l.jsx)("br",{}),c.t("New users and those who have enabled auto-update will instantly use this new version of your module.")]}):null,h?(0,l.jsx)(g.A,{sx:{mt:3},children:(0,l.jsx)(eS.A,{})}):(0,l.jsxs)("form",{onSubmit:S(C),ref:u,children:[(0,l.jsxs)(eA.A,{fullWidth:!0,sx:{my:3},error:!!v.versionName,children:[(0,l.jsx)(ep.xI,{name:"versionName",control:j,render:e=>{let{field:{value:t,onChange:n}}=e;return(0,l.jsx)(ey.A,{disabled:h,autoFocus:!0,required:!0,value:t,onChange:n,onKeyDown:e=>"Enter"===e.key&&b(),spellCheck:!1,autoComplete:"off",inputProps:{minLength:3,maxLength:64,tabIndex:1},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{mr:-2},children:(0,l.jsx)(ej.A,{fontSize:"small"})})},label:c.t("Release version"),placeholder:f,error:!!v.versionName})}}),v.versionName&&(0,l.jsx)(ef.A,{sx:{color:"error.main"},children:v.versionName.message})]}),(0,l.jsxs)(eA.A,{fullWidth:!0,sx:{my:3},error:!!v.changes,children:[(0,l.jsx)(ep.xI,{name:"changes",control:j,render:e=>{let{field:{value:t,onChange:i}}=e;return(0,l.jsx)(ey.A,{multiline:!0,rows:2,value:t,onChange:i,spellCheck:!1,autoComplete:"off",inputProps:{maxLength:512,tabIndex:2},label:c.t("Release details"),placeholder:"string"==typeof n?c.t("Bug fixes and improvements in this version"):c.t("First release"),error:!!v.changes})}}),v.changes&&(0,l.jsx)(ef.A,{sx:{color:"error.main"},children:v.changes.message})]})]})]}),h?null:(0,l.jsxs)(P.A,{children:[(0,l.jsx)(T.A,{color:"secondary",onClick:w,children:c.t("Cancel")}),(0,l.jsx)(T.A,{variant:"contained",onClick:b,startIcon:(0,l.jsx)(ea.A,{}),children:c.t("Publish release")})]})]}):null},eC=e=>{let{isOpen:t=!1,version:n=null,onOpen:i=()=>{},onClose:o=()=>{},onDelete:s=async()=>{}}=e,{i18n:a}=(0,r.B)(),[c,u]=(0,m.useState)(!1);(0,m.useEffect)(()=>{t&&"function"==typeof i&&i()},[t]);let d=()=>{t&&"function"==typeof o&&o()},x=async()=>{u(!0),await s(),u(!1),o()};return t?(0,l.jsxs)(L.A,{open:!0,onClose:c?()=>{}:d,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[c?null:(0,l.jsx)(U.A,{children:(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(z.A,{variant:"h4",sx:{ml:4},children:a.t("Delete release v{{version}}",{version:n})})})}),(0,l.jsx)(E.A,{children:c?(0,l.jsx)(g.A,{sx:{mt:3},children:(0,l.jsx)(eS.A,{})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B.A,{severity:"error",sx:{mb:3},children:a.t("Are you sure you want to delete this release? This action is irreversible!")}),(0,l.jsx)(B.A,{severity:"warning",children:a.t("Once the release is deleted, the existing source code is removed, and the latest release is installed in its place.")})]})}),c?null:(0,l.jsxs)(P.A,{children:[(0,l.jsx)(T.A,{color:"secondary",onClick:d,children:a.t("Cancel")}),(0,l.jsx)(T.A,{variant:"contained",color:"error",onClick:x,startIcon:(0,l.jsx)(es.A,{}),children:a.t("Delete release")})]})]}):null};var ew=n(959);let eb=e=>{let{isOpen:t=!1,onOpen:n=()=>{},onClose:i=()=>{},onImport:o=async()=>{},description:s}=e,{i18n:a}=(0,r.B)(),[c,u]=(0,m.useState)(!1),[d,x]=(0,m.useState)(!1);(0,m.useEffect)(()=>{t&&"function"==typeof n&&n()},[t]);let h=()=>{t&&"function"==typeof i&&i()};return t?(0,l.jsxs)(L.A,{open:!0,onClose:d?()=>{}:h,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[d?null:(0,l.jsx)(U.A,{children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(z.A,{variant:"h4",sx:{ml:4},children:a.t("Import from YAML")}),(0,l.jsx)(O.A,{"aria-label":a.t("More information"),sx:{ml:2},color:"default",onClick:()=>u(!c),size:"large",children:c?(0,l.jsx)(J.A,{}):(0,l.jsx)(V.A,{})})]})}),(0,l.jsxs)(E.A,{children:[!d&&s&&c?(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",children:s})}):null,!d&&c?(0,l.jsx)(B.A,{severity:"warning",sx:{mb:6},children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",children:a.t("Warning! The imported source code will overwrite your current work.")})}):null,d?(0,l.jsx)(g.A,{sx:{mt:6},children:(0,l.jsx)(eS.A,{})}):(0,l.jsx)(ew.A,{maxSize:2,extensions:["yaml"],handleFiles:e=>{let t=Array.isArray(e)&&e.length?e[0]:null;if(!t||"string"!=typeof(null==t?void 0:t.name)||!t.name.toLowerCase().match(/oglama(?: \(\d+\))?\.yaml$/gi))return void K.o.error(a.t("Invalid file extension, expected '.oglama.yaml'"),{duration:5e3,ariaProps:{role:"alert"}});x(!0);let n=new FileReader;n.onload=async e=>{try{let t=(0,er.qg)(e.target.result);await o(t),K.o.success(a.t("Source code imported successfully!")),h()}catch(e){var t;K.o.error("".concat(a.t("Import error"),": ").concat(null!=(t=e.message)?t:e),{duration:5e3,ariaProps:{role:"alert"}})}x(!1)},n.readAsText(t)}})]}),d?null:(0,l.jsx)(P.A,{children:(0,l.jsx)(T.A,{color:"secondary",onClick:h,children:a.t("Close")})})]}):null},eI=e=>{var t;let{isOpen:n=!1,onClose:i=()=>{},moduleId:o,moduleSrcId:s}=e,{i18n:a}=(0,r.B)(),[c,u]=(0,m.useState)(null),[d,x]=(0,m.useState)(!0),h=()=>{n&&"function"==typeof i&&i()};return(0,m.useEffect)(()=>{x(!0),u(null),(async()=>{try{var e;let t=await f.A.get("modules/".concat(o,"/src/").concat(s,"/meta"));"string"==typeof(null==(e=t.data)?void 0:e.id)&&u(t.data)}catch(e){}x(!1)})()},[s]),n?(0,l.jsxs)(L.A,{open:!0,onClose:d?()=>{}:h,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[d?null:(0,l.jsx)(U.A,{children:(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(z.A,{variant:"h4",sx:{ml:4},children:null!=(t=null==c?void 0:c.version)?t:a.t("Release not found")})})}),(0,l.jsx)(E.A,{children:d?(0,l.jsx)(eS.A,{}):(0,l.jsx)(B.A,{color:"string"==typeof(null==c?void 0:c.changes)&&c.changes.length?"info":"warning",children:(0,l.jsx)(z.A,{variant:"caption",component:"pre",sx:{color:"inherit",fontSize:"0.85rem",wordBreak:"break-all",whiteSpace:"preserve",fontFamily:"Yaldevi,sans-serif"},children:"string"==typeof(null==c?void 0:c.changes)&&c.changes.length?c.changes:a.t("No changes were documented for this release.")})})}),d?null:(0,l.jsx)(P.A,{children:(0,l.jsx)(T.A,{color:"secondary",onClick:h,children:a.t("Close")})})]}):null};var e_=n(50694),eT=n(13353);let eR=(0,b.Ay)(T.A)(e=>{let{theme:t}=e;return{justifyContent:"start",textTransform:"none","& > .MuiButton-icon":{marginLeft:t.spacing(.5),marginRight:t.spacing(3)},fontSize:"0.75rem",color:"inherit"}}),eM=e=>{var t,n,o,a,c,u,d;let{agent:x,module:h,updateAgent:p=()=>{},updateModule:A=()=>{},srcStateMachine:y=[],srcModified:j=!1,setLoaded:S=()=>{}}=e,{getSource:v,setSource:C,setSourceModified:w}=(0,i.P)(),b=(0,ei.A)(),{i18n:I}=(0,r.B)(),T=(0,F.A)(),[R,M]=(0,m.useState)(!1),[k,N]=(0,m.useState)(!1),[P,E]=(0,m.useState)(!1),[U,L]=(0,m.useState)(!1),[W,B]=(0,m.useState)(!1),H="string"==typeof(null==x?void 0:x.installedModuleSrcId)&&Array.isArray(null==h?void 0:h.moduleReleases)&&(null==h?void 0:h.moduleReleases.length)?h.moduleReleases[h.moduleReleases.length-1].srcVersion:null,V="string"==typeof(null==x?void 0:x.installedModuleSrcId)&&Array.isArray(null==h?void 0:h.moduleReleases)&&(null==h?void 0:h.moduleReleases.length)?null==h?void 0:h.moduleReleases.reduce((e,t)=>t.srcId===(null==x?void 0:x.installedModuleSrcId)?t.srcVersion:e,null):null,$=async()=>{var e;if("string"!=typeof(null==x?void 0:x.id))return;let t=await v(x.id,!0);for(let e of Object.values(s.ModuleSrc))t[e]=(Array.isArray(t[e])?t[e]:[]).map(e=>"object"==typeof e&&null!==e?(delete e.id,e):null).filter(e=>null!==e);let n=(0,er.As)(t,{lineWidth:0,aliasDuplicateObjects:!1,defaultStringType:"PLAIN"});"founder"===(null==(e=T.user)?void 0:e.userRole)&&(K.o.success("Copied to clipboard!"),b.copy(n));let l=URL.createObjectURL(new Blob([n],{type:"application/x-yaml"})),i=document.createElement("a");i.download="".concat("".concat("string"==typeof(null==h?void 0:h.name)?h.name:x.name).replace(/\W+/gi,"-").toLowerCase(),".oglama.yaml"),i.href=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)},Y=async e=>{if("object"!=typeof e||null===e)throw Error(I.t("Invalid YAML format"));for(let t of Object.values(s.ModuleSrc))if(!Array.isArray(e[t]))throw Error(I.t('Key "{{n}}" missing from source code YAML',{n:t}));C(x.id,e),w(x.id),S(!1),await new Promise(e=>window.setTimeout(e,500)),S(!0)},q=async(e,t)=>{if("string"==typeof(null==x?void 0:x.id)&&["fork","release"].includes(e)&&"object"==typeof t&&null!==t){S(!1);try{var n,l,i,r;await f.A.put("agents/".concat(x.id,"/src"),await v(x.id,!0));let o=await f.A.post("agents/".concat(x.id,"/").concat(e),t);if("string"==typeof(null==(n=o.data)?void 0:n.id)&&p(o.data),"string"==typeof(null==(l=o.data)?void 0:l.installedModuleId)){let e=await f.A.get("modules/".concat(o.data.installedModuleId));"string"==typeof(null==(i=e.data)?void 0:i.id)&&A(e.data,null==(r=o.data)?void 0:r.installedModuleSrcId)}w(x.id,!1)}catch(e){}S(!0)}},G=async e=>{if("string"==typeof(null==x?void 0:x.id)&&"string"==typeof(null==h?void 0:h.id)&&"string"==typeof e){S(!1);try{var t,n,l;let i=await f.A.put("agents/".concat(x.id,"/modules/").concat(h.id),{srcId:e});if("string"!=typeof(null==(t=i.data)?void 0:t.id))return;p(i.data),A(h,null==(n=i.data)?void 0:n.installedModuleSrcId);let r=await f.A.get("agents/".concat(x.id,"/src"));Array.isArray(null==(l=r.data)?void 0:l.srcStateMachine)&&(C(x.id,r.data),w(x.id,!1))}catch(e){}S(!0)}},X=async()=>{var e,t,n;if("string"!=typeof(null==h?void 0:h.id)||"string"!=typeof(null==x?void 0:x.installedModuleSrcId)||null===V||!Array.isArray(null==h?void 0:h.moduleReleases)||!h.moduleReleases.length||(null==x?void 0:x.installedModuleSrcId)===h.moduleReleases[h.moduleReleases.length-1].srcId||(null==(e=T.user)?void 0:e.id)!==(null==h?void 0:h.authorId)&&"founder"!==(null==(t=T.user)?void 0:t.userRole))return;let l=null==x?void 0:x.installedModuleSrcId,i=h.moduleReleases[h.moduleReleases.length-1].srcId;await G(i);try{let e=await f.A.delete("modules/".concat(h.id,"/src/").concat(l));"string"==typeof(null==(n=e.data)?void 0:n.id)&&A(e.data,i)}catch(e){}};return(0,l.jsxs)(g.A,{children:[(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,flexGrow:0},children:null!==h?(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",pl:2},children:[(null==(t=T.user)?void 0:t.id)===(null==h?void 0:h.authorId)||"founder"===(null==(n=T.user)?void 0:n.userRole)?(0,l.jsx)(e_.A,{scale:.8,tooltipPlacement:"top",inactive:!0,module:h}):null,(0,l.jsx)(_.A,{title:"".concat(I.t("Installed module"),": ").concat(h.moduleName),placement:"top",children:(0,l.jsx)(z.A,{variant:"caption",sx:{ml:2,userSelect:"none",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"125px",textTransform:"none",height:"35px",lineHeight:"35px"},children:h.moduleName})})]}),Array.isArray(null==h?void 0:h.moduleReleases)&&h.moduleReleases.length?(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center"},children:[(0,l.jsx)(_.A,{title:I.t("Installed module version"),placement:"top",children:(0,l.jsx)(eo.A,{variant:"standard",value:null!=(d=null==x?void 0:x.installedModuleSrcId)?d:null,onChange:e=>G(e.target.value),sx:{mr:1,maxWidth:"70px",height:"35px","&.MuiInput-root:before":{display:"none"},"& .MuiSelect-select.MuiSelect-standard":{minWidth:"30px !important"}},inputProps:{sx:{py:3,pl:1,borderRadius:0}},children:[...h.moduleReleases].reverse().map(e=>{let{srcId:t,srcVersion:n}=e;return(0,l.jsx)(D.A,{value:t,children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"0.75rem",mt:"-1px"},children:["v.",n]})},t)})})}),"string"==typeof(null==x?void 0:x.installedModuleSrcId)?(0,l.jsx)(_.A,{title:I.t("Release details"),placement:"top",children:(0,l.jsx)(O.A,{onClick:()=>E(!0),sx:{width:"30px",height:"30px"},children:(0,l.jsx)(ec.A,{fontSize:"small"})})}):null]}):(0,l.jsxs)(z.A,{variant:"caption",sx:{userSelect:"none",ml:2},children:["(",I.t("no releases"),")"]})]}):(0,l.jsx)(z.A,{variant:"caption",sx:{userSelect:"none",ml:2},children:I.t("No module installed")})}),"string"==typeof(null==x?void 0:x.id)?(0,l.jsxs)(g.A,{sx:{display:"flex",width:"100%",p:2,flexDirection:"column"},children:[j&&y.length&&null!==h&&((null==(o=T.user)?void 0:o.id)===(null==h?void 0:h.authorId)||"founder"===(null==(a=T.user)?void 0:a.userRole))?(0,l.jsx)(eR,{startIcon:(0,l.jsx)(ea.A,{fontSize:"small",color:"action"}),onClick:()=>M(!0),children:I.t("Create a release")}):null,null!==h&&null!==V&&Array.isArray(null==h?void 0:h.moduleReleases)&&h.moduleReleases.length&&(null==x?void 0:x.installedModuleSrcId)!==h.moduleReleases[h.moduleReleases.length-1].srcId&&((null==(c=T.user)?void 0:c.id)===(null==h?void 0:h.authorId)||"founder"===(null==(u=T.user)?void 0:u.userRole))?(0,l.jsx)(eR,{startIcon:(0,l.jsx)(es.A,{fontSize:"small",color:"action"}),onClick:()=>N(!0),children:I.t("Delete release")}):null,y.length?(0,l.jsx)(eR,{startIcon:(0,l.jsx)(ex.A,{fontSize:"small",color:"action"}),onClick:()=>B(!0),children:I.t("Clone as new module")}):null,(0,l.jsx)(eR,{startIcon:(0,l.jsx)(ed.A,{fontSize:"small",color:"action"}),onClick:()=>L(!0),children:I.t("Import from YAML")}),y.length?(0,l.jsx)(eR,{startIcon:(0,l.jsx)(eu.A,{fontSize:"small",color:"action"}),onClick:()=>$(),children:I.t("Export as YAML")}):null]}):null,P&&"string"==typeof(null==h?void 0:h.id)&&"string"==typeof(null==x?void 0:x.installedModuleSrcId)?(0,l.jsx)(eI,{isOpen:!0,moduleId:null==h?void 0:h.id,moduleSrcId:null==x?void 0:x.installedModuleSrcId,onClose:()=>E(!1)}):null,U?(0,l.jsx)(eb,{isOpen:!0,description:I.t("Import agent source code from a '.oglama.yaml' file."),onClose:()=>L(!1),onImport:Y}):null,null!==h&&R?(0,l.jsx)(ev,{isOpen:!0,description:I.t("Store the changes you have made to this module's source code in a new release.")+(h.isApproved&&h.isPublic?" "+I.t("This new release will be instantly available for users in the module repository."):""),version:H,onClose:()=>M(!1),onRelease:(e,t)=>q("release",{version:e,changes:t})}):null,null!==h&&null!==V&&k?(0,l.jsx)(eC,{isOpen:!0,version:V,onClose:()=>N(!1),onDelete:()=>X()}):null,W?(0,l.jsx)(eT.A,{isOpen:!0,title:I.t("Clone as new module"),description:I.t("Create a new module and store the current source code in release v0.0.1"),onClose:()=>B(!1),onCreate:(e,t)=>q("fork",{moduleName:e,moduleDescription:t})}):null]})};var ek=n(43934),eN=n(93554),eF=n(25596),eK=n(76575),eP=n(8698);let eE=(0,b.Ay)(g.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",marginBottom:t.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}}),eU=e=>{var t,n;let{state:i,id:o,active:s=!1,index:a,tooltip:c="",orphan:u=!1,error:d=!1,selected:x=!1,agentStatus:h=-1,prepareKey:p=()=>{},onClick:f=()=>{},onDelete:A=()=>{},onKeyChange:y=()=>{}}=e,{i18n:j}=(0,r.B)(),S=(0,I.A)(),v=(0,m.useRef)(null),C=(0,m.useRef)(null),w=(0,m.useRef)(null),b=(0,m.useRef)(!0),[T,R]=(0,m.useState)(null!=(n=null==i?void 0:i.key)?n:"");(0,m.useEffect)(()=>{y(null==i?void 0:i.id,p(T,null==i?void 0:i.id),b.current),b.current&&(b.current=!1)},[T]),(0,m.useEffect)(()=>{if(x&&C.current instanceof Element){let e=C.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||C.current.scrollIntoView({behavior:"instant",block:"center"})}},[x]);let M=x?d?S.palette.error.main:0===h?S.palette.warning.main:S.palette.primary.main:null,k=s?S.palette.primary.main:u?S.palette.warning.main:null;return(0,l.jsxs)(eE,{ref:C,children:[(0,l.jsx)(g.A,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,l.jsx)(g.A,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!=M?M:"transparent",transform:"scaleY(".concat(x?"100":"0","%)"),transition:"transform 250ms linear"}})}),0===a?(0,l.jsx)(_.A,{title:j.t("Entry state"),placement:"right",children:(0,l.jsx)(q.A,{color:s?"primary":"action",sx:{mx:1}})}):u?(0,l.jsx)(_.A,{arrow:!0,placement:"right",title:j.t('Orphan state. Call with return { next: "{{keyText}}" }.',{keyText:null==(t=w.current)?void 0:t.value}),children:(0,l.jsx)(eK.A,{color:"warning",sx:{mx:1}})}):(0,l.jsx)(eP.A,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,l.jsx)(_.A,{title:c,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,l.jsxs)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,l.jsx)(ey.A,{inputRef:w,variant:"standard",color:u?"warning":"primary",onClick:f,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:T,placeholder:j.t("State key"),onChange:e=>{var t;return t=e.target.value,void(null!==v.current&&window.clearTimeout(v.current),v.current=window.setTimeout(()=>{R(p(t,null==i?void 0:i.id)),v.current=null},1e3))},inputProps:{id:o,style:{...null!==k?{color:k}:{},fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5}}}),(0,l.jsx)(O.A,{className:"delete",sx:{ml:1},size:"small",onClick:()=>A(null==i?void 0:i.id),children:(0,l.jsx)(eN.A,{fontSize:"small"})})]})})]})};var eO=n(84824);let ez=e=>{let{value:t,total:n,title:i=null}=e;return(!Number.isInteger(n)||n<=0)&&(n=100),(!Number.isInteger(t)||t<0)&&(t=0),t>n&&(t=n),(0,l.jsx)(_.A,{title:i,placement:"right",children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",width:"100%",my:2,px:2},children:[(0,l.jsx)(eO.A,{sx:{borderRadius:1},variant:"determinate",value:100*t/n,color:"inherit"}),(0,l.jsxs)(z.A,{variant:"caption",sx:{flexShrink:0,ml:3},children:[t,"/",n]})]})})},eD=e=>{let{agent:t,loaded:n,activeId:o=null,srcStateMachine:a=[],agentStatus:c=-1,selectedStateKey:h=null,selectedStateError:p=!1}=e,{getSource:f,setSource:A,setSourceModified:y,getSourceOrphans:j,onSourceOrphans:S,setSceTabs:v,addSceItem:C}=(0,i.P)(),{i18n:w}=(0,r.B)(),[b,I]=(0,m.useState)(null),[_,R]=(0,m.useState)([]),M=(0,m.useRef)(a),k=(0,m.useRef)(null),N=(0,m.useRef)(null),F=(e,t)=>x(s.ModuleSrc.K_SRC_STATE_MACHINE,a,e,t);(0,m.useEffect)(()=>{"string"==typeof(null==t?void 0:t.id)&&R(j(t.id).srcStateMachine);let e=S(e=>{let{agentId:n,orphans:l}=e;n===(null==t?void 0:t.id)&&R(l.srcStateMachine)});return()=>{e()}},[null==t?void 0:t.id]),(0,m.useEffect)(()=>{N.current&&Array.isArray(a)&&(M.current=a,k.current=ek.Ay.create(N.current,{animation:150,onUpdate:async e=>{let n=[...M.current],[l]=n.splice(e.oldIndex,1);n.splice(e.newIndex,0,l),M.current=n;let i=await f(t.id);i.srcStateMachine=n,A(t.id,i),y(t.id)}}))},[a]);let K=async e=>{I(null);let n=await f(t.id);Array.isArray(null==n?void 0:n.srcStateMachine)&&"string"==typeof e&&(n.srcStateMachine=n.srcStateMachine.filter(t=>t.id!==e),v(s.ModuleSrc.K_SRC_STATE_MACHINE,e,!1),A(t.id,n),y(t.id))},O=async function(e,n){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=await f(t.id);Array.isArray(null==i?void 0:i.srcStateMachine)&&"string"==typeof e&&(i.srcStateMachine=i.srcStateMachine.map(t=>(t.id===e&&(t.key=n),t)),A(t.id,i),l||y(t.id))};return(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[n?(0,l.jsxs)(g.A,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,l.jsx)(g.A,{sx:{width:"100%"},ref:N,children:a.map((e,t)=>{var n;let i="".concat(null!=(n=e.code)?n:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,l.jsx)(eU,{id:"".concat(d(s.ModuleSrc.K_SRC_STATE_MACHINE),"-").concat(e.id),active:o===e.id,state:e,index:t,orphan:_.includes(e.key),tooltip:i,error:e.key===h&&p,selected:e.key===h,agentStatus:c,prepareKey:F,onClick:()=>v(s.ModuleSrc.K_SRC_STATE_MACHINE,e.id),onDelete:e=>I(e),onKeyChange:O},e.id)})}),(0,l.jsx)(ez,{value:a.length,total:u().max.sourceCode.smCount,title:w.t("Total number of states in this finite-state machine")}),a.length<u().max.sourceCode.smCount?(0,l.jsx)(T.A,{className:0===a.length?"pop":null,onClick:()=>C(s.ModuleSrc.K_SRC_STATE_MACHINE),startIcon:(0,l.jsx)(eF.A,{}),size:"small",children:w.t("Add state")}):null]}):(0,l.jsx)(g.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(eS.A,{count:3})}),null!==b?(0,l.jsxs)(L.A,{open:!0,onClose:()=>I(null),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(U.A,{children:w.t("Delete State")}),(0,l.jsx)(E.A,{children:(0,l.jsx)(B.A,{severity:"warning",children:w.t("Are you sure you want to delete this state?")})}),(0,l.jsxs)(P.A,{children:[(0,l.jsx)(T.A,{color:"secondary",onClick:()=>I(null),children:w.t("Cancel")}),(0,l.jsx)(T.A,{color:"error",onClick:()=>K(b),startIcon:(0,l.jsx)(eN.A,{}),children:w.t("Delete State")})]})]}):null]})},eL=(0,b.Ay)(g.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",marginBottom:t.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}}),eW=e=>{var t,n;let{fn:i,id:o,active:s=!1,tooltip:a="",orphan:c=!1,error:u=!1,selected:d=!1,agentStatus:x=-1,prepareKey:h=()=>{},onClick:p=()=>{},onDelete:f=()=>{},onKeyChange:A=()=>{}}=e,{i18n:y}=(0,r.B)(),j=(0,I.A)(),S=(0,m.useRef)(null),v=(0,m.useRef)(!0),C=(0,m.useRef)(null),w=(0,m.useRef)(null),[b,T]=(0,m.useState)(null!=(n=null==i?void 0:i.key)?n:"");(0,m.useEffect)(()=>{A(null==i?void 0:i.id,h(b,null==i?void 0:i.id),v.current),v.current&&(v.current=!1)},[b]),(0,m.useEffect)(()=>{if(d&&C.current instanceof Element){let e=C.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||C.current.scrollIntoView({behavior:"instant",block:"center"})}},[d]);let R=d?u?j.palette.error.main:0===x?j.palette.warning.main:j.palette.primary.main:null,M=s?j.palette.primary.main:c?j.palette.warning.main:null;return(0,l.jsxs)(eL,{ref:C,children:[(0,l.jsx)(g.A,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,l.jsx)(g.A,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!=R?R:"transparent",transform:"scaleY(".concat(d?"100":"0","%)"),transition:"transform 250ms linear"}})}),c?(0,l.jsx)(_.A,{arrow:!0,placement:"right",title:y.t('Orphan function. Call with $.fn( "{{keyText}}" )',{keyText:null==(t=w.current)?void 0:t.value}),children:(0,l.jsx)(eK.A,{color:"warning",sx:{mx:1}})}):(0,l.jsx)(eP.A,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,l.jsx)(_.A,{title:a,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,l.jsxs)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,l.jsx)(ey.A,{inputRef:w,variant:"standard",color:c?"warning":"primary",onClick:p,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:b,placeholder:y.t("Function key"),onChange:e=>{var t;return t=e.target.value,void(null!==S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{T(h(t,null==i?void 0:i.id)),S.current=null},1e3))},inputProps:{id:o,style:{...null!==M?{color:M}:{},fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5}}}),(0,l.jsx)(O.A,{className:"delete",sx:{ml:1},size:"small",onClick:()=>f(null==i?void 0:i.id),children:(0,l.jsx)(eN.A,{fontSize:"small"})})]})})]})},eB=e=>{let{agent:t,loaded:n,activeId:o=null,srcFunctions:a=[],agentStatus:c=-1,selectedFnKey:h=null,selectedFnError:p=!1}=e,{getSource:f,setSource:A,setSourceModified:y,getSourceOrphans:j,onSourceOrphans:S,setSceTabs:v,addSceItem:C}=(0,i.P)(),{i18n:w}=(0,r.B)(),[b,I]=(0,m.useState)(null),[_,R]=(0,m.useState)([]),M=(0,m.useRef)(a),k=(0,m.useRef)(null),N=(0,m.useRef)(null),F=(e,t)=>x(s.ModuleSrc.K_SRC_FUNCTIONS,a,e,t);(0,m.useEffect)(()=>{"string"==typeof(null==t?void 0:t.id)&&R(j(t.id).srcFunctions);let e=S(e=>{let{agentId:n,orphans:l}=e;n===(null==t?void 0:t.id)&&R(l.srcFunctions)});return()=>{e()}},[null==t?void 0:t.id]),(0,m.useEffect)(()=>{N.current&&Array.isArray(a)&&(M.current=a,k.current=ek.Ay.create(N.current,{animation:150,onUpdate:async e=>{let n=[...M.current],[l]=n.splice(e.oldIndex,1);n.splice(e.newIndex,0,l),M.current=n;let i=await f(t.id);i.srcFunctions=n,A(t.id,i),y(t.id)}}))},[a]);let K=async e=>{I(null);let n=await f(t.id);Array.isArray(null==n?void 0:n.srcFunctions)&&"string"==typeof e&&(n.srcFunctions=n.srcFunctions.filter(t=>t.id!==e),v(s.ModuleSrc.K_SRC_FUNCTIONS,e,!1),A(t.id,n),y(t.id))},O=async function(e,n){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=await f(t.id);Array.isArray(null==i?void 0:i.srcFunctions)&&"string"==typeof e&&(i.srcFunctions=i.srcFunctions.map(t=>(t.id===e&&(t.key=n),t)),A(t.id,i),l||y(t.id))};return(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[n?(0,l.jsxs)(g.A,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,l.jsx)(g.A,{sx:{width:"100%"},ref:N,children:a.map((e,t)=>{var n;let i="".concat(null!=(n=e.code)?n:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,l.jsx)(eW,{fn:e,id:"".concat(d(s.ModuleSrc.K_SRC_FUNCTIONS),"-").concat(e.id),active:e.id===o,index:t,orphan:_.includes(e.key),tooltip:i,error:e.key===h&&p,selected:e.key===h,agentStatus:c,prepareKey:F,onClick:()=>v(s.ModuleSrc.K_SRC_FUNCTIONS,e.id),onDelete:e=>I(e),onKeyChange:O},e.id)})}),(0,l.jsx)(ez,{value:a.length,total:u().max.sourceCode.fnCount,title:w.t("Total number of functions in this module")}),a.length<u().max.sourceCode.fnCount?(0,l.jsx)(T.A,{onClick:()=>C(s.ModuleSrc.K_SRC_FUNCTIONS),startIcon:(0,l.jsx)(eF.A,{}),size:"small",children:w.t("Add function")}):null]}):(0,l.jsx)(g.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(eS.A,{count:3})}),null!==b?(0,l.jsxs)(L.A,{open:!0,onClose:()=>I(null),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(U.A,{children:w.t("Delete Function")}),(0,l.jsx)(E.A,{children:(0,l.jsx)(B.A,{severity:"warning",children:w.t("Are you sure you want to delete this function?")})}),(0,l.jsxs)(P.A,{children:[(0,l.jsx)(T.A,{color:"secondary",onClick:()=>I(null),children:w.t("Cancel")}),(0,l.jsx)(T.A,{color:"error",onClick:()=>K(b),startIcon:(0,l.jsx)(eN.A,{}),children:w.t("Delete Function")})]})]}):null]})};var eH=n(12067),eV=n(32966);let e$=(0,b.Ay)(z.A)(e=>{let{theme:t}=e;return{whiteSpace:"pre-wrap",fontSize:"0.8rem",lineHeight:"0.8rem",fontFamily:"Inconsolata,monospace",textAlign:"left","& > span, & > span > span":{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",verticalAlign:"top",width:"100%",maxWidth:"250px"},"& > span > span":{width:"auto",maxWidth:"75px",textAlign:"left",direction:"rtl"},"& > span > span > span":{direction:"ltr",unicodeBidi:"bidi-override",verticalAlign:"top"},"&.single":{fontWeight:"bold"},"&.single > span":{maxWidth:"200px"},"& i":{background:"rgba(255,215,0,0.8)",color:"#000",textTransform:"none",fontStyle:"normal",verticalAlign:"top",marginLeft:"2px"}}}),eY=(0,b.Ay)(T.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",flexDirection:"column",marginBottom:t.spacing(1),cursor:"pointer",alignItems:"start",justifyContent:"start",textTransform:"none",position:"relative",paddingLeft:t.spacing(2),paddingRight:t.spacing(2),borderColor:"transparent","&.active [data-role=result]":{color:t.palette.primary.main},"&:before":{content:'""',display:"block",position:"absolute",bottom:"3px",left:"3px",borderRadius:"2px",height:"2px",width:"calc(100% - 6px)",background:"transparent",opacity:0,transform:"scaleX(0%)",transition:"transform 200ms linear"},"&.active":{borderColor:"red"},"&.active:before":{background:t.palette.primary.main,transform:"scaleX(100%)",opacity:1}}}),eq=(0,b.Ay)(z.A)(e=>{let{theme:t}=e;return{marginLeft:t.spacing(1),fontSize:"0.7rem",color:t.palette.info.main}}),eG=function(e){var t,n,i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,l.jsxs)(e$,{"data-role":"result",variant:"caption",className:r?null:"single",children:["string"==typeof e.prev?(0,l.jsxs)("span",{children:[r?"".concat(e.line-1,"	"):"",e.prev]}):null,(0,l.jsxs)("span",{children:[r?"".concat(e.line,"	"):"",(0,l.jsx)("span",{children:(0,l.jsx)("span",{children:null!=(t=e.match[0])?t:""})}),(0,l.jsx)("i",{children:null!=(n=e.match[1])?n:""}),null!=(i=e.match[2])?i:""]}),"string"==typeof e.next?(0,l.jsxs)("span",{children:[r?"".concat(e.line+1,"	"):"",e.next]}):null]})},eX=(e,t)=>{let n=t.split("\n"),l=RegExp((0,eH.Nu)(e),"i"),i=[];for(let e=0;e<n.length;e++){let t=n[e].match(l);if(t){let l=t.index,r=n[e].slice(0,l),o=t[0],s=n[e].slice(l+o.length);i.push({prev:e>0?n[e-1]:null,match:[r,o,s],next:e<n.length-1?n[e+1]:null,line:e+1,ch:l})}}return i},eJ=e=>{let{src:t={},icons:n=[],searchText:o="",setSearchText:a=()=>{}}=e,{setSceTabs:c,setSceCursor:u}=(0,i.P)(),{i18n:d}=(0,r.B)(),x=(0,m.useRef)(null),h=(0,m.useRef)(null),p=(0,m.useRef)((()=>{let e={};for(let t of n)e[t.key]={...t};return e})()),[f,A]=(0,m.useState)([]),[y,j]=(0,m.useState)(!0),[S,v]=(0,m.useState)(null),w={["".concat(s.ModuleSrc.K_SRC_STATE_MACHINE,"-key")]:d.t("state key"),["".concat(s.ModuleSrc.K_SRC_STATE_MACHINE,"-code")]:d.t("state"),["".concat(s.ModuleSrc.K_SRC_FUNCTIONS,"-key")]:d.t("function key"),["".concat(s.ModuleSrc.K_SRC_FUNCTIONS,"-code")]:d.t("function"),["".concat(s.ModuleSrc.K_SRC_INPUTS,"-key")]:d.t("input key"),["".concat(s.ModuleSrc.K_SRC_INPUTS,"-name")]:d.t("input name"),["".concat(s.ModuleSrc.K_SRC_OUTPUTS,"-key")]:d.t("output key"),["".concat(s.ModuleSrc.K_SRC_OUTPUTS,"-name")]:d.t("output name")};(0,m.useEffect)(()=>{j(0===o.length);let e={[s.ModuleSrc.K_SRC_STATE_MACHINE]:["key","code"],[s.ModuleSrc.K_SRC_FUNCTIONS]:["key","code"],[s.ModuleSrc.K_SRC_INPUTS]:["key","name"],[s.ModuleSrc.K_SRC_OUTPUTS]:["key","name"]},n=[],l={};if(o.length){for(let i of Object.keys(e))if(Array.isArray(t[i])){for(let r of t[i])if("object"==typeof r&&null!==r)for(let t of e[i]){if("string"!=typeof r[t])continue;let e=eX(o,r[t]);if(e.length)for(let o of e)l["".concat(i,"-").concat(r.id)]=!0,n.push({section:i,id:r.id,key:r.key,prop:t,result:o})}}}A(n),setTimeout(()=>j(!0),150)},[t,o]);let b=[...new Set(f.map(e=>"".concat(e.section,"-").concat(e.id)))].length,I=f.length;return(0,l.jsxs)(g.A,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,l.jsxs)(g.A,{sx:{display:"flex",height:"75px",px:2,flexDirection:"column"},children:[(0,l.jsx)(ey.A,{inputRef:h,variant:"standard",autoFocus:!0,defaultValue:o,placeholder:d.t("Search"),onChange:e=>{var t;return t=e.target.value.toLowerCase(),void(null!==x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{a(t),x.current=null,v(null)},450))},sx:{width:"100%","& input":{px:"0 !important",fontSize:"0.75rem"},"& .MuiInput-root:before":{display:"none"}},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",children:(0,l.jsx)(C.A,{fontSize:"small",sx:{mx:2}})}),endAdornment:o?(0,l.jsx)(eg.A,{position:"start",children:(0,l.jsx)(_.A,{title:d.t("Clear search"),children:(0,l.jsx)(O.A,{size:"small",sx:{width:30,height:30,mr:-2},onClick:()=>{a(""),v(null),null!==h.current&&(h.current.value="",h.current.focus())},children:(0,l.jsx)(eV.A,{fontSize:"small"})})})}):null}}),o.length?(0,l.jsx)(z.A,{variant:"caption",sx:{m:2,textAlign:"right",fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:I>0?1===I?d.t("1 result"):I>100?d.t("100 / {{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:I,itemsCount:b,obj:1===b?"item":"items"}):d.t("{{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:I,itemsCount:b,obj:1===b?"item":"items"}):d.t("No results")}):null]}),(0,l.jsx)(g.A,{sx:{display:"flex",width:"100%",height:"100%",px:2,overflowY:"auto",flexDirection:"column"},children:y?f.slice(0,100).map((e,t)=>{var n;let i="".concat(e.section,"-").concat(e.id,"-").concat(e.prop,"-").concat(t),r=p.current[e.section].Icon,o=p.current[e.section].label,s=null!=(n=w["".concat(e.section,"-").concat(e.prop)])?n:null;return(0,l.jsxs)(eY,{className:S===i?"active":null,onClick:()=>{v(i),c(e.section,e.id),u(e.id,{line:e.result.line-1,ch:e.result.ch})},children:[(0,l.jsxs)(g.A,{sx:{display:"flex",width:"100%",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap"},children:[(0,l.jsx)(_.A,{title:o,placement:"top",children:(0,l.jsx)(r,{fontSize:"small",sx:{mr:2},color:S===i?"primary":"action"})}),"key"===e.prop?eG(e.result):(0,l.jsx)(e$,{"data-role":"result",variant:"caption",children:(0,l.jsx)("span",{children:e.key})}),null!==s?(0,l.jsxs)(eq,{variant:"caption",children:["(",s,")"]}):null]}),"key"!==e.prop?(0,l.jsx)(g.A,{sx:{width:"100%",mt:2,ml:2,textAlign:"left"},children:eG(e.result,"code"===e.prop)}):null]},i)}):(0,l.jsx)(g.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(eS.A,{count:3})})})]})};var eQ=n(90836),eZ=n(75674),e0=n(29783),e1=n(89619),e5=n(34591);function e2(e){return[{value:"int",label:e.t("Integer"),Icon:e1.A},{value:"string",label:e.t("String"),Icon:e5.A},{value:"boolean",label:e.t("Boolean"),Icon:eZ.A},{value:"table",label:e.t("Table"),Icon:e0.A},{value:"files",label:e.t("Files"),Icon:eQ.A}]}var e3=n(54895);let e9=(0,b.Ay)(g.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",marginBottom:t.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1},"&:hover .type":{opacity:0}}}),e4=e=>{let{type:t,active:n=!1,isList:i=!1}=e,{i18n:o}=(0,r.B)(),s=e2(o).reduce((e,n)=>n.value===t?n.Icon:e,null);return(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",position:"relative"},children:[null!==s?(0,l.jsx)(s,{className:"type",color:n?"primary":"action",fontSize:"small",sx:{position:"absolute",left:"6px"}}):null,i?(0,l.jsx)(e3.A,{className:"type",color:n?"primary":"action",sx:{zIndex:2,fontSize:"0.5rem",position:"absolute",right:"0px",bottom:"3px"}}):null,(0,l.jsx)(eP.A,{className:"drag",color:n?"primary":"action",sx:{mx:1}})]})},e7=e=>{var t,n,i;let{field:o,id:a,active:c=!1,section:u,tooltip:d="",orphan:x=!1,prepareKey:h=()=>{},onClick:p=()=>{},onDelete:f=()=>{},onKeyChange:A=()=>{}}=e,{i18n:y}=(0,r.B)(),j=(0,I.A)(),S=(0,m.useRef)(null),v=(0,m.useRef)(!0),C=(0,m.useRef)(null),[w,b]=(0,m.useState)(null!=(t=null==o?void 0:o.key)?t:"");(0,m.useEffect)(()=>{A(null==o?void 0:o.id,h(w,null==o?void 0:o.id),v.current),v.current&&(v.current=!1)},[w]);let T=c?j.palette.primary.main:x?j.palette.warning.main:null;return(0,l.jsxs)(e9,{children:[x?(0,l.jsx)(_.A,{arrow:!0,placement:"right",title:s.ModuleSrc.K_SRC_INPUTS===u?y.t("Orphan input"):y.t("Orphan output"),children:(0,l.jsx)(eK.A,{color:"warning",sx:{mx:1}})}):(0,l.jsx)(e4,{type:null!=(n=null==o?void 0:o.type)?n:null,active:c,isList:null!=(i=null==o?void 0:o.isList)&&i}),(0,l.jsx)(_.A,{title:d,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,l.jsxs)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,l.jsx)(ey.A,{inputRef:C,variant:"standard",color:x?"warning":"primary",onClick:p,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:w,placeholder:s.ModuleSrc.K_SRC_INPUTS===u?y.t("Input key"):y.t("Output key"),onChange:e=>{var t;return t=e.target.value,void(null!==S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{b(h(t,null==o?void 0:o.id)),S.current=null},1e3))},inputProps:{id:a,style:{...null!==T?{color:T}:{},fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5}}}),(0,l.jsx)(O.A,{className:"delete",sx:{ml:1},size:"small",onClick:()=>f(null==o?void 0:o.id),children:(0,l.jsx)(eN.A,{fontSize:"small"})})]})})]})},e8=e=>{let{agent:t,loaded:n,activeId:o=null,srcFields:a=[],ioKey:c=s.ModuleSrc.K_SRC_INPUTS}=e,{getSource:h,setSource:p,setSourceModified:f,getSourceOrphans:A,onSourceOrphans:y,setSceTabs:j,addSceItem:S}=(0,i.P)(),{i18n:v}=(0,r.B)(),[C,w]=(0,m.useState)(null),[b,I]=(0,m.useState)([]),_=(0,m.useRef)(a),R=(0,m.useRef)(null),M=(0,m.useRef)(null),k=(e,t)=>x(c,a,e,t);(0,m.useEffect)(()=>{"string"==typeof(null==t?void 0:t.id)&&I(A(t.id)[c]);let e=y(e=>{let{agentId:n,orphans:l}=e;n===(null==t?void 0:t.id)&&I(l[c])});return()=>{e()}},[null==t?void 0:t.id]),(0,m.useEffect)(()=>{M.current&&Array.isArray(a)&&(_.current=a,R.current=ek.Ay.create(M.current,{animation:150,onUpdate:async e=>{let n=[..._.current],[l]=n.splice(e.oldIndex,1);n.splice(e.newIndex,0,l),_.current=n;let i=await h(t.id);i[c]=n,p(t.id,i),f(t.id)}}))},[a]);let N=async e=>{w(null);let n=await h(t.id);"string"==typeof e&&null!==n&&Array.isArray(n[c])&&(n[c]=n[c].filter(t=>t.id!==e),j(c,e,!1),p(t.id,n),f(t.id))},F=async function(e,n){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=await h(t.id);"object"==typeof i&&null!==i&&Array.isArray(i[c])&&"string"==typeof e&&(i[c]=i[c].map(t=>(t.id===e&&(t.key=n),t)),p(t.id,i),l||f(t.id))};return(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[n?(0,l.jsxs)(g.A,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,l.jsx)(g.A,{sx:{width:"100%"},ref:M,children:a.map((e,t)=>{let n=e.name?"".concat(s.ModuleSrc.K_SRC_INPUTS===c?v.t("Input name"):v.t("Output name"),": ").concat(e.name):"";return(0,l.jsx)(e7,{id:"".concat(d(c),"-").concat(e.id),active:e.id===o,index:t,orphan:b.includes(e.key),tooltip:n,field:e,section:c,prepareKey:k,onClick:()=>j(c,e.id),onDelete:e=>w(e),onKeyChange:F},e.id)})}),(0,l.jsx)(ez,{value:a.length,total:u().max.sourceCode.ioCount,title:s.ModuleSrc.K_SRC_INPUTS===c?v.t("Total number of inputs"):v.t("Total number of outputs")}),a.length<u().max.sourceCode.ioCount?(0,l.jsx)(T.A,{onClick:()=>S(c),size:"small",startIcon:(0,l.jsx)(eF.A,{}),children:s.ModuleSrc.K_SRC_INPUTS===c?v.t("Add input"):v.t("Add output")}):null]}):(0,l.jsx)(g.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(eS.A,{count:3})}),null!==C?(0,l.jsxs)(L.A,{open:!0,onClose:()=>w(null),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(U.A,{children:s.ModuleSrc.K_SRC_INPUTS===c?v.t("Delete Input"):v.t("Delete Output")}),(0,l.jsx)(E.A,{children:(0,l.jsx)(B.A,{severity:"warning",children:s.ModuleSrc.K_SRC_INPUTS===c?v.t("Are you sure you want to delete this input?"):v.t("Are you sure you want to delete this output?")})}),(0,l.jsxs)(P.A,{children:[(0,l.jsx)(T.A,{color:"secondary",onClick:()=>w(null),children:v.t("Cancel")}),(0,l.jsx)(T.A,{color:"error",onClick:()=>N(C),startIcon:(0,l.jsx)(eN.A,{}),children:s.ModuleSrc.K_SRC_INPUTS===c?v.t("Delete Input"):v.t("Delete Output")})]})]}):null]})},e6=(0,b.Ay)("code")(e=>{let{theme:t}=e;return{backgroundColor:t.palette.background.paper,marginLeft:t.spacing(1),marginRight:t.spacing(1),paddingTop:t.spacing(1),paddingBottom:t.spacing(1),borderRadius:t.shape.borderRadius,fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"}}),te=(e,t)=>"object"==typeof e&&null!==e&&Array.isArray(e[t])?e[t]:[],tt=e=>{var t,n,o,a,c,d,x,p,S;let{src:C={},icons:b=[],agent:R,module:M,updateAgent:k=()=>{},updateModule:N=()=>{},loaded:ei,setLoaded:er=()=>{}}=e,{onSceTabs:eo,getSceTabs:es,onSceSection:ea,getSceSection:ec,setSource:eu,onSourceModified:ed,getSourceModified:ex,setSourceModified:eh}=(0,i.P)(),{i18n:ep}=(0,r.B)(),em=(0,I.A)(),ef=(0,F.A)(),eg=(0,m.useRef)(null),eA=(0,m.useRef)(null),[ey,ej]=(0,m.useState)(s.ModuleSrc.K_SRC_STATE_MACHINE),[eS,ev]=(0,m.useState)(!1),[eC,ew]=(0,m.useState)(null),[eb,eI]=(0,m.useState)(!1),[e_,eT]=(0,m.useState)(!1),[eR,ek]=(0,m.useState)(null),[eN,eF]=(0,m.useState)(!1),[eK,eP]=(0,m.useState)(-1),[eE,eU]=(0,m.useState)([]),[eO,ez]=(0,m.useState)(""),[eL,eW]=(0,m.useState)(!1),[eH,eV]=(0,m.useState)(null);(0,m.useEffect)(()=>{var e,t,n;null==(e=window.sdk)||e.ibc.handle("ibc-main:agent:state",(e,t)=>{"string"==typeof(null==R?void 0:R.id)&&(null!==eg.current&&window.clearTimeout(eg.current),eg.current=window.setTimeout(()=>{ew(e),ev(t),eg.current=null},null===e?500:150))}),null==(t=window.sdk)||t.ibc.handle("ibc-main:agent:fn",(e,t)=>{"string"==typeof(null==R?void 0:R.id)&&(null!==eA.current&&window.clearTimeout(eA.current),eA.current=window.setTimeout(()=>{ek(e),eI(t),eA.current=null},null===e?500:150*(null!==eA.current)))}),null==(n=window.sdk)||n.ibc.handle("ibc-main:agent:status",(e,t)=>{"string"==typeof(null==R?void 0:R.id)&&eP(e)}),eU(es().tabs);let l=eo(e=>{let{tabs:t}=e;eU(t)});ej(ec());let i=ea(e=>{let{section:t}=e;ej(t)});null!==R&&eF(ex(R.id));let r=ed(e=>{let{agentId:t,modified:n}=e;t===(null==R?void 0:R.id)&&eF(n)});return()=>{l(),i(),r()}},[R]);let e$=()=>{eV(null)},eY=async e=>{e.preventDefault(),e.stopPropagation(),e$();try{let e=await f.A.put("agents/".concat(R.id),{autoUpdate:!R.autoUpdate});k(e.data)}catch(e){}},eq=async e=>{var t,n;if(e.preventDefault(),e.stopPropagation(),e$(),"string"!=typeof(null==R?void 0:R.id))return null;let l=await (null==(t=window.sdk)?void 0:t.ipc.diskStorage.openAgentFiles(R.id));return"string"!=typeof l&&(K.o.loading(ep.t("Initializing agent..."),null,!1),await h(R.id,C,s.ModuleSrc.K_SRC_STATE_MACHINE,null,eu,eh),await new Promise(e=>setTimeout(e,750)),l=await (null==(n=window.sdk)?void 0:n.ipc.diskStorage.openAgentFiles(R.id))),l},eG=b.reduce((e,t)=>t.key===ey?t.label:e,null),eX="1px solid ".concat((0,w.A)(em)),eQ=eE.reduce((e,t)=>(e[t.section]=t.id,e),{});return(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"300px",borderRight:eX,flexGrow:0,flexShrink:0},children:[(0,l.jsxs)(g.A,{sx:{px:2,width:"100%",height:"50px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(z.A,{variant:"caption",sx:{textTransform:"uppercase",color:em.palette.text.disabled,ml:2},children:eG}),Object.values(s.ModuleSrc).includes(ey)?(0,l.jsx)(O.A,{size:"small",onClick:()=>eW(!0),children:eL?(0,l.jsx)(J.A,{fontSize:"small"}):(0,l.jsx)(V.A,{fontSize:"small"})}):null,"source-control"===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(g.A,{children:[ei&&eN?(0,l.jsx)(_.A,{title:ep.t("Source code modified"),placement:"top",children:(0,l.jsx)(O.A,{onClick:()=>eT(!0),sx:{mr:1,height:"35px",width:"35px"},children:(0,l.jsx)(et.A,{fontSize:"small",sx:{transform:"scale(0.8)"},color:"primary"})})}):null,(0,l.jsx)(O.A,{sx:{width:"30px",height:"30px"},onClick:e=>{eV(e.currentTarget)},children:(0,l.jsx)(X.A,{fontSize:"small"})})]}),(0,l.jsxs)(H.A,{anchorEl:eH,open:!!eH,onClose:e$,children:[(0,l.jsx)(D.A,{onClick:eq,children:(0,l.jsxs)(g.A,{sx:{display:"flex"},children:[(0,l.jsx)($.A,{fontSize:"small"}),(0,l.jsx)(z.A,{sx:{ml:3},variant:"body2",children:ep.t("Open containing folder")})]})}),"source-control"===ey&&"string"==typeof(null==R?void 0:R.installedModuleId)?(0,l.jsx)(_.A,{title:ep.t("Toggle automatic updates for the installed module"),children:(0,l.jsxs)(D.A,{onClick:eY,sx:{justifyContent:"space-between"},children:[(0,l.jsxs)(g.A,{sx:{display:"flex"},children:[(0,l.jsx)(el.A,{fontSize:"small"}),(0,l.jsx)(z.A,{sx:{ml:3},variant:"body2",children:ep.t("Auto-update")})]}),(0,l.jsx)(W.A,{size:"small",sx:{ml:3},checked:R.autoUpdate,defaultValue:R.autoUpdate})]})}):null]})]}):null]}),(0,l.jsxs)(g.A,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",height:"calc( 100vh - 50px)",overflowY:"auto"},children:[s.ModuleSrc.K_SRC_STATE_MACHINE===ey?(0,l.jsx)(eD,{agent:R,loaded:ei,activeId:null!=(o=eQ[ey])?o:null,srcStateMachine:null!=(a=C[ey])?a:[],agentStatus:eK,selectedStateKey:eC,selectedStateError:eS}):null,s.ModuleSrc.K_SRC_INPUTS===ey?(0,l.jsx)(e8,{agent:R,loaded:ei,activeId:null!=(c=eQ[ey])?c:null,srcFields:te(C,ey),ioKey:s.ModuleSrc.K_SRC_INPUTS}):null,s.ModuleSrc.K_SRC_OUTPUTS===ey?(0,l.jsx)(e8,{agent:R,loaded:ei,activeId:null!=(d=eQ[ey])?d:null,srcFields:te(C,ey),ioKey:s.ModuleSrc.K_SRC_OUTPUTS}):null,s.ModuleSrc.K_SRC_FUNCTIONS===ey?(0,l.jsx)(eB,{agent:R,loaded:ei,activeId:null!=(x=eQ[ey])?x:null,srcFunctions:null!=(p=C[ey])?p:[],agentStatus:eK,selectedFnKey:eR,selectedFnError:eb}):null,"search"===ey?(0,l.jsx)(eJ,{src:C,icons:b,searchText:eO,setSearchText:ez}):null,"source-control"===ey?(0,l.jsx)(eM,{srcStateMachine:null!=(S=C[s.ModuleSrc.K_SRC_STATE_MACHINE])?S:[],module:M,updateModule:N,srcModified:eN,agent:R,updateAgent:k,setLoaded:er}):null]}),eL&&Object.values(s.ModuleSrc).includes(ey)?(0,l.jsxs)(L.A,{open:!0,onClose:()=>eW(!1),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:850,p:1}},children:[(0,l.jsx)(U.A,{children:eG}),(0,l.jsxs)(E.A,{children:[s.ModuleSrc.K_SRC_STATE_MACHINE===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B.A,{severity:"success",sx:{mb:3},icon:(0,l.jsx)(Q.A,{}),children:(0,l.jsxs)(z.A,{color:"inherit",variant:"body2",children:[ep.t("Finite-state machine states are written in plain JavaScript.")," ",ep.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(v.A,{}),children:(0,l.jsxs)(z.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are finite-state machine states."),(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:[ep.t("The finite-state machine begins execution from the entry state."),(0,l.jsx)(q.A,{fontSize:"small",sx:{display:"inline-block",verticalAlign:"text-bottom",mx:2}})]}),(0,l.jsxs)("li",{children:[ep.t("The next state to execute is specified using this return object:"),(0,l.jsx)(e6,{children:"{ next: string, args?: any[] }"})]}),(0,l.jsx)("li",{children:ep.t("The finite-state machine stops if an error occurs or if no next state is specified.")})]})]})}),(0,l.jsx)(B.A,{severity:"info",icon:(0,l.jsx)(G.A,{}),children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Ctrl/Cmd hover over $ properties to learn more.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} states, with {{length}} characters per state.",{count:u().max.sourceCode.smCount,length:u().max.sourceCode.smCodeLength})})]})})})]}):null,s.ModuleSrc.K_SRC_FUNCTIONS===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B.A,{severity:"success",sx:{mb:3},icon:(0,l.jsx)(Q.A,{}),children:(0,l.jsxs)(z.A,{color:"inherit",variant:"body2",children:[ep.t("Functions are written in plain JavaScript.")," ",ep.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(y.A,{}),children:(0,l.jsxs)(z.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are functions."),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:ep.t("Functions are used to avoid code duplication in finite-state machine states.")}),(0,l.jsx)("li",{children:ep.t("Unlike finite-state machine states, a function's return value has no special significance.")}),(0,l.jsx)("li",{children:ep.t("Functions can be called from either a state or another function with $.fn().")})]})]})}),(0,l.jsx)(B.A,{severity:"info",icon:(0,l.jsx)(G.A,{}),children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Ctrl/Cmd hover over $.fn() strings to view the invoked function.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} functions, with {{length}} characters per function.",{count:u().max.sourceCode.fnCount,length:u().max.sourceCode.fnCodeLength})})]})})})]}):null,s.ModuleSrc.K_SRC_INPUTS===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(j.A,{}),children:(0,l.jsxs)(z.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are your module's inputs."),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:ep.t("Inputs for each run are specified in the Settings tab.")}),(0,l.jsxs)("li",{children:[ep.t("Fetch inputs in states and functions:"),(0,l.jsx)(e6,{children:"$.ioInput*()."})]})]})]})}),(0,l.jsx)(B.A,{severity:"info",icon:(0,l.jsx)(G.A,{}),children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder items in the Settings tab.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} inputs. This limit is set to reduce cognitive load.",{count:u().max.sourceCode.ioCount})}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} input tables with up to {{columns}} columns and {{size}}MB per table.",{count:u().max.sourceCode.ioFieldTableCount,columns:u().max.sourceCode.ioFieldColumnCount,size:u().max.sourceCode.ioFieldTableSize})})]})})})]}):null,s.ModuleSrc.K_SRC_OUTPUTS===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(A.A,{}),children:(0,l.jsxs)(z.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are your module's outputs."),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:ep.t("Outputs are collected in the Results tab.")}),(0,l.jsxs)("li",{children:[ep.t("Store outputs in states and functions:"),(0,l.jsx)(e6,{children:"$.ioOutput*()"}),(0,l.jsx)(e6,{children:"$.ioSave*()"})]})]})]})}),(0,l.jsx)(B.A,{severity:"info",icon:(0,l.jsx)(G.A,{}),children:(0,l.jsx)(z.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder items in the Results tab.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} outputs. This limit is set to reduce cognitive load.",{count:u().max.sourceCode.ioCount})}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} output tables with up to {{columns}} columns per table.",{count:u().max.sourceCode.ioFieldTableCount,columns:u().max.sourceCode.ioFieldColumnCount})})]})})})]}):null]}),(0,l.jsx)(P.A,{children:(0,l.jsx)(T.A,{color:"secondary",onClick:()=>eW(!1),children:ep.t("OK")})})]}):null,e_?(0,l.jsxs)(L.A,{open:!0,onClose:()=>eT(!1),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(U.A,{children:ep.t("Locally modified source code")}),(0,l.jsxs)(E.A,{children:[(0,l.jsx)(B.A,{sx:{mb:3},icon:(0,l.jsx)(ee.A,{}),children:ep.t("Changes to the source code are instantly saved on your local computer.")}),(null==(t=ef.user)?void 0:t.id)===(null==M?void 0:M.authorId)||"founder"===(null==(n=ef.user)?void 0:n.userRole)?(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(Y.A,{}),children:ep.t("Once you are ready to share your changes with others you can publish them as a new release which will become available for install from the module repository.")}):(0,l.jsx)(B.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(en.A,{}),children:ep.t("If you wish to share your modifications with others, you can publish it to the module repository.")}),(0,l.jsx)(B.A,{severity:"info",icon:(0,l.jsx)(Z.A,{}),children:ep.t("You can also export and import your work as YAML files completely privately, outside of the module repository.")})]}),(0,l.jsx)(P.A,{children:(0,l.jsx)(T.A,{color:"secondary",onClick:()=>eT(!1),children:ep.t("OK")})})]}):null]})};var tn=n(71948),tl=n(79219),ti=n(50705),tr=n(99476),to=n(18847),ts=n.n(to);let ta=(0,b.Ay)(g.A)(e=>{let{theme:t}=e;return{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"light"===t.palette.mode?"#fff":"#272822","&:before, &:after":{content:'""',display:"block",zIndex:0,position:"absolute",top:0,left:0,height:"100%"},"&:before":{width:"30px",background:"light"===t.palette.mode?"#f7f7f7":"#272822",borderRight:"light"===t.palette.mode?"1px solid #dddddd":"none"},"&:after":{width:"7px",left:"auto",right:0,background:t.palette.customColors.bodyBg}}}),tc=ts()(()=>Promise.all([n.e(940),n.e(254),n.e(594),n.e(253),n.e(223)]).then(n.bind(n,70223)),{loadableGenerated:{webpack:()=>[70223]},ssr:!1}),tu=e=>{let{code:t,section:n,item:i,id:o,onFnClick:a,maxLength:c=5e4,actionEdit:u=async()=>{},showInfo:d=!1}=e,x=(0,m.useRef)(null),h=(0,m.useRef)(!0),{i18n:p}=(0,r.B)(),[f,g]=(0,m.useState)(t);(0,m.useEffect)(()=>{u(f,h.current),h.current&&(h.current=!1)},[f]);let A=s.ModuleSrc.K_SRC_FUNCTIONS===n?'await $.fn("'.concat(i.key,'"): any'):"($) => { next: string, args?: any[] } | void";return(0,l.jsxs)(ta,{children:[d?(0,l.jsxs)(B.A,{severity:"info",sx:{m:3,zIndex:100},children:[(0,l.jsx)(z.A,{variant:"caption",color:"inherit",children:s.ModuleSrc.K_SRC_FUNCTIONS===n?p.t("Call this function"):p.t("State signature")}),": ",(0,l.jsx)(z.A,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:A})]}):null,(0,l.jsx)(tc,{id:o,section:n,maxLength:c,defaultValue:f,onChange:e=>{null!==x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{g(e),x.current=null},450)},onFnClick:a})]})};var td=n(20243),tx=n(2684),th=n(80699),tp=n(692),tm=n(21936),tf=n(39031),tg=n(78813),tA=n(37277),ty=n(32870),tj=n(39335),tS=n(64621),tv=n(58086),tC=n(83931),tw=n(98738);let tb=e=>{let{sx:t={},items:n=[],setItems:i=()=>{},sanitize:o=e=>e,label:s="",tooltip:a="",placeholder:c="",placeholderMax:u="",adornment:d=null,maxLength:x=32,inputProps:h=null,numeric:p=!1,maxCount:m=25,maxCountToast:f=""}=e,{i18n:A}=(0,r.B)(),y=(0,I.A)();("object"!=typeof t||null===t)&&(t={});let j=async e=>{e.preventDefault();let t=new FormData(e.target);e.target.reset();let l=p?parseInt(t.get("value"),10):t.get("value");if("function"==typeof o&&(l=o(l)),null===l)return;let r=structuredClone(Array.isArray(n)?n:[]),s=!1;do{if(p){if(!Number.isFinite(l)){K.o.error(A.t("Value is not a valid number"));break}}else{if("string"!=typeof l){K.o.error(A.t("Value is not a valid string"));break}if(!l.length){K.o.error(A.t("Value cannot be empty"));break}}if(r.includes(l)){K.o.error("".concat(A.t("Value already added"),": ").concat(l));break}if(r.length>=m){K.o.error("string"==typeof f&&f.length?f:A.t("Cannot add more than {{maxCount}} values",{maxCount:m}));break}if("".concat(l).length>x){K.o.error(A.t("Value cannot be longer than {{maxLength}} characters",{maxLength:x}));break}s=!0}while(!1);s&&(r.push(l),i(r))},S=!Number.isInteger(m)||!Array.isArray(n)||n.length<m;return(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",...t},children:(0,l.jsxs)(g.A,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%",position:"relative",zIndex:0},children:[(0,l.jsx)(z.A,{variant:"caption",component:"div",sx:{position:"absolute",top:"-10px",left:"10px",px:1,background:y.palette.background.paper},children:s}),(0,l.jsxs)(g.A,{sx:{p:3,pt:4,borderRadius:1,border:"1px solid ".concat("light"===y.palette.mode?"rgba(50,50,50,0.25)":"rgba(255,255,255,0.25)"),flexDirection:"column",minHeight:"40px",display:"flex",alignItems:"center","&:hover":{borderColor:"light"===y.palette.mode?"rgba(50,50,50,0.35)":"rgba(255,255,255,0.35)"}},children:[Array.isArray(n)&&n.length?(0,l.jsx)(g.A,{sx:{display:"flex",width:"100%"},children:(0,l.jsx)(tw.A,{items:n,setItems:i,onDelete:e=>{i(structuredClone(Array.isArray(n)?n:[]).filter(t=>"".concat(t)!=="".concat(e)))},numeric:p})}):null,Number.isInteger(m)&&m>0?(0,l.jsx)(_.A,{title:a||A.t("Total number of items"),children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",width:"100%",mb:3,px:2},children:[(0,l.jsx)(eO.A,{color:"inherit",sx:{borderRadius:1},value:100*(Array.isArray(n)?n.length:0)/m}),(0,l.jsxs)(z.A,{variant:"caption",sx:{flexShrink:0,width:"50px",textAlign:"right"},children:[Array.isArray(n)?n.length:0,"/",m]})]})}):null,(0,l.jsx)("form",{style:{width:"100%"},onSubmit:j,children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",width:"100%",px:2,mb:2},children:[(0,l.jsx)(ey.A,{fullWidth:!0,name:"value",disabled:!S,...p?{type:"number",inputMode:"numeric"}:{},sx:{width:"100%",...S?{}:{"& fieldset":{borderColor:"transparent !important",userSelect:"none"}}},inputProps:null!=h?h:{maxLength:x},placeholder:S?c:u||A.t("Maximum number of items reached"),InputProps:{startAdornment:null!==d?(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:d}):null}}),S?(0,l.jsx)(O.A,{sx:{ml:2},type:"submit",children:(0,l.jsx)(eF.A,{})}):null]})})]})]})})},tI=e=>{var t,n,i,a,c,d,x,h,p,f;let{field:A,section:y,srcFields:j=[],actionEdit:S=async()=>{},showInfo:v=!1}=e,{i18n:C}=(0,r.B)(),w=(0,I.A)(),b=(0,m.useRef)(!0),T=(0,m.useRef)(null),R=(0,m.useRef)(null),M=(0,m.useRef)(null),k=(0,m.useRef)(null),N=(0,m.useRef)(null),F=(0,m.useRef)(null),P=(0,m.useRef)(null),E=(0,m.useRef)(null),U=(0,m.useRef)(null),O=(0,m.useRef)(null),L=(0,m.useRef)(null),W=(0,m.useRef)(null),H=(0,m.useRef)(null),V=(0,m.useRef)(null),[$,Y]=(0,m.useState)(null!=(t=null==A?void 0:A.type)?t:"string"),[q,G]=(0,m.useState)(null!=(n=null==A?void 0:A.name)?n:""),[X,J]=(0,m.useState)(null!=(i=null==A?void 0:A.desc)?i:""),[Q,Z]=(0,m.useState)(Array.isArray(null==A?void 0:A.extensions)?A.extensions:["txt"]),[ee,et]=(0,m.useState)(null!=(a=null==A?void 0:A.options)?a:[]),[en,el]=(0,m.useState)(null!=(c=null==A?void 0:A.default)?c:null),[ei,er]=(0,m.useState)(null!=(d=null==A?void 0:A.depends)?d:null),[es,ea]=(0,m.useState)(null!=(x=null==A?void 0:A.columns)?x:[]),[eu,ed]=(0,m.useState)(null!=(h=null==A?void 0:A.isList)?h:null),[ex,eh]=(0,m.useState)(null!=(p=null==A?void 0:A.min)?p:null),[ep,em]=(0,m.useState)(null!=(f=null==A?void 0:A.max)?f:null),ef=(s.ModuleSrc.K_SRC_INPUTS===y&&Array.isArray(j)?j:[]).filter(e=>"boolean"===e.type).map(e=>e.key),ej=e=>{for(e="".concat(null!=e?e:"").trim().substring(0,u().max.sourceCode.ioFieldNameLength);!(e.length>0);)e="".concat($," ").concat(s.ModuleSrc.K_SRC_INPUTS===y?"input":"output");return null!==W.current&&(W.current.value=e),e},eS=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==R.current&&window.clearTimeout(R.current),R.current=window.setTimeout(()=>{!(e=eb($,"int"===$?parseInt(e,10):"string"==typeof e?e:null,!1))&&Array.isArray(ee)&&ee.length&&(e=ee[0]),el(e),null!==E.current&&(E.current.value=null!=e?e:""),R.current=null},t)},ev=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==N.current&&window.clearTimeout(N.current),N.current=window.setTimeout(()=>{ed(e=!!parseInt(e,10)),null!==O.current&&(O.current.value=e),N.current=null},t)},eC=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==M.current&&window.clearTimeout(M.current),M.current=window.setTimeout(()=>{ef.includes(e)||(e=null),er(e),null!==U.current&&(U.current.value=e),M.current=null},t)},ew=(e,t)=>{null!==k.current&&window.clearTimeout(k.current),k.current=window.setTimeout(()=>{e=parseInt(e,10),t=parseInt(t,10),Number.isInteger(e)||(e=null),Number.isInteger(t)||(t=null),["files","string"].includes($)&&(e<=0&&(e=null),t<=0&&(t=null)),null!==e&&null!==t&&t<e&&(t=e),"string"===$&&((null===t||t>u().max.sourceCode.ioFieldStringLength)&&(t=u().max.sourceCode.ioFieldStringLength),Array.isArray(ee)&&ee.length&&t>u().max.sourceCode.ioFieldOptionLength&&(t=u().max.sourceCode.ioFieldOptionLength),e>t&&(e=null)),eh(e),null!==H.current&&(H.current.value=e),em(t),null!==V.current&&(V.current.value=t),k.current=null},250)};(0,m.useEffect)(()=>{b.current||et([])},[$]),(0,m.useEffect)(()=>{!b.current&&(ew(ex,ep),Array.isArray(ee)&&ee.map(e=>"".concat(e)).includes("".concat(en))||eS(""))},[ee]),(0,m.useEffect)(()=>{let e=window.setTimeout(async()=>{G(ej(q)),await S(null==A?void 0:A.id,{fieldType:$,fieldName:q,fieldDesc:X,fieldExts:Q,fieldOptions:ee,fieldDefault:en,fieldDepends:ei,fieldColumns:es,fieldIsList:eu,fieldMin:ex,fieldMax:ep},b.current),b.current&&(b.current=!1)},450);return()=>window.clearTimeout(e)},[$,q,X,Q,ee,en,ei,es,eu,ex,ep]);let eb=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],l=null;do{if("int"===e){if(!Number.isInteger(t)){n&&K.o.error(C.t("Not a valid integer"));break}if(Number.isInteger(ex)&&t<ex){n&&K.o.error(C.t("Integer cannot be smaller than {{fieldMin}}",{fieldMin:ex}));break}if(Number.isInteger(ep)&&t>ep){n&&K.o.error(C.t("Integer cannot be greater than {{fieldMax}}",{fieldMax:ep}));break}}else{if("string"!=typeof t){n&&K.o.error(C.t("Not a valid string"));break}let e=(t=t.trim()).length;if(e||(t=null),Number.isInteger(ex)&&e<ex){n&&K.o.error(C.t("String cannot be shorter than {{fieldMin}} characters",{fieldMin:ex}));break}if(Number.isInteger(ep)&&e>ep){n&&K.o.error(C.t("String cannot be longer than {{fieldMax}} characters",{fieldMax:ep}));break}}l=t}while(!1);return l},eI=e2(C),e_="table"===$?"Row":(0,eH.TF)($),eT="table"===$?"Object":$,eR=s.ModuleSrc.K_SRC_INPUTS===y?"".concat("table"===$?"await ":"","$.ioInput").concat(e_,'("').concat(null==A?void 0:A.key,'"): ').concat("files"===$?"string[] - File paths":"".concat(eT).concat(["int","string"].includes($)&&eu&&ee.length>1?"[]":"","|null")):"files"===$?'await $.ioSave*("'.concat(null==A?void 0:A.key,'"): string - File path'):"await $.ioOutput".concat(e_,'("').concat(null==A?void 0:A.key,'", ').concat(eT,"): boolean");return(0,l.jsxs)(g.A,{sx:{background:w.palette.background.paper,flexDirection:"column",display:"flex",width:"100%",zIndex:10,flexShrink:0,flexGrow:0,p:3},children:[v?(0,l.jsxs)(B.A,{severity:"info",sx:{mb:2},children:[(0,l.jsx)(z.A,{variant:"caption",color:"inherit",children:s.ModuleSrc.K_SRC_INPUTS===y?C.t("Get this input"):C.t("Set this output")}),": ",(0,l.jsx)(z.A,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:eR})]}):null,(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:2},children:(0,l.jsx)(_.A,{placement:"left",title:C.t("Maximum length: {{len}} characters",{len:u().max.sourceCode.ioFieldNameLength}),children:(0,l.jsx)(ey.A,{fullWidth:!0,label:s.ModuleSrc.K_SRC_INPUTS===y?C.t("Input name"):C.t("Output name"),required:!0,defaultValue:q,inputRef:W,onChange:e=>{var t;return t=e.target.value,void(null!==F.current&&window.clearTimeout(F.current),F.current=window.setTimeout(()=>{G(ej(t)),F.current=null},1e3))},inputProps:{maxLength:u().max.sourceCode.ioFieldNameLength},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(tm.A,{fontSize:"small"})})}})})}),(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,l.jsx)(_.A,{placement:"left",title:C.t("Maximum length: {{len}} characters",{len:u().max.sourceCode.ioFieldDescLength}),children:(0,l.jsx)(ey.A,{fullWidth:!0,multiline:!0,minRows:1,maxRows:5,label:s.ModuleSrc.K_SRC_INPUTS===y?C.t("Input description"):C.t("Output description"),defaultValue:X,onChange:e=>{var t;return t=e.target.value,void(null!==P.current&&window.clearTimeout(P.current),P.current=window.setTimeout(()=>{J("".concat(t).trim().substring(0,u().max.sourceCode.ioFieldDescLength)),P.current=null},1e3))},inputProps:{maxLength:u().max.sourceCode.ioFieldDescLength,style:{paddingTop:0,paddingBottom:0}},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(ec.A,{fontSize:"small"})})}})})}),(0,l.jsxs)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,l.jsxs)(eA.A,{fullWidth:!0,children:[(0,l.jsxs)(td.A,{sx:{px:2,background:w.palette.background.paper,ml:-1},children:[s.ModuleSrc.K_SRC_INPUTS===y?C.t("Input type"):C.t("Output type")," "]}),(0,l.jsx)(eo.A,{value:$,required:!0,onChange:e=>(e=>{if("table"!==$&&"table"===e&&j.filter(e=>"table"===e.type).length>=u().max.sourceCode.ioFieldTableCount)return void K.o.error(C.t("Cannot use more than {{ioFieldTableCount}} tables",{ioFieldTableCount:u().max.sourceCode.ioFieldTableCount}));Y(e)})(e.target.value),fullWidth:!0,children:eI.map(e=>{let{value:t,label:n,Icon:i}=e;return(0,l.jsx)(D.A,{value:t,children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[i?(0,l.jsx)(i,{fontSize:"small",sx:{mr:5}}):null,n||""]})},t)})})]}),"files"===$?(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",ml:2},children:(0,l.jsx)(_.A,{placement:"left",title:C.t("Comma-separated list of accepted extensions"),children:(0,l.jsx)(ey.A,{fullWidth:!0,required:!0,label:C.t("File extensions"),defaultValue:Array.isArray(Q)?Q.join(", "):"txt",inputRef:L,placeholder:C.t("File extensions"),onChange:e=>{var t;return t=e.target.value,void(null!==T.current&&window.clearTimeout(T.current),T.current=window.setTimeout(()=>{let e=[...new Set("".concat(t).split(",").map(e=>(0,o.Pt)(e,u().max.sourceCode.ioFieldExtensionLength)).filter(e=>e.length>0))].slice(0,u().max.sourceCode.ioFieldExtensionCount);e.length||(e=["txt"]),Z(e),null!==L.current&&(L.current.value=e.join(", ")),T.current=null},1e3))},inputProps:{maxLength:(u().max.sourceCode.ioFieldExtensionLength+2)*u().max.sourceCode.ioFieldExtensionCount},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(ty.A,{fontSize:"small"})})}})})}):null]}),["string","int","files"].includes($)?(0,l.jsxs)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,l.jsx)(ey.A,{fullWidth:!0,defaultValue:ex,inputRef:H,type:"number",inputMode:"numeric",label:"files"===$?C.t("Minimum file size (MB)"):"int"===$?C.t("Minimum value"):C.t("Minimum length"),onChange:e=>ew(e.target.value,ep),inputProps:{min:["files","string"].includes($)?0:null,max:"string"===$?Array.isArray(ee)&&ee.length?u().max.sourceCode.ioFieldOptionLength:u().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:"files"===$?(0,l.jsx)(tv.A,{fontSize:"small"}):"int"===$?(0,l.jsx)(tp.A,{fontSize:"small"}):(0,l.jsx)(tj.A,{fontSize:"small"})})}}),(0,l.jsx)(ey.A,{sx:{ml:2},fullWidth:!0,defaultValue:ep,inputRef:V,type:"number",inputMode:"numeric",label:"files"===$?C.t("Maximum file size (MB)"):"int"===$?C.t("Maximum value"):C.t("Maximum length"),onChange:e=>ew(ex,e.target.value),inputProps:{min:["files","string"].includes($)?0:null,max:"string"===$?Array.isArray(ee)&&ee.length?u().max.sourceCode.ioFieldOptionLength:u().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:"files"===$?(0,l.jsx)(tC.A,{fontSize:"small"}):"int"===$?(0,l.jsx)(tg.A,{fontSize:"small"}):(0,l.jsx)(tS.A,{fontSize:"small"})})}})]}):null,s.ModuleSrc.K_SRC_INPUTS===y&&["string","int"].includes($)?(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:Array.isArray(ee)&&ee.length?(0,l.jsxs)(eA.A,{fullWidth:!0,children:[(0,l.jsx)(td.A,{sx:{px:2,background:w.palette.background.paper,ml:-1},children:C.t("Default value")}),(0,l.jsxs)(eo.A,{label:C.t("Default value"),inputRef:E,value:null!=en?en:"",onChange:e=>{var t;return eS("".concat(null!=(t=e.target.value)?t:""))},fullWidth:!0,children:[(0,l.jsx)(D.A,{value:null,children:(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,l.jsx)(z.A,{variant:"caption",children:C.t("No default value")})})}),ee.map(e=>(0,l.jsx)(D.A,{value:e,children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,l.jsx)(th.A,{fontSize:"small",sx:{mr:5}}),e]})},e))]})]}):(0,l.jsx)(ey.A,{fullWidth:!0,inputRef:E,label:C.t("Default value"),defaultValue:null!=en?en:"",onChange:e=>{var t;return eS("".concat(null!=(t=e.target.value)?t:""),1e3)},inputProps:{..."int"===$?{min:ex,max:ep}:{minLength:ex,maxLength:ep}},type:"int"===$?"number":"string",inputMode:"int"===$?"numeric":"text",InputProps:{startAdornment:(0,l.jsx)(eg.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(th.A,{fontSize:"small"})})}})}):null,s.ModuleSrc.K_SRC_INPUTS===y&&["string","int"].includes($)&&Array.isArray(ee)&&ee.length>1?(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,l.jsxs)(eA.A,{fullWidth:!0,children:[(0,l.jsx)(td.A,{sx:{px:2,background:w.palette.background.paper,ml:-1},children:C.t("Input format")}),(0,l.jsxs)(eo.A,{label:C.t("Input format"),inputRef:O,value:eu?"1":"0",onChange:e=>{var t;return ev("".concat(null!=(t=e.target.value)?t:0))},fullWidth:!0,children:[(0,l.jsx)(D.A,{value:"0",children:(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,l.jsx)(z.A,{variant:"caption",children:C.t("Single: user selects a string")})})}),(0,l.jsx)(D.A,{value:"1",children:(0,l.jsx)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,l.jsx)(z.A,{variant:"caption",children:C.t("List: user selects an array of strings")})})})]})]})}):null,s.ModuleSrc.K_SRC_INPUTS===y&&["string","int"].includes($)?(0,l.jsx)(tb,{sx:{mt:4},items:ee,setItems:et,sanitize:e=>eb($,e),label:C.t("Input options - ommit if users can set any value"),placeholder:C.t("Option value"),adornment:(0,l.jsx)(tf.A,{fontSize:"small"}),inputProps:{..."int"===$?{min:ex,max:ep}:{minLength:ex,maxLength:Math.min(null!=ep?ep:u().max.sourceCode.ioFieldOptionLength,u().max.sourceCode.ioFieldOptionLength)}},maxLength:u().max.sourceCode.ioFieldOptionLength,maxCount:u().max.sourceCode.ioFieldOptionCount,maxCountToast:C.t("Cannot add more than {{n}} options",{n:u().max.sourceCode.ioFieldOptionCount}),numeric:"int"===$}):null,"table"===$?(0,l.jsx)(tb,{sx:{mt:4},items:es,setItems:ea,sanitize:e=>(0,o.Pt)(e,u().max.sourceCode.ioFieldColumnLength),label:C.t("Table columns *"),placeholder:C.t("Table column name"),placeholderMax:C.t("Maximum number of columns reached"),tooltip:C.t("Total number of columns"),adornment:(0,l.jsx)(tx.A,{fontSize:"small"}),maxLength:u().max.sourceCode.ioFieldColumnLength,maxCount:u().max.sourceCode.ioFieldColumnCount,maxCountToast:C.t("Cannot add more than {{n}} table columns",{n:u().max.sourceCode.ioFieldColumnCount})}):null,s.ModuleSrc.K_SRC_INPUTS===y&&"boolean"!==$?(0,l.jsx)(g.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,l.jsx)(_.A,{placement:"left",title:C.t("Show field only if this boolean is set to true"),children:(0,l.jsxs)(eA.A,{fullWidth:!0,children:[(0,l.jsx)(td.A,{sx:{px:2,background:w.palette.background.paper,ml:-1},children:C.t("Dependency")}),(0,l.jsxs)(eo.A,{label:C.t("Dependency"),inputRef:U,value:null!=ei?ei:"",onChange:e=>{var t;return eC("".concat(null!=(t=e.target.value)?t:""))},fullWidth:!0,children:[(0,l.jsx)(D.A,{value:null,children:(0,l.jsx)(z.A,{variant:"caption",children:C.t("No dependency - field is always shown")})}),ef.map(e=>(0,l.jsx)(D.A,{value:e,children:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,l.jsx)(tA.A,{fontSize:"small",sx:{mr:5}}),e]})},e))]})]})})}):null]})};var t_=n(75359);let tT=(0,b.Ay)(tn.A)(e=>{let{theme:t}=e;return{height:"50px",minHeight:"50px",paddingRight:0,paddingLeft:0,marginRight:t.spacing(1),"&:hover .close":{opacity:1}}}),tR=(0,b.Ay)("span")(e=>{let{theme:t}=e;return{lineHeight:1.5,fontSize:"0.75rem",textTransform:"none",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"125px",[t.breakpoints.down("md")]:{display:"none"}}}),tM=(0,b.Ay)(g.A)(e=>{let{theme:t}=e;return{height:"50px",position:"relative",display:"flex",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"space-between",paddingLeft:t.spacing(1),paddingRight:t.spacing(1)}}),tk=(0,b.Ay)(g.A)(e=>{let{theme:t}=e;return{position:"absolute",overflowY:"auto",height:"100%",width:"100%",zIndex:1,right:0,top:0}}),tN=e=>{let{src:t={},icons:n=[],agent:o,loaded:a=!1}=e,{getSource:c,setSource:d,setSourceModified:x,setSceTabs:h,getSceTabs:p,onSceTabs:f}=(0,i.P)(),{i18n:A}=(0,r.B)(),y=(0,I.A)(),[j,S]=(0,m.useState)(!1),[v,C]=(0,m.useState)([]),[b,T]=(0,m.useState)(null);(0,m.useEffect)(()=>{C(p().tabs),T(p().tabsIndex);let e=f(e=>{let{tabs:t,tabsIndex:n}=e;C(t),T(n)});return()=>{e()}},[o]);let R=async function(e,t,n){let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=await c(o.id);null!==i&&Array.isArray(i[e])&&"string"==typeof t&&(i[e]=i[e].map(e=>(e.id===t&&(e.code=n),e)),d(o.id,i),l||x(o.id))},M=async function(e,t,n){let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=await c(o.id),{fieldType:r,fieldName:a,fieldDesc:u,fieldExts:h,fieldOptions:p,fieldDefault:m,fieldDepends:f,fieldColumns:g,fieldIsList:A,fieldMin:y,fieldMax:j}=n;"string"==typeof t&&null!==i&&Array.isArray(i[e])&&(i[e]=i[e].map(n=>{if(n.id===t)switch(n={id:t,key:n.key,type:r,name:a,desc:u},"boolean"!==r&&s.ModuleSrc.K_SRC_INPUTS===e&&(n.depends=f),r){case"string":case"int":n.min=y,n.max=j,s.ModuleSrc.K_SRC_INPUTS===e&&(n.options=Array.isArray(p)&&p.length?p:null,n.default=m,n.isList=Array.isArray(p)&&p.length>1?!!A:null);break;case"files":n.min=y,n.max=j,n.extensions=Array.isArray(h)?h:["txt"];break;case"table":n.columns=g}for(let e of Object.keys(n))null===n[e]&&delete n[e];return n}),d(o.id,i),l||x(o.id))},k=async e=>{let t=await c(o.id);if(Array.isArray(t[s.ModuleSrc.K_SRC_FUNCTIONS])){let n=t[s.ModuleSrc.K_SRC_FUNCTIONS].reduce((t,n)=>n.key===e?n.id:t,null);"string"==typeof n?h(s.ModuleSrc.K_SRC_FUNCTIONS,n):K.o.error(A.t('Function "{{fn}}" does not exist',{fn:e}))}},N=null,F=(Array.isArray(v)?structuredClone(v):[]).map((e,n)=>(e.item=(null!==t&&Array.isArray(t[e.section])?t[e.section]:[]).reduce((t,n)=>e.id===n.id?n:t,null),e.selected=b===n,e.selected&&(N="".concat(e.section,"-").concat(e.id)),e)).filter(e=>null!==e.item);return(0,l.jsxs)(g.A,{sx:{width:"calc(100% - 350px)",height:"100vh",display:"flex",flexDirection:"column"},children:[(0,l.jsx)(tM,{sx:{boxShadow:F.length?"0px -1px 0px 0px ".concat((0,w.A)(y)," inset"):null},children:F.length&&"string"==typeof N?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(tl.Ay,{value:N,children:(0,l.jsx)(ti.A,{variant:"scrollable",sx:{"& .MuiTabs-indicator":{borderRadius:"5px",marginBottom:"4px",height:"4px"},height:"50px",width:"100%"},children:F.map(e=>{var t,i;let r="".concat(e.section,"-").concat(e.id),o=n.reduce((t,n)=>e.section===n.key?n.Icon:t,null),s=n.reduce((t,n)=>e.section===n.key?n.label:t,null);return(0,l.jsx)(tT,{icon:(0,l.jsx)(o,{fontSize:"small",sx:{ml:2}}),iconPosition:"start",onClick:()=>h(e.section,e.id),value:r,label:(0,l.jsxs)(g.A,{sx:{display:"flex",alignItems:"center",px:1,"& .close":{opacity:0},"&:hover .close":{opacity:1}},children:[(0,l.jsx)(_.A,{title:"".concat(s," / ").concat(null==(t=e.item)?void 0:t.key),arrow:!0,enterDelay:750,enterNextDelay:750,placement:"bottom",children:(0,l.jsx)(tR,{children:null==(i=e.item)?void 0:i.key})}),(0,l.jsx)(g.A,{className:"close",sx:{ml:2,cursor:"pointer",opacity:.2,display:"flex"},onClick:t=>{t.stopPropagation(),h(e.section,e.id,!1)},children:(0,l.jsx)(tr.A,{fontSize:"small",color:"action"})})]})},r)})})}),(0,l.jsx)(_.A,{title:A.t("Toggle hints"),placement:"left",children:(0,l.jsx)(O.A,{"aria-label":A.t("More information"),color:"default",onClick:()=>S(!j),size:"small",children:j?(0,l.jsx)(J.A,{fontSize:"small"}):(0,l.jsx)(V.A,{fontSize:"small"})})})]}):null}),(0,l.jsx)(g.A,{sx:{position:"relative",width:"100%",height:"100%",background:a&&F.length?y.palette.background.paper:null},children:a&&F.length?F.map(e=>{var n;return(0,l.jsxs)(tk,{sx:{zIndex:e.selected?10:-1},children:[[s.ModuleSrc.K_SRC_STATE_MACHINE,s.ModuleSrc.K_SRC_FUNCTIONS].includes(e.section)?(0,l.jsx)(tu,{code:null==(n=e.item)?void 0:n.code,section:e.section,item:e.item,id:e.id,onFnClick:k,maxLength:u().max.sourceCode.smCodeLength,actionEdit:(t,n)=>R(e.section,e.id,t,n),showInfo:j}):null,[s.ModuleSrc.K_SRC_INPUTS,s.ModuleSrc.K_SRC_OUTPUTS].includes(e.section)?(0,l.jsx)(tI,{field:e.item,section:e.section,srcFields:((e,t)=>"object"==typeof e&&null!==e&&Array.isArray(e[t])?e[t]:[])(t,e.section),actionEdit:(t,n,l)=>{M(e.section,t,n,l)},showInfo:j}):null]},"".concat(e.section,"-").concat(e.id))}):(0,l.jsx)(g.A,{sx:{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},children:(0,l.jsx)(t_.A,{grey:!0,size:192,sx:{opacity:.1}})})})]})},tF=e=>{let t={};for(let n of Object.values(s.ModuleSrc)){if(t[n]=[],"object"!=typeof e||null===e||!Array.isArray(e[n]))continue;let l={};switch(n){case s.ModuleSrc.K_SRC_STATE_MACHINE:for(let t of e.srcStateMachine)if("string"==typeof(null==t?void 0:t.code))for(let e of[...t.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\breturn\s+\{\s*([^{}]+)\s*\}/g)]){let t=e[1].match(/['"]?next['"]?\s*:\s*"([\w\.\-]+)"/);t&&(l[t[1]]=!0)}break;case s.ModuleSrc.K_SRC_INPUTS:for(let t of[s.ModuleSrc.K_SRC_STATE_MACHINE,s.ModuleSrc.K_SRC_FUNCTIONS])for(let n of e[t])if("string"==typeof(null==n?void 0:n.code))for(let e of[...n.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.ioInput\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi)])l[e[1]]=!0;break;case s.ModuleSrc.K_SRC_OUTPUTS:for(let t of[s.ModuleSrc.K_SRC_STATE_MACHINE,s.ModuleSrc.K_SRC_FUNCTIONS])for(let n of e[t])if("string"==typeof(null==n?void 0:n.code))for(let e of[...n.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.io(?:Output|Save)\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi)])l[e[1]]=!0;break;case s.ModuleSrc.K_SRC_FUNCTIONS:for(let t of[s.ModuleSrc.K_SRC_STATE_MACHINE,s.ModuleSrc.K_SRC_FUNCTIONS])for(let n of e[t])if("string"==typeof(null==n?void 0:n.code))for(let e of[...n.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.fn\s*\([^\w\.\-]*([\w\.\-]+)/g)])l[e[1]]=!0}t[n]=(s.ModuleSrc.K_SRC_STATE_MACHINE===n?e.srcStateMachine.slice(1):e[n]).map(e=>e.key).filter(e=>"string"==typeof e&&void 0===l[e])}return t},tK=()=>{var e;let t="".concat(null==(e=window.sdk)?void 0:e.ibc.winName).replace(/^@source\//,""),{setAgentId:n,setPageTitle:o,setPageSubtitle:a,getSource:c,setSource:u,onSource:d,onSourceModified:x,getSourceModified:w,setSourceModified:b,setSourceOrphans:I,onSceItemAdd:_}=(0,i.P)(),{i18n:T}=(0,r.B)(),[R,M]=(0,m.useState)(!1),[k,F]=(0,m.useState)(!1),[K,P]=(0,m.useState)(null),[E,U]=(0,m.useState)(null),[O,z]=(0,m.useState)({});(0,m.useEffect)(()=>{var e,l,i;n(t),null==(e=window.sdk)||e.ibc.send(p.A.ibc.WINDOW_MAIN,"ibc-source:open",[!0]),window.addEventListener("beforeunload",function(e){var n;null==(n=window.sdk)||n.ibc.send(p.A.ibc.WINDOW_MAIN,"ipc:disk-storage:agents:commit",[t])}),null==(l=window.sdk)||l.ibc.handle("ibc-main:module-repo:data",e=>{var n;"object"==typeof(null==e?void 0:e.agentData)&&(null==(n=e.agentData)?void 0:n.id)===t&&(U(e.agentData),"object"==typeof e.moduleData&&P(e.moduleData),"object"==typeof e.sourceCode&&u(t,e.sourceCode,!1))}),null==(i=window.sdk)||i.ibc.handle("ibc-main:agent:data",e=>{"object"==typeof e&&null!==e&&U({...e})}),(async()=>{var e,n,l;let i=null;try{let n=await f.A.get("agents"),l=Array.isArray(n.data)?n.data.reduce((e,n)=>(null==n?void 0:n.id)===t?n:e,null):null;if(U(l),"string"==typeof(null==l?void 0:l.installedModuleId)){i=l.installedModuleId;let t=await f.A.get("modules/".concat(i));"string"==typeof(null==(e=t.data)?void 0:e.id)&&P(t.data)}}catch(e){404===(null==(n=e.response)?void 0:n.status)&&"string"==typeof i&&(null==(l=window.sdk)||l.ibc.send(p.A.ibc.WINDOW_MAIN,"ibc-source:module:purge",[i]))}M(w(t))})();let r=x(e=>{let{agentId:n,modified:l}=e;n===t&&M(l)});return()=>r()},[]),(0,m.useEffect)(()=>{var e;o(null!==E?"".concat(null!=(e=E.name)?e:""):null),(async()=>{if("string"==typeof(null==E?void 0:E.id)){let e=await c(E.id,!0);z(null!=e?e:{}),I(E.id,tF(null!=e?e:"")),F(!0)}})();let t=d(e=>{let{agentId:t,sourceCode:n}=e;t===(null==E?void 0:E.id)&&(z(n),I(t,tF(n)))});return()=>t()},[E]),(0,m.useEffect)(()=>{let e=_(e=>{let{section:t,key:n}=e;"string"==typeof(null==E?void 0:E.id)&&h(E.id,O,t,n,u,b)});return()=>e()},[null==E?void 0:E.id,O]),(0,m.useEffect)(()=>{a((R?"â ":"")+T.t("Source code"))},[R]);let D=[{key:s.ModuleSrc.K_SRC_STATE_MACHINE,label:T.t("Finite-state machine"),Icon:v.A},{key:s.ModuleSrc.K_SRC_FUNCTIONS,label:T.t("Functions"),Icon:y.A},{key:s.ModuleSrc.K_SRC_INPUTS,label:T.t("Inputs"),Icon:j.A},{key:s.ModuleSrc.K_SRC_OUTPUTS,label:T.t("Outputs"),Icon:A.A},{key:"search",label:T.t("Search"),Icon:C.A},{key:"source-control",label:T.t("Source control"),Icon:S.A}];return(0,l.jsxs)(g.A,{sx:{display:"flex",width:"100%",height:"100%"},children:[(0,l.jsx)(N,{icons:D,agent:E,loaded:k}),(0,l.jsx)(tt,{src:O,icons:D,agent:E,updateAgent:e=>{if("string"==typeof(null==e?void 0:e.id)){var t;let n=structuredClone(e);delete n.moduleReleases,U(n),null==(t=window.sdk)||t.ibc.send(p.A.ibc.WINDOW_MAIN,"ibc-source:agent:data",[n])}},updateModule:(e,n)=>{if("string"==typeof(null==e?void 0:e.id)){var l;P(structuredClone(e)),null==(l=window.sdk)||l.ibc.send(p.A.ibc.WINDOW_MAIN,"ibc-source:module:installed",[t,e,n])}},loaded:k,setLoaded:F,module:K}),(0,l.jsx)(tN,{src:O,icons:D,agent:E,loaded:k})]})};tK.guestGuard=!0;let tP=tK},86529:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/source-code",function(){return n(83366)}])}},e=>{e.O(0,[894,573,853,864,338,636,593,792],()=>e(e.s=86529)),_N_E=e.O()}]);