/*!
 * @architect Mark Jivko <mark@oglama.com>
 * @copyright Â© 2024-2025 Oglama (https://oglama.com)
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[373],{25877:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/source-code",function(){return t(64944)}])},64944:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Xn}});var i=t(47568),r=t(26042),o=t(29815),l=t(97582),a=t(85893),s=t(67817),u=t(77058),c=t(14924),d=t(758),f=t(5082),h=t(74595),p=t(65782),x=t.n(p),m=function(e){var n,t;return null!==(t=(n={},(0,c.Z)(n,f.ModuleSrc.K_SRC_FUNCTIONS,"function"),(0,c.Z)(n,f.ModuleSrc.K_SRC_INPUTS,"input"),(0,c.Z)(n,f.ModuleSrc.K_SRC_OUTPUTS,"output"),(0,c.Z)(n,f.ModuleSrc.K_SRC_STATE_MACHINE,"state"),n)[e])&&void 0!==t?t:"state"},v=function(e,n,t,i){t=(0,d.W)(t);for(var r=(Array.isArray(n)?n:[]).filter((function(e){return(null===e||void 0===e?void 0:e.id)!==i})).map((function(e){return null===e||void 0===e?void 0:e.key})),o=1;;){if(t.length>0&&!r.includes(t))break;if(!r.length&&f.ModuleSrc.K_SRC_STATE_MACHINE===e){t="start";break}t="".concat(m(e),"-").concat(o++)}return t},g=function(){var e=(0,i.Z)((function(e,n,t){var i,r,o,a,s,u,d,p,g,y=arguments;return(0,l.__generator)(this,(function(l){if(i=y.length>3&&void 0!==y[3]?y[3]:null,r=y.length>4&&void 0!==y[4]?y[4]:function(){},o=y.length>5&&void 0!==y[5]?y[5]:function(){},"string"!==typeof e||"string"!==typeof t)return[2];if("object"!==typeof n||null===n||!Array.isArray(n[t]))return[2];if(a=n[t],s={},(0,c.Z)(s,f.ModuleSrc.K_SRC_FUNCTIONS,x().max.sourceCode.fnCount),(0,c.Z)(s,f.ModuleSrc.K_SRC_INPUTS,x().max.sourceCode.ioCount),(0,c.Z)(s,f.ModuleSrc.K_SRC_OUTPUTS,x().max.sourceCode.ioCount),(0,c.Z)(s,f.ModuleSrc.K_SRC_STATE_MACHINE,x().max.sourceCode.smCount),u=s,null!==(d=a.length>=u[t])&&void 0!==d?d:x().max.sourceCode.ioCount)return[2];switch(p=(0,h.H)(),g={id:p,key:v(t,a,i,p)},t){case f.ModuleSrc.K_SRC_FUNCTIONS:case f.ModuleSrc.K_SRC_STATE_MACHINE:g.code="";break;case f.ModuleSrc.K_SRC_INPUTS:case f.ModuleSrc.K_SRC_OUTPUTS:g.type="string",g.name="string ".concat(f.ModuleSrc.K_SRC_INPUTS===t?"input":"output"),g.desc="",g.max=x().max.sourceCode.ioFieldStringLength}return n[t].push(g),r(e,n),o(e),setTimeout((function(){var e=document.getElementById("".concat(m(t),"-").concat(p));null===e||void 0===e||e.focus(),null===e||void 0===e||e.click()}),250),[2]}))}));return function(n,t,i){return e.apply(this,arguments)}}(),y=t(32342),S=t(67294),j=t(87066),Z=t(80822),b=t(22455),C=t(46956),w=t(2279),I=t(40533),_=t(75562),M=t(69497),T=t(69604),k=t(90948),A=t(2734),R=t(34386),N=t(11057),F=t(23488),K=(0,k.ZP)(N.Z)((function(e){return{width:"50px",minWidth:"50px",height:"50px",borderRadius:0,position:"relative","&:before":{content:'""',display:"block",position:"absolute",top:"5px",left:"3px",borderRadius:"5px",width:"5px",height:"40px",background:"transparent",opacity:0,transform:"scaleY(0%)",transition:"transform 200ms linear"},"&.active:before":{background:e.theme.palette.primary.main,transform:"scaleY(100%)",opacity:1}}})),P=(0,k.ZP)(F.Z)((function(e){e.theme;return{position:"absolute",right:"5px",bottom:"5px"}})),O=function(e){var n=e.icons,t=void 0===n?[]:n,i=e.agent,r=e.loaded,o=void 0!==r&&r,l=(0,A.Z)(),u=(0,s.O)(),c=u.getSourceModified,d=u.onSourceModified,h=u.getSourceOrphans,p=u.onSourceOrphans,x=u.getSceSection,m=u.setSceSection,v=u.onSceSection,g=(0,S.useState)(f.ModuleSrc.K_SRC_STATE_MACHINE),y=g[0],j=g[1],b=(0,S.useState)(!1),C=b[0],w=b[1],I=(0,S.useState)({}),_=I[0],M=I[1],k="1px 0px 0px 0px ".concat((0,T.k)(l));return(0,S.useEffect)((function(){if(null!==i){"string"===typeof(null===i||void 0===i?void 0:i.id)&&M(h(i.id));var e=p((function(e){var n=e.agentId,t=e.orphans;n===(null===i||void 0===i?void 0:i.id)&&M(t)}));w(c(i.id));var n=d((function(e){var n=e.agentId,t=e.modified;n===i.id&&w(t)}));j(x());var t=v((function(e){var n=e.section;j(n)}));return function(){n(),e(),t()}}}),[i]),(0,a.jsx)(Z.Z,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"50px",boxShadow:k},children:t.map((function(e){var n=e.key,t=e.label,i=e.Icon,r=n===y,l=null;do{if("source-control"===n&&C){l=(0,a.jsx)(P,{color:o?"primary":"disabled"});break}if(Array.isArray(_[n])&&_[n].length){l=(0,a.jsx)(P,{color:o?"warning":"disabled"});break}}while(0);return(0,a.jsx)(R.Z,{title:t||"",placement:"right",enterDelay:500,enterNextDelay:500,children:(0,a.jsx)(Z.Z,{sx:{width:"50px",height:"50px"},children:(0,a.jsxs)(K,{className:r?"active":"",disabled:!o,color:"inherit",onClick:function(){return m(n)},children:[i?(0,a.jsx)(i,{fontSize:"medium",color:r?"inherit":"action"}):null,l]})})},n)}))})},E=t(20214),U=t(5097),z=t(31425),D=t(6514),L=t(37645),W=t(93946),H=t(15861),$=t(23599),B=t(50657),V=t(72852),Y=t(46901),q=t(38333),G=t(74496),X=t(74017),Q=t(1431),J=t(29691),ee=t(21489),ne=t(46160),te=t(25577),ie=t(17785),re=t(34354),oe=t(11973),le=t(51397),ae=t(38047),se=t(59384),ue=t(14873),ce=t(18360),de=t(78981),fe=t(50874),he=t(42945),pe=t(22394),xe=t(48136);var me=t(47533),ve=t(87536),ge=t(74231),ye=t(56815),Se=t(87109),je=t(94054),Ze=t(50135),be=t(20811),Ce=t(42274),we=function(e){var n=e.isOpen,t=void 0!==n&&n,r=e.version,o=void 0===r?null:r,s=e.onOpen,c=void 0===s?function(){}:s,d=e.onClose,f=void 0===d?function(){}:d,h=e.onRelease,p=void 0===h?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):h,x=e.description,m=(0,u.$)().i18n,v=(0,S.useRef)(null),g=(0,S.useState)(!1),y=g[0],j=g[1],b=(0,S.useState)(!1),C=b[0],w=b[1],I="string"===typeof o?function(e){var n=e.split(".").map(Number);return n[n.length-1]++,n.join(".")}(o):"0.0.1",_={versionName:ge.Z_().required(m.t("Release version is required")).matches(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/,m.t("Version name must follow the x.y.z format with no leading zeros")).test("is-greater-or-equal",m.t("Version must be greater than or equal to {{v}}",{v:I}),(function(e){return e&&function(e,n){for(var t=e.split(".").map(Number),i=n.split(".").map(Number);t.length<i.length;)t.push(0);for(;i.length<t.length;)i.push(0);for(var r=0;r<t.length;r++){if(t[r]>i[r])return!0;if(t[r]<i[r])return!1}return!0}(e,I)})),changes:ge.Z_().max(512,(function(){return m.t("Must be at most {{n}} characters long",{n:512})}))},M={versionName:I,changes:""},T=(0,ve.cI)({defaultValues:M,mode:"onChange",resolver:(0,me.X)(ge.Ry().shape(_))}),k=T.reset,A=T.control,R=T.handleSubmit,F=T.formState.errors,K=function(){var e=(0,i.Z)((function(e){var n,t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return n=e.versionName,t=e.changes,w(!0),[4,p(n,t)];case 1:return i.sent(),w(!1),f(),[2]}}))}));return function(n){return e.apply(this,arguments)}}();(0,S.useEffect)((function(){t&&"function"===typeof c&&c()}),[t]);var P=function(){t&&"function"===typeof f&&f(),k()},O=function(){v.current&&v.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))};return t?(0,a.jsxs)(B.Z,{open:!0,onClose:C?function(){}:P,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[C?null:(0,a.jsx)(L.Z,{children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,a.jsx)(H.Z,{variant:"h4",sx:{ml:4},children:m.t("Publish a release")}),(0,a.jsx)(W.Z,{"aria-label":m.t("More information"),sx:{ml:2},color:"default",onClick:function(){return j(!y)},size:"large",children:y?(0,a.jsx)(te.Z,{}):(0,a.jsx)(G.Z,{})})]})}),(0,a.jsxs)(D.Z,{children:[!C&&x&&y?(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",children:x})}):null,!C&&y?(0,a.jsxs)(Y.Z,{severity:"warning",sx:{mb:6},children:[m.t("Please make sure you have tested your code thouroughly before releasing it!"),(0,a.jsx)("br",{}),m.t("New users and those who have enabled auto-update will instantly use this new version of your module.")]}):null,C?(0,a.jsx)(Z.Z,{sx:{mt:3},children:(0,a.jsx)(Ce.Z,{})}):(0,a.jsxs)("form",{onSubmit:R(K),ref:v,children:[(0,a.jsxs)(je.Z,{fullWidth:!0,sx:{my:3},error:!!F.versionName,children:[(0,a.jsx)(ve.Qr,{name:"versionName",control:A,render:function(e){var n=e.field,t=n.value,i=n.onChange;return(0,a.jsx)(Ze.Z,{disabled:C,autoFocus:!0,required:!0,value:t,onChange:i,onKeyDown:function(e){return"Enter"===e.key&&O()},spellCheck:!1,autoComplete:"off",inputProps:{minLength:3,maxLength:64,tabIndex:1},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{mr:-2},children:(0,a.jsx)(be.Z,{fontSize:"small"})})},label:m.t("Release version"),placeholder:I,error:Boolean(F.versionName)})}}),F.versionName&&(0,a.jsx)(ye.Z,{sx:{color:"error.main"},children:F.versionName.message})]}),(0,a.jsxs)(je.Z,{fullWidth:!0,sx:{my:3},error:!!F.changes,children:[(0,a.jsx)(ve.Qr,{name:"changes",control:A,render:function(e){var n=e.field,t=n.value,i=n.onChange;return(0,a.jsx)(Ze.Z,{multiline:!0,rows:2,value:t,onChange:i,spellCheck:!1,autoComplete:"off",inputProps:{maxLength:512,tabIndex:2},label:m.t("Release details"),placeholder:"string"===typeof o?m.t("Bug fixes and improvements in this version"):m.t("First release"),error:Boolean(F.changes)})}}),F.changes&&(0,a.jsx)(ye.Z,{sx:{color:"error.main"},children:F.changes.message})]})]})]}),C?null:(0,a.jsxs)(z.Z,{children:[(0,a.jsx)(N.Z,{color:"secondary",onClick:P,children:m.t("Cancel")}),(0,a.jsx)(N.Z,{variant:"contained",onClick:O,startIcon:(0,a.jsx)(de.Z,{}),children:m.t("Publish release")})]})]}):null},Ie=t(40876),_e=function(e){var n=e.isOpen,t=void 0!==n&&n,r=e.onOpen,o=void 0===r?function(){}:r,s=e.onClose,c=void 0===s?function(){}:s,d=e.onImport,f=void 0===d?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):d,h=e.description,p=(0,u.$)().i18n,x=(0,S.useState)(!1),m=x[0],v=x[1],g=(0,S.useState)(!1),y=g[0],j=g[1];(0,S.useEffect)((function(){t&&"function"===typeof o&&o()}),[t]);var b=function(){t&&"function"===typeof c&&c()};return t?(0,a.jsxs)(B.Z,{open:!0,onClose:y?function(){}:b,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[y?null:(0,a.jsx)(L.Z,{children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,a.jsx)(H.Z,{variant:"h4",sx:{ml:4},children:p.t("Import from YAML")}),(0,a.jsx)(W.Z,{"aria-label":p.t("More information"),sx:{ml:2},color:"default",onClick:function(){return v(!m)},size:"large",children:m?(0,a.jsx)(te.Z,{}):(0,a.jsx)(G.Z,{})})]})}),(0,a.jsxs)(D.Z,{children:[!y&&h&&m?(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",children:h})}):null,!y&&m?(0,a.jsx)(Y.Z,{severity:"warning",sx:{mb:6},children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",children:p.t("Warning! The imported source code will overwrite your current work.")})}):null,y?(0,a.jsx)(Z.Z,{sx:{mt:6},children:(0,a.jsx)(Ce.Z,{})}):(0,a.jsx)(Ie.Z,{maxSize:2,extensions:["yaml"],handleFiles:function(e){var n=Array.isArray(e)&&e.length?e[0]:null;if(n&&"string"===typeof(null===n||void 0===n?void 0:n.name)&&n.name.toLowerCase().endsWith(".oglama.yaml")){j(!0);var t=new FileReader;t.onload=function(){var e=(0,i.Z)((function(e){var n,t,i;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n=(0,ue.Qc)(e.target.result),[4,f(n)];case 1:return r.sent(),U.A.success(p.t("Source code imported successfully!")),b(),[3,3];case 2:return t=r.sent(),U.A.error("".concat(p.t("Import error"),": ").concat(null!==(i=t.message)&&void 0!==i?i:t),{duration:5e3,ariaProps:{role:"alert"}}),[3,3];case 3:return j(!1),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),t.readAsText(n)}else U.A.error(p.t("Invalid file extension, expected '.oglama.yaml'"),{duration:5e3,ariaProps:{role:"alert"}})}})]}),y?null:(0,a.jsx)(z.Z,{children:(0,a.jsx)(N.Z,{color:"secondary",onClick:b,children:p.t("Close")})})]}):null},Me=function(e){var n,t=e.isOpen,r=void 0!==t&&t,o=e.onClose,s=void 0===o?function(){}:o,c=e.moduleId,d=e.moduleSrcId,f=(0,u.$)().i18n,h=(0,S.useState)(null),p=h[0],x=h[1],m=(0,S.useState)(!0),v=m[0],g=m[1],y=function(){r&&"function"===typeof s&&s()};return(0,S.useEffect)((function(){g(!0),x(null),(0,i.Z)((function(){var e,n;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,j.Z.get("modules/".concat(c,"/src/").concat(d,"/meta"))];case 1:return n=t.sent(),"string"===typeof(null===(e=n.data)||void 0===e?void 0:e.id)&&x(n.data),[3,3];case 2:return t.sent(),[3,3];case 3:return g(!1),[2]}}))}))()}),[d]),r?(0,a.jsxs)(B.Z,{open:!0,onClose:v?function(){}:y,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[v?null:(0,a.jsx)(L.Z,{children:(0,a.jsx)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,a.jsx)(H.Z,{variant:"h4",sx:{ml:4},children:null!==(n=null===p||void 0===p?void 0:p.version)&&void 0!==n?n:f.t("Release not found")})})}),(0,a.jsx)(D.Z,{children:v?(0,a.jsx)(Ce.Z,{}):(0,a.jsx)(Y.Z,{color:"string"===typeof(null===p||void 0===p?void 0:p.changes)&&p.changes.length?"info":"warning",children:(0,a.jsx)(H.Z,{variant:"caption",component:"pre",sx:{color:"inherit",fontSize:"0.85rem",wordBreak:"break-all",whiteSpace:"preserve",fontFamily:"Yaldevi,sans-serif"},children:"string"===typeof(null===p||void 0===p?void 0:p.changes)&&p.changes.length?p.changes:f.t("No changes were documented for this release.")})})}),v?null:(0,a.jsx)(z.Z,{children:(0,a.jsx)(N.Z,{color:"secondary",onClick:y,children:f.t("Close")})})]}):null},Te=t(86822),ke=t(60848),Ae=(0,k.ZP)(N.Z)((function(e){var n=e.theme;return{justifyContent:"start",textTransform:"none","& > .MuiButton-icon":{marginLeft:n.spacing(.5),marginRight:n.spacing(3)},fontSize:"0.75rem",color:"inherit"}})),Re=function(e){var n,t,r,o,c,d=e.agent,h=e.module,p=e.updateAgent,x=void 0===p?function(){}:p,m=e.updateModule,v=void 0===m?function(){}:m,g=e.srcStateMachine,y=void 0===g?[]:g,b=e.srcModified,C=void 0!==b&&b,w=(e.loaded,e.setLoaded),I=void 0===w?function(){}:w,_=(0,s.O)(),M=_.getSource,T=_.setSource,k=_.setSourceModified,A=(0,u.$)().i18n,N=(0,E.a)(),F=(0,S.useState)(!1),K=F[0],P=F[1],O=(0,S.useState)(!1),U=O[0],z=O[1],D=(0,S.useState)(!1),L=D[0],B=D[1],V=(0,S.useState)(!1),Y=V[0],q=V[1],G=function(){var e=(0,i.Z)((function(){var e,n,t,i,r,o,a,s,u,c;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return"string"!==typeof(null===d||void 0===d?void 0:d.id)?[2]:[4,M(d.id,!0)];case 1:e=l.sent(),n=!0,t=!1,i=void 0;try{for(r=Object.values(f.ModuleSrc)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)a=o.value,e[a]=(Array.isArray(e[a])?e[a]:[]).map((function(e){return"object"===typeof e&&null!==e?(delete e.id,e):null})).filter((function(e){return null!==e}))}catch(p){t=!0,i=p}finally{try{n||null==r.return||r.return()}finally{if(t)throw i}}return s=(0,ue.Pz)(e,{lineWidth:0,aliasDuplicateObjects:!1,defaultStringType:"PLAIN"}),u=URL.createObjectURL(new Blob([s],{type:"application/x-yaml"})),(c=document.createElement("a")).download="".concat("".concat("string"===typeof(null===h||void 0===h?void 0:h.name)?h.name:d.name).replace(/\W+/gi,"-").toLowerCase(),".oglama.yaml"),c.href=u,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(u),[2]}}))}));return function(){return e.apply(this,arguments)}}(),X=function(){var e=(0,i.Z)((function(e){var n,t,i,r,o,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if("object"!==typeof e||null===e)throw new Error(A.t("Invalid YAML format"));n=!0,t=!1,i=void 0;try{for(r=Object.values(f.ModuleSrc)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)if(a=o.value,!Array.isArray(e[a]))throw new Error(A.t('Key "{{n}}" missing from source code YAML',{n:a}))}catch(s){t=!0,i=s}finally{try{n||null==r.return||r.return()}finally{if(t)throw i}}return T(d.id,e),k(d.id),I(!1),[4,new Promise((function(e){return window.setTimeout(e,500)}))];case 1:return l.sent(),I(!0),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Q=function(){var e=(0,i.Z)((function(e,n){var t,i,r,o,a,s,u,c;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if("string"!==typeof(null===d||void 0===d?void 0:d.id))return[2];if(!["fork","release"].includes(e))return[2];if("object"!==typeof n||null===n)return[2];I(!1),l.label=1;case 1:return l.trys.push([1,7,,8]),r=j.Z.put,o=["agents/".concat(d.id,"/src")],[4,M(d.id,!0)];case 2:return[4,r.apply(j.Z,o.concat(l.sent()))];case 3:return l.sent(),[4,j.Z.post("agents/".concat(d.id,"/").concat(e),n)];case 4:return a=l.sent(),"string"===typeof(null===(t=a.data)||void 0===t?void 0:t.id)&&x(a.data),"string"!==typeof(null===(i=a.data)||void 0===i?void 0:i.installedModuleId)?[3,6]:[4,j.Z.get("modules/".concat(a.data.installedModuleId))];case 5:u=l.sent(),"string"===typeof(null===(s=u.data)||void 0===s?void 0:s.id)&&v(u.data,null===(c=a.data)||void 0===c?void 0:c.installedModuleSrcId),l.label=6;case 6:return k(d.id,!1),[3,8];case 7:return l.sent(),[3,8];case 8:return I(!0),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}(),J=function(){var e=(0,i.Z)((function(e){var n,t,i,r,o;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if("string"!==typeof(null===d||void 0===d?void 0:d.id))return[2];if("string"!==typeof(null===h||void 0===h?void 0:h.id))return[2];if("string"!==typeof e)return[2];I(!1),l.label=1;case 1:return l.trys.push([1,4,,5]),[4,j.Z.put("agents/".concat(d.id,"/modules/").concat(h.id),{srcId:e})];case 2:return r=l.sent(),"string"!==typeof(null===(n=r.data)||void 0===n?void 0:n.id)?[2]:(x(r.data),v(h,null===(t=r.data)||void 0===t?void 0:t.installedModuleSrcId),[4,j.Z.get("agents/".concat(d.id,"/src"))]);case 3:return o=l.sent(),Array.isArray(null===(i=o.data)||void 0===i?void 0:i.srcStateMachine)&&(T(d.id,o.data),k(d.id,!1)),[3,5];case 4:return l.sent(),[3,5];case 5:return I(!0),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),ee="string"===typeof(null===d||void 0===d?void 0:d.installedModuleSrcId)&&Array.isArray(null===h||void 0===h?void 0:h.moduleReleases)&&(null===h||void 0===h?void 0:h.moduleReleases.length)?h.moduleReleases[h.moduleReleases.length-1].srcVersion:null;return(0,a.jsxs)(Z.Z,{children:[(0,a.jsx)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,flexGrow:0},children:null!==h?(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",pl:2},children:[(null===(n=N.user)||void 0===n?void 0:n.id)===h.authorId||"founder"===(null===(t=N.user)||void 0===t?void 0:t.userRole)?(0,a.jsx)(Te.Z,{scale:.8,tooltipPlacement:"top",inactive:!0,module:h}):null,(0,a.jsx)(R.Z,{title:"".concat(A.t("Installed module"),": ").concat(h.moduleName),placement:"top",children:(0,a.jsx)(H.Z,{variant:"caption",sx:{ml:2,userSelect:"none",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"125px",textTransform:"none",height:"35px",lineHeight:"35px"},children:h.moduleName})})]}),Array.isArray(null===h||void 0===h?void 0:h.moduleReleases)&&h.moduleReleases.length?(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,a.jsx)(R.Z,{title:A.t("Installed module version"),placement:"top",children:(0,a.jsx)(ce.Z,{variant:"standard",value:null!==(c=null===d||void 0===d?void 0:d.installedModuleSrcId)&&void 0!==c?c:null,onChange:function(e){return J(e.target.value)},sx:{mr:1,maxWidth:"70px",height:"35px","&.MuiInput-root:before":{display:"none"},"& .MuiSelect-select.MuiSelect-standard":{minWidth:"30px !important"}},inputProps:{sx:{py:3,pl:1,borderRadius:0}},children:h.moduleReleases.map((function(e){var n=e.srcId,t=e.srcVersion;return(0,a.jsx)($.Z,{value:n,children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"0.75rem",mt:"-1px"},children:["v.",t]})},n)}))})}),"string"===typeof(null===d||void 0===d?void 0:d.installedModuleSrcId)?(0,a.jsx)(R.Z,{title:A.t("Release details"),placement:"top",children:(0,a.jsx)(W.Z,{onClick:function(){return z(!0)},sx:{width:"30px",height:"30px"},children:(0,a.jsx)(fe.Z,{fontSize:"small"})})}):null]}):(0,a.jsxs)(H.Z,{variant:"caption",sx:{userSelect:"none",ml:2},children:["(",A.t("no releases"),")"]})]}):(0,a.jsx)(H.Z,{variant:"caption",sx:{userSelect:"none",ml:2},children:A.t("No module installed")})}),"string"===typeof(null===d||void 0===d?void 0:d.id)?(0,a.jsxs)(Z.Z,{sx:{display:"flex",width:"100%",p:2,flexDirection:"column"},children:[C&&y.length&&null!==h&&(null===(r=N.user)||void 0===r?void 0:r.id)===h.authorId?(0,a.jsx)(Ae,{startIcon:(0,a.jsx)(de.Z,{fontSize:"small",color:"action"}),onClick:function(){return P(!0)},children:A.t("Publish a release")}):null,y.length?(0,a.jsx)(Ae,{startIcon:(0,a.jsx)(xe.Z,{fontSize:"small",color:"action"}),onClick:function(){return q(!0)},children:A.t("Clone as new module")}):null,(0,a.jsx)(Ae,{startIcon:(0,a.jsx)(pe.Z,{fontSize:"small",color:"action"}),onClick:function(){return B(!0)},children:A.t("Import from YAML")}),y.length?(0,a.jsx)(Ae,{startIcon:(0,a.jsx)(he.Z,{fontSize:"small",color:"action"}),onClick:function(){return G()},children:A.t("Export as YAML")}):null]}):null,U&&"string"===typeof(null===h||void 0===h?void 0:h.id)&&"string"===typeof(null===d||void 0===d?void 0:d.installedModuleSrcId)?(0,a.jsx)(Me,{isOpen:!0,moduleId:null===h||void 0===h?void 0:h.id,moduleSrcId:null===d||void 0===d?void 0:d.installedModuleSrcId,onClose:function(){return z(!1)}}):null,L?(0,a.jsx)(_e,{isOpen:!0,description:A.t("Import agent source code from a '.oglama.yaml' file."),onClose:function(){return B(!1)},onImport:X}):null,null!==h&&(null===(o=N.user)||void 0===o?void 0:o.id)===h.authorId&&K?(0,a.jsx)(we,{isOpen:!0,module:h,description:A.t("Store the changes you have made to this module's source code in a new release.")+(h.isApproved&&h.isPublic?" "+A.t("This new release will be instantly available for users in the module repository."):""),version:ee,onClose:function(){return P(!1)},onRelease:function(e,n){return Q("release",{version:e,changes:n})}}):null,Y?(0,a.jsx)(ke.Z,{isOpen:!0,title:A.t("Clone as new module"),description:A.t("Create a new module and store the current source code in release v0.0.1"),onClose:function(){return q(!1)},onCreate:function(e,n){return Q("fork",{moduleName:e,moduleDescription:n})}}):null]})},Ne=t(828),Fe=t(51474),Ke=t(38299),Pe=t(65834),Oe=t(82670),Ee=t(69396),Ue=t(25410),ze=t(48859),De=(0,k.ZP)(Z.Z)((function(e){return{width:"100%",display:"flex",marginBottom:e.theme.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}})),Le=function(e){var n,t,i=e.state,o=e.id,l=e.active,s=void 0!==l&&l,c=e.index,d=e.tooltip,f=void 0===d?"":d,h=e.orphan,p=void 0!==h&&h,x=e.error,m=void 0!==x&&x,v=e.selected,g=void 0!==v&&v,y=e.agentStatus,j=void 0===y?-1:y,b=e.prepareKey,C=void 0===b?function(){}:b,w=e.onClick,I=void 0===w?function(){}:w,_=e.onDelete,M=void 0===_?function(){}:_,T=e.onKeyChange,k=void 0===T?function(){}:T,N=(0,u.$)().i18n,F=(0,A.Z)(),K=(0,S.useRef)(null),P=(0,S.useRef)(null),O=(0,S.useRef)(null),E=(0,S.useRef)(!0),U=(0,S.useState)(null!==(t=null===i||void 0===i?void 0:i.key)&&void 0!==t?t:""),z=U[0],D=U[1],L=(0,S.useCallback)((function(e){null!==K.current&&window.clearTimeout(K.current),K.current=window.setTimeout((function(){D(C(e,null===i||void 0===i?void 0:i.id)),K.current=null}),1e3)}),[]);(0,S.useEffect)((function(){k(null===i||void 0===i?void 0:i.id,C(z,null===i||void 0===i?void 0:i.id),E.current),E.current&&(E.current=!1)}),[z]),(0,S.useEffect)((function(){if(g&&(0,Oe.Z)(P.current,Element)){var e=P.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||P.current.scrollIntoView({behavior:"instant",block:"center"})}}),[g]);var H=g?m?F.palette.error.main:0===j?F.palette.warning.main:F.palette.primary.main:null,$=s?F.palette.primary.main:p?F.palette.warning.main:null;return(0,a.jsxs)(De,{ref:P,children:[(0,a.jsx)(Z.Z,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,a.jsx)(Z.Z,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!==H&&void 0!==H?H:"transparent",transform:"scaleY(".concat(g?"100":"0","%)"),transition:"transform 250ms linear"}})}),0===c?(0,a.jsx)(R.Z,{title:N.t("Entry state"),placement:"right",children:(0,a.jsx)(J.Z,{color:s?"primary":"action",sx:{mx:1}})}):p?(0,a.jsx)(R.Z,{arrow:!0,placement:"right",title:N.t('Orphan state. Call with return { next: "{{keyText}}" }.',{keyText:null===(n=O.current)||void 0===n?void 0:n.value}),children:(0,a.jsx)(Ue.Z,{color:"warning",sx:{mx:1}})}):(0,a.jsx)(ze.Z,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,a.jsx)(R.Z,{title:f,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,a.jsxs)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,a.jsx)(Ze.Z,{inputRef:O,variant:"standard",color:p?"warning":"primary",onClick:I,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:z,placeholder:N.t("State key"),onChange:function(e){return L(e.target.value)},inputProps:{id:o,style:(0,Ee.Z)((0,r.Z)({},null!==$?{color:$}:{}),{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5})}}),(0,a.jsx)(W.Z,{className:"delete",sx:{ml:1},size:"small",onClick:function(){return M(null===i||void 0===i?void 0:i.id)},children:(0,a.jsx)(Ke.Z,{fontSize:"small"})})]})})]})},We=t(63203),He=function(e){var n=e.value,t=e.total,i=e.title,r=void 0===i?null:i;return(!Number.isInteger(t)||t<=0)&&(t=100),(!Number.isInteger(n)||n<0)&&(n=0),n>t&&(n=t),(0,a.jsx)(R.Z,{title:r,placement:"right",children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",width:"100%",my:2,px:2},children:[(0,a.jsx)(We.Z,{sx:{borderRadius:1},variant:"determinate",value:100*n/t,color:"inherit"}),(0,a.jsxs)(H.Z,{variant:"caption",sx:{flexShrink:0,ml:3},children:[n,"/",t]})]})})},$e=function(e){var n=e.agent,t=e.loaded,r=e.activeId,c=void 0===r?null:r,d=e.srcStateMachine,h=void 0===d?[]:d,p=e.agentStatus,g=void 0===p?-1:p,y=e.selectedStateKey,j=void 0===y?null:y,b=e.selectedStateError,C=void 0!==b&&b,w=(0,s.O)(),I=w.getSource,_=w.setSource,M=w.setSourceModified,T=w.getSourceOrphans,k=w.onSourceOrphans,A=w.setSceTabs,R=w.addSceItem,F=(0,u.$)().i18n,K=(0,S.useState)(null),P=K[0],O=K[1],E=(0,S.useState)([]),U=E[0],W=E[1],H=(0,S.useRef)(h),$=(0,S.useRef)(null),V=(0,S.useRef)(null),q=function(e,n){return v(f.ModuleSrc.K_SRC_STATE_MACHINE,h,e,n)};(0,S.useEffect)((function(){"string"===typeof(null===n||void 0===n?void 0:n.id)&&W(T(n.id).srcStateMachine);var e=k((function(e){var t=e.agentId,i=e.orphans;t===(null===n||void 0===n?void 0:n.id)&&W(i.srcStateMachine)}));return function(){e()}}),[null===n||void 0===n?void 0:n.id]),(0,S.useEffect)((function(){V.current&&Array.isArray(h)&&(H.current=h,$.current=Fe.ZP.create(V.current,{animation:150,onUpdate:function(){var e=(0,i.Z)((function(e){var t,i,r,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,o.Z)(H.current),i=(0,Ne.Z)(t.splice(e.oldIndex,1),1),r=i[0],t.splice(e.newIndex,0,r),H.current=t,[4,I(n.id)];case 1:return(a=l.sent()).srcStateMachine=t,_(n.id,a),M(n.id),[2]}}))}));return function(n){return e.apply(this,arguments)}}()}))}),[h]);var G=function(){var e=(0,i.Z)((function(e){var t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return O(null),[4,I(n.id)];case 1:return t=i.sent(),Array.isArray(null===t||void 0===t?void 0:t.srcStateMachine)&&"string"===typeof e&&(t.srcStateMachine=t.srcStateMachine.filter((function(n){return n.id!==e})),A(f.ModuleSrc.K_SRC_STATE_MACHINE,e,!1),_(n.id,t),M(n.id)),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),X=function(){var e=(0,i.Z)((function(e,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>2&&void 0!==o[2])||o[2],[4,I(n.id)];case 1:return r=l.sent(),Array.isArray(null===r||void 0===r?void 0:r.srcStateMachine)&&"string"===typeof e&&(r.srcStateMachine=r.srcStateMachine.map((function(n){return n.id===e&&(n.key=t),n})),_(n.id,r),i||M(n.id)),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[t?(0,a.jsxs)(Z.Z,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,a.jsx)(Z.Z,{sx:{width:"100%"},ref:V,children:h.map((function(e,n){var t,i="".concat(null!==(t=e.code)&&void 0!==t?t:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,a.jsx)(Le,{id:"".concat(m(f.ModuleSrc.K_SRC_STATE_MACHINE),"-").concat(e.id),active:c===e.id,state:e,index:n,orphan:U.includes(e.key),tooltip:i,error:e.key===j&&C,selected:e.key===j,agentStatus:g,prepareKey:q,onClick:function(){return A(f.ModuleSrc.K_SRC_STATE_MACHINE,e.id)},onDelete:function(e){return O(e)},onKeyChange:X},e.id)}))}),(0,a.jsx)(He,{value:h.length,total:x().max.sourceCode.smCount,title:F.t("Total number of states in this finite-state machine")}),h.length<x().max.sourceCode.smCount?(0,a.jsx)(N.Z,{className:0===h.length?"pop":null,onClick:function(){return R(f.ModuleSrc.K_SRC_STATE_MACHINE)},startIcon:(0,a.jsx)(Pe.Z,{}),size:"small",children:F.t("Add state")}):null]}):(0,a.jsx)(Z.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(Ce.Z,{count:3})}),null!==P?(0,a.jsxs)(B.Z,{open:!0,onClose:function(){return O(null)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,a.jsx)(L.Z,{children:F.t("Delete State")}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(Y.Z,{severity:"warning",children:F.t("Are you sure you want to delete this state?")})}),(0,a.jsxs)(z.Z,{children:[(0,a.jsx)(N.Z,{color:"secondary",onClick:function(){return O(null)},children:F.t("Cancel")}),(0,a.jsx)(N.Z,{color:"error",onClick:function(){return G(P)},startIcon:(0,a.jsx)(Ke.Z,{}),children:F.t("Delete State")})]})]}):null]})},Be=(0,k.ZP)(Z.Z)((function(e){return{width:"100%",display:"flex",marginBottom:e.theme.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}})),Ve=function(e){var n,t,i=e.fn,o=e.id,l=e.active,s=void 0!==l&&l,c=e.tooltip,d=void 0===c?"":c,f=e.orphan,h=void 0!==f&&f,p=e.error,x=void 0!==p&&p,m=e.selected,v=void 0!==m&&m,g=e.agentStatus,y=void 0===g?-1:g,j=e.prepareKey,b=void 0===j?function(){}:j,C=e.onClick,w=void 0===C?function(){}:C,I=e.onDelete,_=void 0===I?function(){}:I,M=e.onKeyChange,T=void 0===M?function(){}:M,k=(0,u.$)().i18n,N=(0,A.Z)(),F=(0,S.useRef)(null),K=(0,S.useRef)(!0),P=(0,S.useRef)(null),O=(0,S.useRef)(null),E=(0,S.useState)(null!==(t=null===i||void 0===i?void 0:i.key)&&void 0!==t?t:""),U=E[0],z=E[1],D=(0,S.useCallback)((function(e){null!==F.current&&window.clearTimeout(F.current),F.current=window.setTimeout((function(){z(b(e,null===i||void 0===i?void 0:i.id)),F.current=null}),1e3)}),[]);(0,S.useEffect)((function(){T(null===i||void 0===i?void 0:i.id,b(U,null===i||void 0===i?void 0:i.id),K.current),K.current&&(K.current=!1)}),[U]),(0,S.useEffect)((function(){if(v&&(0,Oe.Z)(P.current,Element)){var e=P.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||P.current.scrollIntoView({behavior:"instant",block:"center"})}}),[v]);var L=v?x?N.palette.error.main:0===y?N.palette.warning.main:N.palette.primary.main:null,H=s?N.palette.primary.main:h?N.palette.warning.main:null;return(0,a.jsxs)(Be,{ref:P,children:[(0,a.jsx)(Z.Z,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,a.jsx)(Z.Z,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!==L&&void 0!==L?L:"transparent",transform:"scaleY(".concat(v?"100":"0","%)"),transition:"transform 250ms linear"}})}),h?(0,a.jsx)(R.Z,{arrow:!0,placement:"right",title:k.t('Orphan function. Call with $.fn( "{{keyText}}" )',{keyText:null===(n=O.current)||void 0===n?void 0:n.value}),children:(0,a.jsx)(Ue.Z,{color:"warning",sx:{mx:1}})}):(0,a.jsx)(ze.Z,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,a.jsx)(R.Z,{title:d,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,a.jsxs)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,a.jsx)(Ze.Z,{inputRef:O,variant:"standard",color:h?"warning":"primary",onClick:w,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:U,placeholder:k.t("Function key"),onChange:function(e){return D(e.target.value)},inputProps:{id:o,style:(0,Ee.Z)((0,r.Z)({},null!==H?{color:H}:{}),{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5})}}),(0,a.jsx)(W.Z,{className:"delete",sx:{ml:1},size:"small",onClick:function(){return _(null===i||void 0===i?void 0:i.id)},children:(0,a.jsx)(Ke.Z,{fontSize:"small"})})]})})]})},Ye=function(e){var n=e.agent,t=e.loaded,r=e.activeId,c=void 0===r?null:r,d=e.srcFunctions,h=void 0===d?[]:d,p=e.agentStatus,g=void 0===p?-1:p,y=e.selectedFnKey,j=void 0===y?null:y,b=e.selectedFnError,C=void 0!==b&&b,w=(0,s.O)(),I=w.getSource,_=w.setSource,M=w.setSourceModified,T=w.getSourceOrphans,k=w.onSourceOrphans,A=w.setSceTabs,R=w.addSceItem,F=(0,u.$)().i18n,K=(0,S.useState)(null),P=K[0],O=K[1],E=(0,S.useState)([]),U=E[0],W=E[1],H=(0,S.useRef)(h),$=(0,S.useRef)(null),V=(0,S.useRef)(null),q=function(e,n){return v(f.ModuleSrc.K_SRC_FUNCTIONS,h,e,n)};(0,S.useEffect)((function(){"string"===typeof(null===n||void 0===n?void 0:n.id)&&W(T(n.id).srcFunctions);var e=k((function(e){var t=e.agentId,i=e.orphans;t===(null===n||void 0===n?void 0:n.id)&&W(i.srcFunctions)}));return function(){e()}}),[null===n||void 0===n?void 0:n.id]),(0,S.useEffect)((function(){V.current&&Array.isArray(h)&&(H.current=h,$.current=Fe.ZP.create(V.current,{animation:150,onUpdate:function(){var e=(0,i.Z)((function(e){var t,i,r,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,o.Z)(H.current),i=(0,Ne.Z)(t.splice(e.oldIndex,1),1),r=i[0],t.splice(e.newIndex,0,r),H.current=t,[4,I(n.id)];case 1:return(a=l.sent()).srcFunctions=t,_(n.id,a),M(n.id),[2]}}))}));return function(n){return e.apply(this,arguments)}}()}))}),[h]);var G=function(){var e=(0,i.Z)((function(e){var t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return O(null),[4,I(n.id)];case 1:return t=i.sent(),Array.isArray(null===t||void 0===t?void 0:t.srcFunctions)&&"string"===typeof e&&(t.srcFunctions=t.srcFunctions.filter((function(n){return n.id!==e})),A(f.ModuleSrc.K_SRC_FUNCTIONS,e,!1),_(n.id,t),M(n.id)),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),X=function(){var e=(0,i.Z)((function(e,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>2&&void 0!==o[2])||o[2],[4,I(n.id)];case 1:return r=l.sent(),Array.isArray(null===r||void 0===r?void 0:r.srcFunctions)&&"string"===typeof e&&(r.srcFunctions=r.srcFunctions.map((function(n){return n.id===e&&(n.key=t),n})),_(n.id,r),i||M(n.id)),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[t?(0,a.jsxs)(Z.Z,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,a.jsx)(Z.Z,{sx:{width:"100%"},ref:V,children:h.map((function(e,n){var t,i="".concat(null!==(t=e.code)&&void 0!==t?t:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,a.jsx)(Ve,{fn:e,id:"".concat(m(f.ModuleSrc.K_SRC_FUNCTIONS),"-").concat(e.id),active:e.id===c,index:n,orphan:U.includes(e.key),tooltip:i,error:e.key===j&&C,selected:e.key===j,agentStatus:g,prepareKey:q,onClick:function(){return A(f.ModuleSrc.K_SRC_FUNCTIONS,e.id)},onDelete:function(e){return O(e)},onKeyChange:X},e.id)}))}),(0,a.jsx)(He,{value:h.length,total:x().max.sourceCode.fnCount,title:F.t("Total number of functions in this module")}),h.length<x().max.sourceCode.fnCount?(0,a.jsx)(N.Z,{onClick:function(){return R(f.ModuleSrc.K_SRC_FUNCTIONS)},startIcon:(0,a.jsx)(Pe.Z,{}),size:"small",children:F.t("Add function")}):null]}):(0,a.jsx)(Z.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(Ce.Z,{count:3})}),null!==P?(0,a.jsxs)(B.Z,{open:!0,onClose:function(){return O(null)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,a.jsx)(L.Z,{children:F.t("Delete Function")}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(Y.Z,{severity:"warning",children:F.t("Are you sure you want to delete this function?")})}),(0,a.jsxs)(z.Z,{children:[(0,a.jsx)(N.Z,{color:"secondary",onClick:function(){return O(null)},children:F.t("Cancel")}),(0,a.jsx)(N.Z,{color:"error",onClick:function(){return G(P)},startIcon:(0,a.jsx)(Ke.Z,{}),children:F.t("Delete Function")})]})]}):null]})},qe=t(76530),Ge=t(7902),Xe=(0,k.ZP)(H.Z)((function(e){e.theme;return{whiteSpace:"pre-wrap",fontSize:"0.8rem",lineHeight:"0.8rem",fontFamily:"Inconsolata,monospace",textAlign:"left","& > span, & > span > span":{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",verticalAlign:"top",width:"100%",maxWidth:"250px"},"& > span > span":{width:"auto",maxWidth:"75px",textAlign:"left",direction:"rtl"},"& > span > span > span":{direction:"ltr",unicodeBidi:"bidi-override",verticalAlign:"top"},"&.single":{fontWeight:"bold"},"&.single > span":{maxWidth:"200px"},"& i":{background:"rgba(255,215,0,0.8)",color:"#000",textTransform:"none",fontStyle:"normal",verticalAlign:"top",marginLeft:"2px"}}})),Qe=(0,k.ZP)(N.Z)((function(e){var n=e.theme;return{width:"100%",display:"flex",flexDirection:"column",marginBottom:n.spacing(1),cursor:"pointer",alignItems:"start",justifyContent:"start",textTransform:"none",position:"relative",paddingLeft:n.spacing(2),paddingRight:n.spacing(2),borderColor:"transparent","&.active [data-role=result]":{color:n.palette.primary.main},"&:before":{content:'""',display:"block",position:"absolute",bottom:"3px",left:"3px",borderRadius:"2px",height:"2px",width:"calc(100% - 6px)",background:"transparent",opacity:0,transform:"scaleX(0%)",transition:"transform 200ms linear"},"&.active":{borderColor:"red"},"&.active:before":{background:n.palette.primary.main,transform:"scaleX(100%)",opacity:1}}})),Je=(0,k.ZP)(H.Z)((function(e){var n=e.theme;return{marginLeft:n.spacing(1),fontSize:"0.7rem",color:n.palette.info.main}})),en=function(e){var n,t,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.jsxs)(Xe,{"data-role":"result",variant:"caption",className:r?null:"single",children:["string"===typeof e.prev?(0,a.jsxs)("span",{children:[r?"".concat(e.line-1,"\t"):"",e.prev]}):null,(0,a.jsxs)("span",{children:[r?"".concat(e.line,"\t"):"",(0,a.jsx)("span",{children:(0,a.jsx)("span",{children:null!==(n=e.match[0])&&void 0!==n?n:""})}),(0,a.jsx)("i",{children:null!==(t=e.match[1])&&void 0!==t?t:""}),null!==(i=e.match[2])&&void 0!==i?i:""]}),"string"===typeof e.next?(0,a.jsxs)("span",{children:[r?"".concat(e.line+1,"\t"):"",e.next]}):null]})},nn=function(e,n){for(var t=n.split("\n"),i=new RegExp((0,qe.N1)(e),"i"),r=[],o=0;o<t.length;o++){var l=t[o].match(i);if(l){var a=l.index,s=t[o].slice(0,a),u=l[0],c=t[o].slice(a+u.length);r.push({prev:o>0?t[o-1]:null,match:[s,u,c],next:o<t.length-1?t[o+1]:null,line:o+1,ch:a})}}return r},tn=function(e){var n,t=e.src,i=void 0===t?{}:t,l=e.icons,d=void 0===l?[]:l,h=e.searchText,p=void 0===h?"":h,x=e.setSearchText,m=void 0===x?function(){}:x,v=(0,s.O)(),g=v.setSceTabs,y=v.setSceCursor,j=(0,u.$)().i18n,b=(0,S.useRef)(null),C=(0,S.useRef)(null),w=(0,S.useRef)(function(){var e={},n=!0,t=!1,i=void 0;try{for(var o,l=d[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var a=o.value;e[a.key]=(0,r.Z)({},a)}}catch(s){t=!0,i=s}finally{try{n||null==l.return||l.return()}finally{if(t)throw i}}return e}()),I=(0,S.useState)([]),_=I[0],T=I[1],k=(0,S.useState)(!0),A=k[0],N=k[1],F=(0,S.useState)(null),K=F[0],P=F[1],O=(n={},(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_STATE_MACHINE,"-key"),j.t("state key")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_STATE_MACHINE,"-code"),j.t("state")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_FUNCTIONS,"-key"),j.t("function key")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_FUNCTIONS,"-code"),j.t("function")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_INPUTS,"-key"),j.t("input key")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_INPUTS,"-name"),j.t("input name")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_OUTPUTS,"-key"),j.t("output key")),(0,c.Z)(n,"".concat(f.ModuleSrc.K_SRC_OUTPUTS,"-name"),j.t("output name")),n);(0,S.useEffect)((function(){var e;N(0===p.length);var n=(e={},(0,c.Z)(e,f.ModuleSrc.K_SRC_STATE_MACHINE,["key","code"]),(0,c.Z)(e,f.ModuleSrc.K_SRC_FUNCTIONS,["key","code"]),(0,c.Z)(e,f.ModuleSrc.K_SRC_INPUTS,["key","name"]),(0,c.Z)(e,f.ModuleSrc.K_SRC_OUTPUTS,["key","name"]),e),t=[],r={};if(p.length){var o=!0,l=!1,a=void 0;try{for(var s,u=Object.keys(n)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var d=s.value;if(Array.isArray(i[d])){var h=!0,x=!1,m=void 0;try{for(var v,g=i[d][Symbol.iterator]();!(h=(v=g.next()).done);h=!0){var y=v.value;if("object"===typeof y&&null!==y){var S=!0,j=!1,Z=void 0;try{for(var b,C=n[d][Symbol.iterator]();!(S=(b=C.next()).done);S=!0){var w=b.value;if("string"===typeof y[w]){var I=nn(p,y[w]);if(I.length){var _=!0,M=!1,k=void 0;try{for(var A,R=I[Symbol.iterator]();!(_=(A=R.next()).done);_=!0){var F=A.value;r["".concat(d,"-").concat(y.id)]=!0,t.push({section:d,id:y.id,key:y.key,prop:w,result:F})}}catch(K){M=!0,k=K}finally{try{_||null==R.return||R.return()}finally{if(M)throw k}}}}}}catch(K){j=!0,Z=K}finally{try{S||null==C.return||C.return()}finally{if(j)throw Z}}}}}catch(K){x=!0,m=K}finally{try{h||null==g.return||g.return()}finally{if(x)throw m}}}}}catch(K){l=!0,a=K}finally{try{o||null==u.return||u.return()}finally{if(l)throw a}}}T(t),setTimeout((function(){return N(!0)}),150)}),[i,p]);var E=(0,o.Z)(new Set(_.map((function(e){return"".concat(e.section,"-").concat(e.id)})))).length,U=_.length;return(0,a.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,a.jsxs)(Z.Z,{sx:{display:"flex",height:"75px",px:2,flexDirection:"column"},children:[(0,a.jsx)(Ze.Z,{inputRef:C,variant:"standard",autoFocus:!0,defaultValue:p,placeholder:j.t("Search"),onChange:function(e){return n=e.target.value.toLowerCase(),null!==b.current&&window.clearTimeout(b.current),void(b.current=window.setTimeout((function(){m(n),b.current=null,P(null)}),350));var n},sx:{width:"100%","& input":{px:"0 !important",fontSize:"0.75rem"},"& .MuiInput-root:before":{display:"none"}},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",children:(0,a.jsx)(M.Z,{fontSize:"small",sx:{mx:2}})}),endAdornment:p?(0,a.jsx)(Se.Z,{position:"start",children:(0,a.jsx)(R.Z,{title:j.t("Clear search"),children:(0,a.jsx)(W.Z,{size:"small",sx:{width:30,height:30,mr:-2},onClick:function(){m(""),P(null),null!==C.current&&(C.current.value="",C.current.focus())},children:(0,a.jsx)(Ge.Z,{fontSize:"small"})})})}):null}}),p.length?(0,a.jsx)(H.Z,{variant:"caption",sx:{m:2,textAlign:"right",fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:U>0?1===U?j.t("1 result"):U>100?j.t("100 / {{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:U,itemsCount:E,obj:1===E?"item":"items"}):j.t("{{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:U,itemsCount:E,obj:1===E?"item":"items"}):j.t("No results")}):null]}),(0,a.jsx)(Z.Z,{sx:{display:"flex",width:"100%",height:"100%",px:2,overflowY:"auto",flexDirection:"column"},children:A?_.slice(0,100).map((function(e,n){var t,i="".concat(e.section,"-").concat(e.id,"-").concat(e.prop,"-").concat(n),r=w.current[e.section].Icon,o=w.current[e.section].label,l=null!==(t=O["".concat(e.section,"-").concat(e.prop)])&&void 0!==t?t:null;return(0,a.jsxs)(Qe,{className:K===i?"active":null,onClick:function(){P(i),g(e.section,e.id),y(e.id,{line:e.result.line-1,ch:e.result.ch})},children:[(0,a.jsxs)(Z.Z,{sx:{display:"flex",width:"100%",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap"},children:[(0,a.jsx)(R.Z,{title:o,placement:"top",children:(0,a.jsx)(r,{fontSize:"small",sx:{mr:2},color:K===i?"primary":"action"})}),"key"===e.prop?en(e.result):(0,a.jsx)(Xe,{"data-role":"result",variant:"caption",children:(0,a.jsx)("span",{children:e.key})}),null!==l?(0,a.jsxs)(Je,{variant:"caption",children:["(",l,")"]}):null]}),"key"!==e.prop?(0,a.jsx)(Z.Z,{sx:{width:"100%",mt:2,ml:2,textAlign:"left"},children:en(e.result,"code"===e.prop)}):null]},i)})):(0,a.jsx)(Z.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(Ce.Z,{count:3})})})]})},rn=t(91736),on=t(41667),ln=t(18166),an=t(63213),sn=t(60010);function un(e){return[{value:"int",label:e.t("Integer"),Icon:an.Z},{value:"string",label:e.t("String"),Icon:sn.Z},{value:"boolean",label:e.t("Boolean"),Icon:on.Z},{value:"table",label:e.t("Table"),Icon:ln.Z},{value:"files",label:e.t("Files"),Icon:rn.Z}]}var cn=t(22313),dn=(0,k.ZP)(Z.Z)((function(e){return{width:"100%",display:"flex",marginBottom:e.theme.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1},"&:hover .type":{opacity:0}}})),fn=function(e){var n=e.type,t=e.active,i=void 0!==t&&t,r=e.isList,o=void 0!==r&&r,l=un((0,u.$)().i18n).reduce((function(e,t){return t.value===n?t.Icon:e}),null);return(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",position:"relative"},children:[null!==l?(0,a.jsx)(l,{className:"type",color:i?"primary":"action",fontSize:"small",sx:{position:"absolute",left:"6px"}}):null,o?(0,a.jsx)(cn.Z,{className:"type",color:i?"primary":"action",sx:{zIndex:2,fontSize:"0.5rem",position:"absolute",right:"0px",bottom:"3px"}}):null,(0,a.jsx)(ze.Z,{className:"drag",color:i?"primary":"action",sx:{mx:1}})]})},hn=function(e){var n,t=e.field,i=e.id,o=e.active,l=void 0!==o&&o,s=e.section,c=e.tooltip,d=void 0===c?"":c,h=e.orphan,p=void 0!==h&&h,x=e.prepareKey,m=void 0===x?function(){}:x,v=e.onClick,g=void 0===v?function(){}:v,y=e.onDelete,j=void 0===y?function(){}:y,b=e.onKeyChange,C=void 0===b?function(){}:b,w=(0,u.$)().i18n,I=(0,A.Z)(),_=(0,S.useRef)(null),M=(0,S.useRef)(!0),T=(0,S.useRef)(null),k=(0,S.useState)(null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:""),N=k[0],F=k[1];(0,S.useEffect)((function(){C(null===t||void 0===t?void 0:t.id,m(N,null===t||void 0===t?void 0:t.id),M.current),M.current&&(M.current=!1)}),[N]);var K,P,O=(0,S.useCallback)((function(e){null!==_.current&&window.clearTimeout(_.current),_.current=window.setTimeout((function(){F(m(e,null===t||void 0===t?void 0:t.id)),_.current=null}),1e3)}),[]),E=l?I.palette.primary.main:p?I.palette.warning.main:null;return(0,a.jsxs)(dn,{children:[p?(0,a.jsx)(R.Z,{arrow:!0,placement:"right",title:f.ModuleSrc.K_SRC_INPUTS===s?w.t("Orphan input"):w.t("Orphan output"),children:(0,a.jsx)(Ue.Z,{color:"warning",sx:{mx:1}})}):(0,a.jsx)(fn,{type:null!==(K=null===t||void 0===t?void 0:t.type)&&void 0!==K?K:null,active:l,isList:null!==(P=null===t||void 0===t?void 0:t.isList)&&void 0!==P&&P}),(0,a.jsx)(R.Z,{title:d,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,a.jsxs)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,a.jsx)(Ze.Z,{inputRef:T,variant:"standard",color:p?"warning":"primary",onClick:g,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:N,placeholder:f.ModuleSrc.K_SRC_INPUTS===s?w.t("Input key"):w.t("Output key"),onChange:function(e){return O(e.target.value)},inputProps:{id:i,style:(0,Ee.Z)((0,r.Z)({},null!==E?{color:E}:{}),{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5})}}),(0,a.jsx)(W.Z,{className:"delete",sx:{ml:1},size:"small",onClick:function(){return j(null===t||void 0===t?void 0:t.id)},children:(0,a.jsx)(Ke.Z,{fontSize:"small"})})]})})]})},pn=function(e){var n=e.agent,t=e.loaded,r=e.activeId,c=void 0===r?null:r,d=e.srcFields,h=void 0===d?[]:d,p=e.ioKey,g=void 0===p?f.ModuleSrc.K_SRC_INPUTS:p,y=(0,s.O)(),j=y.getSource,b=y.setSource,C=y.setSourceModified,w=y.getSourceOrphans,I=y.onSourceOrphans,_=y.setSceTabs,M=y.addSceItem,T=(0,u.$)().i18n,k=(0,S.useState)(null),A=k[0],R=k[1],F=(0,S.useState)([]),K=F[0],P=F[1],O=(0,S.useRef)(h),E=(0,S.useRef)(null),U=(0,S.useRef)(null),W=function(e,n){return v(g,h,e,n)};(0,S.useEffect)((function(){"string"===typeof(null===n||void 0===n?void 0:n.id)&&P(w(n.id)[g]);var e=I((function(e){var t=e.agentId,i=e.orphans;t===(null===n||void 0===n?void 0:n.id)&&P(i[g])}));return function(){e()}}),[null===n||void 0===n?void 0:n.id]),(0,S.useEffect)((function(){U.current&&Array.isArray(h)&&(O.current=h,E.current=Fe.ZP.create(U.current,{animation:150,onUpdate:function(){var e=(0,i.Z)((function(e){var t,i,r,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,o.Z)(O.current),i=(0,Ne.Z)(t.splice(e.oldIndex,1),1),r=i[0],t.splice(e.newIndex,0,r),O.current=t,[4,j(n.id)];case 1:return(a=l.sent())[g]=t,b(n.id,a),C(n.id),[2]}}))}));return function(n){return e.apply(this,arguments)}}()}))}),[h]);var H=function(){var e=(0,i.Z)((function(e){var t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return R(null),[4,j(n.id)];case 1:return t=i.sent(),"string"===typeof e&&null!==t&&Array.isArray(t[g])&&(t[g]=t[g].filter((function(n){return n.id!==e})),_(g,e,!1),b(n.id,t),C(n.id)),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),$=function(){var e=(0,i.Z)((function(e,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>2&&void 0!==o[2])||o[2],[4,j(n.id)];case 1:return"object"===typeof(r=l.sent())&&null!==r&&Array.isArray(r[g])&&"string"===typeof e&&(r[g]=r[g].map((function(n){return n.id===e&&(n.key=t),n})),b(n.id,r),i||C(n.id)),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[t?(0,a.jsxs)(Z.Z,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,a.jsx)(Z.Z,{sx:{width:"100%"},ref:U,children:h.map((function(e,n){var t=e.name?"".concat(f.ModuleSrc.K_SRC_INPUTS===g?T.t("Input name"):T.t("Output name"),": ").concat(e.name):"";return(0,a.jsx)(hn,{id:"".concat(m(g),"-").concat(e.id),active:e.id===c,index:n,orphan:K.includes(e.key),tooltip:t,field:e,section:g,prepareKey:W,onClick:function(){return _(g,e.id)},onDelete:function(e){return R(e)},onKeyChange:$},e.id)}))}),(0,a.jsx)(He,{value:h.length,total:x().max.sourceCode.ioCount,title:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Total number of inputs"):T.t("Total number of outputs")}),h.length<x().max.sourceCode.ioCount?(0,a.jsx)(N.Z,{onClick:function(){return M(g)},size:"small",startIcon:(0,a.jsx)(Pe.Z,{}),children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Add input"):T.t("Add output")}):null]}):(0,a.jsx)(Z.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(Ce.Z,{count:3})}),null!==A?(0,a.jsxs)(B.Z,{open:!0,onClose:function(){return R(null)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,a.jsx)(L.Z,{children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Delete Input"):T.t("Delete Output")}),(0,a.jsx)(D.Z,{children:(0,a.jsx)(Y.Z,{severity:"warning",children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Are you sure you want to delete this input?"):T.t("Are you sure you want to delete this output?")})}),(0,a.jsxs)(z.Z,{children:[(0,a.jsx)(N.Z,{color:"secondary",onClick:function(){return R(null)},children:T.t("Cancel")}),(0,a.jsx)(N.Z,{color:"error",onClick:function(){return H(A)},startIcon:(0,a.jsx)(Ke.Z,{}),children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Delete Input"):T.t("Delete Output")})]})]}):null]})},xn=(0,k.ZP)("code")((function(e){var n=e.theme;return{backgroundColor:n.palette.background.paper,marginLeft:n.spacing(1),marginRight:n.spacing(1),paddingTop:n.spacing(1),paddingBottom:n.spacing(1),borderRadius:n.shape.borderRadius,fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"}})),mn=function(e,n){return"object"===typeof e&&null!==e&&Array.isArray(e[n])?e[n]:[]},vn=function(e){var n,t=e.src,r=void 0===t?{}:t,o=e.icons,c=void 0===o?[]:o,d=e.agent,h=e.module,p=e.updateAgent,m=void 0===p?function(){}:p,v=e.updateModule,y=void 0===v?function(){}:v,I=e.loaded,M=e.setLoaded,k=void 0===M?function(){}:M,F=(0,s.O)(),K=F.onSceTabs,P=F.getSceTabs,O=F.onSceSection,ue=F.getSceSection,ce=F.setSource,de=F.onSourceModified,fe=F.getSourceModified,he=F.setSourceModified,pe=(0,u.$)().i18n,xe=(0,A.Z)(),me=(0,E.a)(),ve=(0,S.useRef)(null),ge=(0,S.useRef)(null),ye=(0,S.useState)(f.ModuleSrc.K_SRC_STATE_MACHINE),Se=ye[0],je=ye[1],Ze=(0,S.useState)(!1),be=Ze[0],Ce=Ze[1],we=(0,S.useState)(null),Ie=we[0],_e=we[1],Me=(0,S.useState)(!1),Te=Me[0],ke=Me[1],Ae=(0,S.useState)(!1),Ne=Ae[0],Fe=Ae[1],Ke=(0,S.useState)(null),Pe=Ke[0],Oe=Ke[1],Ee=(0,S.useState)(!1),Ue=Ee[0],ze=Ee[1],De=(0,S.useState)(-1),Le=De[0],We=De[1],He=(0,S.useState)([]),Be=He[0],Ve=He[1],qe=(0,S.useState)(""),Ge=qe[0],Xe=qe[1],Qe=(0,S.useState)(!1),Je=Qe[0],en=Qe[1],nn=(0,S.useState)(null),rn=nn[0],on=nn[1];(0,S.useEffect)((function(){var e,n,t;null===(e=window.sdk)||void 0===e||e.ibc.handle("ibc-main:agent:state",(function(e,n){"string"===typeof(null===d||void 0===d?void 0:d.id)&&(null!==ve.current&&window.clearTimeout(ve.current),ve.current=window.setTimeout((function(){_e(e),Ce(n),ve.current=null}),150))})),null===(n=window.sdk)||void 0===n||n.ibc.handle("ibc-main:agent:fn",(function(e,n){"string"===typeof(null===d||void 0===d?void 0:d.id)&&(null!==ge.current&&window.clearTimeout(ge.current),ge.current=window.setTimeout((function(){Oe(e),ke(n),ge.current=null}),150))})),null===(t=window.sdk)||void 0===t||t.ibc.handle("ibc-main:agent:status",(function(e){"string"===typeof(null===d||void 0===d?void 0:d.id)&&We(e)})),Ve(P().tabs);var i=K((function(e){var n=e.tabs;Ve(n)}));je(ue());var r=O((function(e){var n=e.section;je(n)}));null!==d&&ze(fe(d.id));var o=de((function(e){var n=e.agentId,t=e.modified;n===(null===d||void 0===d?void 0:d.id)&&ze(t)}));return function(){i(),r(),o()}}),[d]);var ln,an,sn,un,cn,dn,fn,hn=function(){on(null)},vn=function(){var e=(0,i.Z)((function(e){var n;return(0,l.__generator)(this,(function(t){switch(t.label){case 0:e.preventDefault(),e.stopPropagation(),hn(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,j.Z.put("agents/".concat(d.id),{autoUpdate:!d.autoUpdate})];case 2:return n=t.sent(),m(n.data),[3,4];case 3:return t.sent(),[3,4];case 4:return[2]}}))}));return function(n){return e.apply(this,arguments)}}(),gn=function(){var e=(0,i.Z)((function(e){var n,t,i;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return e.preventDefault(),e.stopPropagation(),hn(),"string"!==typeof(null===d||void 0===d?void 0:d.id)?[2,null]:[4,null===(n=window.sdk)||void 0===n?void 0:n.ipc.diskStorage.openAgentFiles(d.id)];case 1:return"string"===typeof(t=o.sent())?[3,5]:(U.A.loading(pe.t("Initializing agent..."),null,!1),[4,g(d.id,r,f.ModuleSrc.K_SRC_STATE_MACHINE,null,ce,he)]);case 2:return o.sent(),[4,new Promise((function(e){return setTimeout(e,750)}))];case 3:return o.sent(),[4,null===(i=window.sdk)||void 0===i?void 0:i.ipc.diskStorage.openAgentFiles(d.id)];case 4:t=o.sent(),o.label=5;case 5:return[2,t]}}))}));return function(n){return e.apply(this,arguments)}}(),yn=c.reduce((function(e,n){return n.key===Se?n.label:e}),null),Sn="1px solid ".concat((0,T.k)(xe)),jn=Be.reduce((function(e,n){return e[n.section]=n.id,e}),{});return(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"300px",borderRight:Sn,flexGrow:0,flexShrink:0},children:[(0,a.jsxs)(Z.Z,{sx:{px:2,width:"100%",height:"50px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsx)(H.Z,{variant:"caption",sx:{textTransform:"uppercase",color:xe.palette.text.disabled,ml:2},children:yn}),Object.values(f.ModuleSrc).includes(Se)?(0,a.jsx)(W.Z,{size:"small",onClick:function(){return en(!0)},children:Je?(0,a.jsx)(te.Z,{fontSize:"small"}):(0,a.jsx)(G.Z,{fontSize:"small"})}):null,"source-control"===Se?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(Z.Z,{children:[I&&Ue?(0,a.jsx)(R.Z,{title:pe.t("Source code modified"),placement:"top",children:(0,a.jsx)(W.Z,{onClick:function(){return Fe(!0)},sx:{mr:1,height:"35px",width:"35px"},children:(0,a.jsx)(le.Z,{fontSize:"small",sx:{transform:"scale(0.8)"},color:"primary"})})}):null,(0,a.jsx)(W.Z,{sx:{width:"30px",height:"30px"},onClick:function(e){on(e.currentTarget)},children:(0,a.jsx)(ne.Z,{fontSize:"small"})})]}),(0,a.jsxs)(q.Z,{anchorEl:rn,open:Boolean(rn),onClose:hn,children:[(0,a.jsx)($.Z,{onClick:gn,children:(0,a.jsxs)(Z.Z,{sx:{display:"flex"},children:[(0,a.jsx)(X.Z,{fontSize:"small"}),(0,a.jsx)(H.Z,{sx:{ml:3},variant:"body2",children:pe.t("Open containing folder")})]})}),"source-control"===Se&&"string"===typeof(null===d||void 0===d?void 0:d.installedModuleId)?(0,a.jsx)(R.Z,{title:pe.t("Toggle automatic updates for the installed module"),children:(0,a.jsxs)($.Z,{onClick:vn,sx:{justifyContent:"space-between"},children:[(0,a.jsxs)(Z.Z,{sx:{display:"flex"},children:[(0,a.jsx)(se.Z,{fontSize:"small"}),(0,a.jsx)(H.Z,{sx:{ml:3},variant:"body2",children:pe.t("Auto-update")})]}),(0,a.jsx)(V.Z,{size:"small",sx:{ml:3},checked:d.autoUpdate,defaultValue:d.autoUpdate})]})}):null]})]}):null]}),(0,a.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",height:"calc( 100vh - 50px)",overflowY:"auto"},children:[f.ModuleSrc.K_SRC_STATE_MACHINE===Se?(0,a.jsx)($e,{agent:d,loaded:I,activeId:null!==(ln=jn[Se])&&void 0!==ln?ln:null,srcStateMachine:null!==(an=r[Se])&&void 0!==an?an:[],agentStatus:Le,selectedStateKey:Ie,selectedStateError:be}):null,f.ModuleSrc.K_SRC_INPUTS===Se?(0,a.jsx)(pn,{agent:d,loaded:I,activeId:null!==(sn=jn[Se])&&void 0!==sn?sn:null,srcFields:mn(r,Se),ioKey:f.ModuleSrc.K_SRC_INPUTS}):null,f.ModuleSrc.K_SRC_OUTPUTS===Se?(0,a.jsx)(pn,{agent:d,loaded:I,activeId:null!==(un=jn[Se])&&void 0!==un?un:null,srcFields:mn(r,Se),ioKey:f.ModuleSrc.K_SRC_OUTPUTS}):null,f.ModuleSrc.K_SRC_FUNCTIONS===Se?(0,a.jsx)(Ye,{agent:d,loaded:I,activeId:null!==(cn=jn[Se])&&void 0!==cn?cn:null,srcFunctions:null!==(dn=r[Se])&&void 0!==dn?dn:[],agentStatus:Le,selectedFnKey:Pe,selectedFnError:Te}):null,"search"===Se?(0,a.jsx)(tn,{src:r,icons:c,searchText:Ge,setSearchText:Xe}):null,"source-control"===Se?(0,a.jsx)(Re,{srcStateMachine:null!==(fn=r[f.ModuleSrc.K_SRC_STATE_MACHINE])&&void 0!==fn?fn:[],module:h,updateModule:y,srcModified:Ue,agent:d,updateAgent:m,loaded:I,setLoaded:k}):null]}),Je&&Object.values(f.ModuleSrc).includes(Se)?(0,a.jsxs)(B.Z,{open:!0,onClose:function(){return en(!1)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:850,p:1}},children:[(0,a.jsx)(L.Z,{children:yn}),(0,a.jsxs)(D.Z,{children:[f.ModuleSrc.K_SRC_STATE_MACHINE===Se?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.Z,{severity:"success",sx:{mb:3},icon:(0,a.jsx)(ie.Z,{}),children:(0,a.jsxs)(H.Z,{color:"inherit",variant:"body2",children:[pe.t("Finite-state machine states are written in plain JavaScript.")," ",pe.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(_.Z,{}),children:(0,a.jsxs)(H.Z,{color:"inherit",variant:"body2",component:"span",children:[pe.t("These are finite-state machine states."),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:[pe.t("The finite-state machine begins execution from the entry state."),(0,a.jsx)(J.Z,{fontSize:"small",sx:{display:"inline-block",verticalAlign:"text-bottom",mx:2}})]}),(0,a.jsxs)("li",{children:[pe.t("The next state to execute is specified using this return object:"),(0,a.jsx)(xn,{children:"{ next: string, args?: any[] }"})]}),(0,a.jsx)("li",{children:pe.t("The finite-state machine stops if an error occurs or if no next state is specified.")})]})]})}),(0,a.jsx)(Y.Z,{severity:"info",icon:(0,a.jsx)(ee.Z,{}),children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:pe.t("Drag to reorder.")}),(0,a.jsx)("li",{children:pe.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:pe.t("Ctrl/Cmd hover over $ properties to learn more.")}),(0,a.jsx)("li",{children:pe.t("Define up to {{count}} states, with {{length}} characters per state.",{count:x().max.sourceCode.smCount,length:x().max.sourceCode.smCodeLength})})]})})})]}):null,f.ModuleSrc.K_SRC_FUNCTIONS===Se?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.Z,{severity:"success",sx:{mb:3},icon:(0,a.jsx)(ie.Z,{}),children:(0,a.jsxs)(H.Z,{color:"inherit",variant:"body2",children:[pe.t("Functions are written in plain JavaScript.")," ",pe.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(C.Z,{}),children:(0,a.jsxs)(H.Z,{color:"inherit",variant:"body2",component:"span",children:[pe.t("These are functions."),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:pe.t("Functions are used to avoid code duplication in finite-state machine states.")}),(0,a.jsx)("li",{children:pe.t("Unlike finite-state machine states, a function's return value has no special significance.")}),(0,a.jsx)("li",{children:pe.t("Functions can be called from either a state or another function with $.fn().")})]})]})}),(0,a.jsx)(Y.Z,{severity:"info",icon:(0,a.jsx)(ee.Z,{}),children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:pe.t("Drag to reorder.")}),(0,a.jsx)("li",{children:pe.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:pe.t("Ctrl/Cmd hover over $.fn() strings to view the invoked function.")}),(0,a.jsx)("li",{children:pe.t("Define up to {{count}} functions, with {{length}} characters per function.",{count:x().max.sourceCode.fnCount,length:x().max.sourceCode.fnCodeLength})})]})})})]}):null,f.ModuleSrc.K_SRC_INPUTS===Se?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(w.Z,{}),children:(0,a.jsxs)(H.Z,{color:"inherit",variant:"body2",component:"span",children:[pe.t("These are your module's inputs."),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:pe.t("Inputs for each run are specified in the Settings tab.")}),(0,a.jsxs)("li",{children:[pe.t("Fetch inputs in states and functions:"),(0,a.jsx)(xn,{children:"$.ioInput*()."})]})]})]})}),(0,a.jsx)(Y.Z,{severity:"info",icon:(0,a.jsx)(ee.Z,{}),children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:pe.t("Drag to reorder items in the Settings tab.")}),(0,a.jsx)("li",{children:pe.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:pe.t("Define up to {{count}} inputs. This limit is set to reduce cognitive load.",{count:x().max.sourceCode.ioCount})}),(0,a.jsx)("li",{children:pe.t("Define up to {{count}} input tables with up to {{columns}} columns and {{size}}MB per table.",{count:x().max.sourceCode.ioFieldTableCount,columns:x().max.sourceCode.ioFieldColumnCount,size:x().max.sourceCode.ioFieldTableSize})})]})})})]}):null,f.ModuleSrc.K_SRC_OUTPUTS===Se?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(b.Z,{}),children:(0,a.jsxs)(H.Z,{color:"inherit",variant:"body2",component:"span",children:[pe.t("These are your module's outputs."),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:pe.t("Outputs are collected in the Results tab.")}),(0,a.jsxs)("li",{children:[pe.t("Store outputs in states and functions:"),(0,a.jsx)(xn,{children:"$.ioOutput*()"}),(0,a.jsx)(xn,{children:"$.ioSave*()"})]})]})]})}),(0,a.jsx)(Y.Z,{severity:"info",icon:(0,a.jsx)(ee.Z,{}),children:(0,a.jsx)(H.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:pe.t("Drag to reorder items in the Results tab.")}),(0,a.jsx)("li",{children:pe.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:pe.t("Define up to {{count}} outputs. This limit is set to reduce cognitive load.",{count:x().max.sourceCode.ioCount})}),(0,a.jsx)("li",{children:pe.t("Define up to {{count}} output tables with up to {{columns}} columns per table.",{count:x().max.sourceCode.ioFieldTableCount,columns:x().max.sourceCode.ioFieldColumnCount})})]})})})]}):null]}),(0,a.jsx)(z.Z,{children:(0,a.jsx)(N.Z,{color:"secondary",onClick:function(){return en(!1)},children:pe.t("OK")})})]}):null,Ne?(0,a.jsxs)(B.Z,{open:!0,onClose:function(){return Fe(!1)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,a.jsx)(L.Z,{children:pe.t("Locally modified source code")}),(0,a.jsxs)(D.Z,{children:[(0,a.jsx)(Y.Z,{sx:{mb:3},icon:(0,a.jsx)(oe.Z,{}),children:pe.t("Changes to the source code are instantly saved on your local computer.")}),(null===(n=me.user)||void 0===n?void 0:n.id)===(null===h||void 0===h?void 0:h.authorId)?(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(Q.Z,{}),children:pe.t("Once you are ready to share your changes with others you can publish them as a new release which will become available for install from the module repository.")}):(0,a.jsx)(Y.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(ae.Z,{}),children:pe.t("If you wish to share your modifications with others, you can publish it to the module repository.")}),(0,a.jsx)(Y.Z,{severity:"info",icon:(0,a.jsx)(re.Z,{}),children:pe.t("You can also export and import your work as YAML files completely privately, outside of the module repository.")})]}),(0,a.jsx)(z.Z,{children:(0,a.jsx)(N.Z,{color:"secondary",onClick:function(){return Fe(!1)},children:pe.t("OK")})})]}):null]})},gn=t(40044),yn=t(45670),Sn=t(46408),jn=t(42734),Zn=t(5152),bn=t.n(Zn),Cn=(0,k.ZP)(Z.Z)((function(e){var n=e.theme;return{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"light"===n.palette.mode?"#fff":"#272822","&:before, &:after":{content:'""',display:"block",zIndex:0,position:"absolute",top:0,left:0,height:"100%"},"&:before":{width:"30px",background:"light"===n.palette.mode?"#f7f7f7":"#272822",borderRight:"light"===n.palette.mode?"1px solid #dddddd":"none"},"&:after":{width:"7px",left:"auto",right:0,background:n.palette.customColors.bodyBg}}})),wn=bn()((function(){return Promise.all([t.e(54),t.e(993),t.e(126),t.e(12),t.e(502)]).then(t.bind(t,3502))}),{loadableGenerated:{webpack:function(){return[3502]}},ssr:!1}),In=function(e){var n=e.code,t=e.section,r=e.item,o=e.id,s=e.onFnClick,c=e.maxLength,d=void 0===c?5e4:c,h=e.actionEdit,p=void 0===h?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):h,x=e.showInfo,m=void 0!==x&&x,v=(0,S.useRef)(null),g=(0,S.useRef)(!0),y=(0,u.$)().i18n,j=(0,S.useState)(n),Z=j[0],b=j[1];(0,S.useEffect)((function(){p(Z,g.current),g.current&&(g.current=!1)}),[Z]);var C=(0,S.useCallback)((function(e){null!==v.current&&window.clearTimeout(v.current),v.current=window.setTimeout((function(){b(e),v.current=null}),250)}),[]),w=f.ModuleSrc.K_SRC_FUNCTIONS===t?'await $.fn("'.concat(r.key,'"): any'):"($) => { next: string, args?: any[] } | void";return(0,a.jsxs)(Cn,{children:[m?(0,a.jsxs)(Y.Z,{severity:"info",sx:{m:3,zIndex:100},children:[(0,a.jsx)(H.Z,{variant:"caption",color:"inherit",children:f.ModuleSrc.K_SRC_FUNCTIONS===t?y.t("Call this function"):y.t("State signature")}),": ",(0,a.jsx)(H.Z,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:w})]}):null,(0,a.jsx)(wn,{id:o,section:t,maxLength:d,defaultValue:Z,onChange:function(e){return C(e)},onFnClick:s})]})},_n=t(47312),Mn=t(27489),Tn=t(73431),kn=t(41826),An=t(77849),Rn=t(94818),Nn=t(98347),Fn=t(95898),Kn=t(81418),Pn=t(1938),On=t(48584),En=t(62535),Un=t(28399),zn=t(84323),Dn=function(e){var n=e.sx,t=void 0===n?{}:n,o=e.items,s=void 0===o?[]:o,c=e.setItems,d=void 0===c?function(){}:c,f=e.sanitize,h=void 0===f?function(e){return e}:f,p=e.label,x=void 0===p?"":p,m=e.tooltip,v=void 0===m?"":m,g=e.placeholder,y=void 0===g?"":g,S=e.placeholderMax,j=void 0===S?"":S,b=e.adornment,C=void 0===b?null:b,w=e.maxLength,I=void 0===w?32:w,_=e.inputProps,M=void 0===_?null:_,T=e.numeric,k=void 0!==T&&T,N=e.maxCount,F=void 0===N?25:N,K=e.maxCountToast,P=void 0===K?"":K,O=(0,u.$)().i18n,E=(0,A.Z)();"object"===typeof t&&null!==t||(t={});var z=function(){var e=(0,i.Z)((function(e){var n,t,i,r;return(0,l.__generator)(this,(function(o){if(e.preventDefault(),n=new FormData(e.target),e.target.reset(),t=k?parseInt(n.get("value"),10):n.get("value"),"function"===typeof h&&(t=h(t)),null===t)return[2];i=structuredClone(Array.isArray(s)?s:[]),r=!1;do{if(k){if(!Number.isFinite(t)){U.A.error(O.t("Value is not a valid number"));break}}else{if("string"!==typeof t){U.A.error(O.t("Value is not a valid string"));break}if(!t.length){U.A.error(O.t("Value cannot be empty"));break}}if(i.includes(t)){U.A.error("".concat(O.t("Value already added"),": ").concat(t));break}if(i.length>=F){U.A.error("string"===typeof P&&P.length?P:O.t("Cannot add more than {{maxCount}} values",{maxCount:F}));break}if("".concat(t).length>I){U.A.error(O.t("Value cannot be longer than {{maxLength}} characters",{maxLength:I}));break}r=!0}while(0);return r&&(i.push(t),d(i)),[2]}))}));return function(n){return e.apply(this,arguments)}}(),D=!Number.isInteger(F)||!Array.isArray(s)||s.length<F;return(0,a.jsx)(Z.Z,{sx:(0,r.Z)({width:"100%",display:"flex",alignItems:"center"},t),children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%",position:"relative",zIndex:0},children:[(0,a.jsx)(H.Z,{variant:"caption",component:"div",sx:{position:"absolute",top:"-10px",left:"10px",px:1,background:E.palette.background.paper},children:x}),(0,a.jsxs)(Z.Z,{sx:{p:3,pt:4,borderRadius:1,border:"1px solid ".concat("light"===E.palette.mode?"rgba(50,50,50,0.25)":"rgba(255,255,255,0.25)"),flexDirection:"column",minHeight:"40px",display:"flex",alignItems:"center","&:hover":{borderColor:"light"===E.palette.mode?"rgba(50,50,50,0.35)":"rgba(255,255,255,0.35)"}},children:[Array.isArray(s)&&s.length?(0,a.jsx)(Z.Z,{sx:{display:"flex",width:"100%"},children:(0,a.jsx)(zn.Z,{items:s,setItems:d,onDelete:function(e){d(structuredClone(Array.isArray(s)?s:[]).filter((function(n){return"".concat(n)!=="".concat(e)})))},numeric:k})}):null,Number.isInteger(F)&&F>0?(0,a.jsx)(R.Z,{title:v||O.t("Total number of items"),children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",width:"100%",mb:3,px:2},children:[(0,a.jsx)(We.Z,{color:"inherit",sx:{borderRadius:1},value:100*(Array.isArray(s)?s.length:0)/F}),(0,a.jsxs)(H.Z,{variant:"caption",sx:{flexShrink:0,width:"50px",textAlign:"right"},children:[Array.isArray(s)?s.length:0,"/",F]})]})}):null,(0,a.jsx)("form",{style:{width:"100%"},onSubmit:z,children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",width:"100%",px:2,mb:2},children:[(0,a.jsx)(Ze.Z,(0,Ee.Z)((0,r.Z)({fullWidth:!0,name:"value",disabled:!D},k?{type:"number",inputMode:"numeric"}:{}),{sx:(0,r.Z)({width:"100%"},D?{}:{"& fieldset":{borderColor:"transparent !important",userSelect:"none"}}),inputProps:null!==M&&void 0!==M?M:{maxLength:I},placeholder:D?y:j||O.t("Maximum number of items reached"),InputProps:{startAdornment:null!==C?(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:C}):null}})),D?(0,a.jsx)(W.Z,{sx:{ml:2},type:"submit",children:(0,a.jsx)(Pe.Z,{})}):null]})})]})]})})},Ln=function(e){var n,t,s,c,h,p,m,v,g,y,j=e.field,b=e.section,C=e.srcFields,w=void 0===C?[]:C,I=e.actionEdit,_=void 0===I?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):I,M=e.showInfo,T=void 0!==M&&M,k=(0,u.$)().i18n,N=(0,A.Z)(),F=(0,S.useRef)(!0),K=(0,S.useRef)(null),P=(0,S.useRef)(null),O=(0,S.useRef)(null),E=(0,S.useRef)(null),z=(0,S.useRef)(null),D=(0,S.useRef)(null),L=(0,S.useRef)(null),W=(0,S.useRef)(null),B=(0,S.useRef)(null),V=(0,S.useRef)(null),q=(0,S.useRef)(null),G=(0,S.useRef)(null),X=(0,S.useRef)(null),Q=(0,S.useRef)(null),J=(0,S.useState)(null!==(n=null===j||void 0===j?void 0:j.type)&&void 0!==n?n:"string"),ee=J[0],ne=J[1],te=(0,S.useState)(null!==(t=null===j||void 0===j?void 0:j.name)&&void 0!==t?t:""),ie=te[0],re=te[1],oe=(0,S.useState)(null!==(s=null===j||void 0===j?void 0:j.desc)&&void 0!==s?s:""),le=oe[0],ae=oe[1],se=(0,S.useState)(Array.isArray(null===j||void 0===j?void 0:j.extensions)?j.extensions:["txt"]),ue=se[0],de=se[1],he=(0,S.useState)(null!==(c=null===j||void 0===j?void 0:j.options)&&void 0!==c?c:[]),pe=he[0],xe=he[1],me=(0,S.useState)(null!==(h=null===j||void 0===j?void 0:j.default)&&void 0!==h?h:null),ve=me[0],ge=me[1],ye=(0,S.useState)(null!==(p=null===j||void 0===j?void 0:j.depends)&&void 0!==p?p:null),be=ye[0],Ce=ye[1],we=(0,S.useState)(null!==(m=null===j||void 0===j?void 0:j.columns)&&void 0!==m?m:[]),Ie=we[0],_e=we[1],Me=(0,S.useState)(null!==(v=null===j||void 0===j?void 0:j.isList)&&void 0!==v?v:null),Te=Me[0],ke=Me[1],Ae=(0,S.useState)(null!==(g=null===j||void 0===j?void 0:j.min)&&void 0!==g?g:null),Re=Ae[0],Ne=Ae[1],Fe=(0,S.useState)(null!==(y=null===j||void 0===j?void 0:j.max)&&void 0!==y?y:null),Ke=Fe[0],Pe=Fe[1],Oe=(f.ModuleSrc.K_SRC_INPUTS===b&&Array.isArray(w)?w:[]).filter((function(e){return"boolean"===e.type})).map((function(e){return e.key})),Ee=function(e){for(e="".concat(null!==e&&void 0!==e?e:"").trim().substring(0,x().max.sourceCode.ioFieldNameLength);;){if(e.length>0)break;e="".concat(ee," ").concat(f.ModuleSrc.K_SRC_INPUTS===b?"input":"output")}return null!==G.current&&(G.current.value=e),e},Ue=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==P.current&&window.clearTimeout(P.current),P.current=window.setTimeout((function(){!(e=$e(ee,"int"===ee?parseInt(e,10):"string"===typeof e?e:"",!1))&&Array.isArray(pe)&&pe.length&&(e=pe[0]),ge(e),null!==W.current&&(W.current.value=null!==e&&void 0!==e?e:""),P.current=null}),n)},ze=function(e,n){null!==E.current&&window.clearTimeout(E.current),E.current=window.setTimeout((function(){e=parseInt(e,10),n=parseInt(n,10),Number.isInteger(e)||(e=null),Number.isInteger(n)||(n=null),["files","string"].includes(ee)&&(e<=0&&(e=null),n<=0&&(n=null)),null!==e&&null!==n&&n<e&&(n=e),"string"===ee&&((null===n||n>x().max.sourceCode.ioFieldStringLength)&&(n=x().max.sourceCode.ioFieldStringLength),Array.isArray(pe)&&pe.length&&n>x().max.sourceCode.ioFieldOptionLength&&(n=x().max.sourceCode.ioFieldOptionLength),e>n&&(e=null)),Ne(e),null!==X.current&&(X.current.value=e),Pe(n),null!==Q.current&&(Q.current.value=n),E.current=null}),250)};(0,S.useEffect)((function(){F.current||xe([])}),[ee]),(0,S.useEffect)((function(){F.current||(ze(Re,Ke),Array.isArray(pe)&&pe.map((function(e){return"".concat(e)})).includes("".concat(ve))||Ue(""))}),[pe]),(0,S.useEffect)((function(){var e=window.setTimeout((0,i.Z)((function(){var e;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return re(Ee(ie)),e={fieldType:ee,fieldName:ie,fieldDesc:le,fieldExts:ue,fieldOptions:pe,fieldDefault:ve,fieldDepends:be,fieldColumns:Ie,fieldMulti:Te,fieldMin:Re,fieldMax:Ke},[4,_(null===j||void 0===j?void 0:j.id,e,F.current)];case 1:return n.sent(),F.current&&(F.current=!1),[2]}}))})),450);return function(){return window.clearTimeout(e)}}),[ee,ie,le,ue,pe,ve,be,Ie,Te,Re,Ke]);var De,Le,We,He,$e=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null;do{if("int"===e){if(!Number.isInteger(n)){t&&U.A.error(k.t("Not a valid integer"));break}if(Number.isInteger(Re)&&n<Re){t&&U.A.error(k.t("Integer cannot be smaller than {{fieldMin}}",{fieldMin:Re}));break}if(Number.isInteger(Ke)&&n>Ke){t&&U.A.error(k.t("Integer cannot be greater than {{fieldMax}}",{fieldMax:Ke}));break}}else{if("string"!==typeof n){t&&U.A.error(k.t("Not a valid string"));break}if(n=n.trim(),Number.isInteger(Re)&&n.length<Re){t&&U.A.error(k.t("String cannot be shorter than {{fieldMin}} characters",{fieldMin:Re}));break}if(Number.isInteger(Ke)&&n.length>Ke){t&&U.A.error(k.t("String cannot be longer than {{fieldMax}} characters",{fieldMax:Ke}));break}}i=n}while(0);return i},Be=un(k),Ve="table"===ee?"Row":(0,qe.zf)(ee),Ye="table"===ee?"Object":ee,Ge=f.ModuleSrc.K_SRC_INPUTS===b?"".concat("table"===ee?"await ":"","$.ioInput").concat(Ve,'("').concat(null===j||void 0===j?void 0:j.key,'"): ').concat("files"===ee?"string[] - File paths":"".concat(Ye).concat(["int","string"].includes(ee)&&Te&&pe.length>1?"[]":"","|null")):"files"===ee?'await $.ioSave*("'.concat(null===j||void 0===j?void 0:j.key,'"): string - File path'):"await $.ioOutput".concat(Ve,'("').concat(null===j||void 0===j?void 0:j.key,'", ').concat(Ye,"): boolean");return(0,a.jsxs)(Z.Z,{sx:{background:N.palette.background.paper,flexDirection:"column",display:"flex",width:"100%",zIndex:10,flexShrink:0,flexGrow:0,p:3},children:[T?(0,a.jsxs)(Y.Z,{severity:"info",sx:{mb:2},children:[(0,a.jsx)(H.Z,{variant:"caption",color:"inherit",children:f.ModuleSrc.K_SRC_INPUTS===b?k.t("Get this input"):k.t("Set this output")}),": ",(0,a.jsx)(H.Z,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:Ge})]}):null,(0,a.jsx)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:2},children:(0,a.jsx)(R.Z,{placement:"left",title:k.t("Maximum length: {{len}} characters",{len:x().max.sourceCode.ioFieldNameLength}),children:(0,a.jsx)(Ze.Z,{fullWidth:!0,label:f.ModuleSrc.K_SRC_INPUTS===b?k.t("Input name"):k.t("Output name"),required:!0,defaultValue:ie,inputRef:G,onChange:function(e){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;null!==D.current&&window.clearTimeout(D.current),D.current=window.setTimeout((function(){re(Ee(e)),D.current=null}),n)}(e.target.value)},inputProps:{maxLength:x().max.sourceCode.ioFieldNameLength},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(An.Z,{fontSize:"small"})})}})})}),(0,a.jsx)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,a.jsx)(R.Z,{placement:"left",title:k.t("Maximum length: {{len}} characters",{len:x().max.sourceCode.ioFieldDescLength}),children:(0,a.jsx)(Ze.Z,{fullWidth:!0,multiline:!0,minRows:1,maxRows:9,label:f.ModuleSrc.K_SRC_INPUTS===b?k.t("Input description"):k.t("Output description"),defaultValue:le,onChange:function(e){return n=e.target.value,null!==L.current&&window.clearTimeout(L.current),void(L.current=window.setTimeout((function(){ae("".concat(n).trim().substring(0,x().max.sourceCode.ioFieldDescLength)),L.current=null}),1e3));var n},inputProps:{maxLength:x().max.sourceCode.ioFieldDescLength,style:{padding:0,fontFamily:"Inconsolata,monospace"}},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(fe.Z,{fontSize:"small"})})}})})}),(0,a.jsxs)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,a.jsxs)(je.Z,{fullWidth:!0,children:[(0,a.jsxs)(_n.Z,{sx:{px:2,background:N.palette.background.paper,ml:-1},children:[f.ModuleSrc.K_SRC_INPUTS===b?k.t("Input type"):k.t("Output type")," "]}),(0,a.jsx)(ce.Z,{value:ee,required:!0,onChange:function(e){return function(e){if("table"!==ee&&"table"===e&&w.filter((function(e){return"table"===e.type})).length>=x().max.sourceCode.ioFieldTableCount)return void U.A.error(k.t("Cannot use more than {{ioFieldTableCount}} tables",{ioFieldTableCount:x().max.sourceCode.ioFieldTableCount}));ne(e)}(e.target.value)},fullWidth:!0,children:Be.map((function(e){var n=e.value,t=e.label,i=e.Icon;return(0,a.jsx)($.Z,{value:n,children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[i?(0,a.jsx)(i,{fontSize:"small",sx:{mr:5}}):null,t||""]})},n)}))})]}),"files"===ee?(0,a.jsx)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",ml:2},children:(0,a.jsx)(R.Z,{placement:"left",title:k.t("Comma-separated list of accepted extensions"),children:(0,a.jsx)(Ze.Z,{fullWidth:!0,required:!0,label:k.t("File extensions"),defaultValue:Array.isArray(ue)?ue.join(", "):"txt",inputRef:q,placeholder:k.t("File extensions"),onChange:function(e){return n=e.target.value,null!==K.current&&window.clearTimeout(K.current),void(K.current=window.setTimeout((function(){var e=(0,o.Z)(new Set("".concat(n).split(",").map((function(e){return(0,d.W)(e,x().max.sourceCode.ioFieldExtensionLength)})).filter((function(e){return e.length>0})))).slice(0,x().max.sourceCode.ioFieldExtensionCount);e.length||(e=["txt"]),de(e),null!==q.current&&(q.current.value=e.join(", ")),K.current=null}),1e3));var n},inputProps:{maxLength:(x().max.sourceCode.ioFieldExtensionLength+2)*x().max.sourceCode.ioFieldExtensionCount},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(Kn.Z,{fontSize:"small"})})}})})}):null]}),["string","int","files"].includes(ee)?(0,a.jsxs)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,a.jsx)(Ze.Z,{fullWidth:!0,defaultValue:Re,inputRef:X,type:"number",inputMode:"numeric",label:"files"===ee?k.t("Minimum file size (MB)"):"int"===ee?k.t("Minimum value"):k.t("Minimum length"),onChange:function(e){return ze(e.target.value,Ke)},inputProps:{min:["files","string"].includes(ee)?0:null,max:"string"===ee?Array.isArray(pe)&&pe.length?x().max.sourceCode.ioFieldOptionLength:x().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:"files"===ee?(0,a.jsx)(En.Z,{fontSize:"small"}):"int"===ee?(0,a.jsx)(kn.Z,{fontSize:"small"}):(0,a.jsx)(Pn.Z,{fontSize:"small"})})}}),(0,a.jsx)(Ze.Z,{sx:{ml:2},fullWidth:!0,defaultValue:Ke,inputRef:Q,type:"number",inputMode:"numeric",label:"files"===ee?k.t("Maximum file size (MB)"):"int"===ee?k.t("Maximum value"):k.t("Maximum length"),onChange:function(e){return ze(Re,e.target.value)},inputProps:{min:["files","string"].includes(ee)?0:null,max:"string"===ee?Array.isArray(pe)&&pe.length?x().max.sourceCode.ioFieldOptionLength:x().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:"files"===ee?(0,a.jsx)(Un.Z,{fontSize:"small"}):"int"===ee?(0,a.jsx)(Nn.Z,{fontSize:"small"}):(0,a.jsx)(On.Z,{fontSize:"small"})})}})]}):null,f.ModuleSrc.K_SRC_INPUTS===b&&["string","int"].includes(ee)?(0,a.jsx)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:Array.isArray(pe)&&pe.length?(0,a.jsxs)(je.Z,{fullWidth:!0,children:[(0,a.jsx)(_n.Z,{sx:{px:2,background:N.palette.background.paper,ml:-1},children:k.t("Default value")}),(0,a.jsxs)(ce.Z,{label:k.t("Default value"),inputRef:W,value:null!==ve&&void 0!==ve?ve:"",onChange:function(e){return Ue("".concat(null!==(De=e.target.value)&&void 0!==De?De:""))},fullWidth:!0,children:[(0,a.jsx)($.Z,{value:null,children:(0,a.jsx)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,a.jsx)(H.Z,{variant:"caption",children:k.t("No default value")})})}),pe.map((function(e){return(0,a.jsx)($.Z,{value:e,children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,a.jsx)(Tn.Z,{fontSize:"small",sx:{mr:5}}),e]})},e)}))]})]}):(0,a.jsx)(Ze.Z,{fullWidth:!0,inputRef:W,label:k.t("Default value"),defaultValue:null!==ve&&void 0!==ve?ve:"",onChange:function(e){return Ue("".concat(null!==(Le=e.target.value)&&void 0!==Le?Le:""),1e3)},inputProps:(0,r.Z)({},"int"===ee?{min:Re,max:Ke}:{minLength:Re,maxLength:Ke}),type:"int"===ee?"number":"string",inputMode:"int"===ee?"numeric":"text",InputProps:{startAdornment:(0,a.jsx)(Se.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(Tn.Z,{fontSize:"small"})})}})}):null,f.ModuleSrc.K_SRC_INPUTS===b&&["string","int"].includes(ee)&&Array.isArray(pe)&&pe.length>1?(0,a.jsx)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,a.jsxs)(je.Z,{fullWidth:!0,children:[(0,a.jsx)(_n.Z,{sx:{px:2,background:N.palette.background.paper,ml:-1},children:k.t("Input format")}),(0,a.jsxs)(ce.Z,{label:k.t("Input format"),inputRef:V,value:Te?"1":"0",onChange:function(e){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==z.current&&window.clearTimeout(z.current),z.current=window.setTimeout((function(){e=!!parseInt(e,10),ke(e),null!==V.current&&(V.current.value=e),z.current=null}),n)}("".concat(null!==(We=e.target.value)&&void 0!==We?We:0))},fullWidth:!0,children:[(0,a.jsx)($.Z,{value:"0",children:(0,a.jsx)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,a.jsx)(H.Z,{variant:"caption",children:k.t("Single: user selects a string")})})}),(0,a.jsx)($.Z,{value:"1",children:(0,a.jsx)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,a.jsx)(H.Z,{variant:"caption",children:k.t("List: user selects an array of strings")})})})]})]})}):null,f.ModuleSrc.K_SRC_INPUTS===b&&["string","int"].includes(ee)?(0,a.jsx)(Dn,{sx:{mt:4},items:pe,setItems:xe,sanitize:function(e){return $e(ee,e)},label:k.t("Input options - ommit if users can set any value"),placeholder:k.t("Option value"),adornment:(0,a.jsx)(Rn.Z,{fontSize:"small"}),inputProps:(0,r.Z)({},"int"===ee?{min:Re,max:Ke}:{minLength:Re,maxLength:Math.min(null!==Ke&&void 0!==Ke?Ke:x().max.sourceCode.ioFieldOptionLength,x().max.sourceCode.ioFieldOptionLength)}),maxLength:x().max.sourceCode.ioFieldOptionLength,maxCount:x().max.sourceCode.ioFieldOptionCount,maxCountToast:k.t("Cannot add more than {{n}} options",{n:x().max.sourceCode.ioFieldOptionCount}),numeric:"int"===ee}):null,"table"===ee?(0,a.jsx)(Dn,{sx:{mt:4},items:Ie,setItems:_e,sanitize:function(e){return(0,d.W)(e,x().max.sourceCode.ioFieldColumnLength)},label:k.t("Table columns *"),placeholder:k.t("Table column name"),placeholderMax:k.t("Maximum number of columns reached"),tooltip:k.t("Total number of columns"),adornment:(0,a.jsx)(Mn.Z,{fontSize:"small"}),maxLength:x().max.sourceCode.ioFieldColumnLength,maxCount:x().max.sourceCode.ioFieldColumnCount,maxCountToast:k.t("Cannot add more than {{n}} table columns",{n:x().max.sourceCode.ioFieldColumnCount})}):null,f.ModuleSrc.K_SRC_INPUTS===b&&"boolean"!==ee?(0,a.jsx)(Z.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,a.jsx)(R.Z,{placement:"left",title:k.t("Show field only if this boolean is set to true"),children:(0,a.jsxs)(je.Z,{fullWidth:!0,children:[(0,a.jsx)(_n.Z,{sx:{px:2,background:N.palette.background.paper,ml:-1},children:k.t("Dependency")}),(0,a.jsxs)(ce.Z,{label:k.t("Dependency"),inputRef:B,value:null!==be&&void 0!==be?be:"",onChange:function(e){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==O.current&&window.clearTimeout(O.current),O.current=window.setTimeout((function(){Oe.includes(e)||(e=null),Ce(e),null!==B.current&&(B.current.value=e),O.current=null}),n)}("".concat(null!==(He=e.target.value)&&void 0!==He?He:""))},fullWidth:!0,children:[(0,a.jsx)($.Z,{value:null,children:(0,a.jsx)(H.Z,{variant:"caption",children:k.t("No dependency - field is always shown")})}),Oe.map((function(e){return(0,a.jsx)($.Z,{value:e,children:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,a.jsx)(Fn.Z,{fontSize:"small",sx:{mr:5}}),e]})},e)}))]})]})})}):null]})},Wn=t(77381),Hn=(0,k.ZP)(gn.Z)((function(e){return{height:"50px",minHeight:"50px",paddingRight:0,paddingLeft:0,marginRight:e.theme.spacing(1),"&:hover .close":{opacity:1}}})),$n=(0,k.ZP)("span")((function(e){var n=e.theme;return(0,c.Z)({lineHeight:1.5,fontSize:"0.75rem",textTransform:"none",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"125px"},n.breakpoints.down("md"),{display:"none"})})),Bn=(0,k.ZP)(Z.Z)((function(e){var n=e.theme;return{height:"50px",position:"relative",display:"flex",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"space-between",paddingLeft:n.spacing(1),paddingRight:n.spacing(1)}})),Vn=(0,k.ZP)(Z.Z)((function(e){e.theme;return{position:"absolute",overflowY:"auto",height:"100%",width:"100%",zIndex:1,right:0,top:0}})),Yn=function(e){var n=e.src,t=void 0===n?{}:n,r=e.icons,o=void 0===r?[]:r,c=e.agent,d=e.loaded,h=void 0!==d&&d,p=(0,s.O)(),m=p.getSource,v=p.setSource,g=p.setSourceModified,y=p.setSceTabs,j=p.getSceTabs,b=p.onSceTabs,C=(0,u.$)().i18n,w=(0,A.Z)(),I=(0,S.useState)(!1),_=I[0],M=I[1],k=(0,S.useState)([]),N=k[0],F=k[1],K=(0,S.useState)(null),P=K[0],O=K[1];(0,S.useEffect)((function(){F(j().tabs),O(j().tabsIndex);var e=b((function(e){var n=e.tabs,t=e.tabsIndex;F(n),O(t)}));return function(){e()}}),[c]);var E=function(){var e=(0,i.Z)((function(e,n,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>3&&void 0!==o[3])||o[3],[4,m(c.id)];case 1:return null!==(r=l.sent())&&Array.isArray(r[e])&&"string"===typeof n&&(r[e]=r[e].map((function(e){return e.id===n&&(e.code=t),e})),v(c.id,r),i||g(c.id)),[2]}}))}));return function(n,t,i){return e.apply(this,arguments)}}(),z=function(){var e=(0,i.Z)((function(e,n,t){var i,r,o,a,s,u,d,h,p,x,y,S,j,Z=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(Z.length>3&&void 0!==Z[3])||Z[3],[4,m(c.id)];case 1:return r=l.sent(),o=t.fieldType,a=t.fieldName,s=t.fieldDesc,u=t.fieldExts,d=t.fieldOptions,h=t.fieldDefault,p=t.fieldDepends,x=t.fieldColumns,y=t.fieldMulti,S=t.fieldMin,j=t.fieldMax,"string"===typeof n&&null!==r&&Array.isArray(r[e])&&(r[e]=r[e].map((function(t){if(t.id===n)switch(t={id:n,key:t.key,type:o,name:a,desc:s},"boolean"!==o&&f.ModuleSrc.K_SRC_INPUTS===e&&(t.depends=p),o){case"string":case"int":t.min=S,t.max=j,f.ModuleSrc.K_SRC_INPUTS===e&&(t.options=Array.isArray(d)&&d.length?d:null,t.default=h,t.isList=Array.isArray(d)&&d.length>1?!!y:null);break;case"files":t.min=S,t.max=j,t.extensions=Array.isArray(u)?u:["txt"];break;case"table":t.columns=x}var i=!0,r=!1,l=void 0;try{for(var c,m=Object.keys(t)[Symbol.iterator]();!(i=(c=m.next()).done);i=!0){var v=c.value;null===t[v]&&delete t[v]}}catch(g){r=!0,l=g}finally{try{i||null==m.return||m.return()}finally{if(r)throw l}}return t})),v(c.id,r),i||g(c.id)),[2]}}))}));return function(n,t,i){return e.apply(this,arguments)}}(),D=function(){var e=(0,i.Z)((function(e){var n,t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,m(c.id)];case 1:return n=i.sent(),Array.isArray(n[f.ModuleSrc.K_SRC_FUNCTIONS])&&("string"===typeof(t=n[f.ModuleSrc.K_SRC_FUNCTIONS].reduce((function(n,t){return t.key===e?t.id:n}),null))?y(f.ModuleSrc.K_SRC_FUNCTIONS,t):U.A.error(C.t('Function "{{fn}}" does not exist',{fn:e}))),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),L=null,H=(Array.isArray(N)?structuredClone(N):[]).map((function(e,n){return e.item=(null!==t&&Array.isArray(t[e.section])?t[e.section]:[]).reduce((function(n,t){return e.id===t.id?t:n}),null),e.selected=P===n,e.selected&&(L="".concat(e.section,"-").concat(e.id)),e})).filter((function(e){return null!==e.item}));return(0,a.jsxs)(Z.Z,{sx:{width:"calc(100% - 350px)",height:"100vh",display:"flex",flexDirection:"column"},children:[(0,a.jsx)(Bn,{sx:{boxShadow:H.length?"0px -1px 0px 0px ".concat((0,T.k)(w)," inset"):null},children:H.length&&"string"===typeof L?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(yn.ZP,{value:L,children:(0,a.jsx)(Sn.Z,{variant:"scrollable",sx:{"& .MuiTabs-indicator":{borderRadius:"5px",marginBottom:"4px",height:"4px"},height:"50px",width:"100%"},children:H.map((function(e){var n,t,i="".concat(e.section,"-").concat(e.id),r=o.reduce((function(n,t){return e.section===t.key?t.Icon:n}),null),l=o.reduce((function(n,t){return e.section===t.key?t.label:n}),null);return(0,a.jsx)(Hn,{icon:(0,a.jsx)(r,{fontSize:"small",sx:{ml:2}}),iconPosition:"start",onClick:function(){return y(e.section,e.id)},value:i,label:(0,a.jsxs)(Z.Z,{sx:{display:"flex",alignItems:"center",px:1,"& .close":{opacity:0},"&:hover .close":{opacity:1}},children:[(0,a.jsx)(R.Z,{title:"".concat(l," / ").concat(null===(n=e.item)||void 0===n?void 0:n.key),arrow:!0,enterDelay:750,enterNextDelay:750,placement:"bottom",children:(0,a.jsx)($n,{children:null===(t=e.item)||void 0===t?void 0:t.key})}),(0,a.jsx)(Z.Z,{className:"close",sx:{ml:2,cursor:"pointer",opacity:.2,display:"flex"},onClick:function(n){n.stopPropagation(),y(e.section,e.id,!1)},children:(0,a.jsx)(jn.Z,{fontSize:"small",color:"action"})})]})},i)}))})}),(0,a.jsx)(R.Z,{title:C.t("Toggle hints"),placement:"left",children:(0,a.jsx)(W.Z,{"aria-label":C.t("More information"),color:"default",onClick:function(){return M(!_)},size:"small",children:_?(0,a.jsx)(te.Z,{fontSize:"small"}):(0,a.jsx)(G.Z,{fontSize:"small"})})})]}):null}),(0,a.jsx)(Z.Z,{sx:{position:"relative",width:"100%",height:"100%",background:h&&H.length?w.palette.background.paper:null},children:h&&H.length?H.map((function(e){var n,i,r;return(0,a.jsxs)(Vn,{sx:{zIndex:e.selected?10:-1},children:[[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS].includes(e.section)?(0,a.jsx)(In,{code:null===(n=e.item)||void 0===n?void 0:n.code,section:e.section,item:e.item,id:e.id,onFnClick:D,maxLength:x().max.sourceCode.smCodeLength,actionEdit:function(n,t){return E(e.section,e.id,n,t)},showInfo:_}):null,[f.ModuleSrc.K_SRC_INPUTS,f.ModuleSrc.K_SRC_OUTPUTS].includes(e.section)?(0,a.jsx)(Ln,{field:e.item,section:e.section,srcFields:(i=t,r=e.section,"object"===typeof i&&null!==i&&Array.isArray(i[r])?i[r]:[]),actionEdit:function(n,t,i){z(e.section,n,t,i)},showInfo:_}):null]},"".concat(e.section,"-").concat(e.id))})):(0,a.jsx)(Z.Z,{sx:{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(Wn.Z,{grey:!0,size:192,sx:{opacity:.1}})})})]})},qn=function(e){var n={},t=!0,i=!1,r=void 0;try{for(var l,a=function(){var t=l.value;if(n[t]=[],"object"!==typeof e||null===e||!Array.isArray(e[t]))return"continue";var i={};switch(t){case f.ModuleSrc.K_SRC_STATE_MACHINE:var r=!0,a=!1,s=void 0;try{for(var u,c=e.srcStateMachine[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var d=u.value;if("string"===typeof(null===d||void 0===d?void 0:d.code)){var h=!0,p=!1,x=void 0;try{for(var m,v=(0,o.Z)(d.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\breturn\s+\{\s*([^{}]+)\s*\}/g))[Symbol.iterator]();!(h=(m=v.next()).done);h=!0){var g=m.value[1].match(/['"]?next['"]?\s*:\s*"([\w\.\-]+)"/);g&&(i[g[1]]=!0)}}catch(ce){p=!0,x=ce}finally{try{h||null==v.return||v.return()}finally{if(p)throw x}}}}}catch(ce){a=!0,s=ce}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}break;case f.ModuleSrc.K_SRC_INPUTS:for(var y=0,S=[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS];y<S.length;y++){var j=S[y],Z=!0,b=!1,C=void 0;try{for(var w,I=e[j][Symbol.iterator]();!(Z=(w=I.next()).done);Z=!0){var _=w.value;if("string"===typeof(null===_||void 0===_?void 0:_.code)){var M=!0,T=!1,k=void 0;try{for(var A,R=(0,o.Z)(_.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.ioInput\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi))[Symbol.iterator]();!(M=(A=R.next()).done);M=!0){var N=A.value;i[N[1]]=!0}}catch(ce){T=!0,k=ce}finally{try{M||null==R.return||R.return()}finally{if(T)throw k}}}}}catch(ce){b=!0,C=ce}finally{try{Z||null==I.return||I.return()}finally{if(b)throw C}}}break;case f.ModuleSrc.K_SRC_OUTPUTS:for(var F=0,K=[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS];F<K.length;F++){var P=K[F],O=!0,E=!1,U=void 0;try{for(var z,D=e[P][Symbol.iterator]();!(O=(z=D.next()).done);O=!0){var L=z.value;if("string"===typeof(null===L||void 0===L?void 0:L.code)){var W=!0,H=!1,$=void 0;try{for(var B,V=(0,o.Z)(L.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.io(?:Output|Save)\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi))[Symbol.iterator]();!(W=(B=V.next()).done);W=!0){var Y=B.value;i[Y[1]]=!0}}catch(ce){H=!0,$=ce}finally{try{W||null==V.return||V.return()}finally{if(H)throw $}}}}}catch(ce){E=!0,U=ce}finally{try{O||null==D.return||D.return()}finally{if(E)throw U}}}break;case f.ModuleSrc.K_SRC_FUNCTIONS:for(var q=0,G=[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS];q<G.length;q++){var X=G[q],Q=!0,J=!1,ee=void 0;try{for(var ne,te=e[X][Symbol.iterator]();!(Q=(ne=te.next()).done);Q=!0){var ie=ne.value;if("string"===typeof(null===ie||void 0===ie?void 0:ie.code)){var re=!0,oe=!1,le=void 0;try{for(var ae,se=(0,o.Z)(ie.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.fn\s*\([^\w\.\-]*([\w\.\-]+)/g))[Symbol.iterator]();!(re=(ae=se.next()).done);re=!0){var ue=ae.value;i[ue[1]]=!0}}catch(ce){oe=!0,le=ce}finally{try{re||null==se.return||se.return()}finally{if(oe)throw le}}}}}catch(ce){J=!0,ee=ce}finally{try{Q||null==te.return||te.return()}finally{if(J)throw ee}}}}n[t]=(f.ModuleSrc.K_SRC_STATE_MACHINE===t?e.srcStateMachine.slice(1):e[t]).map((function(e){return e.key})).filter((function(e){return"string"===typeof e&&"undefined"===typeof i[e]}))},s=Object.values(f.ModuleSrc)[Symbol.iterator]();!(t=(l=s.next()).done);t=!0)a()}catch(u){i=!0,r=u}finally{try{t||null==s.return||s.return()}finally{if(i)throw r}}return n},Gn=function(){var e,n="".concat(null===(e=window.sdk)||void 0===e?void 0:e.ibc.winName).replace(/^@source\//,""),t=(0,s.O)(),o=t.setAgentId,c=t.setPageTitle,d=t.setPageSubtitle,h=t.getSource,p=t.setSource,x=t.onSource,m=t.onSourceModified,v=t.getSourceModified,T=t.setSourceModified,k=t.setSourceOrphans,A=t.onSceItemAdd,R=(0,u.$)().i18n,N=(0,S.useState)(!1),F=N[0],K=N[1],P=(0,S.useState)(!1),E=P[0],U=P[1],z=(0,S.useState)(null),D=z[0],L=z[1],W=(0,S.useState)(null),H=W[0],$=W[1],B=(0,S.useState)({}),V=B[0],Y=B[1];(0,S.useEffect)((function(){var e,t,a;o(n),null===(e=window.sdk)||void 0===e||e.ibc.send(y.Z.ibc.WINDOW_MAIN,"ibc-source:open",[!0]),window.addEventListener("beforeunload",(function(e){var t;null===(t=window.sdk)||void 0===t||t.ibc.send(y.Z.ibc.WINDOW_MAIN,"ipc:disk-storage:agents:commit",[n])})),null===(t=window.sdk)||void 0===t||t.ibc.handle("ibc-main:module-repo:data",(function(e){var t;"object"===typeof(null===e||void 0===e?void 0:e.agentData)&&(null===(t=e.agentData)||void 0===t?void 0:t.id)===n&&($(e.agentData),"object"===typeof e.moduleData&&L(e.moduleData),"object"===typeof e.sourceCode&&p(n,e.sourceCode,!1))})),null===(a=window.sdk)||void 0===a||a.ibc.handle("ibc-main:agent:data",(function(e){"object"===typeof e&&null!==e&&$((0,r.Z)({},e))})),(0,i.Z)((function(){var e,t,i,r;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,j.Z.get("agents")];case 1:return e=o.sent(),t=Array.isArray(e.data)?e.data.reduce((function(e,t){return(null===t||void 0===t?void 0:t.id)===n?t:e}),null):null,$(t),"string"!==typeof(null===t||void 0===t?void 0:t.installedModuleId)?[3,3]:[4,j.Z.get("modules/".concat(t.installedModuleId))];case 2:r=o.sent(),"string"===typeof(null===(i=r.data)||void 0===i?void 0:i.id)&&L(r.data),o.label=3;case 3:return[3,5];case 4:return o.sent(),[3,5];case 5:return K(v(n)),[2]}}))}))();var s=m((function(e){var t=e.agentId,i=e.modified;t===n&&K(i)}));return function(){return s()}}),[]),(0,S.useEffect)((function(){var e;c(null!==H?"".concat(null!==(e=H.name)&&void 0!==e?e:""):null),(0,i.Z)((function(){var e;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return"string"!==typeof(null===H||void 0===H?void 0:H.id)?[3,2]:[4,h(H.id,!0)];case 1:e=n.sent(),Y(null!==e&&void 0!==e?e:{}),k(H.id,qn(null!==e&&void 0!==e?e:"")),U(!0),n.label=2;case 2:return[2]}}))}))();var n=x((function(e){var n=e.agentId,t=e.sourceCode;n===(null===H||void 0===H?void 0:H.id)&&(Y(t),k(n,qn(t)))}));return function(){return n()}}),[H]),(0,S.useEffect)((function(){var e=A((function(e){var n=e.section,t=e.key;"string"===typeof(null===H||void 0===H?void 0:H.id)&&g(H.id,V,n,t,p,T)}));return function(){return e()}}),[null===H||void 0===H?void 0:H.id,V]);(0,S.useEffect)((function(){d((F?"\u25cf ":"")+R.t("Source code"))}),[F]);var q=[{key:f.ModuleSrc.K_SRC_STATE_MACHINE,label:R.t("Finite-state machine"),Icon:_.Z},{key:f.ModuleSrc.K_SRC_FUNCTIONS,label:R.t("Functions"),Icon:C.Z},{key:f.ModuleSrc.K_SRC_INPUTS,label:R.t("Inputs"),Icon:w.Z},{key:f.ModuleSrc.K_SRC_OUTPUTS,label:R.t("Outputs"),Icon:b.Z},{key:"search",label:R.t("Search"),Icon:M.Z},{key:"source-control",label:R.t("Source control"),Icon:I.Z}];return(0,a.jsxs)(Z.Z,{sx:{display:"flex",width:"100%",height:"100%"},children:[(0,a.jsx)(O,{icons:q,agent:H,loaded:E}),(0,a.jsx)(vn,{src:V,icons:q,agent:H,updateAgent:function(e){if("string"===typeof(null===e||void 0===e?void 0:e.id)){var n,t=structuredClone(e);delete t.moduleReleases,$(t),null===(n=window.sdk)||void 0===n||n.ibc.send(y.Z.ibc.WINDOW_MAIN,"ibc-source:agent:data",[t])}},updateModule:function(e,t){var i;"string"===typeof(null===e||void 0===e?void 0:e.id)&&(L(structuredClone(e)),null===(i=window.sdk)||void 0===i||i.ibc.send(y.Z.ibc.WINDOW_MAIN,"ibc-source:installed:data",[n,e,t]))},loaded:E,setLoaded:U,module:D}),(0,a.jsx)(Yn,{src:V,icons:q,agent:H,loaded:E})]})};Gn.guestGuard=!0;var Xn=Gn}},function(e){e.O(0,[901,884,899,83,955,774,888,179],(function(){return n=25877,e(e.s=n);var n}));var n=e.O();_N_E=n}]);