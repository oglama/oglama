/*!
 * @architect Mark Jivko <mark@oglama.com>
 * @copyright Â© 2024-2025 Oglama (https://oglama.com)
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[373],{25877:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/source-code",function(){return t(59722)}])},59722:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Un}});var i=t(47568),r=t(26042),o=t(29815),l=t(97582),a=t(85893),s=t(67817),u=t(77058),c=t(32342),d=t(67294),f=t(5082),h=t(87066),p=t(80822),x=t(22455),m=t(46956),v=t(2279),g=t(40533),y=t(75562),S=t(69497),j=t(69604),Z=t(90948),b=t(2734),C=t(34386),w=t(11057),I=t(23488),_=(0,Z.ZP)(w.Z)((function(e){return{width:"50px",minWidth:"50px",height:"50px",borderRadius:0,position:"relative","&:before":{content:'""',display:"block",position:"absolute",top:"5px",left:"3px",borderRadius:"5px",width:"5px",height:"40px",background:"transparent",opacity:0,transform:"scaleY(0%)",transition:"transform 200ms linear"},"&.active:before":{background:e.theme.palette.primary.main,transform:"scaleY(100%)",opacity:1}}})),k=(0,Z.ZP)(I.Z)((function(e){e.theme;return{position:"absolute",right:"5px",bottom:"5px"}})),T=function(e){var n=e.icons,t=void 0===n?[]:n,i=e.agent,r=e.loaded,o=void 0!==r&&r,l=(0,b.Z)(),u=(0,s.O)(),c=u.getSourceModified,h=u.onSourceModified,x=u.getSourceOrphans,m=u.onSourceOrphans,v=u.getSceSection,g=u.setSceSection,y=u.onSceSection,S=(0,d.useState)(f.ModuleSrc.K_SRC_STATE_MACHINE),Z=S[0],w=S[1],I=(0,d.useState)(!1),T=I[0],M=I[1],A=(0,d.useState)({}),R=A[0],N=A[1],F="1px 0px 0px 0px ".concat((0,j.k)(l));return(0,d.useEffect)((function(){if(null!==i){"string"===typeof(null===i||void 0===i?void 0:i.id)&&N(x(i.id));var e=m((function(e){var n=e.agentId,t=e.orphans;n===(null===i||void 0===i?void 0:i.id)&&N(t)}));M(c(i.id));var n=h((function(e){var n=e.agentId,t=e.modified;n===i.id&&M(t)}));w(v());var t=y((function(e){var n=e.section;w(n)}));return function(){n(),e(),t()}}}),[i]),(0,a.jsx)(p.Z,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"50px",boxShadow:F},children:t.map((function(e){var n=e.key,t=e.label,i=e.Icon,r=n===Z,l=null;do{if("source-control"===n&&T){l=(0,a.jsx)(k,{color:o?"primary":"disabled"});break}if(Array.isArray(R[n])&&R[n].length){l=(0,a.jsx)(k,{color:o?"warning":"disabled"});break}}while(0);return(0,a.jsx)(C.Z,{title:t||"",placement:"right",enterDelay:500,enterNextDelay:500,children:(0,a.jsx)(p.Z,{sx:{width:"50px",height:"50px"},children:(0,a.jsxs)(_,{className:r?"active":"",disabled:!o,color:"inherit",onClick:function(){return g(n)},children:[i?(0,a.jsx)(i,{fontSize:"medium",color:r?"inherit":"action"}):null,l]})})},n)}))})},M=t(65782),A=t.n(M),R=t(31425),N=t(6514),F=t(37645),P=t(93946),O=t(15861),K=t(50657),E=t(46901),z=t(74496),U=t(29691),D=t(21489),L=t(25577),W=t(17785),$=t(20214),H=t(14873),B=t(23599),V=t(18360),Y=t(78981),q=t(42945),G=t(22394),X=t(1431),Q=t(48136),J=t(34354),ee=t(11973),ne=t(51397),te=t(38047);var ie=t(47533),re=t(87536),oe=t(74231),le=t(56815),ae=t(87109),se=t(94054),ue=t(50135),ce=t(20811),de=t(42274),fe=function(e){var n=e.isOpen,t=void 0!==n&&n,r=e.version,o=void 0===r?null:r,s=e.onOpen,c=void 0===s?function(){}:s,f=e.onClose,h=void 0===f?function(){}:f,x=e.onRelease,m=void 0===x?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):x,v=e.description,g=(0,u.$)().i18n,y=(0,d.useRef)(null),S=(0,d.useState)(!1),j=S[0],Z=S[1],b=(0,d.useState)(!1),C=b[0],I=b[1],_="string"===typeof o?function(e){var n=e.split(".").map(Number);return n[n.length-1]++,n.join(".")}(o):"0.0.1",k={versionName:oe.Z_().required(g.t("Release version is required")).matches(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/,g.t("Version name must follow the x.y.z format with no leading zeros")).test("is-greater-or-equal",g.t("Version must be greater than or equal to {{v}}",{v:_}),(function(e){return e&&function(e,n){for(var t=e.split(".").map(Number),i=n.split(".").map(Number);t.length<i.length;)t.push(0);for(;i.length<t.length;)i.push(0);for(var r=0;r<t.length;r++){if(t[r]>i[r])return!0;if(t[r]<i[r])return!1}return!0}(e,_)})),changes:oe.Z_().max(512,(function(){return g.t("Must be at most {{n}} characters long",{n:512})}))},T={versionName:_,changes:""},M=(0,re.cI)({defaultValues:T,mode:"onChange",resolver:(0,ie.X)(oe.Ry().shape(k))}),A=M.reset,U=M.control,D=M.handleSubmit,W=M.formState.errors,$=function(){var e=(0,i.Z)((function(e){var n,t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return n=e.versionName,t=e.changes,I(!0),[4,m(n,t)];case 1:return i.sent(),I(!1),h(),[2]}}))}));return function(n){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){t&&"function"===typeof c&&c()}),[t]);var H=function(){t&&"function"===typeof h&&h(),A()},B=function(){y.current&&y.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))};return t?(0,a.jsxs)(K.Z,{open:!0,onClose:C?function(){}:H,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:2}},children:[C?null:(0,a.jsx)(F.Z,{children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,a.jsx)(O.Z,{variant:"h4",sx:{ml:4},children:g.t("Publish a release")}),(0,a.jsx)(P.Z,{"aria-label":g.t("More information"),sx:{ml:2},color:"default",onClick:function(){return Z(!j)},size:"large",children:j?(0,a.jsx)(L.Z,{}):(0,a.jsx)(z.Z,{})})]})}),(0,a.jsxs)(N.Z,{children:[!C&&v&&j?(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",children:v})}):null,!C&&j?(0,a.jsxs)(E.Z,{severity:"warning",sx:{mb:6},children:[g.t("Please make sure you have tested your code thouroughly before releasing it!"),(0,a.jsx)("br",{}),g.t("New users and those who have enabled auto-update will instantly use this new version of your module.")]}):null,C?(0,a.jsx)(p.Z,{sx:{mt:3},children:(0,a.jsx)(de.Z,{})}):(0,a.jsxs)("form",{onSubmit:D($),ref:y,children:[(0,a.jsxs)(se.Z,{fullWidth:!0,sx:{my:3},error:!!W.versionName,children:[(0,a.jsx)(re.Qr,{name:"versionName",control:U,render:function(e){var n=e.field,t=n.value,i=n.onChange;return(0,a.jsx)(ue.Z,{disabled:C,autoFocus:!0,required:!0,value:t,onChange:i,onKeyDown:function(e){return"Enter"===e.key&&B()},spellCheck:!1,autoComplete:"off",inputProps:{minLength:3,maxLength:64,tabIndex:1},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{mr:-2},children:(0,a.jsx)(ce.Z,{fontSize:"small"})})},label:g.t("Release version"),placeholder:_,error:Boolean(W.versionName)})}}),W.versionName&&(0,a.jsx)(le.Z,{sx:{color:"error.main"},children:W.versionName.message})]}),(0,a.jsxs)(se.Z,{fullWidth:!0,sx:{my:3},error:!!W.changes,children:[(0,a.jsx)(re.Qr,{name:"changes",control:U,render:function(e){var n=e.field,t=n.value,i=n.onChange;return(0,a.jsx)(ue.Z,{multiline:!0,rows:2,value:t,onChange:i,spellCheck:!1,autoComplete:"off",inputProps:{maxLength:512,tabIndex:2},label:g.t("Release details"),placeholder:"string"===typeof o?g.t("Bug fixes and improvements in this version"):g.t("First release"),error:Boolean(W.changes)})}}),W.changes&&(0,a.jsx)(le.Z,{sx:{color:"error.main"},children:W.changes.message})]})]})]}),C?null:(0,a.jsxs)(R.Z,{children:[(0,a.jsx)(w.Z,{color:"secondary",onClick:H,children:g.t("Cancel")}),(0,a.jsx)(w.Z,{variant:"contained",onClick:B,startIcon:(0,a.jsx)(Y.Z,{}),children:g.t("Publish release")})]})]}):null},he=t(5097),pe=t(40876),xe=function(e){var n=e.isOpen,t=void 0!==n&&n,r=e.onOpen,o=void 0===r?function(){}:r,s=e.onClose,c=void 0===s?function(){}:s,f=e.onImport,h=void 0===f?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):f,x=e.description,m=(0,u.$)().i18n,v=(0,d.useState)(!1),g=v[0],y=v[1],S=(0,d.useState)(!1),j=S[0],Z=S[1];(0,d.useEffect)((function(){t&&"function"===typeof o&&o()}),[t]);var b=function(){t&&"function"===typeof c&&c()};return t?(0,a.jsxs)(K.Z,{open:!0,onClose:j?function(){}:b,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:2}},children:[j?null:(0,a.jsx)(F.Z,{children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,a.jsx)(O.Z,{variant:"h4",sx:{ml:4},children:m.t("Import from YAML")}),(0,a.jsx)(P.Z,{"aria-label":m.t("More information"),sx:{ml:2},color:"default",onClick:function(){return y(!g)},size:"large",children:g?(0,a.jsx)(L.Z,{}):(0,a.jsx)(z.Z,{})})]})}),(0,a.jsxs)(N.Z,{children:[!j&&x&&g?(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",children:x})}):null,!j&&g?(0,a.jsx)(E.Z,{severity:"warning",sx:{mb:6},children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",children:m.t("Warning! The imported source code will overwrite your current work.")})}):null,j?(0,a.jsx)(p.Z,{sx:{mt:6},children:(0,a.jsx)(de.Z,{})}):(0,a.jsx)(pe.Z,{maxSize:2,extensions:["yaml"],handleFiles:function(e){var n=Array.isArray(e)&&e.length?e[0]:null;if(n&&"string"===typeof(null===n||void 0===n?void 0:n.name)&&n.name.toLowerCase().endsWith(".oglama.yaml")){Z(!0);var t=new FileReader;t.onload=function(){var e=(0,i.Z)((function(e){var n,t,i;return(0,l.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n=(0,H.Qc)(e.target.result),[4,h(n)];case 1:return r.sent(),he.A.success(m.t("Source code imported successfully!")),b(),[3,3];case 2:return t=r.sent(),he.A.error("".concat(m.t("Import error"),": ").concat(null!==(i=t.message)&&void 0!==i?i:t),{duration:5e3,ariaProps:{role:"alert"}}),[3,3];case 3:return Z(!1),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),t.readAsText(n)}else he.A.error(m.t("Invalid file extension, expected '.oglama.yaml'"),{duration:5e3,ariaProps:{role:"alert"}})}})]}),j?null:(0,a.jsx)(R.Z,{children:(0,a.jsx)(w.Z,{color:"secondary",onClick:b,children:m.t("Close")})})]}):null},me=t(86822),ve=t(60848),ge=(0,Z.ZP)(w.Z)((function(e){var n=e.theme;return{justifyContent:"start",textTransform:"none","& > .MuiButton-icon":{marginLeft:n.spacing(.5),marginRight:n.spacing(3)},fontSize:"0.75rem",color:"inherit"}})),ye=function(e){var n,t,r,o,c,x=e.module,m=e.setModule,v=void 0===m?function(){}:m,g=e.agent,y=e.updateAgent,S=void 0===y?function(){}:y,j=e.loaded,Z=void 0!==j&&j,b=e.setLoaded,I=void 0===b?function(){}:b,_=(0,s.O)(),k=_.getSource,T=_.setSource,M=_.setSourceModified,A=_.getSourceModified,z=_.onSourceModified,U=(0,u.$)().i18n,D=(0,$.a)(),L=(0,d.useState)(!1),W=L[0],ie=L[1],re=(0,d.useState)(!1),oe=re[0],le=re[1],ae=(0,d.useState)(!1),se=ae[0],ue=ae[1],ce=(0,d.useState)(!1),de=ce[0],he=ce[1],pe=(0,d.useState)(!1),ye=pe[0],Se=pe[1];(0,d.useEffect)((function(){Se(A(g.id));var e=z((function(e){var n=e.agentId,t=e.modified;n===g.id&&Se(t)}));return function(){e()}}),[g]);var je,Ze=function(){var e=(0,i.Z)((function(){var e,n,t,i,r,o,a,s,u,c;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return"string"!==typeof(null===g||void 0===g?void 0:g.id)?[2]:[4,k(g.id,!0)];case 1:e=l.sent(),n=!0,t=!1,i=void 0;try{for(r=Object.values(f.ModuleSrc)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)a=o.value,e[a]=(Array.isArray(e[a])?e[a]:[]).map((function(e){return"object"===typeof e&&null!==e?(delete e.id,e):null})).filter((function(e){return null!==e}))}catch(d){t=!0,i=d}finally{try{n||null==r.return||r.return()}finally{if(t)throw i}}return s=(0,H.Pz)(e,{lineWidth:0,aliasDuplicateObjects:!1,defaultStringType:"PLAIN"}),u=URL.createObjectURL(new Blob([s],{type:"application/x-yaml"})),(c=document.createElement("a")).download="".concat("".concat(g.name).replace(/\W+/gi,"-").toLowerCase(),".oglama.yaml"),c.href=u,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(u),[2]}}))}));return function(){return e.apply(this,arguments)}}(),be=function(){var e=(0,i.Z)((function(e){var n,t,i,r,o,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if("object"!==typeof e||null===e)throw new Error(U.t("Invalid YAML format"));n=!0,t=!1,i=void 0;try{for(r=Object.values(f.ModuleSrc)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)if(a=o.value,!Array.isArray(e[a]))throw new Error(U.t('Key "{{n}}" missing from source code YAML',{n:a}))}catch(s){t=!0,i=s}finally{try{n||null==r.return||r.return()}finally{if(t)throw i}}return T(g.id,e),M(g.id),I(!1),[4,new Promise((function(e){return window.setTimeout(e,500)}))];case 1:return l.sent(),I(!0),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Ce=function(){var e=(0,i.Z)((function(e,n){var t,i,r,o,a,s,u;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:if("string"!==typeof(null===g||void 0===g?void 0:g.id))return[2];if(!["fork","release"].includes(e))return[2];if("object"!==typeof n||null===n)return[2];I(!1),l.label=1;case 1:return l.trys.push([1,7,,8]),r=h.Z.put,o=["agents/".concat(g.id,"/src")],[4,k(g.id,!0)];case 2:return[4,r.apply(h.Z,o.concat(l.sent()))];case 3:return l.sent(),[4,h.Z.post("agents/".concat(g.id,"/").concat(e),n)];case 4:return a=l.sent(),"string"===typeof(null===(t=a.data)||void 0===t?void 0:t.id)&&S(a.data),"string"!==typeof(null===(i=a.data)||void 0===i?void 0:i.installedModuleId)?[3,6]:[4,h.Z.get("modules/".concat(a.data.installedModuleId))];case 5:u=l.sent(),"string"===typeof(null===(s=u.data)||void 0===s?void 0:s.id)&&v(u.data),l.label=6;case 6:return M(g.id,!1),[3,8];case 7:return l.sent(),[3,8];case 8:return I(!0),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}(),we=function(){var e=(0,i.Z)((function(e){var n,t,i,r;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:if("string"!==typeof(null===g||void 0===g?void 0:g.id))return[2];if("string"!==typeof(null===x||void 0===x?void 0:x.id))return[2];if("string"!==typeof e)return[2];I(!1),o.label=1;case 1:return o.trys.push([1,4,,5]),[4,h.Z.put("agents/".concat(g.id,"/modules/").concat(x.id),{srcId:e})];case 2:return i=o.sent(),g.id===(null===(n=i.data)||void 0===n?void 0:n.id)&&S(i.data),[4,h.Z.get("agents/".concat(g.id,"/src"))];case 3:return r=o.sent(),Array.isArray(null===(t=r.data)||void 0===t?void 0:t.srcStateMachine)&&(T(g.id,r.data),M(g.id,!1)),[3,5];case 4:return o.sent(),[3,5];case 5:return I(!0),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Ie="string"===typeof(null===g||void 0===g?void 0:g.installedModuleSrcId)&&Array.isArray(null===x||void 0===x?void 0:x.moduleReleases)&&(null===x||void 0===x?void 0:x.moduleReleases.length)?x.moduleReleases[x.moduleReleases.length-1].srcVersion:null;return(0,a.jsxs)(p.Z,{children:[(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between",p:2},children:[Z?null!==x?(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",pl:2},children:[(null===(n=D.user)||void 0===n?void 0:n.id)===x.authorId||"founder"===(null===(t=D.user)||void 0===t?void 0:t.userRole)?(0,a.jsx)(me.Z,{tooltipPlacement:"top",inactive:!0,module:x}):null,(0,a.jsx)(C.Z,{title:"".concat(U.t("Installed module"),": ").concat(x.moduleName),placement:"top",children:(0,a.jsx)(O.Z,{variant:"caption",sx:{ml:3,userSelect:"none",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",maxWidth:"110px",textTransform:"none",height:"35px",lineHeight:"35px"},children:x.moduleName})})]}),Array.isArray(null===x||void 0===x?void 0:x.moduleReleases)&&x.moduleReleases.length?(0,a.jsx)(C.Z,{title:U.t("Selected version"),placement:"top",children:(0,a.jsx)(V.Z,{variant:"standard",value:null!==(je=null===g||void 0===g?void 0:g.installedModuleSrcId)&&void 0!==je?je:null,onChange:function(e){return we(e.target.value)},sx:{ml:1,height:"35px",borderRadius:0,"&.MuiInput-root:before":{display:"none"},"& .MuiSelect-select.MuiSelect-standard":{minWidth:"30px !important"}},inputProps:{sx:{py:3,pl:1,borderRadius:0}},children:x.moduleReleases.map((function(e){var n=e.srcId,t=e.srcVersion;return(0,a.jsx)(B.Z,{value:n,children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",fontSize:"0.75rem",mt:"-1px"},children:["v.",t]})},n)}))})}):(0,a.jsxs)(O.Z,{variant:"caption",sx:{userSelect:"none",ml:2},children:["(",U.t("no releases"),")"]})]}):(0,a.jsx)(O.Z,{variant:"caption",sx:{userSelect:"none",ml:2},children:U.t("No module installed")}):null,Z&&ye?(0,a.jsx)(C.Z,{title:U.t("Source code modified"),placement:"top",children:(0,a.jsx)(P.Z,{onClick:function(){return ie(!0)},sx:{ml:1,height:"35px",width:"35px"},children:(0,a.jsx)(ne.Z,{fontSize:"small",sx:{transform:"scale(0.8)"},color:"primary"})})}):null]}),(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",p:2,flexDirection:"column"},children:[null!==x&&(null===(r=D.user)||void 0===r?void 0:r.id)===x.authorId?(0,a.jsx)(ge,{startIcon:(0,a.jsx)(Y.Z,{fontSize:"small",color:"action"}),onClick:function(){return le(!0)},children:U.t("Publish a release")}):null,(0,a.jsx)(ge,{startIcon:(0,a.jsx)(Q.Z,{fontSize:"small",color:"action"}),onClick:function(){return he(!0)},children:U.t("Clone as new module")}),(0,a.jsx)(ge,{startIcon:(0,a.jsx)(G.Z,{fontSize:"small",color:"action"}),onClick:function(){return ue(!0)},children:U.t("Import from YAML")}),(0,a.jsx)(ge,{startIcon:(0,a.jsx)(q.Z,{fontSize:"small",color:"action"}),onClick:function(){return Ze()},children:U.t("Export as YAML")})]}),se?(0,a.jsx)(xe,{isOpen:!0,description:U.t("Import agent source code from a '.oglama.yaml' file."),onClose:function(){return ue(!1)},onImport:be}):null,null!==x&&(null===(o=D.user)||void 0===o?void 0:o.id)===x.authorId&&oe?(0,a.jsx)(fe,{isOpen:!0,module:x,description:U.t("Store the changes you have made to this module's source code in a new release.")+(x.isApproved&&x.isPublic?" "+U.t("This new release will be instantly available for users in the module repository."):""),version:Ie,onClose:function(){return le(!1)},onRelease:function(e,n){return Ce("release",{version:e,changes:n})}}):null,de?(0,a.jsx)(ve.Z,{isOpen:!0,title:U.t("Clone as new module"),description:U.t("Create a new module and store the current source code in release v0.0.1"),onClose:function(){return he(!1)},onCreate:function(e,n){return Ce("fork",{moduleName:e,moduleDescription:n})}}):null,W?(0,a.jsxs)(K.Z,{open:!0,onClose:function(){return ie(!1)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:2}},children:[(0,a.jsx)(F.Z,{children:U.t("Locally modified source code")}),(0,a.jsxs)(N.Z,{children:[(0,a.jsx)(E.Z,{sx:{mb:3},icon:(0,a.jsx)(ee.Z,{}),children:U.t("Changes to the source code are instantly saved on your local computer.")}),(null===(c=D.user)||void 0===c?void 0:c.id)===(null===x||void 0===x?void 0:x.authorId)?(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(X.Z,{}),children:U.t("Once you are ready to share your changes with others you can publish them as a new release which will become available for install from the module repository.")}):(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(te.Z,{}),children:U.t("If you wish to share your modifications with others, you can export your work as a new module and publish it on the module repository.")}),(0,a.jsx)(E.Z,{severity:"info",icon:(0,a.jsx)(J.Z,{}),children:U.t("You can also export and import your work as YAML files completely privately, outside of the module repository.")})]}),(0,a.jsx)(R.Z,{children:(0,a.jsx)(w.Z,{color:"secondary",onClick:function(){return ie(!1)},children:U.t("OK")})})]}):null]})},Se=t(828),je=t(74595),Ze=t(758),be=function(e,n,t){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];e=(0,Ze.W)(e);for(var r=(Array.isArray(i)?i:[]).filter((function(e){return(null===e||void 0===e?void 0:e.id)!==t})).map((function(e){return null===e||void 0===e?void 0:e.key})),o=1;;){if(e.length>0&&!r.includes(e))break;e="".concat(n,"-").concat(o++)}return e},Ce=t(51474),we=t(38299),Ie=t(65834),_e=t(82670),ke=t(69396),Te=t(25410),Me=t(48859),Ae=(0,Z.ZP)(p.Z)((function(e){return{width:"100%",display:"flex",marginBottom:e.theme.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}})),Re=function(e){var n,t,i=e.state,o=e.id,l=e.active,s=void 0!==l&&l,c=e.index,f=e.tooltip,h=void 0===f?"":f,x=e.orphan,m=void 0!==x&&x,v=e.error,g=void 0!==v&&v,y=e.selected,S=void 0!==y&&y,j=e.agentStatus,Z=void 0===j?-1:j,w=e.prepareKey,I=void 0===w?function(){}:w,_=e.onClick,k=void 0===_?function(){}:_,T=e.onDelete,M=void 0===T?function(){}:T,A=e.onKeyChange,R=void 0===A?function(){}:A,N=(0,u.$)().i18n,F=(0,b.Z)(),O=(0,d.useRef)(null),K=(0,d.useRef)(null),E=(0,d.useRef)(null),z=(0,d.useRef)(!0),D=(0,d.useState)(null!==(t=null===i||void 0===i?void 0:i.key)&&void 0!==t?t:""),L=D[0],W=D[1],$=(0,d.useCallback)((function(e){null!==O.current&&window.clearTimeout(O.current),O.current=window.setTimeout((function(){W(I(e,null===i||void 0===i?void 0:i.id)),O.current=null}),1e3)}),[]);(0,d.useEffect)((function(){R(null===i||void 0===i?void 0:i.id,I(L,null===i||void 0===i?void 0:i.id),z.current),z.current&&(z.current=!1)}),[L]),(0,d.useEffect)((function(){if(S&&(0,_e.Z)(K.current,Element)){var e=K.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||K.current.scrollIntoView({behavior:"instant",block:"center"})}}),[S]);var H=S?g?F.palette.error.main:0===Z?F.palette.warning.main:F.palette.primary.main:null,B=s?F.palette.primary.main:m?F.palette.warning.main:null;return(0,a.jsxs)(Ae,{ref:K,children:[(0,a.jsx)(p.Z,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,a.jsx)(p.Z,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!==H&&void 0!==H?H:"transparent",transform:"scaleY(".concat(S?"100":"0","%)"),transition:"transform 250ms linear"}})}),0===c?(0,a.jsx)(C.Z,{title:N.t("Entry state"),placement:"right",children:(0,a.jsx)(U.Z,{color:s?"primary":"action",sx:{mx:1}})}):m?(0,a.jsx)(C.Z,{arrow:!0,placement:"right",title:N.t('Orphan state. Call with return { next: "{{keyText}}" }.',{keyText:null===(n=E.current)||void 0===n?void 0:n.value}),children:(0,a.jsx)(Te.Z,{color:"warning",sx:{mx:1}})}):(0,a.jsx)(Me.Z,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,a.jsx)(C.Z,{title:h,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,a.jsxs)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,a.jsx)(ue.Z,{inputRef:E,variant:"standard",color:m?"warning":"primary",onClick:k,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:L,placeholder:N.t("State key"),onChange:function(e){return $(e.target.value)},inputProps:{id:o,style:(0,ke.Z)((0,r.Z)({},null!==B?{color:B}:{}),{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5})}}),(0,a.jsx)(P.Z,{className:"delete",sx:{ml:1},size:"small",onClick:function(){return M(null===i||void 0===i?void 0:i.id)},children:(0,a.jsx)(we.Z,{fontSize:"small"})})]})})]})},Ne=t(63203),Fe=function(e){var n=e.value,t=e.total,i=e.title,r=void 0===i?null:i;return(!Number.isInteger(t)||t<=0)&&(t=100),(!Number.isInteger(n)||n<0)&&(n=0),n>t&&(n=t),(0,a.jsx)(C.Z,{title:r,placement:"right",children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",width:"100%",my:2,px:2},children:[(0,a.jsx)(Ne.Z,{sx:{borderRadius:1},variant:"determinate",value:100*n/t,color:"inherit"}),(0,a.jsxs)(O.Z,{variant:"caption",sx:{flexShrink:0,ml:3},children:[n,"/",t]})]})})},Pe=function(e){var n=e.agent,t=e.loaded,r=e.activeId,c=void 0===r?null:r,h=e.srcStateMachine,x=void 0===h?[]:h,m=e.agentStatus,v=void 0===m?-1:m,g=e.selectedStateKey,y=void 0===g?null:g,S=e.selectedStateError,j=void 0!==S&&S,Z="state",b=(0,s.O)(),C=b.getSource,I=b.setSource,_=b.setSourceModified,k=b.getSourceOrphans,T=b.onSourceOrphans,M=b.setSceTabs,P=b.onSceItemAdd,O=(0,u.$)().i18n,z=(0,d.useState)(null),U=z[0],D=z[1],L=(0,d.useState)([]),W=L[0],$=L[1],H=(0,d.useRef)(x),B=(0,d.useRef)(null),V=(0,d.useRef)(null),Y=function(e,n){return be(e,Z,n,x)},q=function(){var e=(0,i.Z)((function(){var e,t,i,r=arguments;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:null,"string"!==typeof(null===n||void 0===n?void 0:n.id)||x.length>=A().max.sourceCode.smCount?[2]:[4,C(n.id,!0)];case 1:return t=o.sent(),Array.isArray(null===t||void 0===t?void 0:t.srcStateMachine)&&(i=(0,je.H)(),t.srcStateMachine.push({id:i,key:Y(e,i),code:""}),I(n.id,t),_(n.id),setTimeout((function(){var e=document.getElementById("".concat(Z,"-").concat(i));null===e||void 0===e||e.focus(),null===e||void 0===e||e.click()}),250)),[2]}}))}));return function(){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){"string"===typeof(null===n||void 0===n?void 0:n.id)&&$(k(n.id).srcStateMachine);var e=T((function(e){var t=e.agentId,i=e.orphans;t===(null===n||void 0===n?void 0:n.id)&&$(i.srcStateMachine)})),t=P((function(e){var n=e.section,t=e.key;f.ModuleSrc.K_SRC_STATE_MACHINE===n&&q(t)}));return function(){e(),t()}}),[null===n||void 0===n?void 0:n.id]),(0,d.useEffect)((function(){V.current&&Array.isArray(x)&&(H.current=x,B.current=Ce.ZP.create(V.current,{animation:150,onUpdate:function(){var e=(0,i.Z)((function(e){var t,i,r,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,o.Z)(H.current),i=(0,Se.Z)(t.splice(e.oldIndex,1),1),r=i[0],t.splice(e.newIndex,0,r),H.current=t,[4,C(n.id)];case 1:return(a=l.sent()).srcStateMachine=t,I(n.id,a),_(n.id),[2]}}))}));return function(n){return e.apply(this,arguments)}}()}))}),[x]);var G=function(){var e=(0,i.Z)((function(e){var t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return D(null),[4,C(n.id)];case 1:return t=i.sent(),Array.isArray(null===t||void 0===t?void 0:t.srcStateMachine)&&"string"===typeof e&&(t.srcStateMachine=t.srcStateMachine.filter((function(n){return n.id!==e})),M(f.ModuleSrc.K_SRC_STATE_MACHINE,e,!1),I(n.id,t),_(n.id)),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),X=function(){var e=(0,i.Z)((function(e,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>2&&void 0!==o[2])||o[2],[4,C(n.id)];case 1:return r=l.sent(),Array.isArray(null===r||void 0===r?void 0:r.srcStateMachine)&&"string"===typeof e&&(r.srcStateMachine=r.srcStateMachine.map((function(n){return n.id===e&&(n.key=t),n})),I(n.id,r),i||_(n.id)),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[t?(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,a.jsx)(p.Z,{sx:{width:"100%"},ref:V,children:x.map((function(e,n){var t,i="".concat(null!==(t=e.code)&&void 0!==t?t:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,a.jsx)(Re,{id:"".concat(Z,"-").concat(e.id),active:c===e.id,state:e,index:n,orphan:W.includes(e.key),tooltip:i,error:e.key===y&&j,selected:e.key===y,agentStatus:v,prepareKey:Y,onClick:function(){return M(f.ModuleSrc.K_SRC_STATE_MACHINE,e.id)},onDelete:function(e){return D(e)},onKeyChange:X},e.id)}))}),(0,a.jsx)(Fe,{value:x.length,total:A().max.sourceCode.smCount,title:O.t("Total number of states in this finite-state machine")}),x.length<A().max.sourceCode.smCount?(0,a.jsx)(w.Z,{onClick:function(){return q()},startIcon:(0,a.jsx)(Ie.Z,{}),size:"small",children:O.t("Add state")}):null]}):(0,a.jsx)(p.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(de.Z,{count:3})}),null!==U?(0,a.jsxs)(K.Z,{open:!0,onClose:function(){return D(null)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:2}},children:[(0,a.jsx)(F.Z,{children:O.t("Delete State")}),(0,a.jsx)(N.Z,{children:(0,a.jsx)(E.Z,{severity:"warning",children:O.t("Are you sure you want to delete this state?")})}),(0,a.jsxs)(R.Z,{children:[(0,a.jsx)(w.Z,{color:"secondary",onClick:function(){return D(null)},children:O.t("Cancel")}),(0,a.jsx)(w.Z,{color:"error",onClick:function(){return G(U)},startIcon:(0,a.jsx)(we.Z,{}),children:O.t("Delete State")})]})]}):null]})},Oe=(0,Z.ZP)(p.Z)((function(e){return{width:"100%",display:"flex",marginBottom:e.theme.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}})),Ke=function(e){var n,t,i=e.fn,o=e.id,l=e.active,s=void 0!==l&&l,c=e.tooltip,f=void 0===c?"":c,h=e.orphan,x=void 0!==h&&h,m=e.error,v=void 0!==m&&m,g=e.selected,y=void 0!==g&&g,S=e.agentStatus,j=void 0===S?-1:S,Z=e.prepareKey,w=void 0===Z?function(){}:Z,I=e.onClick,_=void 0===I?function(){}:I,k=e.onDelete,T=void 0===k?function(){}:k,M=e.onKeyChange,A=void 0===M?function(){}:M,R=(0,u.$)().i18n,N=(0,b.Z)(),F=(0,d.useRef)(null),O=(0,d.useRef)(!0),K=(0,d.useRef)(null),E=(0,d.useRef)(null),z=(0,d.useState)(null!==(t=null===i||void 0===i?void 0:i.key)&&void 0!==t?t:""),U=z[0],D=z[1],L=(0,d.useCallback)((function(e){null!==F.current&&window.clearTimeout(F.current),F.current=window.setTimeout((function(){D(w(e,null===i||void 0===i?void 0:i.id)),F.current=null}),1e3)}),[]);(0,d.useEffect)((function(){A(null===i||void 0===i?void 0:i.id,w(U,null===i||void 0===i?void 0:i.id),O.current),O.current&&(O.current=!1)}),[U]),(0,d.useEffect)((function(){if(y&&(0,_e.Z)(K.current,Element)){var e=K.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||K.current.scrollIntoView({behavior:"instant",block:"center"})}}),[y]);var W=y?v?N.palette.error.main:0===j?N.palette.warning.main:N.palette.primary.main:null,$=s?N.palette.primary.main:x?N.palette.warning.main:null;return(0,a.jsxs)(Oe,{ref:K,children:[(0,a.jsx)(p.Z,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,a.jsx)(p.Z,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!==W&&void 0!==W?W:"transparent",transform:"scaleY(".concat(y?"100":"0","%)"),transition:"transform 250ms linear"}})}),x?(0,a.jsx)(C.Z,{arrow:!0,placement:"right",title:R.t('Orphan function. Call with $.fn( "{{keyText}}" )',{keyText:null===(n=E.current)||void 0===n?void 0:n.value}),children:(0,a.jsx)(Te.Z,{color:"warning",sx:{mx:1}})}):(0,a.jsx)(Me.Z,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,a.jsx)(C.Z,{title:f,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,a.jsxs)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,a.jsx)(ue.Z,{inputRef:E,variant:"standard",color:x?"warning":"primary",onClick:_,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:U,placeholder:R.t("Function key"),onChange:function(e){return L(e.target.value)},inputProps:{id:o,style:(0,ke.Z)((0,r.Z)({},null!==$?{color:$}:{}),{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5})}}),(0,a.jsx)(P.Z,{className:"delete",sx:{ml:1},size:"small",onClick:function(){return T(null===i||void 0===i?void 0:i.id)},children:(0,a.jsx)(we.Z,{fontSize:"small"})})]})})]})},Ee=function(e){var n=e.agent,t=e.loaded,r=e.activeId,c=void 0===r?null:r,h=e.srcFunctions,x=void 0===h?[]:h,m=e.agentStatus,v=void 0===m?-1:m,g=e.selectedFnKey,y=void 0===g?null:g,S=e.selectedFnError,j=void 0!==S&&S,Z="function",b=(0,s.O)(),C=b.getSource,I=b.setSource,_=b.setSourceModified,k=b.getSourceOrphans,T=b.onSourceOrphans,M=b.setSceTabs,P=b.onSceItemAdd,O=(0,u.$)().i18n,z=(0,d.useState)(null),U=z[0],D=z[1],L=(0,d.useState)([]),W=L[0],$=L[1],H=(0,d.useRef)(x),B=(0,d.useRef)(null),V=(0,d.useRef)(null),Y=function(e,n){return be(e,Z,n,x)},q=function(){var e=(0,i.Z)((function(){var e,t,i,r=arguments;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:null,"string"!==typeof(null===n||void 0===n?void 0:n.id)||x.length>=A().max.sourceCode.fnCount?[2]:[4,C(n.id,!0)];case 1:return t=o.sent(),Array.isArray(null===t||void 0===t?void 0:t.srcFunctions)&&(i=(0,je.H)(),t.srcFunctions.push({id:i,key:Y(e,i),code:""}),I(n.id,t),_(n.id),setTimeout((function(){var e=document.getElementById("".concat(Z,"-").concat(i));null===e||void 0===e||e.focus(),null===e||void 0===e||e.click()}),250)),[2]}}))}));return function(){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){"string"===typeof(null===n||void 0===n?void 0:n.id)&&$(k(n.id).srcFunctions);var e=T((function(e){var t=e.agentId,i=e.orphans;t===(null===n||void 0===n?void 0:n.id)&&$(i.srcFunctions)})),t=P((function(e){var n=e.section,t=e.key;console.log(n,t),f.ModuleSrc.K_SRC_FUNCTIONS===n&&q(t)}));return function(){e(),t()}}),[null===n||void 0===n?void 0:n.id]),(0,d.useEffect)((function(){V.current&&Array.isArray(x)&&(H.current=x,B.current=Ce.ZP.create(V.current,{animation:150,onUpdate:function(){var e=(0,i.Z)((function(e){var t,i,r,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,o.Z)(H.current),i=(0,Se.Z)(t.splice(e.oldIndex,1),1),r=i[0],t.splice(e.newIndex,0,r),H.current=t,[4,C(n.id)];case 1:return(a=l.sent()).srcFunctions=t,I(n.id,a),_(n.id),[2]}}))}));return function(n){return e.apply(this,arguments)}}()}))}),[x]);var G=function(){var e=(0,i.Z)((function(e){var t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return D(null),[4,C(n.id)];case 1:return t=i.sent(),Array.isArray(null===t||void 0===t?void 0:t.srcFunctions)&&"string"===typeof e&&(t.srcFunctions=t.srcFunctions.filter((function(n){return n.id!==e})),M(f.ModuleSrc.K_SRC_FUNCTIONS,e,!1),I(n.id,t),_(n.id)),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),X=function(){var e=(0,i.Z)((function(e,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>2&&void 0!==o[2])||o[2],[4,C(n.id)];case 1:return r=l.sent(),Array.isArray(null===r||void 0===r?void 0:r.srcFunctions)&&"string"===typeof e&&(r.srcFunctions=r.srcFunctions.map((function(n){return n.id===e&&(n.key=t),n})),I(n.id,r),i||_(n.id)),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[t?(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,a.jsx)(p.Z,{sx:{width:"100%"},ref:V,children:x.map((function(e,n){var t,i="".concat(null!==(t=e.code)&&void 0!==t?t:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,a.jsx)(Ke,{fn:e,id:"".concat(Z,"-").concat(e.id),active:e.id===c,index:n,orphan:W.includes(e.key),tooltip:i,error:e.key===y&&j,selected:e.key===y,agentStatus:v,prepareKey:Y,onClick:function(){return M(f.ModuleSrc.K_SRC_FUNCTIONS,e.id)},onDelete:function(e){return D(e)},onKeyChange:X},e.id)}))}),(0,a.jsx)(Fe,{value:x.length,total:A().max.sourceCode.fnCount,title:O.t("Total number of functions in this module")}),x.length<A().max.sourceCode.fnCount?(0,a.jsx)(w.Z,{onClick:function(){return q()},startIcon:(0,a.jsx)(Ie.Z,{}),size:"small",children:O.t("Add function")}):null]}):(0,a.jsx)(p.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(de.Z,{count:3})}),null!==U?(0,a.jsxs)(K.Z,{open:!0,onClose:function(){return D(null)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:2}},children:[(0,a.jsx)(F.Z,{children:O.t("Delete Function")}),(0,a.jsx)(N.Z,{children:(0,a.jsx)(E.Z,{severity:"warning",children:O.t("Are you sure you want to delete this function?")})}),(0,a.jsxs)(R.Z,{children:[(0,a.jsx)(w.Z,{color:"secondary",onClick:function(){return D(null)},children:O.t("Cancel")}),(0,a.jsx)(w.Z,{color:"error",onClick:function(){return G(U)},startIcon:(0,a.jsx)(we.Z,{}),children:O.t("Delete Function")})]})]}):null]})},ze=t(14924),Ue=t(76530),De=t(7902),Le=(0,Z.ZP)(O.Z)((function(e){e.theme;return{whiteSpace:"pre-wrap",fontSize:"0.8rem",lineHeight:"0.8rem",fontFamily:"Inconsolata,monospace",textAlign:"left","& > span, & > span > span":{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",verticalAlign:"top",width:"100%",maxWidth:"250px"},"& > span > span":{width:"auto",maxWidth:"75px",textAlign:"left",direction:"rtl"},"& > span > span > span":{direction:"ltr",unicodeBidi:"bidi-override",verticalAlign:"top"},"&.single":{fontWeight:"bold"},"&.single > span":{maxWidth:"200px"},"& i":{background:"rgba(255,215,0,0.8)",color:"#000",textTransform:"none",fontStyle:"normal",verticalAlign:"top",marginLeft:"2px"}}})),We=(0,Z.ZP)(w.Z)((function(e){var n=e.theme;return{width:"100%",display:"flex",flexDirection:"column",marginBottom:n.spacing(1),cursor:"pointer",alignItems:"start",justifyContent:"start",textTransform:"none",position:"relative",paddingLeft:n.spacing(2),paddingRight:n.spacing(2),borderColor:"transparent","&.active [data-role=result]":{color:n.palette.primary.main},"&:before":{content:'""',display:"block",position:"absolute",bottom:"3px",left:"3px",borderRadius:"2px",height:"2px",width:"calc(100% - 6px)",background:"transparent",opacity:0,transform:"scaleX(0%)",transition:"transform 200ms linear"},"&.active":{borderColor:"red"},"&.active:before":{background:n.palette.primary.main,transform:"scaleX(100%)",opacity:1}}})),$e=(0,Z.ZP)(O.Z)((function(e){var n=e.theme;return{marginLeft:n.spacing(1),fontSize:"0.7rem",color:n.palette.info.main}})),He=function(e){var n,t,i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,a.jsxs)(Le,{"data-role":"result",variant:"caption",className:r?null:"single",children:["string"===typeof e.prev?(0,a.jsxs)("span",{children:[r?"".concat(e.line-1,"\t"):"",e.prev]}):null,(0,a.jsxs)("span",{children:[r?"".concat(e.line,"\t"):"",(0,a.jsx)("span",{children:(0,a.jsx)("span",{children:null!==(n=e.match[0])&&void 0!==n?n:""})}),(0,a.jsx)("i",{children:null!==(t=e.match[1])&&void 0!==t?t:""}),null!==(i=e.match[2])&&void 0!==i?i:""]}),"string"===typeof e.next?(0,a.jsxs)("span",{children:[r?"".concat(e.line+1,"\t"):"",e.next]}):null]})},Be=function(e,n){for(var t=n.split("\n"),i=new RegExp((0,Ue.N1)(e),"i"),r=[],o=0;o<t.length;o++){var l=t[o].match(i);if(l){var a=l.index,s=t[o].slice(0,a),u=l[0],c=t[o].slice(a+u.length);r.push({prev:o>0?t[o-1]:null,match:[s,u,c],next:o<t.length-1?t[o+1]:null,line:o+1,ch:a})}}return r},Ve=function(e){var n,t=e.src,i=void 0===t?{}:t,l=e.icons,c=void 0===l?[]:l,h=e.searchText,x=void 0===h?"":h,m=e.setSearchText,v=void 0===m?function(){}:m,g=(0,s.O)(),y=g.setSceTabs,j=g.setSceCursor,Z=(0,u.$)().i18n,b=(0,d.useRef)(null),w=(0,d.useRef)(null),I=(0,d.useRef)(function(){var e={},n=!0,t=!1,i=void 0;try{for(var o,l=c[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var a=o.value;e[a.key]=(0,r.Z)({},a)}}catch(s){t=!0,i=s}finally{try{n||null==l.return||l.return()}finally{if(t)throw i}}return e}()),_=(0,d.useState)([]),k=_[0],T=_[1],M=(0,d.useState)(!0),A=M[0],R=M[1],N=(0,d.useState)(null),F=N[0],K=N[1],E=(n={},(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_STATE_MACHINE,"-key"),Z.t("state key")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_STATE_MACHINE,"-code"),Z.t("state")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_FUNCTIONS,"-key"),Z.t("function key")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_FUNCTIONS,"-code"),Z.t("function")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_INPUTS,"-key"),Z.t("input key")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_INPUTS,"-name"),Z.t("input name")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_OUTPUTS,"-key"),Z.t("output key")),(0,ze.Z)(n,"".concat(f.ModuleSrc.K_SRC_OUTPUTS,"-name"),Z.t("output name")),n);(0,d.useEffect)((function(){var e;R(0===x.length);var n=(e={},(0,ze.Z)(e,f.ModuleSrc.K_SRC_STATE_MACHINE,["key","code"]),(0,ze.Z)(e,f.ModuleSrc.K_SRC_FUNCTIONS,["key","code"]),(0,ze.Z)(e,f.ModuleSrc.K_SRC_INPUTS,["key","name"]),(0,ze.Z)(e,f.ModuleSrc.K_SRC_OUTPUTS,["key","name"]),e),t=[],r={};if(x.length){var o=!0,l=!1,a=void 0;try{for(var s,u=Object.keys(n)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var c=s.value;if(Array.isArray(i[c])){var d=!0,h=!1,p=void 0;try{for(var m,v=i[c][Symbol.iterator]();!(d=(m=v.next()).done);d=!0){var g=m.value;if("object"===typeof g&&null!==g){var y=!0,S=!1,j=void 0;try{for(var Z,b=n[c][Symbol.iterator]();!(y=(Z=b.next()).done);y=!0){var C=Z.value;if("string"===typeof g[C]){var w=Be(x,g[C]);if(w.length){var I=!0,_=!1,k=void 0;try{for(var M,A=w[Symbol.iterator]();!(I=(M=A.next()).done);I=!0){var N=M.value;r["".concat(c,"-").concat(g.id)]=!0,t.push({section:c,id:g.id,key:g.key,prop:C,result:N})}}catch(F){_=!0,k=F}finally{try{I||null==A.return||A.return()}finally{if(_)throw k}}}}}}catch(F){S=!0,j=F}finally{try{y||null==b.return||b.return()}finally{if(S)throw j}}}}}catch(F){h=!0,p=F}finally{try{d||null==v.return||v.return()}finally{if(h)throw p}}}}}catch(F){l=!0,a=F}finally{try{o||null==u.return||u.return()}finally{if(l)throw a}}}T(t),setTimeout((function(){return R(!0)}),150)}),[i,x]);var z=(0,o.Z)(new Set(k.map((function(e){return"".concat(e.section,"-").concat(e.id)})))).length,U=k.length;return(0,a.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,a.jsxs)(p.Z,{sx:{display:"flex",height:"75px",px:2,flexDirection:"column"},children:[(0,a.jsx)(ue.Z,{inputRef:w,variant:"standard",autoFocus:!0,defaultValue:x,placeholder:Z.t("Search"),onChange:function(e){return n=e.target.value.toLowerCase(),null!==b.current&&window.clearTimeout(b.current),void(b.current=window.setTimeout((function(){v(n),b.current=null,K(null)}),350));var n},sx:{width:"100%","& input":{px:"0 !important",fontSize:"0.75rem"},"& .MuiInput-root:before":{display:"none"}},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",children:(0,a.jsx)(S.Z,{fontSize:"small",sx:{mx:2}})}),endAdornment:x?(0,a.jsx)(ae.Z,{position:"start",children:(0,a.jsx)(C.Z,{title:Z.t("Clear search"),children:(0,a.jsx)(P.Z,{size:"small",sx:{width:30,height:30,mr:-2},onClick:function(){v(""),K(null),null!==w.current&&(w.current.value="",w.current.focus())},children:(0,a.jsx)(De.Z,{fontSize:"small"})})})}):null}}),x.length?(0,a.jsx)(O.Z,{variant:"caption",sx:{m:2,textAlign:"right",fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:U>0?1===U?Z.t("1 result"):U>100?Z.t("100 / {{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:U,itemsCount:z,obj:1===z?"item":"items"}):Z.t("{{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:U,itemsCount:z,obj:1===z?"item":"items"}):Z.t("No results")}):null]}),(0,a.jsx)(p.Z,{sx:{display:"flex",width:"100%",height:"100%",px:2,overflowY:"auto",flexDirection:"column"},children:A?k.slice(0,100).map((function(e,n){var t,i="".concat(e.section,"-").concat(e.id,"-").concat(e.prop,"-").concat(n),r=I.current[e.section].Icon,o=I.current[e.section].label,l=null!==(t=E["".concat(e.section,"-").concat(e.prop)])&&void 0!==t?t:null;return(0,a.jsxs)(We,{className:F===i?"active":null,onClick:function(){K(i),y(e.section,e.id),j(e.id,{line:e.result.line-1,ch:e.result.ch})},children:[(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap"},children:[(0,a.jsx)(C.Z,{title:o,placement:"top",children:(0,a.jsx)(r,{fontSize:"small",sx:{mr:2},color:F===i?"primary":"action"})}),"key"===e.prop?He(e.result):(0,a.jsx)(Le,{"data-role":"result",variant:"caption",children:(0,a.jsx)("span",{children:e.key})}),null!==l?(0,a.jsxs)($e,{variant:"caption",children:["(",l,")"]}):null]}),"key"!==e.prop?(0,a.jsx)(p.Z,{sx:{width:"100%",mt:2,ml:2,textAlign:"left"},children:He(e.result,"code"===e.prop)}):null]},i)})):(0,a.jsx)(p.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(de.Z,{count:3})})})]})},Ye=(0,Z.ZP)(p.Z)((function(e){return{width:"100%",display:"flex",marginBottom:e.theme.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}})),qe=function(e){var n,t=e.field,i=e.id,o=e.active,l=void 0!==o&&o,s=e.section,c=e.tooltip,h=void 0===c?"":c,x=e.orphan,m=void 0!==x&&x,v=e.prepareKey,g=void 0===v?function(){}:v,y=e.onClick,S=void 0===y?function(){}:y,j=e.onDelete,Z=void 0===j?function(){}:j,w=e.onKeyChange,I=void 0===w?function(){}:w,_=(0,u.$)().i18n,k=(0,b.Z)(),T=(0,d.useRef)(null),M=(0,d.useRef)(!0),A=(0,d.useRef)(null),R=(0,d.useState)(null!==(n=null===t||void 0===t?void 0:t.key)&&void 0!==n?n:""),N=R[0],F=R[1];(0,d.useEffect)((function(){I(null===t||void 0===t?void 0:t.id,g(N,null===t||void 0===t?void 0:t.id),M.current),M.current&&(M.current=!1)}),[N]);var O=(0,d.useCallback)((function(e){null!==T.current&&window.clearTimeout(T.current),T.current=window.setTimeout((function(){F(g(e,null===t||void 0===t?void 0:t.id)),T.current=null}),1e3)}),[]),K=l?k.palette.primary.main:m?k.palette.warning.main:null;return(0,a.jsxs)(Ye,{children:[m?(0,a.jsx)(C.Z,{arrow:!0,placement:"right",title:f.ModuleSrc.K_SRC_INPUTS===s?_.t("Orphan input"):_.t("Orphan output"),children:(0,a.jsx)(Te.Z,{color:"warning",sx:{mx:1}})}):(0,a.jsx)(Me.Z,{className:"drag",color:l?"primary":"action",sx:{mx:1}}),(0,a.jsx)(C.Z,{title:h,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,a.jsxs)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,a.jsx)(ue.Z,{inputRef:A,variant:"standard",color:m?"warning":"primary",onClick:S,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:N,placeholder:f.ModuleSrc.K_SRC_INPUTS===s?_.t("Input key"):_.t("Output key"),onChange:function(e){return O(e.target.value)},inputProps:{id:i,style:(0,ke.Z)((0,r.Z)({},null!==K?{color:K}:{}),{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5})}}),(0,a.jsx)(P.Z,{className:"delete",sx:{ml:1},size:"small",onClick:function(){return Z(null===t||void 0===t?void 0:t.id)},children:(0,a.jsx)(we.Z,{fontSize:"small"})})]})})]})},Ge=function(e){var n=e.agent,t=e.loaded,c=e.activeId,h=void 0===c?null:c,x=e.srcFields,m=void 0===x?[]:x,v=e.ioKey,g=void 0===v?f.ModuleSrc.K_SRC_INPUTS:v,y=f.ModuleSrc.K_SRC_INPUTS===g?"input":"output",S=(0,s.O)(),j=S.getSource,Z=S.setSource,b=S.setSourceModified,C=S.getSourceOrphans,I=S.onSourceOrphans,_=S.setSceTabs,k=S.onSceItemAdd,T=(0,u.$)().i18n,M=(0,d.useState)(null),P=M[0],O=M[1],z=(0,d.useState)([]),U=z[0],D=z[1],L=(0,d.useRef)(m),W=(0,d.useRef)(null),$=(0,d.useRef)(null),H=function(e,n){return be(e,y,n,m)},B=function(){var e=(0,i.Z)((function(){var e,t,i,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:null,"string"!==typeof(null===n||void 0===n?void 0:n.id)||m.length>=A().max.sourceCode.ioCount?[2]:[4,j(n.id,!0)];case 1:return null!==(t=l.sent())&&Array.isArray(t[g])&&(i=(0,je.H)(),t[g].push((0,r.Z)({id:i,key:H(e,i),type:"string",name:"string ".concat(f.ModuleSrc.K_SRC_INPUTS===g?"input":"output"),desc:"",max:A().max.sourceCode.ioFieldStringLength},f.ModuleSrc.K_SRC_INPUTS===g?{options:[]}:{})),Z(n.id,t),b(n.id),setTimeout((function(){var e=document.getElementById("".concat(y,"-").concat(i));null===e||void 0===e||e.focus(),null===e||void 0===e||e.click()}),250)),[2]}}))}));return function(){return e.apply(this,arguments)}}();(0,d.useEffect)((function(){"string"===typeof(null===n||void 0===n?void 0:n.id)&&D(C(n.id)[g]);var e=I((function(e){var t=e.agentId,i=e.orphans;t===(null===n||void 0===n?void 0:n.id)&&D(i[g])})),t=k((function(e){var n=e.section,t=e.key;[f.ModuleSrc.K_SRC_INPUTS,f.ModuleSrc.K_SRC_OUTPUTS].includes(n)&&B(t)}));return function(){e(),t()}}),[null===n||void 0===n?void 0:n.id]),(0,d.useEffect)((function(){$.current&&Array.isArray(m)&&(L.current=m,W.current=Ce.ZP.create($.current,{animation:150,onUpdate:function(){var e=(0,i.Z)((function(e){var t,i,r,a;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return t=(0,o.Z)(L.current),i=(0,Se.Z)(t.splice(e.oldIndex,1),1),r=i[0],t.splice(e.newIndex,0,r),L.current=t,[4,j(n.id)];case 1:return(a=l.sent())[g]=t,Z(n.id,a),b(n.id),[2]}}))}));return function(n){return e.apply(this,arguments)}}()}))}),[m]);var V=function(){var e=(0,i.Z)((function(e){var t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return O(null),[4,j(n.id)];case 1:return t=i.sent(),"string"===typeof e&&null!==t&&Array.isArray(t[g])&&(t[g]=t[g].filter((function(n){return n.id!==e})),_(g,e,!1),Z(n.id,t),b(n.id)),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Y=function(){var e=(0,i.Z)((function(e,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>2&&void 0!==o[2])||o[2],[4,j(n.id)];case 1:return"object"===typeof(r=l.sent())&&null!==r&&Array.isArray(r[g])&&"string"===typeof e&&(r[g]=r[g].map((function(n){return n.id===e&&(n.key=t),n})),Z(n.id,r),i||b(n.id)),[2]}}))}));return function(n,t){return e.apply(this,arguments)}}();return(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[t?(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,a.jsx)(p.Z,{sx:{width:"100%"},ref:$,children:m.map((function(e,n){var t=e.name?"".concat(f.ModuleSrc.K_SRC_INPUTS===g?T.t("Input name"):T.t("Output name"),": ").concat(e.name):"";return(0,a.jsx)(qe,{id:"".concat(y,"-").concat(e.id),active:e.id===h,index:n,orphan:U.includes(e.key),tooltip:t,field:e,section:g,prepareKey:H,onClick:function(){return _(g,e.id)},onDelete:function(e){return O(e)},onKeyChange:Y},e.id)}))}),(0,a.jsx)(Fe,{value:m.length,total:A().max.sourceCode.ioCount,title:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Total number of inputs"):T.t("Total number of outputs")}),m.length<A().max.sourceCode.ioCount?(0,a.jsx)(w.Z,{onClick:function(){return B()},size:"small",startIcon:(0,a.jsx)(Ie.Z,{}),children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Add input"):T.t("Add output")}):null]}):(0,a.jsx)(p.Z,{sx:{width:"100%",mt:3},children:(0,a.jsx)(de.Z,{count:3})}),null!==P?(0,a.jsxs)(K.Z,{open:!0,onClose:function(){return O(null)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:2}},children:[(0,a.jsx)(F.Z,{children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Delete Input"):T.t("Delete Output")}),(0,a.jsx)(N.Z,{children:(0,a.jsx)(E.Z,{severity:"warning",children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Are you sure you want to delete this input?"):T.t("Are you sure you want to delete this output?")})}),(0,a.jsxs)(R.Z,{children:[(0,a.jsx)(w.Z,{color:"secondary",onClick:function(){return O(null)},children:T.t("Cancel")}),(0,a.jsx)(w.Z,{color:"error",onClick:function(){return V(P)},startIcon:(0,a.jsx)(we.Z,{}),children:f.ModuleSrc.K_SRC_INPUTS===g?T.t("Delete Input"):T.t("Delete Output")})]})]}):null]})},Xe=(0,Z.ZP)("code")((function(e){var n=e.theme;return{backgroundColor:n.palette.background.paper,marginLeft:n.spacing(1),marginRight:n.spacing(1),paddingTop:n.spacing(1),paddingBottom:n.spacing(1),borderRadius:n.shape.borderRadius,fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"}})),Qe=function(e,n){return"object"===typeof e&&null!==e&&Array.isArray(e[n])?e[n]:[]},Je=function(e){var n=e.src,t=void 0===n?{}:n,i=e.icons,r=void 0===i?[]:i,o=e.agent,l=e.updateAgent,c=void 0===l?function(){}:l,h=e.loaded,g=e.setLoaded,S=void 0===g?function(){}:g,Z=e.module,C=e.setModule,I=void 0===C?function(){}:C,_=(0,s.O)(),k=_.onSceTabs,T=_.getSceTabs,M=_.onSceSection,$=_.getSceSection,H=(0,u.$)().i18n,B=(0,d.useRef)(null),V=(0,d.useRef)(null),Y=(0,d.useState)([]),q=Y[0],G=Y[1],X=(0,d.useState)(f.ModuleSrc.K_SRC_STATE_MACHINE),Q=X[0],J=X[1],ee=(0,d.useState)(!1),ne=ee[0],te=ee[1],ie=(0,d.useState)(-1),re=ie[0],oe=ie[1],le=(0,d.useState)(null),ae=le[0],se=le[1],ue=(0,d.useState)(!1),ce=ue[0],de=ue[1],fe=(0,d.useState)(null),he=fe[0],pe=fe[1],xe=(0,d.useState)(!1),me=xe[0],ve=xe[1],ge=(0,d.useState)(""),Se=ge[0],je=ge[1],Ze=(0,b.Z)();(0,d.useEffect)((function(){var e,n,t;null===(e=window.sdk)||void 0===e||e.ibc.handle("ibc-main:agent:state",(function(e,n){"string"===typeof(null===o||void 0===o?void 0:o.id)&&(null!==V.current&&window.clearTimeout(V.current),V.current=window.setTimeout((function(){se(e),de(n),V.current=null}),150))})),null===(n=window.sdk)||void 0===n||n.ibc.handle("ibc-main:agent:fn",(function(e,n){"string"===typeof(null===o||void 0===o?void 0:o.id)&&(null!==B.current&&window.clearTimeout(B.current),B.current=window.setTimeout((function(){pe(e),ve(n),B.current=null}),150))})),null===(t=window.sdk)||void 0===t||t.ibc.handle("ibc-main:agent:status",(function(e){"string"===typeof(null===o||void 0===o?void 0:o.id)&&oe(e)})),G(T().tabs);var i=k((function(e){var n=e.tabs;G(n)}));J($());var r=M((function(e){var n=e.section;J(n)}));return function(){i(),r()}}),[o]);var be,Ce,we,Ie,_e,ke,Te=r.reduce((function(e,n){return n.key===Q?n.label:e}),null),Me="1px solid ".concat((0,j.k)(Ze)),Ae=q.reduce((function(e,n){return e[n.section]=n.id,e}),{});return(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"300px",borderRight:Me,flexGrow:0,flexShrink:0},children:[(0,a.jsxs)(p.Z,{sx:{px:2,width:"100%",height:"50px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsx)(O.Z,{variant:"caption",sx:{textTransform:"uppercase",color:Ze.palette.text.disabled,ml:2},children:Te}),Object.values(f.ModuleSrc).includes(Q)?(0,a.jsx)(P.Z,{size:"small",onClick:function(){return te(!0)},children:ne?(0,a.jsx)(L.Z,{fontSize:"small"}):(0,a.jsx)(z.Z,{fontSize:"small"})}):null]}),(0,a.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",height:"calc( 100vh - 50px)",overflowY:"auto"},children:[f.ModuleSrc.K_SRC_STATE_MACHINE===Q?(0,a.jsx)(Pe,{agent:o,loaded:h,activeId:null!==(be=Ae[Q])&&void 0!==be?be:null,srcStateMachine:null!==(Ce=t[Q])&&void 0!==Ce?Ce:[],agentStatus:re,selectedStateKey:ae,selectedStateError:ce}):null,f.ModuleSrc.K_SRC_INPUTS===Q?(0,a.jsx)(Ge,{agent:o,loaded:h,activeId:null!==(we=Ae[Q])&&void 0!==we?we:null,srcFields:Qe(t,Q),ioKey:f.ModuleSrc.K_SRC_INPUTS}):null,f.ModuleSrc.K_SRC_OUTPUTS===Q?(0,a.jsx)(Ge,{agent:o,loaded:h,activeId:null!==(Ie=Ae[Q])&&void 0!==Ie?Ie:null,srcFields:Qe(t,Q),ioKey:f.ModuleSrc.K_SRC_OUTPUTS}):null,f.ModuleSrc.K_SRC_FUNCTIONS===Q?(0,a.jsx)(Ee,{agent:o,loaded:h,activeId:null!==(_e=Ae[Q])&&void 0!==_e?_e:null,srcFunctions:null!==(ke=t[Q])&&void 0!==ke?ke:[],agentStatus:re,selectedFnKey:he,selectedFnError:me}):null,"search"===Q?(0,a.jsx)(Ve,{src:t,icons:r,searchText:Se,setSearchText:je}):null,"source-control"===Q?(0,a.jsx)(ye,{module:Z,setModule:I,agent:o,updateAgent:c,loaded:h,setLoaded:S}):null]}),ne&&Object.values(f.ModuleSrc).includes(Q)?(0,a.jsxs)(K.Z,{open:!0,onClose:function(){return te(!1)},sx:{"& .MuiPaper-root":{width:"100%",maxWidth:850,p:2}},children:[(0,a.jsx)(F.Z,{children:Te}),(0,a.jsxs)(N.Z,{children:[f.ModuleSrc.K_SRC_STATE_MACHINE===Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{severity:"success",sx:{mb:3},icon:(0,a.jsx)(W.Z,{}),children:(0,a.jsxs)(O.Z,{color:"inherit",variant:"body2",children:[H.t("Finite-state machine states are written in plain JavaScript.")," ",H.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(y.Z,{}),children:(0,a.jsxs)(O.Z,{color:"inherit",variant:"body2",component:"span",children:[H.t("These are finite-state machine states."),(0,a.jsxs)("ul",{children:[(0,a.jsxs)("li",{children:[H.t("The finite-state machine begins execution from the entry state."),(0,a.jsx)(U.Z,{fontSize:"small",sx:{display:"inline-block",verticalAlign:"text-bottom",mx:2}})]}),(0,a.jsxs)("li",{children:[H.t("The next state to execute is specified using this return object:"),(0,a.jsx)(Xe,{children:"{ next: string, args?: any[] }"})]}),(0,a.jsx)("li",{children:H.t("The finite-state machine stops if an error occurs or if no next state is specified.")})]})]})}),(0,a.jsx)(E.Z,{severity:"info",icon:(0,a.jsx)(D.Z,{}),children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:H.t("Drag to reorder.")}),(0,a.jsx)("li",{children:H.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:H.t("Ctrl/Cmd hover over $ properties to learn more.")}),(0,a.jsx)("li",{children:H.t("Define up to {{count}} states, with {{length}} characters per state.",{count:A().max.sourceCode.smCount,length:A().max.sourceCode.smCodeLength})})]})})})]}):null,f.ModuleSrc.K_SRC_FUNCTIONS===Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{severity:"success",sx:{mb:3},icon:(0,a.jsx)(W.Z,{}),children:(0,a.jsxs)(O.Z,{color:"inherit",variant:"body2",children:[H.t("Functions are written in plain JavaScript.")," ",H.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(m.Z,{}),children:(0,a.jsxs)(O.Z,{color:"inherit",variant:"body2",component:"span",children:[H.t("These are functions."),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:H.t("Functions are used to avoid code duplication in finite-state machine states.")}),(0,a.jsx)("li",{children:H.t("Unlike finite-state machine states, a function's return value has no special significance.")}),(0,a.jsx)("li",{children:H.t("Functions can be called from either a state or another function with $.fn().")})]})]})}),(0,a.jsx)(E.Z,{severity:"info",icon:(0,a.jsx)(D.Z,{}),children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:H.t("Drag to reorder.")}),(0,a.jsx)("li",{children:H.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:H.t("Ctrl/Cmd hover over $.fn() strings to view the invoked function.")}),(0,a.jsx)("li",{children:H.t("Define up to {{count}} functions, with {{length}} characters per function.",{count:A().max.sourceCode.fnCount,length:A().max.sourceCode.fnCodeLength})})]})})})]}):null,f.ModuleSrc.K_SRC_INPUTS===Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(v.Z,{}),children:(0,a.jsxs)(O.Z,{color:"inherit",variant:"body2",component:"span",children:[H.t("These are your module's inputs."),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:H.t("Inputs for each run are specified in the Settings tab.")}),(0,a.jsxs)("li",{children:[H.t("Fetch inputs in states and functions:"),(0,a.jsx)(Xe,{children:"$.ioInput*()."})]})]})]})}),(0,a.jsx)(E.Z,{severity:"info",icon:(0,a.jsx)(D.Z,{}),children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:H.t("Drag to reorder items in the Settings tab.")}),(0,a.jsx)("li",{children:H.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:H.t("Define up to {{count}} inputs. This limit is set to reduce cognitive load.",{count:A().max.sourceCode.ioCount})}),(0,a.jsx)("li",{children:H.t("Define up to {{count}} input tables with up to {{columns}} columns and {{size}}MB per table.",{count:A().max.sourceCode.ioFieldTableCount,columns:A().max.sourceCode.ioFieldColumnCount,size:A().max.sourceCode.ioFieldTableSize})})]})})})]}):null,f.ModuleSrc.K_SRC_OUTPUTS===Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.Z,{severity:"info",sx:{mb:3},icon:(0,a.jsx)(x.Z,{}),children:(0,a.jsxs)(O.Z,{color:"inherit",variant:"body2",component:"span",children:[H.t("These are your module's outputs."),(0,a.jsxs)("ul",{children:[(0,a.jsx)("li",{children:H.t("Outputs are collected in the Results tab.")}),(0,a.jsxs)("li",{children:[H.t("Store outputs in states and functions:"),(0,a.jsx)(Xe,{children:"$.ioOutput*()"}),(0,a.jsx)(Xe,{children:"$.ioSave*()"})]})]})]})}),(0,a.jsx)(E.Z,{severity:"info",icon:(0,a.jsx)(D.Z,{}),children:(0,a.jsx)(O.Z,{color:"inherit",variant:"body2",component:"span",children:(0,a.jsxs)("ul",{style:{margin:0},children:[(0,a.jsx)("li",{children:H.t("Drag to reorder items in the Results tab.")}),(0,a.jsx)("li",{children:H.t("Click to edit or rename.")}),(0,a.jsx)("li",{children:H.t("Define up to {{count}} outputs. This limit is set to reduce cognitive load.",{count:A().max.sourceCode.ioCount})}),(0,a.jsx)("li",{children:H.t("Define up to {{count}} output tables with up to {{columns}} columns per table.",{count:A().max.sourceCode.ioFieldTableCount,columns:A().max.sourceCode.ioFieldColumnCount})})]})})})]}):null]}),(0,a.jsx)(R.Z,{children:(0,a.jsx)(w.Z,{color:"secondary",onClick:function(){return te(!1)},children:H.t("OK")})})]}):null]})},en=t(40044),nn=t(45670),tn=t(46408),rn=t(42734),on=t(5152),ln=t.n(on),an=(0,Z.ZP)(p.Z)((function(e){var n=e.theme;return{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"light"===n.palette.mode?"#fff":"#272822","&:before, &:after":{content:'""',display:"block",zIndex:0,position:"absolute",top:0,left:0,height:"100%"},"&:before":{width:"30px",background:"light"===n.palette.mode?"#f7f7f7":"#272822",borderRight:"light"===n.palette.mode?"1px solid #dddddd":"none"},"&:after":{width:"7px",left:"auto",right:0,background:n.palette.customColors.bodyBg}}})),sn=ln()((function(){return Promise.all([t.e(54),t.e(993),t.e(126),t.e(12),t.e(502)]).then(t.bind(t,3502))}),{loadableGenerated:{webpack:function(){return[3502]}},ssr:!1}),un=function(e){var n=e.code,t=e.section,r=e.item,o=e.id,s=e.onFnClick,c=e.maxLength,h=void 0===c?5e4:c,p=e.actionEdit,x=void 0===p?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):p,m=e.showInfo,v=void 0!==m&&m,g=(0,d.useRef)(null),y=(0,d.useRef)(!0),S=(0,u.$)().i18n,j=(0,d.useState)(n),Z=j[0],b=j[1];(0,d.useEffect)((function(){x(Z,y.current),y.current&&(y.current=!1)}),[Z]);var C=(0,d.useCallback)((function(e){null!==g.current&&window.clearTimeout(g.current),g.current=window.setTimeout((function(){b(e),g.current=null}),250)}),[]),w=f.ModuleSrc.K_SRC_FUNCTIONS===t?'await $.fn("'.concat(r.key,'"): any'):"($) => { next: string, args?: any[] } | void";return(0,a.jsxs)(an,{children:[v?(0,a.jsxs)(E.Z,{severity:"info",sx:{m:3,zIndex:100},children:[(0,a.jsx)(O.Z,{variant:"caption",color:"inherit",children:f.ModuleSrc.K_SRC_FUNCTIONS===t?S.t("Call this function"):S.t("State signature")}),": ",(0,a.jsx)(O.Z,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:w})]}):null,(0,a.jsx)(sn,{id:o,section:t,maxLength:h,defaultValue:Z,onChange:function(e){return C(e)},onFnClick:s})]})},cn=t(47312),dn=t(27489),fn=t(91736),hn=t(41667),pn=t(73431),xn=t(50874),mn=t(41826),vn=t(77849),gn=t(94818),yn=t(98347),Sn=t(95898),jn=t(81418),Zn=t(18166),bn=t(1938),Cn=t(48584),wn=t(63213),In=t(62535),_n=t(28399),kn=t(60010),Tn=t(84323),Mn=function(e){var n=e.sx,t=void 0===n?{}:n,o=e.items,s=void 0===o?[]:o,c=e.setItems,d=void 0===c?function(){}:c,f=e.sanitize,h=void 0===f?function(e){return e}:f,x=e.label,m=void 0===x?"":x,v=e.tooltip,g=void 0===v?"":v,y=e.placeholder,S=void 0===y?"":y,j=e.placeholderMax,Z=void 0===j?"":j,w=e.adornment,I=void 0===w?null:w,_=e.maxLength,k=void 0===_?32:_,T=e.inputProps,M=void 0===T?null:T,A=e.numeric,R=void 0!==A&&A,N=e.maxCount,F=void 0===N?25:N,K=e.maxCountToast,E=void 0===K?"":K,z=(0,u.$)().i18n,U=(0,b.Z)();"object"===typeof t&&null!==t||(t={});var D=function(){var e=(0,i.Z)((function(e){var n,t,i,r;return(0,l.__generator)(this,(function(o){if(e.preventDefault(),n=new FormData(e.target),e.target.reset(),t=R?parseInt(n.get("value"),10):n.get("value"),"function"===typeof h&&(t=h(t)),null===t)return[2];i=structuredClone(Array.isArray(s)?s:[]),r=!1;do{if(R){if(!Number.isFinite(t)){he.A.error(z.t("Value is not a valid number"));break}}else{if("string"!==typeof t){he.A.error(z.t("Value is not a valid string"));break}if(!t.length){he.A.error(z.t("Value cannot be empty"));break}}if(i.includes(t)){he.A.error("".concat(z.t("Value already added"),": ").concat(t));break}if(i.length>=F){he.A.error("string"===typeof E&&E.length?E:z.t("Cannot add more than {{maxCount}} values",{maxCount:F}));break}if("".concat(t).length>k){he.A.error(z.t("Value cannot be longer than {{maxLength}} characters",{maxLength:k}));break}r=!0}while(0);return r&&(i.push(t),d(i)),[2]}))}));return function(n){return e.apply(this,arguments)}}(),L=!Number.isInteger(F)||!Array.isArray(s)||s.length<F;return(0,a.jsx)(p.Z,{sx:(0,r.Z)({width:"100%",display:"flex",alignItems:"center"},t),children:(0,a.jsxs)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%",position:"relative",zIndex:0},children:[(0,a.jsx)(O.Z,{variant:"caption",component:"div",sx:{position:"absolute",top:"-10px",left:"10px",px:1,background:U.palette.background.paper},children:m}),(0,a.jsxs)(p.Z,{sx:{p:3,pt:4,borderRadius:1,border:"1px solid ".concat("light"===U.palette.mode?"rgba(50,50,50,0.25)":"rgba(255,255,255,0.25)"),flexDirection:"column",minHeight:"40px",display:"flex",alignItems:"center","&:hover":{borderColor:"light"===U.palette.mode?"rgba(50,50,50,0.35)":"rgba(255,255,255,0.35)"}},children:[Array.isArray(s)&&s.length?(0,a.jsx)(p.Z,{sx:{display:"flex",width:"100%"},children:(0,a.jsx)(Tn.Z,{items:s,setItems:d,onDelete:function(e){d(structuredClone(Array.isArray(s)?s:[]).filter((function(n){return"".concat(n)!=="".concat(e)})))},numeric:R})}):null,Number.isInteger(F)&&F>0?(0,a.jsx)(C.Z,{title:g||z.t("Total number of items"),children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",width:"100%",mb:3,px:2},children:[(0,a.jsx)(Ne.Z,{color:"inherit",sx:{borderRadius:1},value:100*(Array.isArray(s)?s.length:0)/F}),(0,a.jsxs)(O.Z,{variant:"caption",sx:{flexShrink:0,width:"50px",textAlign:"right"},children:[Array.isArray(s)?s.length:0,"/",F]})]})}):null,(0,a.jsx)("form",{style:{width:"100%"},onSubmit:D,children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",width:"100%",px:2,mb:2},children:[(0,a.jsx)(ue.Z,(0,ke.Z)((0,r.Z)({fullWidth:!0,name:"value",disabled:!L},R?{type:"number",inputMode:"numeric"}:{}),{sx:(0,r.Z)({width:"100%"},L?{}:{"& fieldset":{borderColor:"transparent !important",userSelect:"none"}}),inputProps:null!==M&&void 0!==M?M:{maxLength:k},placeholder:L?S:Z||z.t("Maximum number of items reached"),InputProps:{startAdornment:null!==I?(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:I}):null}})),L?(0,a.jsx)(P.Z,{sx:{ml:2},type:"submit",children:(0,a.jsx)(Ie.Z,{})}):null]})})]})]})})},An=function(e){var n,t,s,c,h,x,m,v,g,y=e.field,S=e.section,j=e.srcFields,Z=void 0===j?[]:j,w=e.actionEdit,I=void 0===w?(0,i.Z)((function(){return(0,l.__generator)(this,(function(e){return[2]}))})):w,_=e.showInfo,k=void 0!==_&&_,T=(0,u.$)().i18n,M=(0,b.Z)(),R=(0,d.useRef)(!0),N=(0,d.useRef)(null),F=(0,d.useRef)(null),P=(0,d.useRef)(null),K=(0,d.useRef)(null),z=(0,d.useRef)(null),U=(0,d.useRef)(null),D=(0,d.useRef)(null),L=(0,d.useRef)(null),W=(0,d.useRef)(null),$=(0,d.useRef)(null),H=(0,d.useRef)(null),Y=(0,d.useRef)(null),q=(0,d.useState)(null!==(n=null===y||void 0===y?void 0:y.type)&&void 0!==n?n:"string"),G=q[0],X=q[1],Q=(0,d.useState)(null!==(t=null===y||void 0===y?void 0:y.name)&&void 0!==t?t:""),J=Q[0],ee=Q[1],ne=(0,d.useState)(null!==(s=null===y||void 0===y?void 0:y.desc)&&void 0!==s?s:""),te=ne[0],ie=ne[1],re=(0,d.useState)(Array.isArray(null===y||void 0===y?void 0:y.extensions)?y.extensions:["txt"]),oe=re[0],le=re[1],ce=(0,d.useState)(null!==(c=null===y||void 0===y?void 0:y.options)&&void 0!==c?c:[]),de=ce[0],fe=ce[1],pe=(0,d.useState)(null!==(h=null===y||void 0===y?void 0:y.default)&&void 0!==h?h:null),xe=pe[0],me=pe[1],ve=(0,d.useState)(null!==(x=null===y||void 0===y?void 0:y.depends)&&void 0!==x?x:null),ge=ve[0],ye=ve[1],Se=(0,d.useState)(null!==(m=null===y||void 0===y?void 0:y.columns)&&void 0!==m?m:[]),je=Se[0],be=Se[1],Ce=(0,d.useState)(null!==(v=null===y||void 0===y?void 0:y.min)&&void 0!==v?v:null),we=Ce[0],Ie=Ce[1],_e=(0,d.useState)(null!==(g=null===y||void 0===y?void 0:y.max)&&void 0!==g?g:null),ke=_e[0],Te=_e[1],Me=(f.ModuleSrc.K_SRC_INPUTS===S&&Array.isArray(Z)?Z:[]).filter((function(e){return"bool"===e.type})).map((function(e){return e.key})),Ae=function(e){for(e="".concat(null!==e&&void 0!==e?e:"").trim().substring(0,A().max.sourceCode.ioFieldNameLength);;){if(e.length>0)break;e="".concat(G," ").concat(f.ModuleSrc.K_SRC_INPUTS===S?"input":"output")}return null!==$.current&&($.current.value=e),e},Re=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==F.current&&window.clearTimeout(F.current),F.current=window.setTimeout((function(){!(e=Ke(G,"int"===G?parseInt(e,10):"string"===typeof e?e:"",!1))&&Array.isArray(de)&&de.length&&(e=de[0]),me(e),null!==D.current&&(D.current.value=null!==e&&void 0!==e?e:""),F.current=null}),n)},Ne=function(e,n){null!==K.current&&window.clearTimeout(K.current),K.current=window.setTimeout((function(){e=parseInt(e,10),n=parseInt(n,10),Number.isInteger(e)||(e=null),Number.isInteger(n)||(n=null),["files","string"].includes(G)&&(e<=0&&(e=null),n<=0&&(n=null)),null!==e&&null!==n&&n<e&&(n=e),"string"===G&&((null===n||n>A().max.sourceCode.ioFieldStringLength)&&(n=A().max.sourceCode.ioFieldStringLength),Array.isArray(de)&&de.length&&n>A().max.sourceCode.ioFieldOptionLength&&(n=A().max.sourceCode.ioFieldOptionLength),e>n&&(e=null)),Ie(e),null!==H.current&&(H.current.value=e),Te(n),null!==Y.current&&(Y.current.value=n),K.current=null}),250)};(0,d.useEffect)((function(){R.current||fe([])}),[G]),(0,d.useEffect)((function(){R.current||(Ne(we,ke),Array.isArray(de)&&de.map((function(e){return"".concat(e)})).includes("".concat(xe))||Re(""))}),[de]),(0,d.useEffect)((function(){var e=window.setTimeout((0,i.Z)((function(){var e;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return ee(Ae(J)),e={fieldType:G,fieldName:J,fieldDesc:te,fieldExts:oe,fieldOptions:de,fieldDefault:xe,fieldDepends:ge,fieldColumns:je,fieldMin:we,fieldMax:ke},[4,I(null===y||void 0===y?void 0:y.id,e,R.current)];case 1:return n.sent(),R.current&&(R.current=!1),[2]}}))})),450);return function(){return window.clearTimeout(e)}}),[G,J,te,oe,de,xe,ge,je,we,ke]);var Fe,Pe,Oe,Ke=function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=null;do{if("int"===e){if(!Number.isInteger(n)){t&&he.A.error(T.t("Not a valid integer"));break}if(Number.isInteger(we)&&n<we){t&&he.A.error(T.t("Integer cannot be smaller than {{fieldMin}}",{fieldMin:we}));break}if(Number.isInteger(ke)&&n>ke){t&&he.A.error(T.t("Integer cannot be greater than {{fieldMax}}",{fieldMax:ke}));break}}else{if("string"!==typeof n){t&&he.A.error(T.t("Not a valid string"));break}if(n=n.trim(),Number.isInteger(we)&&n.length<we){t&&he.A.error(T.t("String cannot be shorter than {{fieldMin}} characters",{fieldMin:we}));break}if(Number.isInteger(ke)&&n.length>ke){t&&he.A.error(T.t("String cannot be longer than {{fieldMax}} characters",{fieldMax:ke}));break}}i=n}while(0);return i},Ee=[{value:"bool",label:T.t("Switch"),Icon:hn.Z},{value:"int",label:T.t("Integer"),Icon:wn.Z},{value:"string",label:T.t("String"),Icon:kn.Z},{value:"table",label:T.t("Table"),Icon:Zn.Z},{value:"files",label:T.t("Files"),Icon:fn.Z}],ze="table"===G?"Row":(0,Ue.zf)(G),De="table"===G?"Object":G,Le=f.ModuleSrc.K_SRC_INPUTS===S?"".concat("table"===G?"await ":"","$.ioInput").concat(ze,'("').concat(null===y||void 0===y?void 0:y.key,'"): ').concat("files"===G?"string[] - File paths":"".concat(De,"|null")):"files"===G?'await $.ioSave*("'.concat(null===y||void 0===y?void 0:y.key,'"): string - File path'):"await $.ioOutput".concat(ze,'("').concat(null===y||void 0===y?void 0:y.key,'", ').concat(De,"): bool");return(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",height:"100%",zIndex:10,flexDirection:"column",p:3,background:M.palette.background.paper},children:[k?(0,a.jsxs)(E.Z,{severity:"info",sx:{mb:2},children:[(0,a.jsx)(O.Z,{variant:"caption",color:"inherit",children:f.ModuleSrc.K_SRC_INPUTS===S?T.t("Get this input"):T.t("Set this output")}),": ",(0,a.jsx)(O.Z,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:Le})]}):null,(0,a.jsx)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:2},children:(0,a.jsx)(C.Z,{title:T.t("Maximum length: {{len}} characters",{len:A().max.sourceCode.ioFieldNameLength}),children:(0,a.jsx)(ue.Z,{fullWidth:!0,label:f.ModuleSrc.K_SRC_INPUTS===S?T.t("Input name"):T.t("Output name"),required:!0,defaultValue:J,inputRef:$,onChange:function(e){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:400;null!==z.current&&window.clearTimeout(z.current),z.current=window.setTimeout((function(){ee(Ae(e)),z.current=null}),n)}(e.target.value)},inputProps:{maxLength:A().max.sourceCode.ioFieldNameLength},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(vn.Z,{fontSize:"small"})})}})})}),(0,a.jsx)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,a.jsx)(C.Z,{title:T.t("Maximum length: {{len}} characters",{len:A().max.sourceCode.ioFieldDescLength}),children:(0,a.jsx)(ue.Z,{fullWidth:!0,multiline:!0,minRows:1,maxRows:9,label:f.ModuleSrc.K_SRC_INPUTS===S?T.t("Input description"):T.t("Output description"),defaultValue:te,onChange:function(e){return n=e.target.value,null!==U.current&&window.clearTimeout(U.current),void(U.current=window.setTimeout((function(){ie("".concat(n).trim().substring(0,A().max.sourceCode.ioFieldDescLength)),U.current=null}),1e3));var n},inputProps:{maxLength:A().max.sourceCode.ioFieldDescLength,style:{padding:0,fontFamily:"Inconsolata,monospace"}},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(xn.Z,{fontSize:"small"})})}})})}),(0,a.jsxs)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,a.jsxs)(se.Z,{fullWidth:!0,children:[(0,a.jsxs)(cn.Z,{sx:{px:2,background:M.palette.background.paper,ml:-1},children:[f.ModuleSrc.K_SRC_INPUTS===S?T.t("Input type"):T.t("Output type")," "]}),(0,a.jsx)(V.Z,{value:G,required:!0,onChange:function(e){return function(e){if("table"!==G&&"table"===e&&Z.filter((function(e){return"table"===e.type})).length>=A().max.sourceCode.ioFieldTableCount)return void he.A.error(T.t("Cannot use more than {{ioFieldTableCount}} tables",{ioFieldTableCount:A().max.sourceCode.ioFieldTableCount}));X(e)}(e.target.value)},fullWidth:!0,children:Ee.map((function(e){var n=e.value,t=e.label,i=e.Icon;return(0,a.jsx)(B.Z,{value:n,children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[i?(0,a.jsx)(i,{fontSize:"small",sx:{mr:5}}):null,t||""]})},n)}))})]}),"files"===G?(0,a.jsx)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",ml:2},children:(0,a.jsx)(C.Z,{title:T.t("Comma-separated list of accepted extensions"),children:(0,a.jsx)(ue.Z,{fullWidth:!0,required:!0,label:T.t("File extensions"),defaultValue:Array.isArray(oe)?oe.join(", "):"txt",inputRef:W,placeholder:T.t("File extensions"),onChange:function(e){return n=e.target.value,null!==N.current&&window.clearTimeout(N.current),void(N.current=window.setTimeout((function(){var e=(0,o.Z)(new Set("".concat(n).split(",").map((function(e){return(0,Ze.W)(e,A().max.sourceCode.ioFieldExtensionLength)})).filter((function(e){return e.length>0})))).slice(0,A().max.sourceCode.ioFieldExtensionCount);e.length||(e=["txt"]),le(e),null!==W.current&&(W.current.value=e.join(", ")),N.current=null}),1e3));var n},inputProps:{maxLength:(A().max.sourceCode.ioFieldExtensionLength+2)*A().max.sourceCode.ioFieldExtensionCount},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(jn.Z,{fontSize:"small"})})}})})}):null]}),["string","int","files"].includes(G)?(0,a.jsxs)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,a.jsx)(ue.Z,{fullWidth:!0,defaultValue:we,inputRef:H,type:"number",inputMode:"numeric",label:"files"===G?T.t("Minimum file size (MB)"):"int"===G?T.t("Minimum value"):T.t("Minimum length"),onChange:function(e){return Ne(e.target.value,ke)},inputProps:{min:["files","string"].includes(G)?0:null,max:"string"===G?Array.isArray(de)&&de.length?A().max.sourceCode.ioFieldOptionLength:A().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:"files"===G?(0,a.jsx)(In.Z,{fontSize:"small"}):"int"===G?(0,a.jsx)(mn.Z,{fontSize:"small"}):(0,a.jsx)(bn.Z,{fontSize:"small"})})}}),(0,a.jsx)(ue.Z,{sx:{ml:2},fullWidth:!0,defaultValue:ke,inputRef:Y,type:"number",inputMode:"numeric",label:"files"===G?T.t("Maximum file size (MB)"):"int"===G?T.t("Maximum value"):T.t("Maximum length"),onChange:function(e){return Ne(we,e.target.value)},inputProps:{min:["files","string"].includes(G)?0:null,max:"string"===G?Array.isArray(de)&&de.length?A().max.sourceCode.ioFieldOptionLength:A().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:"files"===G?(0,a.jsx)(_n.Z,{fontSize:"small"}):"int"===G?(0,a.jsx)(yn.Z,{fontSize:"small"}):(0,a.jsx)(Cn.Z,{fontSize:"small"})})}})]}):null,f.ModuleSrc.K_SRC_INPUTS===S&&["string","int"].includes(G)?(0,a.jsx)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:Array.isArray(de)&&de.length?(0,a.jsxs)(se.Z,{fullWidth:!0,children:[(0,a.jsx)(cn.Z,{sx:{px:2,background:M.palette.background.paper,ml:-1},children:T.t("Default value")}),(0,a.jsxs)(V.Z,{label:T.t("Default value"),inputRef:D,value:null!==xe&&void 0!==xe?xe:"",onChange:function(e){return Re("".concat(null!==(Fe=e.target.value)&&void 0!==Fe?Fe:""))},fullWidth:!0,children:[(0,a.jsx)(B.Z,{value:null,children:(0,a.jsx)(p.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,a.jsx)(O.Z,{variant:"caption",children:T.t("No default value")})})}),de.map((function(e){return(0,a.jsx)(B.Z,{value:e,children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,a.jsx)(pn.Z,{fontSize:"small",sx:{mr:5}}),e]})},e)}))]})]}):(0,a.jsx)(ue.Z,{fullWidth:!0,inputRef:D,label:T.t("Default value"),defaultValue:null!==xe&&void 0!==xe?xe:"",onChange:function(e){return Re("".concat(null!==(Pe=e.target.value)&&void 0!==Pe?Pe:""),1e3)},inputProps:(0,r.Z)({},"int"===G?{min:we,max:ke}:{minLength:we,maxLength:ke}),type:"int"===G?"number":"string",inputMode:"int"===G?"numeric":"text",InputProps:{startAdornment:(0,a.jsx)(ae.Z,{position:"start",sx:{ml:0},children:(0,a.jsx)(pn.Z,{fontSize:"small"})})}})}):null,f.ModuleSrc.K_SRC_INPUTS===S&&["string","int"].includes(G)?(0,a.jsx)(Mn,{sx:{mt:4},items:de,setItems:fe,sanitize:function(e){return Ke(G,e)},label:T.t("Input options - ommit if users can set any value"),placeholder:T.t("Option value"),adornment:(0,a.jsx)(gn.Z,{fontSize:"small"}),inputProps:(0,r.Z)({},"int"===G?{min:we,max:ke}:{minLength:we,maxLength:Math.min(null!==ke&&void 0!==ke?ke:A().max.sourceCode.ioFieldOptionLength,A().max.sourceCode.ioFieldOptionLength)}),maxLength:A().max.sourceCode.ioFieldOptionLength,maxCount:A().max.sourceCode.ioFieldOptionCount,maxCountToast:T.t("Cannot add more than {{n}} options",{n:A().max.sourceCode.ioFieldOptionCount}),numeric:"int"===G}):null,"table"===G?(0,a.jsx)(Mn,{sx:{mt:4},items:je,setItems:be,sanitize:function(e){return(0,Ze.W)(e,A().max.sourceCode.ioFieldColumnLength)},label:T.t("Table columns *"),placeholder:T.t("Table column name"),placeholderMax:T.t("Maximum number of columns reached"),tooltip:T.t("Total number of columns"),adornment:(0,a.jsx)(dn.Z,{fontSize:"small"}),maxLength:A().max.sourceCode.ioFieldColumnLength,maxCount:A().max.sourceCode.ioFieldColumnCount,maxCountToast:T.t("Cannot add more than {{n}} table columns",{n:A().max.sourceCode.ioFieldColumnCount})}):null,f.ModuleSrc.K_SRC_INPUTS===S&&"bool"!==G?(0,a.jsx)(p.Z,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,a.jsx)(C.Z,{title:T.t("Show field only if this boolean is set to true"),children:(0,a.jsxs)(se.Z,{fullWidth:!0,children:[(0,a.jsx)(cn.Z,{sx:{px:2,background:M.palette.background.paper,ml:-1},children:T.t("Dependency")}),(0,a.jsxs)(V.Z,{label:T.t("Dependency"),inputRef:L,value:null!==ge&&void 0!==ge?ge:"",onChange:function(e){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==P.current&&window.clearTimeout(P.current),P.current=window.setTimeout((function(){Me.includes(e)||(e=null),ye(e),null!==L.current&&(L.current.value=e),P.current=null}),n)}("".concat(null!==(Oe=e.target.value)&&void 0!==Oe?Oe:""))},fullWidth:!0,children:[(0,a.jsx)(B.Z,{value:null,children:(0,a.jsx)(O.Z,{variant:"caption",children:T.t("No dependency - field is always shown")})}),Me.map((function(e){return(0,a.jsx)(B.Z,{value:e,children:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,a.jsx)(Sn.Z,{fontSize:"small",sx:{mr:5}}),e]})},e)}))]})]})})}):null]})},Rn=t(77381),Nn=(0,Z.ZP)(en.Z)((function(e){return{height:"50px",minHeight:"50px",paddingRight:0,paddingLeft:0,marginRight:e.theme.spacing(1),"&:hover .close":{opacity:1}}})),Fn=(0,Z.ZP)("span")((function(e){var n=e.theme;return(0,ze.Z)({lineHeight:1.5,fontSize:"0.75rem",textTransform:"none",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"125px"},n.breakpoints.down("md"),{display:"none"})})),Pn=(0,Z.ZP)(p.Z)((function(e){var n=e.theme;return{height:"50px",position:"relative",display:"flex",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"space-between",paddingLeft:n.spacing(1),paddingRight:n.spacing(1)}})),On=(0,Z.ZP)(p.Z)((function(e){e.theme;return{height:"100%",width:"100%",position:"absolute",overflowY:"auto",top:0,right:0,zIndex:1}})),Kn=function(e){var n=e.src,t=void 0===n?{}:n,r=e.icons,o=void 0===r?[]:r,c=e.agent,h=e.loaded,x=void 0!==h&&h,m=(0,s.O)(),v=m.getSource,g=m.setSource,y=m.setSourceModified,S=m.setSceTabs,Z=m.getSceTabs,w=m.onSceTabs,I=(0,u.$)().i18n,_=(0,b.Z)(),k=(0,d.useState)(!1),T=k[0],M=k[1],R=(0,d.useState)([]),N=R[0],F=R[1],O=(0,d.useState)(null),K=O[0],E=O[1];(0,d.useEffect)((function(){F(Z().tabs),E(Z().tabsIndex);var e=w((function(e){var n=e.tabs,t=e.tabsIndex;F(n),E(t)}));return function(){e()}}),[c]);var U=function(){var e=(0,i.Z)((function(e,n,t){var i,r,o=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(o.length>3&&void 0!==o[3])||o[3],[4,v(c.id)];case 1:return null!==(r=l.sent())&&Array.isArray(r[e])&&"string"===typeof n&&(r[e]=r[e].map((function(e){return e.id===n&&(e.code=t),e})),g(c.id,r),i||y(c.id)),[2]}}))}));return function(n,t,i){return e.apply(this,arguments)}}(),D=function(){var e=(0,i.Z)((function(e,n,t){var i,r,o,a,s,u,d,h,p,x,m,S,j=arguments;return(0,l.__generator)(this,(function(l){switch(l.label){case 0:return i=!(j.length>3&&void 0!==j[3])||j[3],[4,v(c.id)];case 1:return r=l.sent(),o=t.fieldType,a=t.fieldName,s=t.fieldDesc,u=t.fieldExts,d=t.fieldOptions,h=t.fieldDefault,p=t.fieldDepends,x=t.fieldColumns,m=t.fieldMin,S=t.fieldMax,"string"===typeof n&&null!==r&&Array.isArray(r[e])&&(r[e]=r[e].map((function(t){if(t.id===n)switch(t={id:n,key:t.key,type:o,name:a,desc:s},"bool"!==o&&f.ModuleSrc.K_SRC_INPUTS===e&&(t.depends=p),o){case"string":case"int":t.min=m,t.max=S,f.ModuleSrc.K_SRC_INPUTS===e&&(t.options=d,t.default=h);break;case"files":t.min=m,t.max=S,t.extensions=Array.isArray(u)?u:["txt"];break;case"table":t.columns=x}var i=!0,r=!1,l=void 0;try{for(var c,v=Object.keys(t)[Symbol.iterator]();!(i=(c=v.next()).done);i=!0){var g=c.value;null===t[g]&&delete t[g]}}catch(y){r=!0,l=y}finally{try{i||null==v.return||v.return()}finally{if(r)throw l}}return t})),g(c.id,r),i||y(c.id)),[2]}}))}));return function(n,t,i){return e.apply(this,arguments)}}(),W=function(){var e=(0,i.Z)((function(e){var n,t;return(0,l.__generator)(this,(function(i){switch(i.label){case 0:return[4,v(c.id)];case 1:return n=i.sent(),Array.isArray(n[f.ModuleSrc.K_SRC_FUNCTIONS])&&("string"===typeof(t=n[f.ModuleSrc.K_SRC_FUNCTIONS].reduce((function(n,t){return t.key===e?t.id:n}),null))?S(f.ModuleSrc.K_SRC_FUNCTIONS,t):he.A.error(I.t('Function "{{fn}}" does not exist',{fn:e}))),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),$=null,H=(Array.isArray(N)?structuredClone(N):[]).map((function(e,n){return e.item=(null!==t&&Array.isArray(t[e.section])?t[e.section]:[]).reduce((function(n,t){return e.id===t.id?t:n}),null),e.selected=K===n,e.selected&&($="".concat(e.section,"-").concat(e.id)),e})).filter((function(e){return null!==e.item}));return(0,a.jsxs)(p.Z,{sx:{width:"calc(100% - 350px)",height:"100vh",display:"flex",flexDirection:"column"},children:[(0,a.jsx)(Pn,{sx:{boxShadow:H.length?"0px -1px 0px 0px ".concat((0,j.k)(_)," inset"):null},children:H.length&&"string"===typeof $?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(nn.ZP,{value:$,children:(0,a.jsx)(tn.Z,{variant:"scrollable",sx:{"& .MuiTabs-indicator":{borderRadius:"5px",marginBottom:"4px",height:"4px"},height:"50px",width:"100%"},children:H.map((function(e){var n,t,i="".concat(e.section,"-").concat(e.id),r=o.reduce((function(n,t){return e.section===t.key?t.Icon:n}),null),l=o.reduce((function(n,t){return e.section===t.key?t.label:n}),null);return(0,a.jsx)(Nn,{icon:(0,a.jsx)(r,{fontSize:"small",sx:{ml:2}}),iconPosition:"start",onClick:function(){return S(e.section,e.id)},value:i,label:(0,a.jsxs)(p.Z,{sx:{display:"flex",alignItems:"center",px:1,"& .close":{opacity:0},"&:hover .close":{opacity:1}},children:[(0,a.jsx)(C.Z,{title:"".concat(l," / ").concat(null===(n=e.item)||void 0===n?void 0:n.key),arrow:!0,enterDelay:750,enterNextDelay:750,placement:"bottom",children:(0,a.jsx)(Fn,{children:null===(t=e.item)||void 0===t?void 0:t.key})}),(0,a.jsx)(p.Z,{className:"close",sx:{ml:2,cursor:"pointer",opacity:.2,display:"flex"},onClick:function(n){n.stopPropagation(),S(e.section,e.id,!1)},children:(0,a.jsx)(rn.Z,{fontSize:"small",color:"action"})})]})},i)}))})}),(0,a.jsx)(C.Z,{title:I.t("Toggle hints"),placement:"left",children:(0,a.jsx)(P.Z,{"aria-label":I.t("More information"),color:"default",onClick:function(){return M(!T)},size:"small",children:T?(0,a.jsx)(L.Z,{fontSize:"small"}):(0,a.jsx)(z.Z,{fontSize:"small"})})})]}):null}),(0,a.jsx)(p.Z,{sx:{position:"relative",width:"100%",height:"100%"},children:x&&H.length?H.map((function(e){var n,i,r;return(0,a.jsxs)(On,{sx:{zIndex:e.selected?10:-1},children:[[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS].includes(e.section)?(0,a.jsx)(un,{code:null===(n=e.item)||void 0===n?void 0:n.code,section:e.section,item:e.item,id:e.id,onFnClick:W,maxLength:A().max.sourceCode.smCodeLength,actionEdit:function(n,t){return U(e.section,e.id,n,t)},showInfo:T}):null,[f.ModuleSrc.K_SRC_INPUTS,f.ModuleSrc.K_SRC_OUTPUTS].includes(e.section)?(0,a.jsx)(An,{field:e.item,section:e.section,srcFields:(i=t,r=e.section,"object"===typeof i&&null!==i&&Array.isArray(i[r])?i[r]:[]),actionEdit:function(n,t,i){D(e.section,n,t,i)},showInfo:T}):null]},"".concat(e.section,"-").concat(e.id))})):(0,a.jsx)(p.Z,{sx:{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},children:(0,a.jsx)(Rn.Z,{grey:!0,size:192,sx:{opacity:.1}})})})]})},En=function(e){var n={},t=!0,i=!1,r=void 0;try{for(var l,a=function(){var t=l.value;if(n[t]=[],"object"!==typeof e||null===e||!Array.isArray(e[t]))return"continue";var i={};switch(t){case f.ModuleSrc.K_SRC_STATE_MACHINE:var r=!0,a=!1,s=void 0;try{for(var u,c=e.srcStateMachine[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var d=u.value;if("string"===typeof(null===d||void 0===d?void 0:d.code)){var h=!0,p=!1,x=void 0;try{for(var m,v=(0,o.Z)(d.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\breturn\s+\{\s*([^{}]+)\s*\}/g))[Symbol.iterator]();!(h=(m=v.next()).done);h=!0){var g=m.value[1].match(/['"]?next['"]?\s*:\s*"([\w\.\-]+)"/);g&&(i[g[1]]=!0)}}catch(ce){p=!0,x=ce}finally{try{h||null==v.return||v.return()}finally{if(p)throw x}}}}}catch(ce){a=!0,s=ce}finally{try{r||null==c.return||c.return()}finally{if(a)throw s}}break;case f.ModuleSrc.K_SRC_INPUTS:for(var y=0,S=[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS];y<S.length;y++){var j=S[y],Z=!0,b=!1,C=void 0;try{for(var w,I=e[j][Symbol.iterator]();!(Z=(w=I.next()).done);Z=!0){var _=w.value;if("string"===typeof(null===_||void 0===_?void 0:_.code)){var k=!0,T=!1,M=void 0;try{for(var A,R=(0,o.Z)(_.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.ioInput\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi))[Symbol.iterator]();!(k=(A=R.next()).done);k=!0){var N=A.value;i[N[1]]=!0}}catch(ce){T=!0,M=ce}finally{try{k||null==R.return||R.return()}finally{if(T)throw M}}}}}catch(ce){b=!0,C=ce}finally{try{Z||null==I.return||I.return()}finally{if(b)throw C}}}break;case f.ModuleSrc.K_SRC_OUTPUTS:for(var F=0,P=[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS];F<P.length;F++){var O=P[F],K=!0,E=!1,z=void 0;try{for(var U,D=e[O][Symbol.iterator]();!(K=(U=D.next()).done);K=!0){var L=U.value;if("string"===typeof(null===L||void 0===L?void 0:L.code)){var W=!0,$=!1,H=void 0;try{for(var B,V=(0,o.Z)(L.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.io(?:Output|Save)\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi))[Symbol.iterator]();!(W=(B=V.next()).done);W=!0){var Y=B.value;i[Y[1]]=!0}}catch(ce){$=!0,H=ce}finally{try{W||null==V.return||V.return()}finally{if($)throw H}}}}}catch(ce){E=!0,z=ce}finally{try{K||null==D.return||D.return()}finally{if(E)throw z}}}break;case f.ModuleSrc.K_SRC_FUNCTIONS:for(var q=0,G=[f.ModuleSrc.K_SRC_STATE_MACHINE,f.ModuleSrc.K_SRC_FUNCTIONS];q<G.length;q++){var X=G[q],Q=!0,J=!1,ee=void 0;try{for(var ne,te=e[X][Symbol.iterator]();!(Q=(ne=te.next()).done);Q=!0){var ie=ne.value;if("string"===typeof(null===ie||void 0===ie?void 0:ie.code)){var re=!0,oe=!1,le=void 0;try{for(var ae,se=(0,o.Z)(ie.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.fn\s*\([^\w\.\-]*([\w\.\-]+)/g))[Symbol.iterator]();!(re=(ae=se.next()).done);re=!0){var ue=ae.value;i[ue[1]]=!0}}catch(ce){oe=!0,le=ce}finally{try{re||null==se.return||se.return()}finally{if(oe)throw le}}}}}catch(ce){J=!0,ee=ce}finally{try{Q||null==te.return||te.return()}finally{if(J)throw ee}}}}n[t]=(f.ModuleSrc.K_SRC_STATE_MACHINE===t?e.srcStateMachine.slice(1):e[t]).map((function(e){return e.key})).filter((function(e){return"string"===typeof e&&"undefined"===typeof i[e]}))},s=Object.values(f.ModuleSrc)[Symbol.iterator]();!(t=(l=s.next()).done);t=!0)a()}catch(u){i=!0,r=u}finally{try{t||null==s.return||s.return()}finally{if(i)throw r}}return n},zn=function(){var e,n="".concat(null===(e=window.sdk)||void 0===e?void 0:e.ibc.winName).replace(/^@source\//,""),t=(0,s.O)(),o=t.setAgentId,j=t.setPageTitle,Z=t.setPageSubtitle,b=t.getSource,C=t.setSource,w=t.onSource,I=t.onSourceModified,_=t.getSourceModified,k=t.setSourceOrphans,M=(0,u.$)().i18n,A=(0,d.useState)({}),R=A[0],N=A[1],F=(0,d.useState)(null),P=F[0],O=F[1],K=(0,d.useState)(null),E=K[0],z=K[1],U=(0,d.useState)(!1),D=U[0],L=U[1],W=(0,d.useState)(!1),$=W[0],H=W[1];(0,d.useEffect)((function(){var e,t,a;o(n),null===(e=window.sdk)||void 0===e||e.ibc.send(c.Z.ibc.WINDOW_MAIN,"ibc-source:open",[!0]),window.addEventListener("beforeunload",(function(e){var t;null===(t=window.sdk)||void 0===t||t.ibc.send(c.Z.ibc.WINDOW_MAIN,"ipc:disk-storage:agents:commit",[n])})),null===(t=window.sdk)||void 0===t||t.ibc.handle("ibc-main:module-repo:data",(function(e){var t=e.agentData,i=e.moduleData,r=e.sourceCode;"string"===typeof(null===t||void 0===t?void 0:t.id)&&(z(t),O(i),C(n,r,!1))})),null===(a=window.sdk)||void 0===a||a.ibc.handle("ibc-main:agent:data",(function(e){"object"===typeof e&&null!==e&&z((0,r.Z)({},e))})),(0,i.Z)((function(){var e,t,i,r;return(0,l.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),[4,h.Z.get("agents")];case 1:return e=o.sent(),t=Array.isArray(e.data)?e.data.reduce((function(e,t){return(null===t||void 0===t?void 0:t.id)===n?t:e}),null):null,z(t),"string"!==typeof(null===t||void 0===t?void 0:t.installedModuleId)?[3,3]:[4,h.Z.get("modules/".concat(t.installedModuleId))];case 2:r=o.sent(),"string"===typeof(null===(i=r.data)||void 0===i?void 0:i.id)&&O(r.data),o.label=3;case 3:return[3,5];case 4:return o.sent(),[3,5];case 5:return H(_(n)),[2]}}))}))();var s=I((function(e){var t=e.agentId,i=e.modified;t===n&&H(i)}));return function(){return s()}}),[]),(0,d.useEffect)((function(){var e;j(null!==E?"".concat(null!==(e=E.name)&&void 0!==e?e:""):null),(0,i.Z)((function(){var e;return(0,l.__generator)(this,(function(n){switch(n.label){case 0:return"string"!==typeof(null===E||void 0===E?void 0:E.id)?[3,2]:[4,b(E.id)];case 1:e=n.sent(),N(null!==e&&void 0!==e?e:{}),k(E.id,En(null!==e&&void 0!==e?e:"")),L(!0),n.label=2;case 2:return[2]}}))}))();var n=w((function(e){var n=e.agentId,t=e.sourceCode;n===(null===E||void 0===E?void 0:E.id)&&(N(t),k(n,En(t)))}));return function(){return n()}}),[E]);(0,d.useEffect)((function(){Z(($?"\u25cf ":"")+M.t("Source code"))}),[$]);var B=[{key:f.ModuleSrc.K_SRC_STATE_MACHINE,label:M.t("Finite-state machine"),Icon:y.Z},{key:f.ModuleSrc.K_SRC_FUNCTIONS,label:M.t("Functions"),Icon:m.Z},{key:f.ModuleSrc.K_SRC_INPUTS,label:M.t("Inputs"),Icon:v.Z},{key:f.ModuleSrc.K_SRC_OUTPUTS,label:M.t("Outputs"),Icon:x.Z},{key:"search",label:M.t("Search"),Icon:S.Z},{key:"source-control",label:M.t("Source control"),Icon:g.Z}];return(0,a.jsxs)(p.Z,{sx:{display:"flex",width:"100%",height:"100%"},children:[(0,a.jsx)(T,{icons:B,agent:E,loaded:D}),(0,a.jsx)(Je,{src:R,icons:B,agent:E,updateAgent:function(e){var n;"object"===typeof e&&null!==e&&"string"===typeof e.id&&(delete e.moduleReleases,z(e),null===(n=window.sdk)||void 0===n||n.ibc.send(c.Z.ibc.WINDOW_MAIN,"ibc-source:agent:data",[e.id,e]))},loaded:D,setLoaded:L,module:P,setModule:O}),(0,a.jsx)(Kn,{src:R,icons:B,agent:E,loaded:D})]})};zn.guestGuard=!0;var Un=zn}},function(e){e.O(0,[901,884,48,353,955,774,888,179],(function(){return n=25877,e(e.s=n);var n}));var n=e.O();_N_E=n}]);