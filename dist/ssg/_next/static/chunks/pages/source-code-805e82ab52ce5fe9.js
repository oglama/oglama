/*!
 * @architect Mark Jivko <mark@oglama.com>
 * @copyright © 2024-2026 Oglama™ (https://oglama.com)
 * 
 * Licensed under the Oglama™ Source-Available License, Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     https://github.com/oglama/oglama/blob/main/LICENSE.txt
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[887],{83366:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>tz});var l=n(37876),i=n(46094),r=n(81373),o=n(7156),s=n(98311),a=n(22393),c=n(50033),u=n(39763),d=n.n(u);let x=e=>{var t;return null!=(t=({[a.ModuleSrc.K_SRC_FUNCTIONS]:"function",[a.ModuleSrc.K_SRC_INPUTS]:"input",[a.ModuleSrc.K_SRC_OUTPUTS]:"output",[a.ModuleSrc.K_SRC_STATE_MACHINE]:"state"})[e])?t:"state"},h=(e,t,n,l)=>{n=(0,s.Pt)(n);let i=(Array.isArray(t)?t:[]).filter(e=>(null==e?void 0:e.id)!==l).map(e=>null==e?void 0:e.key),r=1;for(;!(n.length>0)||i.includes(n);){if(!i.length&&a.ModuleSrc.K_SRC_STATE_MACHINE===e){n="start";break}n="".concat(x(e),"-").concat(r++)}return n},p=async function(e,t,n){var l;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>{};if("string"!=typeof e||"string"!=typeof n||"object"!=typeof t||null===t||!Array.isArray(t[n]))return;let s=t[n],u={[a.ModuleSrc.K_SRC_FUNCTIONS]:d().max.sourceCode.fnCount,[a.ModuleSrc.K_SRC_INPUTS]:d().max.sourceCode.ioCount,[a.ModuleSrc.K_SRC_OUTPUTS]:d().max.sourceCode.ioCount,[a.ModuleSrc.K_SRC_STATE_MACHINE]:d().max.sourceCode.smCount};if(l=s.length>=u[n],l)return;let p=(0,c.r)(),m={id:p,key:h(n,s,i,p)};switch(n){case a.ModuleSrc.K_SRC_FUNCTIONS:case a.ModuleSrc.K_SRC_STATE_MACHINE:m.code="";break;case a.ModuleSrc.K_SRC_INPUTS:case a.ModuleSrc.K_SRC_OUTPUTS:m.type="string",m.name="string ".concat(a.ModuleSrc.K_SRC_INPUTS===n?"input":"output"),m.desc="",m.max=d().max.sourceCode.ioFieldStringLength}t[n].push(m),r(e,t),o(e),setTimeout(()=>{let e=document.getElementById("".concat(x(n),"-").concat(p));null==e||e.focus(),null==e||e.click()},250)};var m=n(3362),f=n(14232),g=n(91040),A=n(38388),y=n(46367),j=n(55181),S=n(46202),v=n(50789),C=n(72978),w=n(29715),b=n(14632),I=n(35268),_=n(66703),T=n(15852),R=n(84812),M=n(91247);let k=(0,I.Ay)(R.A)(e=>{let{theme:t}=e;return{width:"50px",minWidth:"50px",height:"50px",borderRadius:0,position:"relative","&:before":{content:'""',display:"block",position:"absolute",top:"5px",left:"3px",borderRadius:"5px",width:"4px",height:"40px",background:"transparent",opacity:0,transform:"scaleY(0%)",transition:"transform 200ms linear"},"&.active:before":{background:t.palette.primary.main,transform:"scaleY(100%)",opacity:1}}}),N=(0,I.Ay)(M.A)(e=>{let{theme:t}=e;return{position:"absolute",right:"5px",bottom:"5px"}}),F=e=>{let{icons:t=[],agent:n,loaded:i=!1}=e,o=(0,_.A)(),{getSourceModified:s,onSourceModified:c,getSourceOrphans:u,onSourceOrphans:d,getSceSection:x,setSceSection:h,onSceSection:p}=(0,r.P)(),[m,g]=(0,f.useState)(a.ModuleSrc.K_SRC_STATE_MACHINE),[y,j]=(0,f.useState)(!1),[S,v]=(0,f.useState)({}),C="1px 0px 0px 0px ".concat((0,b.A)(o));return(0,f.useEffect)(()=>{if(null!==n){"string"==typeof(null==n?void 0:n.id)&&v(u(n.id));let e=d(e=>{let{agentId:t,orphans:l}=e;t===(null==n?void 0:n.id)&&v(l)});j(s(n.id));let t=c(e=>{let{agentId:t,modified:l}=e;t===n.id&&j(l)});g(x());let l=p(e=>{let{section:t}=e;g(t)});return()=>{t(),e(),l()}}},[n]),(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"50px",boxShadow:C},children:t.map(e=>{let{key:t,label:n,Icon:r}=e,o=t===m,s=null;do{if("source-control"===t&&y){s=(0,l.jsx)(N,{color:i?"primary":"disabled"});break}if(Array.isArray(S[t])&&S[t].length){s=(0,l.jsx)(N,{color:i?"warning":"disabled"});break}}while(!1);return(0,l.jsx)(T.A,{title:n||"",placement:"right",enterDelay:500,enterNextDelay:500,children:(0,l.jsx)(A.A,{sx:{width:"50px",height:"50px"},children:(0,l.jsxs)(k,{className:o?"active":"",disabled:!i,color:"inherit",onClick:()=>h(t),children:[r?(0,l.jsx)(r,{fontSize:"medium",color:o?"inherit":"action"}):null,s]})})},t)})})};var K=n(8628),P=n(13383),E=n(67906),U=n(80553),O=n(44395),z=n(71733),D=n(35003),L=n(38111),W=n(79270),B=n(51553),H=n(52894),V=n(42371),$=n(71608),Y=n(31274),q=n(41745),G=n(39e3),X=n(15751),J=n(23842),Q=n(9282),Z=n(50321),ee=n(20302),et=n(2136),en=n(45196),el=n(64879),ei=n(32673),er=n(36740),eo=n(82343),es=n(52782),ea=n(51197),ec=n(60709),eu=n(55099),ed=n(73674),ex=n(80735),eh=n(96728),ep=n(71090),em=n(88992),ef=n(39091),eg=n(4728),eA=n(39467),ey=n(96571),ej=n(1912),eS=n(83384),ev=n(43400);let eC=e=>{let{isOpen:t=!1,version:n=null,description:i=null,onOpen:r=()=>{},onClose:s=()=>{},onRelease:a=async()=>{}}=e,{i18n:c}=(0,o.B)(),u=(0,f.useRef)(null),[d,x]=(0,f.useState)(!1),[h,p]=(0,f.useState)(!1),m="string"==typeof n?function(e){let t=e.split(".").map(Number);return t[t.length-1]++,t.join(".")}(n):"0.0.1",g={versionName:ef.Yj().required(c.t("Release version is required")).matches(/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$/,c.t("Version name must follow the x.y.z format with no leading zeros")).test("is-greater-or-equal",c.t("Version must be greater than or equal to {{v}}",{v:m}),e=>e&&function(e,t){let n=e.split(".").map(Number),l=t.split(".").map(Number);for(;n.length<l.length;)n.push(0);for(;l.length<n.length;)l.push(0);for(let e=0;e<n.length&&!(n[e]>l[e]);e++)if(n[e]<l[e])return!1;return!0}(e,m)),changes:ef.Yj().max(512,()=>c.t("Must be at most {{n}} characters long",{n:512}))},{reset:y,control:j,handleSubmit:S,formState:{errors:v}}=(0,em.mN)({defaultValues:{versionName:m,changes:""},mode:"onChange",resolver:(0,ep.t)(ef.Ik().shape(g))}),C=async e=>{let{versionName:t,changes:n}=e;p(!0),await a(t,n),p(!1),s()};(0,f.useEffect)(()=>{t&&"function"==typeof r&&r()},[t]);let w=()=>{t&&"function"==typeof s&&s(),y()};return t?(0,l.jsxs)(W.A,{open:!0,onClose:h?()=>{}:w,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[h?null:(0,l.jsx)(O.A,{children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(D.A,{variant:"h4",sx:{ml:4},children:c.t("Create a release")}),(0,l.jsx)(z.A,{"aria-label":c.t("More information"),sx:{ml:2},color:"default",onClick:()=>x(!d),size:"large",children:d?(0,l.jsx)(Q.A,{}):(0,l.jsx)($.A,{})})]})}),(0,l.jsxs)(U.A,{children:[!h&&i&&d?(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",children:i})}):null,!h&&d?(0,l.jsxs)(H.A,{severity:"warning",sx:{mb:6},children:[c.t("Please make sure you have tested your code thouroughly before releasing it!"),(0,l.jsx)("br",{}),c.t("New users and those who have enabled auto-update will instantly use this new version of your module.")]}):null,h?(0,l.jsx)(A.A,{sx:{mt:3},children:(0,l.jsx)(ev.A,{})}):(0,l.jsxs)("form",{onSubmit:S(C),ref:u,children:[(0,l.jsxs)(ey.A,{fullWidth:!0,sx:{my:3},error:!!v.versionName,children:[(0,l.jsx)(em.xI,{name:"versionName",control:j,render:e=>{let{field:{value:t,onChange:n}}=e;return(0,l.jsx)(ej.A,{disabled:h,autoFocus:!0,required:!0,value:t,onChange:n,spellCheck:!1,autoComplete:"off",inputProps:{minLength:3,maxLength:64,tabIndex:1},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{mr:-2},children:(0,l.jsx)(eS.A,{fontSize:"small"})})},label:c.t("Release version"),placeholder:m,error:!!v.versionName})}}),v.versionName&&(0,l.jsx)(eg.A,{sx:{color:"error.main"},children:v.versionName.message})]}),(0,l.jsxs)(ey.A,{fullWidth:!0,sx:{my:3},error:!!v.changes,children:[(0,l.jsx)(em.xI,{name:"changes",control:j,render:e=>{let{field:{value:t,onChange:i}}=e;return(0,l.jsx)(ej.A,{multiline:!0,rows:2,value:t,onChange:i,spellCheck:!1,autoComplete:"off",inputProps:{maxLength:512,tabIndex:2},label:c.t("Release details"),placeholder:"string"==typeof n?c.t("Bug fixes and improvements in this version"):c.t("First release"),error:!!v.changes})}}),v.changes&&(0,l.jsx)(eg.A,{sx:{color:"error.main"},children:v.changes.message})]})]})]}),h?null:(0,l.jsxs)(E.A,{children:[(0,l.jsx)(R.A,{color:"secondary",onClick:w,children:c.t("Cancel")}),(0,l.jsx)(R.A,{variant:"contained",onClick:()=>{u.current&&u.current.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},startIcon:(0,l.jsx)(ec.A,{}),children:c.t("Publish release")})]})]}):null},ew=e=>{let{isOpen:t=!1,version:n=null,onOpen:i=()=>{},onClose:r=()=>{},onDelete:s=async()=>{}}=e,{i18n:a}=(0,o.B)(),[c,u]=(0,f.useState)(!1);(0,f.useEffect)(()=>{t&&"function"==typeof i&&i()},[t]);let d=()=>{t&&"function"==typeof r&&r()},x=async()=>{u(!0),await s(),u(!1),r()};return t?(0,l.jsxs)(W.A,{open:!0,onClose:c?()=>{}:d,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[c?null:(0,l.jsx)(O.A,{children:(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(D.A,{variant:"h4",sx:{ml:4},children:a.t("Delete release v{{version}}",{version:n})})})}),(0,l.jsx)(U.A,{children:c?(0,l.jsx)(A.A,{sx:{mt:3},children:(0,l.jsx)(ev.A,{})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.A,{severity:"error",sx:{mb:3},children:a.t("Are you sure you want to delete this release? This action is irreversible!")}),(0,l.jsx)(H.A,{severity:"warning",children:a.t("Once the release is deleted, the existing source code is removed, and the latest release is installed in its place.")})]})}),c?null:(0,l.jsxs)(E.A,{children:[(0,l.jsx)(R.A,{color:"secondary",onClick:d,children:a.t("Cancel")}),(0,l.jsx)(R.A,{variant:"contained",color:"error",onClick:x,startIcon:(0,l.jsx)(ea.A,{}),children:a.t("Delete release")})]})]}):null};var eb=n(959);let eI=e=>{let{isOpen:t=!1,onOpen:n=()=>{},onClose:i=()=>{},onImport:r=async()=>{},description:s}=e,{i18n:a}=(0,o.B)(),[c,u]=(0,f.useState)(!1),[d,x]=(0,f.useState)(!1);(0,f.useEffect)(()=>{t&&"function"==typeof n&&n()},[t]);let h=()=>{t&&"function"==typeof i&&i()};return t?(0,l.jsxs)(W.A,{open:!0,onClose:d?()=>{}:h,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[d?null:(0,l.jsx)(O.A,{children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,l.jsx)(D.A,{variant:"h4",sx:{ml:4},children:a.t("Import from YAML")}),(0,l.jsx)(z.A,{"aria-label":a.t("More information"),sx:{ml:2},color:"default",onClick:()=>u(!c),size:"large",children:c?(0,l.jsx)(Q.A,{}):(0,l.jsx)($.A,{})})]})}),(0,l.jsxs)(U.A,{children:[!d&&s&&c?(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",children:s})}):null,!d&&c?(0,l.jsx)(H.A,{severity:"warning",sx:{mb:6},children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",children:a.t("Warning! The imported source code will overwrite your current work.")})}):null,d?(0,l.jsx)(A.A,{sx:{mt:6},children:(0,l.jsx)(ev.A,{})}):(0,l.jsx)(eb.A,{maxSize:2,extensions:["yaml"],handleFiles:e=>{let t=Array.isArray(e)&&e.length?e[0]:null;if(!t||"string"!=typeof(null==t?void 0:t.name)||!t.name.toLowerCase().match(/oglama(?: \(\d+\))?\.yaml$/gi))return void P.o.error(a.t("Invalid file extension, expected '.oglama.yaml'"),{duration:5e3,ariaProps:{role:"alert"}});x(!0);let n=new FileReader;n.onload=async e=>{try{let t=(0,eo.qg)(e.target.result);await r(t),P.o.success(a.t("Source code imported successfully!"),{duration:5e3},!1),h()}catch(e){var t;P.o.error("".concat(a.t("Import error"),": ").concat(null!=(t=e.message)?t:e),{duration:5e3,ariaProps:{role:"alert"}})}x(!1)},n.readAsText(t)}})]}),d?null:(0,l.jsx)(E.A,{children:(0,l.jsx)(R.A,{color:"secondary",onClick:h,children:a.t("Close")})})]}):null},e_=e=>{var t;let{isOpen:n=!1,onClose:i=()=>{},moduleId:r,moduleSrcId:s}=e,{i18n:a}=(0,o.B)(),[c,u]=(0,f.useState)(null),[d,x]=(0,f.useState)(!0),h=()=>{n&&"function"==typeof i&&i()};return(0,f.useEffect)(()=>{x(!0),u(null),(async()=>{try{var e;let t=await g.A.get("modules/".concat(r,"/src/").concat(s,"/meta"));"string"==typeof(null==(e=t.data)?void 0:e.id)&&u(t.data)}catch(e){}x(!1)})()},[s]),n?(0,l.jsxs)(W.A,{open:!0,onClose:d?()=>{}:h,sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[d?null:(0,l.jsx)(O.A,{children:(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,l.jsx)(D.A,{variant:"h4",sx:{ml:4},children:null!=(t=null==c?void 0:c.version)?t:a.t("Release not found")})})}),(0,l.jsx)(U.A,{children:d?(0,l.jsx)(ev.A,{}):(0,l.jsx)(H.A,{color:"string"==typeof(null==c?void 0:c.changes)&&c.changes.length?"info":"warning",children:(0,l.jsx)(D.A,{variant:"caption",component:"pre",sx:{color:"inherit",fontSize:"0.85rem",wordBreak:"break-word",whiteSpace:"preserve",fontFamily:"Yaldevi"},children:"string"==typeof(null==c?void 0:c.changes)&&c.changes.length?c.changes:a.t("No changes were documented for this release.")})})}),d?null:(0,l.jsx)(E.A,{children:(0,l.jsx)(R.A,{color:"secondary",onClick:h,children:a.t("Close")})})]}):null};var eT=n(50694),eR=n(13353);let eM=(0,I.Ay)(R.A)(e=>{let{theme:t}=e;return{justifyContent:"start",textTransform:"none","& > .MuiButton-icon":{marginLeft:t.spacing(.5),marginRight:t.spacing(3)},fontSize:"0.75rem",color:"inherit"}}),ek=e=>{var t,n,i,s,c,u,d;let{agent:x,module:h,updateAgent:p=()=>{},updateModule:m=()=>{},srcStateMachine:y=[],srcModified:j=!1,setLoaded:S=()=>{}}=e,{getSource:v,setSource:C,setSourceModified:w}=(0,r.P)(),b=(0,er.A)(),{i18n:I}=(0,o.B)(),_=(0,K.A)(),[R,M]=(0,f.useState)(!1),[k,N]=(0,f.useState)(!1),[F,E]=(0,f.useState)(!1),[U,O]=(0,f.useState)(!1),[W,B]=(0,f.useState)(!1),H="string"==typeof(null==x?void 0:x.installedModuleSrcId)&&Array.isArray(null==h?void 0:h.moduleReleases)&&(null==h?void 0:h.moduleReleases.length)?h.moduleReleases[h.moduleReleases.length-1].srcVersion:null,V="string"==typeof(null==x?void 0:x.installedModuleSrcId)&&Array.isArray(null==h?void 0:h.moduleReleases)&&(null==h?void 0:h.moduleReleases.length)?null==h?void 0:h.moduleReleases.reduce((e,t)=>t.srcId===(null==x?void 0:x.installedModuleSrcId)?t.srcVersion:e,null):null,$=async()=>{var e;if("string"!=typeof(null==x?void 0:x.id))return;let t=await v(x.id,!0);for(let e of Object.values(a.ModuleSrc))t[e]=(Array.isArray(t[e])?t[e]:[]).map(e=>"object"==typeof e&&null!==e?(delete e.id,e):null).filter(e=>null!==e);let n=(0,eo.As)(t,{lineWidth:0,aliasDuplicateObjects:!1,defaultStringType:"PLAIN"});"founder"===(null==(e=_.user)?void 0:e.userRole)&&(P.o.success("Copied to clipboard!",{duration:5e3},!1),b.copy(n));let l=URL.createObjectURL(new Blob([n],{type:"application/x-yaml"})),i=document.createElement("a");i.download="".concat("".concat("string"==typeof(null==h?void 0:h.name)?h.name:x.name).replace(/\W+/gi,"-").toLowerCase(),".oglama.yaml"),i.href=l,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(l)},Y=async e=>{if("object"!=typeof e||null===e)throw Error(I.t("Invalid YAML format"));for(let t of Object.values(a.ModuleSrc))if(!Array.isArray(e[t]))throw Error(I.t('Key "{{n}}" missing from source code YAML',{n:t}));C(x.id,e),w(x.id),S(!1),await new Promise(e=>window.setTimeout(e,500)),S(!0)},q=async(e,t)=>{if("string"==typeof(null==x?void 0:x.id)&&["fork","release"].includes(e)&&"object"==typeof t&&null!==t){S(!1);try{var n,l,i,r;await g.A.put("agents/".concat(x.id,"/src"),await v(x.id,!0));let o=await g.A.post("agents/".concat(x.id,"/").concat(e),t);if("string"==typeof(null==(n=o.data)?void 0:n.id)&&p(o.data),"string"==typeof(null==(l=o.data)?void 0:l.installedModuleId)){let e=await g.A.get("modules/".concat(o.data.installedModuleId));"string"==typeof(null==(i=e.data)?void 0:i.id)&&m(e.data,null==(r=o.data)?void 0:r.installedModuleSrcId)}w(x.id,!1)}catch(e){}S(!0)}},G=async e=>{if("string"==typeof(null==x?void 0:x.id)&&"string"==typeof(null==h?void 0:h.id)&&"string"==typeof e){S(!1);try{var t,n,l;let i=await g.A.put("agents/".concat(x.id,"/modules/").concat(h.id),{srcId:e});if("string"!=typeof(null==(t=i.data)?void 0:t.id))return;p(i.data),m(h,null==(n=i.data)?void 0:n.installedModuleSrcId);let r=await g.A.get("agents/".concat(x.id,"/src"));Array.isArray(null==(l=r.data)?void 0:l.srcStateMachine)&&(C(x.id,r.data),w(x.id,!1))}catch(e){}S(!0)}},X=async()=>{var e,t,n;if("string"!=typeof(null==h?void 0:h.id)||"string"!=typeof(null==x?void 0:x.installedModuleSrcId)||null===V||!Array.isArray(null==h?void 0:h.moduleReleases)||!h.moduleReleases.length||(null==x?void 0:x.installedModuleSrcId)===h.moduleReleases[h.moduleReleases.length-1].srcId||(null==(e=_.user)?void 0:e.id)!==(null==h?void 0:h.authorId)&&"founder"!==(null==(t=_.user)?void 0:t.userRole))return;let l=null==x?void 0:x.installedModuleSrcId,i=h.moduleReleases[h.moduleReleases.length-1].srcId;await G(i);try{let e=await g.A.delete("modules/".concat(h.id,"/src/").concat(l));"string"==typeof(null==(n=e.data)?void 0:n.id)&&m(e.data,i)}catch(e){}};return(0,l.jsxs)(A.A,{children:[(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:2,flexGrow:0},children:null!==h?(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",pl:2},children:[(null==(t=_.user)?void 0:t.id)===(null==h?void 0:h.authorId)||"founder"===(null==(n=_.user)?void 0:n.userRole)?(0,l.jsx)(eT.A,{scale:.8,tooltipPlacement:"top",inactive:!0,module:h}):null,(0,l.jsx)(T.A,{title:"".concat(I.t("Installed module"),": ").concat(h.moduleName),placement:"top",children:(0,l.jsx)(D.A,{variant:"caption",sx:{ml:2,userSelect:"none",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"125px",textTransform:"none",height:"35px",lineHeight:"35px"},children:h.moduleName})})]}),Array.isArray(null==h?void 0:h.moduleReleases)&&h.moduleReleases.length?(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center"},children:[(0,l.jsx)(T.A,{title:I.t("Installed module version"),placement:"top",children:(0,l.jsx)(es.A,{variant:"standard",value:null!=(d=null==x?void 0:x.installedModuleSrcId)?d:null,onChange:e=>G(e.target.value),sx:{mr:1,maxWidth:"70px",height:"35px","&.MuiInput-root:before":{display:"none"},"& .MuiSelect-select.MuiSelect-standard":{minWidth:"30px !important"}},inputProps:{sx:{py:3,pl:1,borderRadius:0}},children:[...h.moduleReleases].reverse().map(e=>{let{srcId:t,srcVersion:n}=e;return(0,l.jsx)(L.A,{value:t,children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"0.75rem",mt:"-1px"},children:["v.",n]})},t)})})}),"string"==typeof(null==x?void 0:x.installedModuleSrcId)?(0,l.jsx)(T.A,{title:I.t("Release details"),placement:"top",children:(0,l.jsx)(z.A,{onClick:()=>E(!0),sx:{width:"30px",height:"30px"},children:(0,l.jsx)(eu.A,{fontSize:"small"})})}):null]}):(0,l.jsxs)(D.A,{variant:"caption",sx:{userSelect:"none",ml:2},children:["(",I.t("no releases"),")"]})]}):(0,l.jsx)(D.A,{variant:"caption",sx:{userSelect:"none",ml:2},children:I.t("No module installed")})}),"string"==typeof(null==x?void 0:x.id)?(0,l.jsxs)(A.A,{sx:{display:"flex",width:"100%",p:2,flexDirection:"column"},children:[j&&y.length&&null!==h&&((null==(i=_.user)?void 0:i.id)===(null==h?void 0:h.authorId)||"founder"===(null==(s=_.user)?void 0:s.userRole))?(0,l.jsx)(eM,{startIcon:(0,l.jsx)(ec.A,{fontSize:"small",color:"action"}),onClick:()=>M(!0),children:I.t("Create a release")}):null,null!==h&&null!==V&&Array.isArray(null==h?void 0:h.moduleReleases)&&h.moduleReleases.length&&(null==x?void 0:x.installedModuleSrcId)!==h.moduleReleases[h.moduleReleases.length-1].srcId&&((null==(c=_.user)?void 0:c.id)===(null==h?void 0:h.authorId)||"founder"===(null==(u=_.user)?void 0:u.userRole))?(0,l.jsx)(eM,{startIcon:(0,l.jsx)(ea.A,{fontSize:"small",color:"action"}),onClick:()=>N(!0),children:I.t("Delete release")}):null,y.length?(0,l.jsx)(eM,{startIcon:(0,l.jsx)(eh.A,{fontSize:"small",color:"action"}),onClick:()=>B(!0),children:I.t("Clone as new module")}):null,(0,l.jsx)(eM,{startIcon:(0,l.jsx)(ex.A,{fontSize:"small",color:"action"}),onClick:()=>O(!0),children:I.t("Import from YAML")}),y.length?(0,l.jsx)(eM,{startIcon:(0,l.jsx)(ed.A,{fontSize:"small",color:"action"}),onClick:()=>$(),children:I.t("Export as YAML")}):null]}):null,F&&"string"==typeof(null==h?void 0:h.id)&&"string"==typeof(null==x?void 0:x.installedModuleSrcId)?(0,l.jsx)(e_,{isOpen:!0,moduleId:null==h?void 0:h.id,moduleSrcId:null==x?void 0:x.installedModuleSrcId,onClose:()=>E(!1)}):null,U?(0,l.jsx)(eI,{isOpen:!0,description:I.t("Import agent source code from a '.oglama.yaml' file."),onClose:()=>O(!1),onImport:Y}):null,null!==h&&R?(0,l.jsx)(eC,{isOpen:!0,description:I.t("Store the changes you have made to this module's source code in a new release.")+(h.isApproved&&h.isPublic?" "+I.t("This new release will be instantly available for users in the module repository."):""),version:H,onClose:()=>M(!1),onRelease:(e,t)=>q("release",{version:e,changes:t})}):null,null!==h&&null!==V&&k?(0,l.jsx)(ew,{isOpen:!0,version:V,onClose:()=>N(!1),onDelete:()=>X()}):null,W?(0,l.jsx)(eR.A,{isOpen:!0,title:I.t("Clone as new module"),description:I.t("Create a new module and store the current source code in release v0.0.1"),onClose:()=>B(!1),onCreate:(e,t)=>q("fork",{moduleName:e,moduleDescription:t})}):null]})};var eN=n(43934),eF=n(93554),eK=n(25596),eP=n(76575),eE=n(8698);let eU=(0,I.Ay)(A.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",marginBottom:t.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}}),eO=e=>{var t,n;let{state:i,id:r,active:s=!1,index:a,tooltip:c="",orphan:u=!1,error:d=!1,selected:x=!1,agentStatus:h=-1,prepareKey:p=()=>{},onClick:m=()=>{},onDelete:g=()=>{},onKeyChange:y=()=>{}}=e,{i18n:j}=(0,o.B)(),S=(0,_.A)(),v=(0,f.useRef)(null),C=(0,f.useRef)(null),w=(0,f.useRef)(null),b=(0,f.useRef)(!0),[I,R]=(0,f.useState)(null!=(n=null==i?void 0:i.key)?n:"");(0,f.useEffect)(()=>{y(null==i?void 0:i.id,p(I,null==i?void 0:i.id),b.current),b.current&&(b.current=!1)},[I]),(0,f.useEffect)(()=>{if(x&&C.current instanceof Element){let e=C.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||C.current.scrollIntoView({behavior:"instant",block:"center"})}},[x]);let M=x?d?S.palette.error.main:0===h?S.palette.warning.main:S.palette.primary.main:null,k=s?S.palette.primary.main:u?S.palette.warning.main:null;return(0,l.jsxs)(eU,{ref:C,children:[(0,l.jsx)(A.A,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,l.jsx)(A.A,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!=M?M:"transparent",transform:"scaleY(".concat(x?"100":"0","%)"),transition:"transform 250ms linear"}})}),0===a?(0,l.jsx)(T.A,{title:j.t("Entry state"),placement:"right",children:(0,l.jsx)(G.A,{color:s?"primary":"action",sx:{mx:1}})}):u?(0,l.jsx)(T.A,{arrow:!0,placement:"right",title:j.t('Orphan state. Call with return { next: "{{keyText}}" }.',{keyText:null==(t=w.current)?void 0:t.value}),children:(0,l.jsx)(eP.A,{color:"warning",sx:{mx:1}})}):(0,l.jsx)(eE.A,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,l.jsx)(T.A,{title:c,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,l.jsxs)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,l.jsx)(ej.A,{inputRef:w,variant:"standard",color:u?"warning":"primary",onClick:m,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:I,placeholder:j.t("State key"),onChange:e=>{var t;return t=e.target.value,void(null!==v.current&&window.clearTimeout(v.current),v.current=window.setTimeout(()=>{R(p(t,null==i?void 0:i.id)),v.current=null},1e3))},inputProps:{id:r,style:{...null!==k?{color:k}:{},fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5}}}),(0,l.jsx)(z.A,{className:"delete",sx:{ml:1},size:"small",onClick:()=>g(null==i?void 0:i.id),children:(0,l.jsx)(eF.A,{fontSize:"small"})})]})})]})};var ez=n(84824);let eD=e=>{let{value:t,total:n,title:i=null}=e;return(!Number.isInteger(n)||n<=0)&&(n=100),(!Number.isInteger(t)||t<0)&&(t=0),t>n&&(t=n),(0,l.jsx)(T.A,{title:i,placement:"right",children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",width:"100%",my:2,px:2},children:[(0,l.jsx)(ez.A,{sx:{borderRadius:1},variant:"determinate",value:100*t/n,color:"inherit"}),(0,l.jsxs)(D.A,{variant:"caption",sx:{flexShrink:0,ml:3},children:[t,"/",n]})]})})},eL=e=>{let{agent:t,loaded:n,activeId:i=null,srcStateMachine:s=[],agentStatus:c=-1,selectedStateKey:u=null,selectedStateError:p=!1}=e,{getSource:m,setSource:g,setSourceModified:y,getSourceOrphans:j,onSourceOrphans:S,setSceTabs:v,addSceItem:C}=(0,r.P)(),{i18n:w}=(0,o.B)(),[b,I]=(0,f.useState)(null),[_,T]=(0,f.useState)([]),M=(0,f.useRef)(s),k=(0,f.useRef)(null),N=(0,f.useRef)(null),F=(e,t)=>h(a.ModuleSrc.K_SRC_STATE_MACHINE,s,e,t);(0,f.useEffect)(()=>{"string"==typeof(null==t?void 0:t.id)&&T(j(t.id).srcStateMachine);let e=S(e=>{let{agentId:n,orphans:l}=e;n===(null==t?void 0:t.id)&&T(l.srcStateMachine)});return()=>{e()}},[null==t?void 0:t.id]),(0,f.useEffect)(()=>{N.current&&Array.isArray(s)&&(M.current=s,k.current=eN.Ay.create(N.current,{animation:150,onUpdate:async e=>{let n=[...M.current],[l]=n.splice(e.oldIndex,1);n.splice(e.newIndex,0,l),M.current=n;let i=await m(t.id);i.srcStateMachine=n,g(t.id,i),y(t.id)}}))},[s]);let K=async e=>{I(null);let n=await m(t.id);Array.isArray(null==n?void 0:n.srcStateMachine)&&"string"==typeof e&&(n.srcStateMachine=n.srcStateMachine.filter(t=>t.id!==e),v(a.ModuleSrc.K_SRC_STATE_MACHINE,e,!1),g(t.id,n),y(t.id))},P=async function(e,n){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=await m(t.id);Array.isArray(null==i?void 0:i.srcStateMachine)&&"string"==typeof e&&(i.srcStateMachine=i.srcStateMachine.map(t=>(t.id===e&&(t.key=n),t)),g(t.id,i),l||y(t.id))};return(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[n?(0,l.jsxs)(A.A,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,l.jsx)(A.A,{sx:{width:"100%"},ref:N,children:s.map((e,t)=>{var n;let r="".concat(null!=(n=e.code)?n:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,l.jsx)(eO,{id:"".concat(x(a.ModuleSrc.K_SRC_STATE_MACHINE),"-").concat(e.id),active:i===e.id,state:e,index:t,orphan:_.includes(e.key),tooltip:r,error:e.key===u&&p,selected:e.key===u,agentStatus:c,prepareKey:F,onClick:()=>v(a.ModuleSrc.K_SRC_STATE_MACHINE,e.id),onDelete:e=>I(e),onKeyChange:P},e.id)})}),(0,l.jsx)(eD,{value:s.length,total:d().max.sourceCode.smCount,title:w.t("Total number of states in this finite-state machine")}),s.length<d().max.sourceCode.smCount?(0,l.jsx)(R.A,{className:0===s.length?"pop":null,onClick:()=>C(a.ModuleSrc.K_SRC_STATE_MACHINE),startIcon:(0,l.jsx)(eK.A,{}),size:"small",children:w.t("Add state")}):null]}):(0,l.jsx)(A.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(ev.A,{count:3})}),null!==b?(0,l.jsxs)(W.A,{open:!0,onClose:()=>I(null),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(O.A,{children:w.t("Delete State")}),(0,l.jsx)(U.A,{children:(0,l.jsx)(H.A,{severity:"warning",children:w.t("Are you sure you want to delete this state?")})}),(0,l.jsxs)(E.A,{children:[(0,l.jsx)(R.A,{color:"secondary",onClick:()=>I(null),children:w.t("Cancel")}),(0,l.jsx)(R.A,{color:"error",onClick:()=>K(b),startIcon:(0,l.jsx)(eF.A,{}),children:w.t("Delete State")})]})]}):null]})},eW=(0,I.Ay)(A.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",marginBottom:t.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1}}}),eB=e=>{var t,n;let{fn:i,id:r,active:s=!1,tooltip:a="",orphan:c=!1,error:u=!1,selected:d=!1,agentStatus:x=-1,prepareKey:h=()=>{},onClick:p=()=>{},onDelete:m=()=>{},onKeyChange:g=()=>{}}=e,{i18n:y}=(0,o.B)(),j=(0,_.A)(),S=(0,f.useRef)(null),v=(0,f.useRef)(!0),C=(0,f.useRef)(null),w=(0,f.useRef)(null),[b,I]=(0,f.useState)(null!=(n=null==i?void 0:i.key)?n:"");(0,f.useEffect)(()=>{g(null==i?void 0:i.id,h(b,null==i?void 0:i.id),v.current),v.current&&(v.current=!1)},[b]),(0,f.useEffect)(()=>{if(d&&C.current instanceof Element){let e=C.current.getBoundingClientRect();e.top+e.height>0&&e.top<(window.innerHeight||document.documentElement.clientHeight)||C.current.scrollIntoView({behavior:"instant",block:"center"})}},[d]);let R=d?u?j.palette.error.main:0===x?j.palette.warning.main:j.palette.primary.main:null,M=s?j.palette.primary.main:c?j.palette.warning.main:null;return(0,l.jsxs)(eW,{ref:C,children:[(0,l.jsx)(A.A,{sx:{position:"absolute",left:0,top:0,width:"5px",height:"30px",borderRadius:5,whiteSpace:"nowrap",flexShrink:0,background:"transparent"},children:(0,l.jsx)(A.A,{sx:{display:"flex",borderRadius:"5px",width:"5px",height:"100%",background:null!=R?R:"transparent",transform:"scaleY(".concat(d?"100":"0","%)"),transition:"transform 250ms linear"}})}),c?(0,l.jsx)(T.A,{arrow:!0,placement:"right",title:y.t('Orphan function. Call with $.fn( "{{keyText}}" )',{keyText:null==(t=w.current)?void 0:t.value}),children:(0,l.jsx)(eP.A,{color:"warning",sx:{mx:1}})}):(0,l.jsx)(eE.A,{className:"drag",color:s?"primary":"action",sx:{mx:1}}),(0,l.jsx)(T.A,{title:a,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,l.jsxs)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,l.jsx)(ej.A,{inputRef:w,variant:"standard",color:c?"warning":"primary",onClick:p,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:b,placeholder:y.t("Function key"),onChange:e=>{var t;return t=e.target.value,void(null!==S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{I(h(t,null==i?void 0:i.id)),S.current=null},1e3))},inputProps:{id:r,style:{...null!==M?{color:M}:{},fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5}}}),(0,l.jsx)(z.A,{className:"delete",sx:{ml:1},size:"small",onClick:()=>m(null==i?void 0:i.id),children:(0,l.jsx)(eF.A,{fontSize:"small"})})]})})]})},eH=e=>{let{agent:t,loaded:n,activeId:i=null,srcFunctions:s=[],agentStatus:c=-1,selectedFnKey:u=null,selectedFnError:p=!1}=e,{getSource:m,setSource:g,setSourceModified:y,getSourceOrphans:j,onSourceOrphans:S,setSceTabs:v,addSceItem:C}=(0,r.P)(),{i18n:w}=(0,o.B)(),[b,I]=(0,f.useState)(null),[_,T]=(0,f.useState)([]),M=(0,f.useRef)(s),k=(0,f.useRef)(null),N=(0,f.useRef)(null),F=(e,t)=>h(a.ModuleSrc.K_SRC_FUNCTIONS,s,e,t);(0,f.useEffect)(()=>{"string"==typeof(null==t?void 0:t.id)&&T(j(t.id).srcFunctions);let e=S(e=>{let{agentId:n,orphans:l}=e;n===(null==t?void 0:t.id)&&T(l.srcFunctions)});return()=>{e()}},[null==t?void 0:t.id]),(0,f.useEffect)(()=>{N.current&&Array.isArray(s)&&(M.current=s,k.current=eN.Ay.create(N.current,{animation:150,onUpdate:async e=>{let n=[...M.current],[l]=n.splice(e.oldIndex,1);n.splice(e.newIndex,0,l),M.current=n;let i=await m(t.id);i.srcFunctions=n,g(t.id,i),y(t.id)}}))},[s]);let K=async e=>{I(null);let n=await m(t.id);Array.isArray(null==n?void 0:n.srcFunctions)&&"string"==typeof e&&(n.srcFunctions=n.srcFunctions.filter(t=>t.id!==e),v(a.ModuleSrc.K_SRC_FUNCTIONS,e,!1),g(t.id,n),y(t.id))},P=async function(e,n){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=await m(t.id);Array.isArray(null==i?void 0:i.srcFunctions)&&"string"==typeof e&&(i.srcFunctions=i.srcFunctions.map(t=>(t.id===e&&(t.key=n),t)),g(t.id,i),l||y(t.id))};return(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[n?(0,l.jsxs)(A.A,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,l.jsx)(A.A,{sx:{width:"100%"},ref:N,children:s.map((e,t)=>{var n;let r="".concat(null!=(n=e.code)?n:"").split("\n")[0].substring(0,105).replace(/^\s*\/\/\s*/gi,"");return(0,l.jsx)(eB,{fn:e,id:"".concat(x(a.ModuleSrc.K_SRC_FUNCTIONS),"-").concat(e.id),active:e.id===i,index:t,orphan:_.includes(e.key),tooltip:r,error:e.key===u&&p,selected:e.key===u,agentStatus:c,prepareKey:F,onClick:()=>v(a.ModuleSrc.K_SRC_FUNCTIONS,e.id),onDelete:e=>I(e),onKeyChange:P},e.id)})}),(0,l.jsx)(eD,{value:s.length,total:d().max.sourceCode.fnCount,title:w.t("Total number of functions in this module")}),s.length<d().max.sourceCode.fnCount?(0,l.jsx)(R.A,{onClick:()=>C(a.ModuleSrc.K_SRC_FUNCTIONS),startIcon:(0,l.jsx)(eK.A,{}),size:"small",children:w.t("Add function")}):null]}):(0,l.jsx)(A.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(ev.A,{count:3})}),null!==b?(0,l.jsxs)(W.A,{open:!0,onClose:()=>I(null),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(O.A,{children:w.t("Delete Function")}),(0,l.jsx)(U.A,{children:(0,l.jsx)(H.A,{severity:"warning",children:w.t("Are you sure you want to delete this function?")})}),(0,l.jsxs)(E.A,{children:[(0,l.jsx)(R.A,{color:"secondary",onClick:()=>I(null),children:w.t("Cancel")}),(0,l.jsx)(R.A,{color:"error",onClick:()=>K(b),startIcon:(0,l.jsx)(eF.A,{}),children:w.t("Delete Function")})]})]}):null]})};var eV=n(12067),e$=n(32966);let eY=(0,I.Ay)(D.A)(e=>{let{theme:t}=e;return{whiteSpace:"pre-wrap",fontSize:"0.8rem",lineHeight:"0.8rem",fontFamily:"Inconsolata,monospace",textAlign:"left","& > span, & > span > span":{display:"inline-block",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",verticalAlign:"top",width:"100%",maxWidth:"250px"},"& > span > span":{width:"auto",maxWidth:"75px",textAlign:"left",direction:"rtl"},"& > span > span > span":{direction:"ltr",unicodeBidi:"bidi-override",verticalAlign:"top"},"&.single":{fontWeight:"bold"},"&.single > span":{maxWidth:"200px"},"& i":{background:"rgba(255,215,0,0.8)",color:"#000",textTransform:"none",fontStyle:"normal",verticalAlign:"top",marginLeft:"2px"}}}),eq=(0,I.Ay)(R.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",flexDirection:"column",marginBottom:t.spacing(1),cursor:"pointer",alignItems:"start",justifyContent:"start",textTransform:"none",position:"relative",paddingLeft:t.spacing(2),paddingRight:t.spacing(2),borderColor:"transparent","&.active [data-role=result]":{color:t.palette.primary.main},"&:before":{content:'""',display:"block",position:"absolute",bottom:"3px",left:"3px",borderRadius:"2px",height:"2px",width:"calc(100% - 6px)",background:"transparent",opacity:0,transform:"scaleX(0%)",transition:"transform 200ms linear"},"&.active":{borderColor:"red"},"&.active:before":{background:t.palette.primary.main,transform:"scaleX(100%)",opacity:1}}}),eG=(0,I.Ay)(D.A)(e=>{let{theme:t}=e;return{marginLeft:t.spacing(1),fontSize:"0.7rem",color:t.palette.info.main}}),eX=function(e){var t,n,i;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,l.jsxs)(eY,{"data-role":"result",variant:"caption",className:r?null:"single",children:["string"==typeof e.prev?(0,l.jsxs)("span",{children:[r?"".concat(e.line-1,"	"):"",e.prev]}):null,(0,l.jsxs)("span",{children:[r?"".concat(e.line,"	"):"",(0,l.jsx)("span",{children:(0,l.jsx)("span",{children:null!=(t=e.match[0])?t:""})}),(0,l.jsx)("i",{children:null!=(n=e.match[1])?n:""}),null!=(i=e.match[2])?i:""]}),"string"==typeof e.next?(0,l.jsxs)("span",{children:[r?"".concat(e.line+1,"	"):"",e.next]}):null]})},eJ=(e,t)=>{let n=t.split("\n"),l=RegExp((0,eV.Nu)(e),"i"),i=[];for(let e=0;e<n.length;e++){let t=n[e].match(l);if(t){let l=t.index,r=n[e].slice(0,l),o=t[0],s=n[e].slice(l+o.length);i.push({prev:e>0?n[e-1]:null,match:[r,o,s],next:e<n.length-1?n[e+1]:null,line:e+1,ch:l})}}return i},eQ=e=>{let{src:t={},icons:n=[],searchText:i="",setSearchText:s=()=>{}}=e,{setSceTabs:c,setSceCursor:u}=(0,r.P)(),{i18n:d}=(0,o.B)(),x=(0,f.useRef)(null),h=(0,f.useRef)(null),p=(0,f.useRef)((()=>{let e={};for(let t of n)e[t.key]={...t};return e})()),[m,g]=(0,f.useState)([]),[y,j]=(0,f.useState)(!0),[S,v]=(0,f.useState)(null),C={["".concat(a.ModuleSrc.K_SRC_STATE_MACHINE,"-key")]:d.t("state key"),["".concat(a.ModuleSrc.K_SRC_STATE_MACHINE,"-code")]:d.t("state"),["".concat(a.ModuleSrc.K_SRC_FUNCTIONS,"-key")]:d.t("function key"),["".concat(a.ModuleSrc.K_SRC_FUNCTIONS,"-code")]:d.t("function"),["".concat(a.ModuleSrc.K_SRC_INPUTS,"-key")]:d.t("input key"),["".concat(a.ModuleSrc.K_SRC_INPUTS,"-name")]:d.t("input name"),["".concat(a.ModuleSrc.K_SRC_OUTPUTS,"-key")]:d.t("output key"),["".concat(a.ModuleSrc.K_SRC_OUTPUTS,"-name")]:d.t("output name")};(0,f.useEffect)(()=>{j(0===i.length);let e={[a.ModuleSrc.K_SRC_STATE_MACHINE]:["key","code"],[a.ModuleSrc.K_SRC_FUNCTIONS]:["key","code"],[a.ModuleSrc.K_SRC_INPUTS]:["key","name"],[a.ModuleSrc.K_SRC_OUTPUTS]:["key","name"]},n=[],l={};if(i.length){for(let r of Object.keys(e))if(Array.isArray(t[r])){for(let o of t[r])if("object"==typeof o&&null!==o)for(let t of e[r]){if("string"!=typeof o[t])continue;let e=eJ(i,o[t]);if(e.length)for(let i of e)l["".concat(r,"-").concat(o.id)]=!0,n.push({section:r,id:o.id,key:o.key,prop:t,result:i})}}}g(n),setTimeout(()=>j(!0),150)},[t,i]);let b=[...new Set(m.map(e=>"".concat(e.section,"-").concat(e.id)))].length,I=m.length;return(0,l.jsxs)(A.A,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,l.jsxs)(A.A,{sx:{display:"flex",height:"75px",px:2,flexDirection:"column"},children:[(0,l.jsx)(ej.A,{inputRef:h,variant:"standard",autoFocus:!0,defaultValue:i,placeholder:d.t("Search"),onChange:e=>{var t;return t=e.target.value.toLowerCase(),void(null!==x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{s(t),x.current=null,v(null)},450))},sx:{width:"100%","& input":{px:"0 !important",fontSize:"0.75rem"},"& .MuiInput-root:before":{display:"none"}},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",children:(0,l.jsx)(w.A,{fontSize:"small",sx:{mx:2}})}),endAdornment:i?(0,l.jsx)(eA.A,{position:"start",children:(0,l.jsx)(T.A,{title:d.t("Clear search"),children:(0,l.jsx)(z.A,{size:"small",sx:{width:30,height:30,mr:-2},onClick:()=>{s(""),v(null),null!==h.current&&(h.current.value="",h.current.focus())},children:(0,l.jsx)(e$.A,{fontSize:"small"})})})}):null}}),i.length?(0,l.jsx)(D.A,{variant:"caption",sx:{m:2,textAlign:"right",fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:I>0?1===I?d.t("1 result"):I>100?d.t("100 / {{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:I,itemsCount:b,obj:1===b?"item":"items"}):d.t("{{resultsCount}} results in {{itemsCount}} {{obj}}",{resultsCount:I,itemsCount:b,obj:1===b?"item":"items"}):d.t("No results")}):null]}),(0,l.jsx)(A.A,{sx:{display:"flex",width:"100%",height:"100%",px:2,overflowY:"auto",flexDirection:"column"},children:y?m.slice(0,100).map((e,t)=>{var n;let i="".concat(e.section,"-").concat(e.id,"-").concat(e.prop,"-").concat(t),r=p.current[e.section].Icon,o=p.current[e.section].label,s=null!=(n=C["".concat(e.section,"-").concat(e.prop)])?n:null;return(0,l.jsxs)(eq,{className:S===i?"active":null,onClick:()=>{v(i),c(e.section,e.id),u(e.id,{line:e.result.line-1,ch:e.result.ch})},children:[(0,l.jsxs)(A.A,{sx:{display:"flex",width:"100%",alignItems:"center",overflow:"hidden",whiteSpace:"nowrap"},children:[(0,l.jsx)(T.A,{title:o,placement:"top",children:(0,l.jsx)(r,{fontSize:"small",sx:{mr:2},color:S===i?"primary":"action"})}),"key"===e.prop?eX(e.result):(0,l.jsx)(eY,{"data-role":"result",variant:"caption",children:(0,l.jsx)("span",{children:e.key})}),null!==s?(0,l.jsxs)(eG,{variant:"caption",children:["(",s,")"]}):null]}),"key"!==e.prop?(0,l.jsx)(A.A,{sx:{width:"100%",mt:2,ml:2,textAlign:"left"},children:eX(e.result,"code"===e.prop)}):null]},i)}):(0,l.jsx)(A.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(ev.A,{count:3})})})]})};var eZ=n(75674),e0=n(4552),e1=n(29783),e5=n(89619),e2=n(34591);function e3(e){return[{value:"int",label:e.t("Integer"),Icon:e5.A},{value:"string",label:e.t("String"),Icon:e2.A},{value:"boolean",label:e.t("Boolean"),Icon:eZ.A},{value:"table",label:e.t("Table"),Icon:e1.A},{value:"files",label:e.t("Files"),Icon:e0.A}]}var e9=n(54895);let e4=(0,I.Ay)(A.A)(e=>{let{theme:t}=e;return{width:"100%",display:"flex",marginBottom:t.spacing(1),position:"relative",alignItems:"center",cursor:"grab","& .delete, & .drag":{opacity:0},"&:hover .delete, &:hover .drag":{opacity:1},"&:hover .type":{opacity:0}}}),e7=e=>{let{type:t,active:n=!1,isList:i=!1}=e,{i18n:r}=(0,o.B)(),s=e3(r).reduce((e,n)=>n.value===t?n.Icon:e,null);return(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",position:"relative"},children:[null!==s?(0,l.jsx)(s,{className:"type",color:n?"primary":"action",fontSize:"small",sx:{position:"absolute",left:"6px"}}):null,i?(0,l.jsx)(e9.A,{className:"type",color:n?"primary":"action",sx:{zIndex:2,fontSize:"0.5rem",position:"absolute",right:"0px",bottom:"3px"}}):null,(0,l.jsx)(eE.A,{className:"drag",color:n?"primary":"action",sx:{mx:1}})]})},e8=e=>{var t,n,i;let{field:r,id:s,active:c=!1,section:u,tooltip:d="",orphan:x=!1,prepareKey:h=()=>{},onClick:p=()=>{},onDelete:m=()=>{},onKeyChange:g=()=>{}}=e,{i18n:y}=(0,o.B)(),j=(0,_.A)(),S=(0,f.useRef)(null),v=(0,f.useRef)(!0),C=(0,f.useRef)(null),[w,b]=(0,f.useState)(null!=(t=null==r?void 0:r.key)?t:"");(0,f.useEffect)(()=>{g(null==r?void 0:r.id,h(w,null==r?void 0:r.id),v.current),v.current&&(v.current=!1)},[w]);let I=c?j.palette.primary.main:x?j.palette.warning.main:null;return(0,l.jsxs)(e4,{children:[x?(0,l.jsx)(T.A,{arrow:!0,placement:"right",title:a.ModuleSrc.K_SRC_INPUTS===u?y.t("Orphan input"):y.t("Orphan output"),children:(0,l.jsx)(eP.A,{color:"warning",sx:{mx:1}})}):(0,l.jsx)(e7,{type:null!=(n=null==r?void 0:r.type)?n:null,active:c,isList:null!=(i=null==r?void 0:r.isList)&&i}),(0,l.jsx)(T.A,{title:d,enterDelay:500,enterNextDelay:500,placement:"right",children:(0,l.jsxs)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center"},children:[(0,l.jsx)(ej.A,{inputRef:C,variant:"standard",color:x?"warning":"primary",onClick:p,sx:{width:"100%",ml:1,"& .MuiInput-root:before":{display:"none"}},defaultValue:w,placeholder:a.ModuleSrc.K_SRC_INPUTS===u?y.t("Input key"):y.t("Output key"),onChange:e=>{var t;return t=e.target.value,void(null!==S.current&&window.clearTimeout(S.current),S.current=window.setTimeout(()=>{b(h(t,null==r?void 0:r.id)),S.current=null},1e3))},inputProps:{id:s,style:{...null!==I?{color:I}:{},fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace",paddingLeft:0,paddingRight:0,paddingTop:5,paddingBottom:5}}}),(0,l.jsx)(z.A,{className:"delete",sx:{ml:1},size:"small",onClick:()=>m(null==r?void 0:r.id),children:(0,l.jsx)(eF.A,{fontSize:"small"})})]})})]})},e6=e=>{let{agent:t,loaded:n,activeId:i=null,srcFields:s=[],ioKey:c=a.ModuleSrc.K_SRC_INPUTS}=e,{getSource:u,setSource:p,setSourceModified:m,getSourceOrphans:g,onSourceOrphans:y,setSceTabs:j,addSceItem:S}=(0,r.P)(),{i18n:v}=(0,o.B)(),[C,w]=(0,f.useState)(null),[b,I]=(0,f.useState)([]),_=(0,f.useRef)(s),T=(0,f.useRef)(null),M=(0,f.useRef)(null),k=(e,t)=>h(c,s,e,t);(0,f.useEffect)(()=>{"string"==typeof(null==t?void 0:t.id)&&I(g(t.id)[c]);let e=y(e=>{let{agentId:n,orphans:l}=e;n===(null==t?void 0:t.id)&&I(l[c])});return()=>{e()}},[null==t?void 0:t.id]),(0,f.useEffect)(()=>{M.current&&Array.isArray(s)&&(_.current=s,T.current=eN.Ay.create(M.current,{animation:150,onUpdate:async e=>{let n=[..._.current],[l]=n.splice(e.oldIndex,1);n.splice(e.newIndex,0,l),_.current=n;let i=await u(t.id);i[c]=n,p(t.id,i),m(t.id)}}))},[s]);let N=async e=>{w(null);let n=await u(t.id);"string"==typeof e&&null!==n&&Array.isArray(n[c])&&(n[c]=n[c].filter(t=>t.id!==e),j(c,e,!1),p(t.id,n),m(t.id))},F=async function(e,n){let l=!(arguments.length>2)||void 0===arguments[2]||arguments[2],i=await u(t.id);"object"==typeof i&&null!==i&&Array.isArray(i[c])&&"string"==typeof e&&(i[c]=i[c].map(t=>(t.id===e&&(t.key=n),t)),p(t.id,i),l||m(t.id))};return(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:2},children:[n?(0,l.jsxs)(A.A,{sx:{display:"flex",width:"100%",alignItems:"center",flexDirection:"column"},children:[(0,l.jsx)(A.A,{sx:{width:"100%"},ref:M,children:s.map((e,t)=>{let n=e.name?"".concat(a.ModuleSrc.K_SRC_INPUTS===c?v.t("Input name"):v.t("Output name"),": ").concat(e.name):"";return(0,l.jsx)(e8,{id:"".concat(x(c),"-").concat(e.id),active:e.id===i,index:t,orphan:b.includes(e.key),tooltip:n,field:e,section:c,prepareKey:k,onClick:()=>j(c,e.id),onDelete:e=>w(e),onKeyChange:F},e.id)})}),(0,l.jsx)(eD,{value:s.length,total:d().max.sourceCode.ioCount,title:a.ModuleSrc.K_SRC_INPUTS===c?v.t("Total number of inputs"):v.t("Total number of outputs")}),s.length<d().max.sourceCode.ioCount?(0,l.jsx)(R.A,{onClick:()=>S(c),size:"small",startIcon:(0,l.jsx)(eK.A,{}),children:a.ModuleSrc.K_SRC_INPUTS===c?v.t("Add input"):v.t("Add output")}):null]}):(0,l.jsx)(A.A,{sx:{width:"100%",mt:3},children:(0,l.jsx)(ev.A,{count:3})}),null!==C?(0,l.jsxs)(W.A,{open:!0,onClose:()=>w(null),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(O.A,{children:a.ModuleSrc.K_SRC_INPUTS===c?v.t("Delete Input"):v.t("Delete Output")}),(0,l.jsx)(U.A,{children:(0,l.jsx)(H.A,{severity:"warning",children:a.ModuleSrc.K_SRC_INPUTS===c?v.t("Are you sure you want to delete this input?"):v.t("Are you sure you want to delete this output?")})}),(0,l.jsxs)(E.A,{children:[(0,l.jsx)(R.A,{color:"secondary",onClick:()=>w(null),children:v.t("Cancel")}),(0,l.jsx)(R.A,{color:"error",onClick:()=>N(C),startIcon:(0,l.jsx)(eF.A,{}),children:a.ModuleSrc.K_SRC_INPUTS===c?v.t("Delete Input"):v.t("Delete Output")})]})]}):null]})},te=(0,I.Ay)("code")(e=>{let{theme:t}=e;return{backgroundColor:t.palette.background.paper,marginLeft:t.spacing(1),marginRight:t.spacing(1),paddingTop:t.spacing(1),paddingBottom:t.spacing(1),borderRadius:t.shape.borderRadius,fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"}}),tt=(e,t)=>"object"==typeof e&&null!==e&&Array.isArray(e[t])?e[t]:[],tn=e=>{var t,n,i,s,c,u,x,h,m;let{src:v={},icons:w=[],agent:I,module:M,updateAgent:k=()=>{},updateModule:N=()=>{},loaded:F,setLoaded:er=()=>{}}=e,{onSceTabs:eo,getSceTabs:es,onSceSection:ea,getSceSection:ec,setSource:eu,onSourceModified:ed,getSourceModified:ex,setSourceModified:eh}=(0,r.P)(),{i18n:ep}=(0,o.B)(),em=(0,_.A)(),ef=(0,K.A)(),eg=(0,f.useRef)(null),eA=(0,f.useRef)(null),[ey,ej]=(0,f.useState)(a.ModuleSrc.K_SRC_STATE_MACHINE),[eS,ev]=(0,f.useState)(!1),[eC,ew]=(0,f.useState)(null),[eb,eI]=(0,f.useState)(!1),[e_,eT]=(0,f.useState)(!1),[eR,eM]=(0,f.useState)(null),[eN,eF]=(0,f.useState)(!1),[eK,eP]=(0,f.useState)(-1),[eE,eU]=(0,f.useState)([]),[eO,ez]=(0,f.useState)(""),[eD,eW]=(0,f.useState)(!1),[eB,eV]=(0,f.useState)(null);(0,f.useEffect)(()=>{var e,t,n;null==(e=window.sdk)||e.irc.handle("irc-main:agent:state",(e,t)=>{"string"==typeof(null==I?void 0:I.id)&&(null!==eg.current&&window.clearTimeout(eg.current),eg.current=window.setTimeout(()=>{ew(e),ev(t),eg.current=null},null===e?500:150))}),null==(t=window.sdk)||t.irc.handle("irc-main:agent:fn",(e,t)=>{"string"==typeof(null==I?void 0:I.id)&&(null!==eA.current&&window.clearTimeout(eA.current),eA.current=window.setTimeout(()=>{eM(e),eI(t),eA.current=null},null===e?500:150*(null!==eA.current)))}),null==(n=window.sdk)||n.irc.handle("irc-main:agent:status",(e,t)=>{"string"==typeof(null==I?void 0:I.id)&&eP(e)}),eU(es().tabs);let l=eo(e=>{let{tabs:t}=e;eU(t)});ej(ec());let i=ea(e=>{let{section:t}=e;ej(t)});null!==I&&eF(ex(I.id));let r=ed(e=>{let{agentId:t,modified:n}=e;t===(null==I?void 0:I.id)&&eF(n)});return()=>{l(),i(),r()}},[I]);let e$=()=>{eV(null)},eY=async e=>{e.preventDefault(),e.stopPropagation(),e$();try{let e=await g.A.put("agents/".concat(I.id),{autoUpdate:!I.autoUpdate});k(e.data)}catch(e){}},eq=async e=>{var t,n;if(e.preventDefault(),e.stopPropagation(),e$(),"string"!=typeof(null==I?void 0:I.id))return null;let l=await (null==(t=window.sdk)?void 0:t.ipc.diskStorage.openAgentFiles(I.id));return"string"!=typeof l&&(P.o.loading(ep.t("Initializing agent..."),null,!1),await p(I.id,v,a.ModuleSrc.K_SRC_STATE_MACHINE,null,eu,eh),await new Promise(e=>setTimeout(e,750)),l=await (null==(n=window.sdk)?void 0:n.ipc.diskStorage.openAgentFiles(I.id))),l},eG=w.reduce((e,t)=>t.key===ey?t.label:e,null),eX="1px solid ".concat((0,b.A)(em)),eJ=eE.reduce((e,t)=>(e[t.section]=t.id,e),{});return(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",flexDirection:"column",width:"300px",borderRight:eX,flexGrow:0,flexShrink:0},children:[(0,l.jsxs)(A.A,{sx:{px:2,width:"100%",height:"50px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,l.jsx)(D.A,{variant:"caption",sx:{textTransform:"uppercase",color:em.palette.text.disabled,ml:2},children:eG}),Object.values(a.ModuleSrc).includes(ey)?(0,l.jsx)(z.A,{size:"small",onClick:()=>eW(!0),children:eD?(0,l.jsx)(Q.A,{fontSize:"small"}):(0,l.jsx)($.A,{fontSize:"small"})}):null,"source-control"===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(A.A,{children:[F&&eN?(0,l.jsx)(T.A,{title:ep.t("Source code modified"),placement:"top",children:(0,l.jsx)(z.A,{onClick:()=>eT(!0),sx:{mr:1,height:"35px",width:"35px"},children:(0,l.jsx)(en.A,{fontSize:"small",sx:{transform:"scale(0.8)"},color:"primary"})})}):null,(0,l.jsx)(z.A,{sx:{width:"30px",height:"30px"},onClick:e=>{eV(e.currentTarget)},children:(0,l.jsx)(J.A,{fontSize:"small"})})]}),(0,l.jsxs)(V.A,{anchorEl:eB,open:!!eB,onClose:e$,children:[(0,l.jsx)(L.A,{onClick:eq,children:(0,l.jsxs)(A.A,{sx:{display:"flex"},children:[(0,l.jsx)(Y.A,{fontSize:"small"}),(0,l.jsx)(D.A,{sx:{ml:3},variant:"body2",children:ep.t("Open containing folder")})]})}),"source-control"===ey&&"string"==typeof(null==I?void 0:I.installedModuleId)?(0,l.jsx)(T.A,{title:ep.t("Toggle automatic updates for the installed module"),children:(0,l.jsxs)(L.A,{onClick:eY,sx:{justifyContent:"space-between"},children:[(0,l.jsxs)(A.A,{sx:{display:"flex"},children:[(0,l.jsx)(ei.A,{fontSize:"small"}),(0,l.jsx)(D.A,{sx:{ml:3},variant:"body2",children:ep.t("Auto-update")})]}),(0,l.jsx)(B.A,{size:"small",sx:{ml:3},checked:I.autoUpdate,defaultValue:I.autoUpdate})]})}):null]})]}):null]}),(0,l.jsxs)(A.A,{sx:{display:"flex",flexDirection:"column",overflow:"hidden",width:"100%",height:"calc( 100vh - 50px)",overflowY:"auto"},children:[a.ModuleSrc.K_SRC_STATE_MACHINE===ey?(0,l.jsx)(eL,{agent:I,loaded:F,activeId:null!=(i=eJ[ey])?i:null,srcStateMachine:null!=(s=v[ey])?s:[],agentStatus:eK,selectedStateKey:eC,selectedStateError:eS}):null,a.ModuleSrc.K_SRC_INPUTS===ey?(0,l.jsx)(e6,{agent:I,loaded:F,activeId:null!=(c=eJ[ey])?c:null,srcFields:tt(v,ey),ioKey:a.ModuleSrc.K_SRC_INPUTS}):null,a.ModuleSrc.K_SRC_OUTPUTS===ey?(0,l.jsx)(e6,{agent:I,loaded:F,activeId:null!=(u=eJ[ey])?u:null,srcFields:tt(v,ey),ioKey:a.ModuleSrc.K_SRC_OUTPUTS}):null,a.ModuleSrc.K_SRC_FUNCTIONS===ey?(0,l.jsx)(eH,{agent:I,loaded:F,activeId:null!=(x=eJ[ey])?x:null,srcFunctions:null!=(h=v[ey])?h:[],agentStatus:eK,selectedFnKey:eR,selectedFnError:eb}):null,"search"===ey?(0,l.jsx)(eQ,{src:v,icons:w,searchText:eO,setSearchText:ez}):null,"source-control"===ey?(0,l.jsx)(ek,{srcStateMachine:null!=(m=v[a.ModuleSrc.K_SRC_STATE_MACHINE])?m:[],module:M,updateModule:N,srcModified:eN,agent:I,updateAgent:k,setLoaded:er}):null]}),eD&&Object.values(a.ModuleSrc).includes(ey)?(0,l.jsxs)(W.A,{open:!0,onClose:()=>eW(!1),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:850,p:1}},children:[(0,l.jsx)(O.A,{children:eG}),(0,l.jsxs)(U.A,{children:[a.ModuleSrc.K_SRC_STATE_MACHINE===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.A,{severity:"success",sx:{mb:3},icon:(0,l.jsx)(Z.A,{}),children:(0,l.jsxs)(D.A,{color:"inherit",variant:"body2",children:[ep.t("Finite-state machine states are written in plain JavaScript.")," ",ep.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(C.A,{}),children:(0,l.jsxs)(D.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are finite-state machine states."),(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:[ep.t("The finite-state machine begins execution from the entry state."),(0,l.jsx)(G.A,{fontSize:"small",sx:{display:"inline-block",verticalAlign:"text-bottom",mx:2}})]}),(0,l.jsxs)("li",{children:[ep.t("The next state to execute is specified using this return object:"),(0,l.jsx)(te,{children:"{ next: string, args?: any[] }"})]}),(0,l.jsx)("li",{children:ep.t("The finite-state machine stops if an error occurs or if no next state is specified.")})]})]})}),(0,l.jsx)(H.A,{severity:"info",icon:(0,l.jsx)(X.A,{}),children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Ctrl/Cmd hover over $ properties to learn more.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} states, with {{length}} characters per state.",{count:d().max.sourceCode.smCount,length:d().max.sourceCode.smCodeLength})})]})})})]}):null,a.ModuleSrc.K_SRC_FUNCTIONS===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.A,{severity:"success",sx:{mb:3},icon:(0,l.jsx)(Z.A,{}),children:(0,l.jsxs)(D.A,{color:"inherit",variant:"body2",children:[ep.t("Functions are written in plain JavaScript.")," ",ep.t("Use the dollar sign object ($) to access the DOM, pause execution, interact with a locally running large language model, fetch user input, save results, and more.")]})}),(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(j.A,{}),children:(0,l.jsxs)(D.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are functions."),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:ep.t("Functions are used to avoid code duplication in finite-state machine states.")}),(0,l.jsx)("li",{children:ep.t("Unlike finite-state machine states, a function's return value has no special significance.")}),(0,l.jsx)("li",{children:ep.t("Functions can be called from either a state or another function with $.fn().")})]})]})}),(0,l.jsx)(H.A,{severity:"info",icon:(0,l.jsx)(X.A,{}),children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Ctrl/Cmd hover over $.fn() strings to view the invoked function.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} functions, with {{length}} characters per function.",{count:d().max.sourceCode.fnCount,length:d().max.sourceCode.fnCodeLength})})]})})})]}):null,a.ModuleSrc.K_SRC_INPUTS===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(S.A,{}),children:(0,l.jsxs)(D.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are your module's inputs."),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:ep.t("Inputs for each run are specified in the Settings tab.")}),(0,l.jsxs)("li",{children:[ep.t("Fetch inputs in states and functions:"),(0,l.jsx)(te,{children:"$.ioInput*()."})]})]})]})}),(0,l.jsx)(H.A,{severity:"info",icon:(0,l.jsx)(X.A,{}),children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder items in the Settings tab.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} inputs.",{count:d().max.sourceCode.ioCount})}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} input tables with up to {{columns}} columns and {{size}}MB per table.",{count:d().max.sourceCode.ioFieldTableCount,columns:d().max.sourceCode.ioFieldColumnCount,size:d().max.sourceCode.ioFieldTableSize})})]})})})]}):null,a.ModuleSrc.K_SRC_OUTPUTS===ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(y.A,{}),children:(0,l.jsxs)(D.A,{color:"inherit",variant:"body2",component:"span",children:[ep.t("These are your module's outputs."),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:ep.t("Outputs are collected in the Results tab.")}),(0,l.jsxs)("li",{children:[ep.t("Store outputs in states and functions:"),(0,l.jsx)(te,{children:"$.ioOutput*()"}),(0,l.jsx)(te,{children:"$.ioSave*()"})]})]})]})}),(0,l.jsx)(H.A,{severity:"info",icon:(0,l.jsx)(X.A,{}),children:(0,l.jsx)(D.A,{color:"inherit",variant:"body2",component:"span",children:(0,l.jsxs)("ul",{style:{margin:0},children:[(0,l.jsx)("li",{children:ep.t("Drag to reorder items in the Results tab.")}),(0,l.jsx)("li",{children:ep.t("Click to edit or rename.")}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} outputs.",{count:d().max.sourceCode.ioCount})}),(0,l.jsx)("li",{children:ep.t("Define up to {{count}} output tables with up to {{columns}} columns per table.",{count:d().max.sourceCode.ioFieldTableCount,columns:d().max.sourceCode.ioFieldColumnCount})})]})})})]}):null]}),(0,l.jsx)(E.A,{children:(0,l.jsx)(R.A,{color:"secondary",onClick:()=>eW(!1),children:ep.t("OK")})})]}):null,e_?(0,l.jsxs)(W.A,{open:!0,onClose:()=>eT(!1),sx:{"& .MuiPaper-root":{width:"100%",maxWidth:650,p:1}},children:[(0,l.jsx)(O.A,{children:ep.t("Locally modified source code")}),(0,l.jsxs)(U.A,{children:[(0,l.jsx)(H.A,{sx:{mb:3},icon:(0,l.jsx)(et.A,{}),children:ep.t("Changes to the source code are instantly saved on your local computer.")}),(null==(t=ef.user)?void 0:t.id)===(null==M?void 0:M.authorId)||"founder"===(null==(n=ef.user)?void 0:n.userRole)?(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(q.A,{}),children:ep.t("Once you are ready to share your changes with others you can publish them as a new release which will become available for install from the module repository.")}):(0,l.jsx)(H.A,{severity:"info",sx:{mb:3},icon:(0,l.jsx)(el.A,{}),children:ep.t("If you wish to share your modifications with others, you can publish it to the module repository.")}),(0,l.jsx)(H.A,{severity:"info",icon:(0,l.jsx)(ee.A,{}),children:ep.t("You can also export and import your work as YAML files completely privately, outside of the module repository.")})]}),(0,l.jsx)(E.A,{children:(0,l.jsx)(R.A,{color:"secondary",onClick:()=>eT(!1),children:ep.t("OK")})})]}):null]})};var tl=n(71948),ti=n(79219),tr=n(50705),to=n(99476),ts=n(18847),ta=n.n(ts);let tc=(0,I.Ay)(A.A)(e=>{let{theme:t}=e;return{width:"100%",height:"100%",display:"flex",flexDirection:"column",background:"light"===t.palette.mode?"#fff":"#272822","&:before, &:after":{content:'""',display:"block",zIndex:0,position:"absolute",top:0,left:0,height:"100%"},"&:before":{width:"30px",background:"light"===t.palette.mode?"#f7f7f7":"#272822",borderRight:"light"===t.palette.mode?"1px solid #dddddd":"none"},"&:after":{width:"7px",left:"auto",right:0,background:t.palette.customColors.bodyBg}}}),tu=ta()(()=>Promise.all([n.e(940),n.e(254),n.e(594),n.e(253),n.e(223)]).then(n.bind(n,70223)),{loadableGenerated:{webpack:()=>[70223]},ssr:!1}),td=e=>{let{code:t,section:n,item:i,id:r,onFnClick:s,maxLength:c=5e4,actionEdit:u=async()=>{},showInfo:d=!1}=e,x=(0,f.useRef)(null),h=(0,f.useRef)(!0),{i18n:p}=(0,o.B)(),[m,g]=(0,f.useState)(t);(0,f.useEffect)(()=>{u(m,h.current),h.current&&(h.current=!1)},[m]);let A=a.ModuleSrc.K_SRC_FUNCTIONS===n?'await $.fn("'.concat(i.key,'"): any'):"($) => { next: string, args?: any[] } | void";return(0,l.jsxs)(tc,{children:[d?(0,l.jsxs)(H.A,{severity:"info",sx:{m:3,zIndex:100},children:[(0,l.jsx)(D.A,{variant:"caption",color:"inherit",children:a.ModuleSrc.K_SRC_FUNCTIONS===n?p.t("Call this function"):p.t("State signature")}),": ",(0,l.jsx)(D.A,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:A})]}):null,(0,l.jsx)(tu,{id:r,section:n,maxLength:c,defaultValue:m,onChange:e=>{null!==x.current&&window.clearTimeout(x.current),x.current=window.setTimeout(()=>{g(e),x.current=null},450)},onFnClick:s})]})};var tx=n(71918),th=n(20243),tp=n(2684),tm=n(80699),tf=n(90836),tg=n(692),tA=n(21936),ty=n(39031),tj=n(78813),tS=n(37277),tv=n(32870),tC=n(39335),tw=n(64621),tb=n(58086),tI=n(83931),t_=n(98738);let tT=e=>{let{sx:t={},items:n=[],setItems:i=()=>{},sanitize:r=e=>e,label:s="",tooltip:a="",placeholder:c="",placeholderMax:u="",adornment:d=null,maxLength:x=32,inputProps:h=null,numeric:p=!1,maxCount:m=25,maxCountToast:f=""}=e,{i18n:g}=(0,o.B)(),y=(0,_.A)();("object"!=typeof t||null===t)&&(t={});let j=async e=>{e.preventDefault();let t=new FormData(e.target);e.target.reset();let l=p?parseInt(t.get("value"),10):t.get("value");if("function"==typeof r&&(l=r(l)),null===l)return;let o=structuredClone(Array.isArray(n)?n:[]),s=!1;do{if(p){if(!Number.isFinite(l)){P.o.error(g.t("Value is not a valid number"));break}}else{if("string"!=typeof l){P.o.error(g.t("Value is not a valid string"));break}if(!l.length){P.o.error(g.t("Value cannot be empty"));break}}if(o.includes(l)){P.o.error("".concat(g.t("Value already added"),": ").concat(l));break}if(o.length>=m){P.o.error("string"==typeof f&&f.length?f:g.t("Cannot add more than {{maxCount}} values",{maxCount:m}));break}if("".concat(l).length>x){P.o.error(g.t("Value cannot be longer than {{maxLength}} characters",{maxLength:x}));break}s=!0}while(!1);s&&(o.push(l),i(o))},S=!Number.isInteger(m)||!Array.isArray(n)||n.length<m;return(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",...t},children:(0,l.jsxs)(A.A,{sx:{display:"flex",flexDirection:"column",gap:1,width:"100%",position:"relative",zIndex:0},children:[(0,l.jsx)(D.A,{variant:"caption",component:"div",sx:{position:"absolute",top:"-10px",left:"10px",px:1,background:y.palette.background.paper},children:s}),(0,l.jsxs)(A.A,{sx:{p:3,pt:4,borderRadius:1,border:"1px solid ".concat("light"===y.palette.mode?"rgba(50,50,50,0.25)":"rgba(255,255,255,0.25)"),flexDirection:"column",minHeight:"40px",display:"flex",alignItems:"center","&:hover":{borderColor:"light"===y.palette.mode?"rgba(50,50,50,0.35)":"rgba(255,255,255,0.35)"}},children:[Array.isArray(n)&&n.length?(0,l.jsx)(A.A,{sx:{display:"flex",width:"100%"},children:(0,l.jsx)(t_.A,{items:n,setItems:i,onDelete:e=>{i(structuredClone(Array.isArray(n)?n:[]).filter(t=>"".concat(t)!=="".concat(e)))},numeric:p})}):null,Number.isInteger(m)&&m>0?(0,l.jsx)(T.A,{title:a||g.t("Total number of items"),children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",width:"100%",mb:3,px:2},children:[(0,l.jsx)(ez.A,{color:"inherit",sx:{borderRadius:1},value:100*(Array.isArray(n)?n.length:0)/m}),(0,l.jsxs)(D.A,{variant:"caption",sx:{flexShrink:0,width:"50px",textAlign:"right"},children:[Array.isArray(n)?n.length:0,"/",m]})]})}):null,(0,l.jsx)("form",{style:{width:"100%"},onSubmit:j,children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",width:"100%",px:2,mb:2},children:[(0,l.jsx)(ej.A,{fullWidth:!0,name:"value",disabled:!S,...p?{type:"number",inputMode:"numeric"}:{},sx:{width:"100%",...S?{}:{"& fieldset":{borderColor:"transparent !important",userSelect:"none"}}},inputProps:null!=h?h:{maxLength:x},placeholder:S?c:u||g.t("Maximum number of items reached"),InputProps:{startAdornment:null!==d?(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:d}):null}}),S?(0,l.jsx)(z.A,{sx:{ml:2},type:"submit",children:(0,l.jsx)(eK.A,{})}):null]})})]})]})})};var tR=n(27395);let tM=e=>{var t,n,i,r,c,u,x,h,p,m,g,y;let{field:j,section:S,srcFields:v=[],actionEdit:C=async()=>{},showInfo:w=!1}=e,{i18n:b}=(0,o.B)(),I=(0,_.A)(),R=(0,f.useRef)(!0),M=(0,f.useRef)(null),k=(0,f.useRef)(null),N=(0,f.useRef)(null),F=(0,f.useRef)(null),K=(0,f.useRef)(null),E=(0,f.useRef)(null),U=(0,f.useRef)(null),O=(0,f.useRef)(null),z=(0,f.useRef)(null),W=(0,f.useRef)(null),V=(0,f.useRef)(null),$=(0,f.useRef)(null),Y=(0,f.useRef)(null),q=(0,f.useRef)(null),G=(0,f.useRef)(null),X=(0,f.useRef)(null),[J,Q]=(0,f.useState)(null!=(t=null==j?void 0:j.type)?t:"string"),[Z,ee]=(0,f.useState)(null!=(n=null==j?void 0:j.name)?n:""),[et,en]=(0,f.useState)(null!=(i=null==j?void 0:j.desc)?i:""),[el,ei]=(0,f.useState)(Array.isArray(null==j?void 0:j.extensions)?j.extensions:["txt"]),[er,eo]=(0,f.useState)(null==(r=null==j?void 0:j.multiple)||r),[ea,ec]=(0,f.useState)(null==(c=null==j?void 0:j.visible)||c),[ed,ex]=(0,f.useState)(null!=(u=null==j?void 0:j.options)?u:[]),[eh,ep]=(0,f.useState)(null!=(x=null==j?void 0:j.default)?x:null),[em,ef]=(0,f.useState)(null!=(h=null==j?void 0:j.depends)?h:null),[eg,eS]=(0,f.useState)(null!=(p=null==j?void 0:j.columns)?p:[]),[ev,eC]=(0,f.useState)(null!=(m=null==j?void 0:j.isList)?m:null),[ew,eb]=(0,f.useState)(null!=(g=null==j?void 0:j.min)?g:null),[eI,e_]=(0,f.useState)(null!=(y=null==j?void 0:j.max)?y:null),eT=(a.ModuleSrc.K_SRC_INPUTS===S&&Array.isArray(v)?v:[]).filter(e=>"boolean"===e.type).map(e=>e.key),eR=e=>{for(e="".concat(null!=e?e:"").trim().substring(0,d().max.sourceCode.ioFieldNameLength);!(e.length>0);)e="".concat(J," ").concat(a.ModuleSrc.K_SRC_INPUTS===S?"input":"output");return null!==q.current&&(q.current.value=e),e},eM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==F.current&&window.clearTimeout(F.current),F.current=window.setTimeout(()=>{!(e=eK(J,"int"===J?parseInt(e,10):"string"==typeof e?e:null,!1))&&Array.isArray(ed)&&ed.length&&(e=ed[0]),ep(e),null!==W.current&&(W.current.value=null!=e?e:""),F.current=null},t)},ek=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==U.current&&window.clearTimeout(U.current),U.current=window.setTimeout(()=>{eC(e=!!parseInt(e,10)),null!==$.current&&($.current.value=e),U.current=null},t)},eN=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;null!==K.current&&window.clearTimeout(K.current),K.current=window.setTimeout(()=>{eT.includes(e)||(e=null),ef(e),null!==V.current&&(V.current.value=e),K.current=null},t)},eF=(e,t)=>{null!==E.current&&window.clearTimeout(E.current),E.current=window.setTimeout(()=>{e=parseInt(e,10),t=parseInt(t,10),Number.isInteger(e)||(e=null),Number.isInteger(t)||(t=null),["files","string"].includes(J)&&(e<=0&&(e=null),t<=0&&(t=null)),null!==e&&null!==t&&t<e&&(t=e),"string"===J&&((null===t||t>d().max.sourceCode.ioFieldStringLength)&&(t=d().max.sourceCode.ioFieldStringLength),Array.isArray(ed)&&ed.length&&t>d().max.sourceCode.ioFieldOptionLength&&(t=d().max.sourceCode.ioFieldOptionLength),e>t&&(e=null)),eb(e),null!==G.current&&(G.current.value=e),e_(t),null!==X.current&&(X.current.value=t),E.current=null},250)};(0,f.useEffect)(()=>{R.current||ex([])},[J]),(0,f.useEffect)(()=>{!R.current&&(eF(ew,eI),Array.isArray(ed)&&ed.map(e=>"".concat(e)).includes("".concat(eh))||eM(""))},[ed]),(0,f.useEffect)(()=>{let e=window.setTimeout(async()=>{ee(eR(Z)),await C(null==j?void 0:j.id,{fieldType:J,fieldName:Z,fieldDesc:et,fieldExts:el,fieldMulti:er,fieldVisible:ea,fieldOptions:ed,fieldDefault:eh,fieldDepends:em,fieldColumns:eg,fieldIsList:ev,fieldMin:ew,fieldMax:eI},R.current),R.current&&(R.current=!1)},450);return()=>window.clearTimeout(e)},[J,Z,et,el,er,ea,ed,eh,em,eg,ev,ew,eI]);let eK=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],l=null;do{if("int"===e){if(!Number.isInteger(t)){n&&P.o.error(b.t("Not a valid integer"));break}if(Number.isInteger(ew)&&t<ew){n&&P.o.error(b.t("Integer cannot be smaller than {{fieldMin}}",{fieldMin:ew}));break}if(Number.isInteger(eI)&&t>eI){n&&P.o.error(b.t("Integer cannot be greater than {{fieldMax}}",{fieldMax:eI}));break}}else{if("string"!=typeof t){n&&P.o.error(b.t("Not a valid string"));break}let e=(t=t.trim()).length;if(e||(t=null),Number.isInteger(ew)&&e<ew){n&&P.o.error(b.t("String cannot be shorter than {{fieldMin}} characters",{fieldMin:ew}));break}if(Number.isInteger(eI)&&e>eI){n&&P.o.error(b.t("String cannot be longer than {{fieldMax}} characters",{fieldMax:eI}));break}}l=t}while(!1);return l},eP=e3(b),eE="table"===J?"Row":(0,eV.TF)(J),eU="table"===J?"Object":J,eO=a.ModuleSrc.K_SRC_INPUTS===S?"".concat("table"===J?"await ":"","$.ioInput").concat(eE,'("').concat(null==j?void 0:j.key,'"): ').concat("files"===J?"string[] - File paths":"".concat(eU).concat(["int","string"].includes(J)&&ev&&ed.length>1?"[]":"","|null")):"files"===J?'await $.ioSave*("'.concat(null==j?void 0:j.key,'"): string - File path'):"await $.ioOutput".concat(eE,'("').concat(null==j?void 0:j.key,'", ').concat(eU,"): boolean");return(0,l.jsxs)(A.A,{sx:{background:I.palette.background.paper,flexDirection:"column",display:"flex",width:"100%",zIndex:10,flexShrink:0,flexGrow:0,p:3},children:[w?(0,l.jsxs)(H.A,{severity:"info",sx:{mb:2},children:[(0,l.jsx)(D.A,{variant:"caption",color:"inherit",children:a.ModuleSrc.K_SRC_INPUTS===S?b.t("Get this input"):b.t("Set this output")}),": ",(0,l.jsx)(D.A,{variant:"caption",sx:{fontSize:"0.9rem",lineHeight:"0.9rem",fontFamily:"Inconsolata,monospace"},children:eO})]}):null,(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:2},children:(0,l.jsx)(T.A,{placement:"left",title:b.t("Maximum length: {{len}} characters",{len:d().max.sourceCode.ioFieldNameLength}),children:(0,l.jsx)(ej.A,{fullWidth:!0,label:a.ModuleSrc.K_SRC_INPUTS===S?b.t("Input name"):b.t("Output name"),required:!0,defaultValue:Z,inputRef:q,onChange:e=>{var t;return t=e.target.value,void(null!==O.current&&window.clearTimeout(O.current),O.current=window.setTimeout(()=>{ee(eR(t)),O.current=null},1e3))},inputProps:{maxLength:d().max.sourceCode.ioFieldNameLength},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(tA.A,{fontSize:"small"})})}})})}),(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,l.jsx)(T.A,{placement:"left",title:b.t("Maximum length: {{len}} characters",{len:d().max.sourceCode.ioFieldDescLength}),children:(0,l.jsx)(ej.A,{fullWidth:!0,multiline:!0,minRows:1,maxRows:5,label:a.ModuleSrc.K_SRC_INPUTS===S?b.t("Input description"):b.t("Output description"),defaultValue:et,onChange:e=>{var t;return t=e.target.value,void(null!==z.current&&window.clearTimeout(z.current),z.current=window.setTimeout(()=>{en("".concat(t).trim().substring(0,d().max.sourceCode.ioFieldDescLength)),z.current=null},1e3))},inputProps:{maxLength:d().max.sourceCode.ioFieldDescLength,style:{paddingTop:0,paddingBottom:0}},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(eu.A,{fontSize:"small"})})}})})}),(0,l.jsxs)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,l.jsxs)(ey.A,{fullWidth:!0,children:[(0,l.jsxs)(th.A,{sx:{px:2,background:I.palette.background.paper,ml:-1},children:[a.ModuleSrc.K_SRC_INPUTS===S?b.t("Input type"):b.t("Output type")," "]}),(0,l.jsx)(es.A,{value:J,required:!0,onChange:e=>(e=>{if("table"!==J&&"table"===e&&v.filter(e=>"table"===e.type).length>=d().max.sourceCode.ioFieldTableCount)return void P.o.error(b.t("Cannot use more than {{ioFieldTableCount}} tables",{ioFieldTableCount:d().max.sourceCode.ioFieldTableCount}));Q(e)})(e.target.value),fullWidth:!0,children:eP.map(e=>{let{value:t,label:n,Icon:i}=e;return(0,l.jsx)(L.A,{value:t,children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[i?(0,l.jsx)(i,{fontSize:"small",sx:{mr:5}}):null,n||""]})},t)})})]}),"files"===J?(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",ml:2},children:(0,l.jsx)(T.A,{placement:"left",title:b.t("Comma-separated list of accepted extensions"),children:(0,l.jsx)(ej.A,{fullWidth:!0,required:!0,label:b.t("File extensions"),defaultValue:Array.isArray(el)?el.join(", "):"txt",inputRef:Y,placeholder:b.t("File extensions"),onChange:e=>{var t;return t=e.target.value,void(null!==M.current&&window.clearTimeout(M.current),M.current=window.setTimeout(()=>{let e=[...new Set("".concat(t).split(",").map(e=>(0,s.Pt)(e,d().max.sourceCode.ioFieldExtensionLength)).filter(e=>e.length>0))].slice(0,d().max.sourceCode.ioFieldExtensionCount);e.length||(e=["txt"]),ei(e),null!==Y.current&&(Y.current.value=e.join(", ")),M.current=null},1e3))},inputProps:{maxLength:(d().max.sourceCode.ioFieldExtensionLength+2)*d().max.sourceCode.ioFieldExtensionCount},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(tv.A,{fontSize:"small"})})}})})}):null,"files"===J&&a.ModuleSrc.K_SRC_INPUTS===S?(0,l.jsx)(A.A,{sx:{width:"auto",display:"flex",alignItems:"center",mx:2},children:(0,l.jsx)(T.A,{title:b.t("Select multiple files"),placement:"left",children:(0,l.jsx)(tx.A,{labelPlacement:"start",control:(0,l.jsx)(B.A,{checked:er,onChange:e=>{var t;return t=e.target.checked,void(null!==k.current&&window.clearTimeout(k.current),k.current=window.setTimeout(()=>{eo(!!t),k.current=null},100))}}),label:(0,l.jsx)(A.A,{sx:{display:"flex",height:"100%",justifyContent:"center",mr:2},children:(0,l.jsx)(tf.A,{fontSize:"small"})})})})}):null,"files"===J&&a.ModuleSrc.K_SRC_OUTPUTS===S?(0,l.jsx)(A.A,{sx:{width:"auto",display:"flex",alignItems:"center",mx:2},children:(0,l.jsx)(T.A,{title:b.t("Output is visible"),placement:"left",children:(0,l.jsx)(tx.A,{labelPlacement:"start",control:(0,l.jsx)(B.A,{checked:ea,onChange:e=>{var t;return t=e.target.checked,void(null!==N.current&&window.clearTimeout(N.current),N.current=window.setTimeout(()=>{ec(!!t),N.current=null},100))}}),label:(0,l.jsx)(A.A,{sx:{display:"flex",height:"100%",justifyContent:"center",mr:2},children:(0,l.jsx)(tR.A,{fontSize:"small"})})})})}):null]}),["string","int","files"].includes(J)?(0,l.jsxs)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:[(0,l.jsx)(ej.A,{fullWidth:!0,defaultValue:ew,inputRef:G,type:"number",inputMode:"numeric",label:"files"===J?b.t("Minimum file size (MB)"):"int"===J?b.t("Minimum value"):b.t("Minimum length"),onChange:e=>eF(e.target.value,eI),inputProps:{min:["files","string"].includes(J)?0:null,max:"string"===J?Array.isArray(ed)&&ed.length?d().max.sourceCode.ioFieldOptionLength:d().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:"files"===J?(0,l.jsx)(tb.A,{fontSize:"small"}):"int"===J?(0,l.jsx)(tg.A,{fontSize:"small"}):(0,l.jsx)(tC.A,{fontSize:"small"})})}}),(0,l.jsx)(ej.A,{sx:{ml:2},fullWidth:!0,defaultValue:eI,inputRef:X,type:"number",inputMode:"numeric",label:"files"===J?b.t("Maximum file size (MB)"):"int"===J?b.t("Maximum value"):b.t("Maximum length"),onChange:e=>eF(ew,e.target.value),inputProps:{min:["files","string"].includes(J)?0:null,max:"string"===J?Array.isArray(ed)&&ed.length?d().max.sourceCode.ioFieldOptionLength:d().max.sourceCode.ioFieldStringLength:null},InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:"files"===J?(0,l.jsx)(tI.A,{fontSize:"small"}):"int"===J?(0,l.jsx)(tj.A,{fontSize:"small"}):(0,l.jsx)(tw.A,{fontSize:"small"})})}})]}):null,a.ModuleSrc.K_SRC_INPUTS===S&&["string","int"].includes(J)?(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:Array.isArray(ed)&&ed.length?(0,l.jsxs)(ey.A,{fullWidth:!0,children:[(0,l.jsx)(th.A,{sx:{px:2,background:I.palette.background.paper,ml:-1},children:b.t("Default value")}),(0,l.jsxs)(es.A,{label:b.t("Default value"),inputRef:W,value:null!=eh?eh:"",onChange:e=>{var t;return eM("".concat(null!=(t=e.target.value)?t:""))},fullWidth:!0,children:[(0,l.jsx)(L.A,{value:null,children:(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,l.jsx)(D.A,{variant:"caption",children:b.t("No default value")})})}),ed.map(e=>(0,l.jsx)(L.A,{value:e,children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,l.jsx)(tm.A,{fontSize:"small",sx:{mr:5}}),e]})},e))]})]}):(0,l.jsx)(ej.A,{fullWidth:!0,inputRef:W,label:b.t("Default value"),defaultValue:null!=eh?eh:"",onChange:e=>{var t;return eM("".concat(null!=(t=e.target.value)?t:""),1e3)},inputProps:{..."int"===J?{min:ew,max:eI}:{minLength:ew,maxLength:eI}},type:"int"===J?"number":"string",inputMode:"int"===J?"numeric":"text",InputProps:{startAdornment:(0,l.jsx)(eA.A,{position:"start",sx:{ml:0},children:(0,l.jsx)(tm.A,{fontSize:"small"})})}})}):null,a.ModuleSrc.K_SRC_INPUTS===S&&["string","int"].includes(J)&&Array.isArray(ed)&&ed.length>1?(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,l.jsxs)(ey.A,{fullWidth:!0,children:[(0,l.jsx)(th.A,{sx:{px:2,background:I.palette.background.paper,ml:-1},children:b.t("Input format")}),(0,l.jsxs)(es.A,{label:b.t("Input format"),inputRef:$,value:ev?"1":"0",onChange:e=>{var t;return ek("".concat(null!=(t=e.target.value)?t:0))},fullWidth:!0,children:[(0,l.jsx)(L.A,{value:"0",children:(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,l.jsx)(D.A,{variant:"caption",children:b.t("Single: user selects a string")})})}),(0,l.jsx)(L.A,{value:"1",children:(0,l.jsx)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:(0,l.jsx)(D.A,{variant:"caption",children:b.t("List: user selects an array of strings")})})})]})]})}):null,a.ModuleSrc.K_SRC_INPUTS===S&&["string","int"].includes(J)?(0,l.jsx)(tT,{sx:{mt:4},items:ed,setItems:ex,sanitize:e=>eK(J,e),label:b.t("Input options - ommit if users can set any value"),placeholder:b.t("Option value"),adornment:(0,l.jsx)(ty.A,{fontSize:"small"}),inputProps:{..."int"===J?{min:ew,max:eI}:{minLength:ew,maxLength:Math.min(null!=eI?eI:d().max.sourceCode.ioFieldOptionLength,d().max.sourceCode.ioFieldOptionLength)}},maxLength:d().max.sourceCode.ioFieldOptionLength,maxCount:d().max.sourceCode.ioFieldOptionCount,maxCountToast:b.t("Cannot add more than {{n}} options",{n:d().max.sourceCode.ioFieldOptionCount}),numeric:"int"===J}):null,"table"===J?(0,l.jsx)(tT,{sx:{mt:4},items:eg,setItems:eS,sanitize:e=>(0,s.Pt)(e,d().max.sourceCode.ioFieldColumnLength),label:b.t("Table columns *"),placeholder:b.t("Table column name"),placeholderMax:b.t("Maximum number of columns reached"),tooltip:b.t("Total number of columns"),adornment:(0,l.jsx)(tp.A,{fontSize:"small"}),maxLength:d().max.sourceCode.ioFieldColumnLength,maxCount:d().max.sourceCode.ioFieldColumnCount,maxCountToast:b.t("Cannot add more than {{n}} table columns",{n:d().max.sourceCode.ioFieldColumnCount})}):null,a.ModuleSrc.K_SRC_INPUTS===S&&"boolean"!==J?(0,l.jsx)(A.A,{sx:{width:"100%",display:"flex",alignItems:"center",mt:4},children:(0,l.jsx)(T.A,{placement:"left",title:b.t("Show field only if this boolean is set to true"),children:(0,l.jsxs)(ey.A,{fullWidth:!0,children:[(0,l.jsx)(th.A,{sx:{px:2,background:I.palette.background.paper,ml:-1},children:b.t("Dependency")}),(0,l.jsxs)(es.A,{label:b.t("Dependency"),inputRef:V,value:null!=em?em:"",onChange:e=>{var t;return eN("".concat(null!=(t=e.target.value)?t:""))},fullWidth:!0,children:[(0,l.jsx)(L.A,{value:null,children:(0,l.jsx)(D.A,{variant:"caption",children:b.t("No dependency - field is always shown")})}),eT.map(e=>(0,l.jsx)(L.A,{value:e,children:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",fontSize:"1rem"},children:[(0,l.jsx)(tS.A,{fontSize:"small",sx:{mr:5}}),e]})},e))]})]})})}):null]})};var tk=n(75359);let tN=(0,I.Ay)(tl.A)(e=>{let{theme:t}=e;return{height:"50px",minHeight:"50px",paddingRight:0,paddingLeft:0,marginRight:t.spacing(1),"&:hover .close":{opacity:1}}}),tF=(0,I.Ay)("span")(e=>{let{theme:t}=e;return{lineHeight:1.5,fontSize:"0.75rem",textTransform:"none",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"125px",[t.breakpoints.down("md")]:{display:"none"}}}),tK=(0,I.Ay)(A.A)(e=>{let{theme:t}=e;return{height:"50px",position:"relative",display:"flex",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"space-between",paddingLeft:t.spacing(1),paddingRight:t.spacing(1)}}),tP=(0,I.Ay)(A.A)(e=>{let{theme:t}=e;return{position:"absolute",overflowY:"auto",height:"100%",width:"100%",zIndex:1,right:0,top:0}}),tE=e=>{let{src:t={},icons:n=[],agent:i,loaded:s=!1}=e,{getSource:c,setSource:u,setSourceModified:x,setSceTabs:h,getSceTabs:p,onSceTabs:m}=(0,r.P)(),{i18n:g}=(0,o.B)(),y=(0,_.A)(),[j,S]=(0,f.useState)(!1),[v,C]=(0,f.useState)([]),[w,I]=(0,f.useState)(null);(0,f.useEffect)(()=>{C(p().tabs),I(p().tabsIndex);let e=m(e=>{let{tabs:t,tabsIndex:n}=e;C(t),I(n)});return()=>{e()}},[i]);let R=async function(e,t,n){let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=await c(i.id);null!==r&&Array.isArray(r[e])&&"string"==typeof t&&(r[e]=r[e].map(e=>(e.id===t&&(e.code=n),e)),u(i.id,r),l||x(i.id))},M=async function(e,t,n){let l=!(arguments.length>3)||void 0===arguments[3]||arguments[3],r=await c(i.id),{fieldType:o,fieldName:s,fieldDesc:d,fieldExts:h,fieldMulti:p,fieldVisible:m,fieldOptions:f,fieldDefault:g,fieldDepends:A,fieldColumns:y,fieldIsList:j,fieldMin:S,fieldMax:v}=n;"string"==typeof t&&null!==r&&Array.isArray(r[e])&&(r[e]=r[e].map(n=>{if(n.id===t)switch(n={id:t,key:n.key,type:o,name:s,desc:d},"boolean"!==o&&a.ModuleSrc.K_SRC_INPUTS===e&&(n.depends=A),o){case"string":case"int":n.min=S,n.max=v,a.ModuleSrc.K_SRC_INPUTS===e&&(n.options=Array.isArray(f)&&f.length?f:null,n.default=g,n.isList=Array.isArray(f)&&f.length>1?!!j:null);break;case"files":n.min=S,n.max=v,n.extensions=Array.isArray(h)?h:["txt"],a.ModuleSrc.K_SRC_INPUTS===e&&(n.multiple=!!p),a.ModuleSrc.K_SRC_OUTPUTS===e&&(n.visible=!!m);break;case"table":n.columns=y}for(let e of Object.keys(n))null===n[e]&&delete n[e];return n}),u(i.id,r),l||x(i.id))},k=async e=>{let t=await c(i.id);if(Array.isArray(t[a.ModuleSrc.K_SRC_FUNCTIONS])){let n=t[a.ModuleSrc.K_SRC_FUNCTIONS].reduce((t,n)=>n.key===e?n.id:t,null);"string"==typeof n?h(a.ModuleSrc.K_SRC_FUNCTIONS,n):P.o.error(g.t('Function "{{fn}}" does not exist',{fn:e}))}},N=null,F=(Array.isArray(v)?structuredClone(v):[]).map((e,n)=>(e.item=(null!==t&&Array.isArray(t[e.section])?t[e.section]:[]).reduce((t,n)=>e.id===n.id?n:t,null),e.selected=w===n,e.selected&&(N="".concat(e.section,"-").concat(e.id)),e)).filter(e=>null!==e.item);return(0,l.jsxs)(A.A,{sx:{width:"calc(100% - 350px)",height:"100vh",display:"flex",flexDirection:"column"},children:[(0,l.jsx)(tK,{sx:{boxShadow:F.length?"0px -1px 0px 0px ".concat((0,b.A)(y)," inset"):null},children:F.length&&"string"==typeof N?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ti.Ay,{value:N,children:(0,l.jsx)(tr.A,{variant:"scrollable",sx:{"& .MuiTabs-indicator":{borderRadius:"5px",marginBottom:"4px",height:"4px"},height:"50px",width:"100%"},children:F.map(e=>{var t,i;let r="".concat(e.section,"-").concat(e.id),o=n.reduce((t,n)=>e.section===n.key?n.Icon:t,null),s=n.reduce((t,n)=>e.section===n.key?n.label:t,null);return(0,l.jsx)(tN,{icon:(0,l.jsx)(o,{fontSize:"small",sx:{ml:2}}),iconPosition:"start",onClick:()=>h(e.section,e.id),value:r,label:(0,l.jsxs)(A.A,{sx:{display:"flex",alignItems:"center",px:1,"& .close":{opacity:0},"&:hover .close":{opacity:1}},children:[(0,l.jsx)(T.A,{title:"".concat(s," / ").concat(null==(t=e.item)?void 0:t.key),arrow:!0,enterDelay:750,enterNextDelay:750,placement:"bottom",children:(0,l.jsx)(tF,{children:null==(i=e.item)?void 0:i.key})}),(0,l.jsx)(A.A,{className:"close",sx:{ml:2,cursor:"pointer",opacity:.2,display:"flex"},onClick:t=>{t.stopPropagation(),h(e.section,e.id,!1)},children:(0,l.jsx)(to.A,{fontSize:"small",color:"action"})})]})},r)})})}),(0,l.jsx)(T.A,{title:g.t("Toggle hints"),placement:"left",children:(0,l.jsx)(z.A,{"aria-label":g.t("More information"),color:"default",onClick:()=>S(!j),size:"small",children:j?(0,l.jsx)(Q.A,{fontSize:"small"}):(0,l.jsx)($.A,{fontSize:"small"})})})]}):null}),(0,l.jsx)(A.A,{sx:{position:"relative",width:"100%",height:"100%",background:s&&F.length?y.palette.background.paper:null},children:s&&F.length?F.map(e=>{var n;return(0,l.jsxs)(tP,{sx:{zIndex:e.selected?10:-1},children:[[a.ModuleSrc.K_SRC_STATE_MACHINE,a.ModuleSrc.K_SRC_FUNCTIONS].includes(e.section)?(0,l.jsx)(td,{code:null==(n=e.item)?void 0:n.code,section:e.section,item:e.item,id:e.id,onFnClick:k,maxLength:d().max.sourceCode.smCodeLength,actionEdit:(t,n)=>R(e.section,e.id,t,n),showInfo:j}):null,[a.ModuleSrc.K_SRC_INPUTS,a.ModuleSrc.K_SRC_OUTPUTS].includes(e.section)?(0,l.jsx)(tM,{field:e.item,section:e.section,srcFields:((e,t)=>"object"==typeof e&&null!==e&&Array.isArray(e[t])?e[t]:[])(t,e.section),actionEdit:(t,n,l)=>{M(e.section,t,n,l)},showInfo:j}):null]},"".concat(e.section,"-").concat(e.id))}):(0,l.jsx)(A.A,{sx:{display:"flex",width:"100%",height:"100%",justifyContent:"center",alignItems:"center"},children:(0,l.jsx)(tk.A,{grey:!0,size:192,sx:{opacity:.1}})})})]})},tU=e=>{let t={};for(let n of Object.values(a.ModuleSrc)){if(t[n]=[],"object"!=typeof e||null===e||!Array.isArray(e[n]))continue;let l={};switch(n){case a.ModuleSrc.K_SRC_STATE_MACHINE:for(let t of e.srcStateMachine)if("string"==typeof(null==t?void 0:t.code))for(let e of[...t.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\breturn\s+\{\s*([^{}]+)\s*\}/g)]){let t=e[1].match(/['"]?next['"]?\s*:\s*"([\w\.\-]+)"/);t&&(l[t[1]]=!0)}break;case a.ModuleSrc.K_SRC_INPUTS:for(let t of[a.ModuleSrc.K_SRC_STATE_MACHINE,a.ModuleSrc.K_SRC_FUNCTIONS])for(let n of e[t])if("string"==typeof(null==n?void 0:n.code))for(let e of[...n.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.ioInput\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi)])l[e[1]]=!0;break;case a.ModuleSrc.K_SRC_OUTPUTS:for(let t of[a.ModuleSrc.K_SRC_STATE_MACHINE,a.ModuleSrc.K_SRC_FUNCTIONS])for(let n of e[t])if("string"==typeof(null==n?void 0:n.code))for(let e of[...n.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.io(?:Output|Save)\w+\s*\([^\w\.\-]*([\w\.\-]+)/gi)])l[e[1]]=!0;break;case a.ModuleSrc.K_SRC_FUNCTIONS:for(let t of[a.ModuleSrc.K_SRC_STATE_MACHINE,a.ModuleSrc.K_SRC_FUNCTIONS])for(let n of e[t])if("string"==typeof(null==n?void 0:n.code))for(let e of[...n.code.replace(/\/\/.*$|\/\*[\s\S]*?\*\//gm,"").matchAll(/\$\.fn\s*\([^\w\.\-]*([\w\.\-]+)/g)])l[e[1]]=!0}t[n]=(a.ModuleSrc.K_SRC_STATE_MACHINE===n?e.srcStateMachine.slice(1):e[n]).map(e=>e.key).filter(e=>"string"==typeof e&&void 0===l[e])}return t},tO=()=>{var e;let t="".concat(null==(e=window.sdk)?void 0:e.irc.winName).replace(/^@source\//,""),{setAgentId:n,setPageTitle:s,setPageSubtitle:c,getSource:u,setSource:d,onSource:x,onSourceModified:h,getSourceModified:b,setSourceModified:I,setSourceOrphans:_,onSceItemAdd:T}=(0,r.P)(),{i18n:R}=(0,o.B)(),[M,k]=(0,f.useState)(!1),[N,K]=(0,f.useState)(!1),[P,E]=(0,f.useState)(null),[U,O]=(0,f.useState)(null),[z,D]=(0,f.useState)({});(0,f.useEffect)(()=>{var e,l,r;n(t),null==(e=window.sdk)||e.irc.send(m.A.irc.WINDOW_MAIN,"irc-source:open",[!0]),window.addEventListener("beforeunload",function(e){var n;null==(n=window.sdk)||n.irc.send(m.A.irc.WINDOW_MAIN,"ipc:disk-storage:agents:commit",[t])}),null==(l=window.sdk)||l.irc.handle("irc-main:module-repo:data",e=>{var n;"object"==typeof(null==e?void 0:e.agentData)&&(null==(n=e.agentData)?void 0:n.id)===t&&(O(e.agentData),"object"==typeof e.moduleData&&E(e.moduleData),"object"==typeof e.sourceCode&&d(t,e.sourceCode,!1))}),null==(r=window.sdk)||r.irc.handle("irc-main:agent:data",e=>{"object"==typeof e&&null!==e&&O({...e})}),(async()=>{var e,n,l;let r=null;try{let n=await (0,i.f)("agents",()=>g.A.get("agents")),l=Array.isArray(n.data)?n.data.reduce((e,n)=>(null==n?void 0:n.id)===t?n:e,null):null;if(O(l),"string"==typeof(null==l?void 0:l.installedModuleId)){r=l.installedModuleId;let t=await g.A.get("modules/".concat(r));"string"==typeof(null==(e=t.data)?void 0:e.id)&&E(t.data)}}catch(e){404===(null==(n=e.response)?void 0:n.status)&&"string"==typeof r&&(null==(l=window.sdk)||l.irc.send(m.A.irc.WINDOW_MAIN,"irc-source:module:purge",[r]))}k(b(t))})();let o=h(e=>{let{agentId:n,modified:l}=e;n===t&&k(l)});return()=>o()},[]),(0,f.useEffect)(()=>{var e;s(null!==U?"".concat(null!=(e=U.name)?e:""):null),(async()=>{if("string"==typeof(null==U?void 0:U.id)){let e=await u(U.id,!0);D(null!=e?e:{}),_(U.id,tU(null!=e?e:"")),K(!0)}})();let t=x(e=>{let{agentId:t,sourceCode:n}=e;t===(null==U?void 0:U.id)&&(D(n),_(t,tU(n)))});return()=>t()},[U]),(0,f.useEffect)(()=>{let e=T(e=>{let{section:t,key:n}=e;"string"==typeof(null==U?void 0:U.id)&&p(U.id,z,t,n,d,I)});return()=>e()},[null==U?void 0:U.id,z]),(0,f.useEffect)(()=>{c((M?"● ":"")+R.t("Source code"))},[M]);let L=[{key:a.ModuleSrc.K_SRC_STATE_MACHINE,label:R.t("Finite-state machine"),Icon:C.A},{key:a.ModuleSrc.K_SRC_FUNCTIONS,label:R.t("Functions"),Icon:j.A},{key:a.ModuleSrc.K_SRC_INPUTS,label:R.t("Inputs"),Icon:S.A},{key:a.ModuleSrc.K_SRC_OUTPUTS,label:R.t("Outputs"),Icon:y.A},{key:"search",label:R.t("Search"),Icon:w.A},{key:"source-control",label:R.t("Source control"),Icon:v.A}];return(0,l.jsxs)(A.A,{sx:{display:"flex",width:"100%",height:"100%"},children:[(0,l.jsx)(F,{icons:L,agent:U,loaded:N}),(0,l.jsx)(tn,{src:z,icons:L,agent:U,updateAgent:e=>{if("string"==typeof(null==e?void 0:e.id)){var t;let n=structuredClone(e);delete n.moduleReleases,O(n),null==(t=window.sdk)||t.irc.send(m.A.irc.WINDOW_MAIN,"irc-source:agent:data",[n])}},updateModule:(e,n)=>{if("string"==typeof(null==e?void 0:e.id)){var l;E(structuredClone(e)),null==(l=window.sdk)||l.irc.send(m.A.irc.WINDOW_MAIN,"irc-source:module:installed",[t,e,n])}},loaded:N,setLoaded:K,module:P}),(0,l.jsx)(tE,{src:z,icons:L,agent:U,loaded:N})]})};tO.guestGuard=!0;let tz=tO},86529:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/source-code",function(){return n(83366)}])}},e=>{e.O(0,[284,957,797,470,654,338,636,593,792],()=>e(e.s=86529)),_N_E=e.O()}]);