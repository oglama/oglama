#!/usr/bin/env node

/*!
 * @architect Mark Jivko <mark@oglama.com>
 * @copyright © 2024-2026 Oglama™ (https://oglama.com)
 * 
 * Licensed under the Oglama™ Source-Available License, Version 1.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 *     https://github.com/oglama/oglama/blob/main/LICENSE.txt
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Zt=Object.defineProperty;var me=n=>{throw TypeError(n)};var Kt=(n,t,e)=>t in n?Zt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var m=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var o=(n,t,e)=>Kt(n,typeof t!="symbol"?t+"":t,e),de=(n,t,e)=>t.has(n)||me("Cannot "+e);var c=(n,t,e)=>(de(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>t.has(n)?me("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(n):t.set(n,e),v=(n,t,e,s)=>(de(n,t,"write to private field"),s?s.call(n,e):t.set(n,e),e);var X=m((ir,fe)=>{var T;fe.exports=(T=class{},o(T,"green",t=>"\x1B[32m".concat(t,"\x1B[0m")),o(T,"orange",t=>"\x1B[38;5;208m".concat(t,"\x1B[0m")),o(T,"blue",t=>"\x1B[34m".concat(t,"\x1B[0m")),o(T,"magenta",t=>"\x1B[35m".concat(t,"\x1B[0m")),o(T,"red",t=>"\x1B[31m".concat(t,"\x1B[0m")),o(T,"gray",t=>"\x1B[90m".concat(t,"\x1B[0m")),T)});var _e=m((cr,ge)=>{ge.exports=class{constructor(t){o(this,"_oglama");this._oglama=t}}});var xe=m((pr,ye)=>{var es=_e();ye.exports=class extends es{getMainMinWidth(){return 1210}getMainMinHeight(){return 640}getMainLoginWidth(){return 512}getMainLoginHeight(){return 512}getSourceMinWidth(){return this.getMainMinWidth()-100}getSourceMinHeight(){return this.getMainMinHeight()-50}getRpcPort(){return 7099}getSsgPort(){return 7199}getOllamaPort(){return 7299}}});var P=m((hr,we)=>{var D,M,B,R;we.exports=(D=class{constructor(){w(this,M,{});w(this,B,!1);w(this,R,null)}_useRPC(t){v(this,B,Number.isInteger(t)&&t>0?t:!1)}_register(t){if(typeof t=="string")for(let e of Object.getOwnPropertyNames(this))["_","#"].includes(e[0])||typeof this[e]!="function"||(c(this,M)[e]="ipc:".concat(t,":").concat(e))}_runner(t,...e){let s=c(this,B),r=function(i,a,l){this.run=async function(){let d=null;if(typeof c(i,M)[a]=="string")if(s)try{let u=await fetch("http://0.0.0.0:".concat(s,"/ipc"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({channel:c(i,M)[a],args:l})});d=u.ok?await u.json():new Error(await u.json())}catch(u){d=new Error("".concat(u.message??u))}else{if(c(i,R)===null)try{v(i,R,require("electron").ipcRenderer)}catch{}d=typeof c(i,R)?.invoke=="function"?await c(i,R).invoke(c(i,M)[a],...l):null}if(d instanceof Error)throw new Error("".concat(D.devMode?"".concat(s?"rpc:":"").concat(c(i,M)[a]," "):"").concat(d.message??d));return d}};return new r(this,t,e)}async _promise(t,...e){return await this._runner(t,...e).run()}},M=new WeakMap,B=new WeakMap,R=new WeakMap,o(D,"devMode",!1),D)});var ve=m((fr,be)=>{var ts=P();be.exports=class extends ts{constructor(){super();o(this,"openAgentFiles",e=>this._promise("openAgentFiles",e));o(this,"purge",e=>this._promise("purge",e));o(this,"runInit",(e,s=null,r=null,i=null)=>this._promise("runInit",e,s,r,i));o(this,"runDelete",(e,s)=>this._promise("runDelete",e,s));o(this,"envGet",e=>this._promise("envGet",e));o(this,"envSet",(e,s)=>this._promise("envSet",e,s));o(this,"sourceGet",e=>this._promise("sourceGet",e));o(this,"sourceSet",(e,s)=>this._promise("sourceSet",e,s));o(this,"inputsGet",(e,s="session",r=null)=>this._promise("inputsGet",e,s,r));o(this,"inputScalarsSet",(e,s,r=null)=>this._promise("inputScalarsSet",e,s,r));o(this,"inputFilesAdd",(e,s,r,i=null)=>this._promise("inputFilesAdd",e,s,r,i));o(this,"inputFilesDelete",(e,s,r,i=null)=>this._promise("inputFilesDelete",e,s,r,i));o(this,"inputTableQuery",(e,s,r=1,i=5e3,a=null)=>this._promise("inputTableQuery",e,s,r,i,a));o(this,"inputTableAdd",(e,s,r=[],i=null)=>this._promise("inputTableAdd",e,s,r,i));o(this,"inputTableGet",(e,s,r,i="session",a=null)=>this._promise("inputTableGet",e,s,r,i,a));o(this,"inputTableUpdate",(e,s,r,i,a=null)=>this._promise("inputTableUpdate",e,s,r,i,a));o(this,"inputTableDelete",(e,s,r=null,i=null)=>this._promise("inputTableDelete",e,s,r,i));o(this,"outputTableQuery",(e,s,r,i=1,a=5e3)=>this._promise("outputTableQuery",e,s,r,i,a));o(this,"outputTableAdd",(e,s,r,i)=>this._promise("outputTableAdd",e,s,r,i));o(this,"outputsGet",(e,s)=>this._promise("outputsGet",e,s));o(this,"outputsQuery",(e,s,r=null,i=null,a=null)=>this._promise("outputsQuery",e,s,r,i,a));o(this,"outputScalarSet",async(e,s,r,i)=>this._promise("outputScalarSet",e,s,r,i));o(this,"outputFilesInit",async(e,s,r,i=null)=>this._promise("outputFilesInit",e,s,r,i));o(this,"outputFilesAppend",async(e,s,r,i,a=null)=>this._promise("outputFilesAppend",e,s,r,i,a));o(this,"outputFilesDelete",async(e,s,r)=>this._promise("outputFilesDelete",e,s,r));this._register("diskStorage")}}});var Ce=m((yr,Se)=>{var ss=ve();Se.exports=class extends ss{constructor(t){super(),this._useRPC(t)}}});var Pe=m((wr,Ee)=>{var rs=P();Ee.exports=class extends rs{constructor(){super();o(this,"getAt",(e,s)=>this._promise("getAt",e,s));o(this,"create",(e,s,r)=>this._promise("create",e,s,r));o(this,"readAll",(e,s)=>this._promise("readAll",e,s));o(this,"read",(e,s)=>this._promise("read",e,s));o(this,"updateName",(e,s,r)=>this._promise("updateName",e,s,r));o(this,"updateInfo",(e,s,r)=>this._promise("updateInfo",e,s,r));o(this,"updateReady",(e,s,r)=>this._promise("updateReady",e,s,r));o(this,"updateEnabled",(e,s,r)=>this._promise("updateEnabled",e,s,r));o(this,"delete",(e,s=null,r=null)=>this._promise("delete",e,s,r));this._register("session")}}});var $e=m((Sr,Oe)=>{var ns=Pe();Oe.exports=class extends ns{constructor(t){super(),this._useRPC(t)}}});var qe=m((Er,Ae)=>{var is=P();Ae.exports=class extends is{constructor(){super();o(this,"install",()=>this._promise("install"));o(this,"check",()=>this._promise("check"));this._register("updater")}}});var ke=m(($r,Ie)=>{var os=qe();Ie.exports=class extends os{constructor(t){super(),this._useRPC(t)}}});var Me=m((qr,Te)=>{var as=P();Te.exports=class extends as{constructor(){super();o(this,"getOS",()=>this._promise("getOS"));o(this,"getName",()=>this._promise("getName"));o(this,"getUUID",()=>this._promise("getUUID"));o(this,"getSerialNumber",()=>this._promise("getSerialNumber"));o(this,"getRam",()=>this._promise("getRam"));o(this,"getCpuArch",()=>this._promise("getCpuArch"));o(this,"getCpuName",()=>this._promise("getCpuName"));o(this,"getFileSize",e=>this._promise("getFileSize",e));o(this,"setPostAuth",e=>this._promise("setPostAuth",!!e));o(this,"getPostAuth",()=>this._promise("getPostAuth"));o(this,"errorLog",(e,s="")=>this._promise("errorLog",e,s));o(this,"showFileInFolder",e=>this._promise("showFileInFolder",e));o(this,"request",(e,s="GET",r={},i={},a=!0,l=60,d=!0)=>this._promise("request",e,s,r,i,a,l,d));this._register("device")}}});var Re=m((Tr,De)=>{var cs=Me();De.exports=class extends cs{constructor(t){super(),this._useRPC(t)}}});var je=m((Dr,Ne)=>{var ls=P();Ne.exports=class extends ls{constructor(){super();o(this,"list",()=>this._promise("list"));o(this,"closeAll",()=>this._promise("closeAll"));o(this,"open",e=>this._promise("open",e));o(this,"close",e=>this._promise("close",e));o(this,"webContents",(e,s,r)=>this._promise("webContents",e,s,r));this._register("source")}}});var Ue=m((jr,Fe)=>{var us=je();Fe.exports=class extends us{constructor(t){super(),this._useRPC(t)}}});var Ge=m((Ur,Le)=>{var ps=P();Le.exports=class extends ps{constructor(){super();o(this,"list",()=>this._promise("list"));o(this,"removeAll",()=>this._promise("removeAll"));o(this,"add",(e,s,r=!1)=>this._promise("add",e,s,r));o(this,"initWorker",e=>this._promise("initWorker",e));o(this,"remove",e=>this._promise("remove",e));o(this,"select",e=>this._promise("select",e));o(this,"getSelected",()=>this._promise("getSelected"));o(this,"setControlled",(e,s=!0)=>this._promise("setControlled",e,s));o(this,"openDevTools",(e,s=null)=>this._promise("openDevTools",e,s));o(this,"setDevToolsTitle",(e,s=null)=>this._promise("setDevToolsTitle",e,s));o(this,"getBounds",e=>this._promise("getBounds",e));o(this,"getMouse",e=>this._promise("getMouse",e));o(this,"moveMouse",(e,s,r,i=null,a=!1,l=[])=>this._promise("moveMouse",e,s,r,i,a,l));o(this,"jiggleMouse",(e,s=50,r=[])=>this._promise("jiggleMouse",e,s,r));o(this,"typeAt",(e,s,r,i,a=!1,l=5,d=250)=>this._promise("typeAt",e,s,r,i,a,l,d));o(this,"loadUrl",(e,s,r=60)=>this._promise("loadUrl",e,s,r));o(this,"getUrl",e=>this._promise("getUrl",e));o(this,"getTitle",e=>this._promise("getTitle",e));o(this,"reload",(e,s=!1,r=60)=>this._promise("reload",e,s,r));o(this,"goHome",e=>this._promise("goHome",e));o(this,"goBack",(e,s=60)=>this._promise("goBack",e,s));o(this,"goForward",(e,s=60)=>this._promise("goForward",e,s));o(this,"setFileInput",(e,s,r)=>this._promise("setFileInput",e,s,r));o(this,"openInNewWindow",(e,s)=>this._promise("openInNewWindow",e,s));o(this,"waitForDomReady",(e,s=60)=>this._promise("waitForDomReady",e,s));o(this,"saveDownload",(e,s,r,i=600,a=null)=>this._promise("saveDownload",e,s,r,i,a));o(this,"saveScreenshot",async(e,s,r,i="png",a=null,l=!1,d=100)=>this._promise("saveScreenshot",e,s,r,i,a,l,d));o(this,"captureFrame",(e,s=null,r=null,i=!1,a=null)=>this._promise("captureFrame",e,s,r,i,a));o(this,"getPreview",e=>this._promise("getPreview",e));o(this,"smoothScroll",(e,s,r=100,i=!0)=>this._promise("smoothScroll",e,s,r,i));o(this,"webContents",(e,s,r=[],i=null,a=[])=>this._promise("webContents",e,s,r,i,a));o(this,"sendKeys",(e,s,r={})=>this._promise("sendKeys",e,s,r));this._register("target")}}});var We=m((Hr,He)=>{var hs=Ge();He.exports=class extends hs{constructor(t){super(),this._useRPC(t)}}});var te=m((Br,Be)=>{var ms=P();Be.exports=class extends ms{constructor(){super();o(this,"openExternal",e=>this._promise("openExternal","".concat(e)));this._register("main/login")}}});var ze=m((Qr,Je)=>{var ds=te();Je.exports=class extends ds{constructor(t){super(),this._useRPC(t)}}});var Ve=m((Vr,Ye)=>{var fs=P(),gs=te(),U,Qe;Ye.exports=(Qe=class extends fs{constructor(e=!0){super();o(this,"login",null);w(this,U,null);o(this,"focus",()=>this._promise("focus"));o(this,"setOnTop",(e=!0)=>this._promise("setOnTop",!!e));o(this,"getOnTop",()=>this._promise("getOnTop"));o(this,"setDarkMode",e=>this._promise("setDarkMode",!!e));o(this,"getDarkMode",()=>this._promise("getDarkMode"));o(this,"getProcessVersions",()=>this._promise("getProcessVersions"));o(this,"getPathForFile",e=>{if(c(this,U)===null)try{v(this,U,require("electron").webUtils)}catch{}return c(this,U)?.getPathForFile(e)||""});o(this,"quit",()=>this._promise("quit"));o(this,"openExternal",e=>this._promise("openExternal","".concat(e)));o(this,"showOpenDialog",(e,s=[],r=!1)=>this._promise("showOpenDialog",e,s,r));this._register("main"),e&&(this.login=new gs)}},U=new WeakMap,Qe)});var Ze=m((Kr,Xe)=>{var _s=ze(),ys=Ve();Xe.exports=class extends ys{constructor(e){super(!1);o(this,"login",null);this._useRPC(e),this.login=new _s(e)}}});var st=m((sn,tt)=>{var x=X(),q="__default__",L="__all__",Ke=(n,t)=>{let e=$=>Array.isArray($)||$===null?$:[$],s=($,Y,C,he)=>{let F,V=$[Y],ee=he.string.indexOf(Y)!==-1?C==null||C===!0?"":String(C):typeof C=="boolean"?C:he.boolean.indexOf(Y)!==-1?C==="false"?!1:C==="true"||($._.push((F=+C,F*0===0?F:C)),!!C):(F=+C,F*0===0?F:C);$[Y]=V==null?ee:Array.isArray(V)?V.concat(ee):[V,ee]};n=n||[],t=t||{};let r,i,a,l,d,u={_:[]},h=0,f=0,p=0,g=n.length,b=t.alias!==void 0,E=t.unknown!==void 0,Q=t.default!==void 0;if(t.alias=t.alias||{},t.string=e(t.string),t.boolean=e(t.boolean),b)for(r of Object.keys(t.alias))for(i=t.alias[r]=e(t.alias[r]),h=0;h<i.length;h++)(t.alias[i[h]]=i.concat(r)).splice(h,1);for(h=t.boolean.length;h-- >0;)for(i=t.alias[t.boolean[h]]||[],f=i.length;f-- >0;)t.boolean.push(i[f]);for(h=t.string.length;h-- >0;)for(i=t.alias[t.string[h]]||[],f=i.length;f-- >0;)t.string.push(i[f]);if(Q){for(r of Object.keys(t.default))if(l=typeof t.default[r],i=t.alias[r]=t.alias[r]||[],t[l]!==void 0)for(t[l].push(r),h=0;h<i.length;h++)t[l].push(i[h])}let pe=E?Object.keys(t.alias):[];for(h=0;h<g;h++){if(a=n[h],a==="--"){u._=u._.concat(n.slice(++h));break}for(f=0;f<a.length&&a.charCodeAt(f)===45;f++);if(f===0)u._.push(a);else if(a.substring(f,f+3)==="no-"){if(l=a.substring(f+3),E&&pe.indexOf(l)===-1)return t.unknown(a);u[l]=!1}else{for(p=f+1;p<a.length&&a.charCodeAt(p)!==61;p++);for(l=a.substring(f,p),d=a.substring(++p)||h+1===g||(""+n[h+1]).charCodeAt(0)===45||n[++h],i=f===2?[l]:l,p=0;p<i.length;p++){if(l=i[p],E&&pe.indexOf(l)===-1)return t.unknown("-".repeat(f)+l);s(u,l,p+1<i.length||d,t)}}}if(Q)for(r in t.default)u[r]===void 0&&(u[r]=t.default[r]);if(b)for(r of Object.keys(u))for(i=t.alias[r]||[];i.length>0;)u[i.shift()]=u[r];return u},y={prepItem:(n,t=e=>e)=>{if(!Array.isArray(n)||(n=n.filter(s=>Array.isArray(s)&&s.length>=2),!n.length))return"";let e=n.map(s=>s[0]).reduce((s,r)=>typeof r=="string"&&r.length>s?r.length:s,0)+4;return n.map(s=>t("".concat(s[0]).padEnd(e+1))+s[1]+(typeof s[2]<"u"?" ".concat(x.gray("(default")," ").concat(x.green(JSON.stringify(s[2]))).concat(x.gray(")")):""))},prepSection:(n,t,e=s=>s)=>!Array.isArray(t)||!t.length?"":"\n".concat(" ".repeat(2)).concat(x.gray(n.toUpperCase()),"\n").concat(t.map(s=>"".concat(" ".repeat(4)).concat(typeof e=="function"?e(s):s)).join("\n"),"\n"),help:(n,t,e,s="")=>{let r="\n  ".concat([x.gray("Oglama\u2122 CLI"),"v".concat(s),x.gray("by Mark Jivko <mark@oglama.com>")].join(" "),"\n");r+="  ".concat(x.gray("Copyright (c) 2024-".concat(new Date().getFullYear()," oglama.com")),"\n");let i=t[e],a="$ npx ".concat(n),l=t[L],d=p=>"".concat(a," ").concat(p),u=[["--help","Displays this message"]],h=i.usage;q===e&&(h=h.substring(q.length+1),u.unshift(["--version","Displays current version"]));let f=(i.options||[]).concat(l.options,u);if(q!==e&&(h=h.replaceAll(/\[(.*?)\]/g,p=>x.blue(p)).replaceAll(/<(.*?)>/g,p=>x.blue(p))),f.filter(p=>p[0]!=="--help").length>0&&(h+=x.magenta(" [options]")),r+=y.prepSection("Description",i.describe.map(p=>p.replace(/(@return)\s+(\{.*?\})/g,(g,b,E)=>"".concat(x.gray(b)," ").concat(x.green(E))))),r+=y.prepSection("Usage",[h],d),q===e){let p=[];for(let g of Object.keys(t)){if(typeof t[g]=="string"||/^__/.test(g))continue;let b=d(g),E=(Array.isArray(t[g].describe)?t[g].describe:[""])[0];p.push([b,E])}r+=y.prepSection("Available commands",y.prepItem(p)),r+=y.prepSection("Options",y.prepItem([["--help","Help menu for a specific command"],["--version","Package version"]],x.magenta))}else r+=y.prepSection("Aliases",i.alibi,d),r+=y.prepSection("Positional arguments",y.prepItem(i.args,x.blue)),r+=y.prepSection("Options",y.prepItem(i.options,x.magenta)),r+=y.prepSection("Examples",y.prepItem(i.examples.map(p=>[d(p[0]),p[1]])));return r},error:(n,t,e=1)=>{console.log(y.prepSection("Error",[x.red(t)])+"\n  ".concat(x.gray("Run")," `$ npx ").concat(n," ").concat(x.magenta("--help"),"` ").concat(x.gray("for more information"),"\n")),process.exit(e)},parseArgString:n=>(typeof n=="string"?n:"").split(/^-{1,2}|,|\s+-{1,2}|\s+/).filter(Boolean),parseDescription:n=>(typeof n=="string"?n:"").replace(/([.?!])\s*(?=[A-Z])/g,"$1\n").split("\n").map(t=>"".concat(t).trim())},A,N,_,j,S,et;tt.exports=(et=class{constructor(t="oglama",e="0.0.1"){w(this,A,"");w(this,N,"0.0.1");w(this,_,{});w(this,j,"");w(this,S,"");let[s]=t.split(/\s+/);v(this,A,s),v(this,N,e),this.command(L),this.command([q].concat("<command>").join(" "))}command(t,e=!1){let s=[],r=[];(typeof t=="string"?t:"").split(/\s+/).forEach(a=>{["<","["].includes(a.charAt(0))?r.push(a):s.push(a)});let i=s.join(" ");if(r.unshift(i),typeof c(this,_)[i]<"u")throw new Error("Command already added: ".concat(i));return v(this,S,i),e&&v(this,j,i),c(this,_)[c(this,S)]={usage:r.join(" "),describe:[],args:[],options:[],alibi:[],alias:{},default:{},examples:[]},this}describe(t){return c(this,_)[c(this,S)||q].describe=Array.isArray(t)?t:y.parseDescription(t),this}alias(...t){if(!c(this,S))throw new Error("Cannot call `alias()` before defining a command");return(c(this,_)[c(this,S)].alibi=c(this,_)[c(this,S)].alibi.concat(...t)).forEach(s=>c(this,_)[s]=c(this,S)),this}option(t,e,s){let r=c(this,_)[c(this,S)||L],[i,a]=y.parseArgString(t);if(a&&a.length>1&&([i,a]=[a,i]),t="--".concat(i),a&&a.length>0){t="-".concat(a,", ").concat(t);let d=r.alias[a];r.alias[a]=(d||[]).concat(i)}let l=[t,e||""];return typeof s<"u"?(r.default[i]=s,l.push(s)):a||(r.default[i]=void 0),r.options.push(l),this}argument(t,e,s){return c(this,_)[c(this,S)||L].args.push([t,e||"",s]),this}action(t){return typeof t=="function"&&(c(this,_)[c(this,S)||q].handler=t),this}example(t,e=""){return c(this,_)[c(this,S)||q].examples.push([t,e]),this}version(t){return v(this,N,"".concat(t)),this}parse(t,e={}){let s=Ke(t.slice());if(s.version)return console.log("v".concat(c(this,N)));let r="",i="";t=t.slice();for(let g=1;g<=s._.length;g++){if(i=s._.slice(0,g).join(" "),typeof c(this,_)[i]=="string"){r=c(this,_)[i];let b=r.split(" ");t.splice(t.indexOf(s._[0]),g,...b),g+=b.length-g;continue}if(typeof c(this,_)[i]<"u"){r=i;continue}if(r)break}let a=c(this,_)[r];if(typeof a>"u"){if(!c(this,j)||typeof c(this,_)[c(this,j)]>"u")return!i&&s.help?this.help(r):y.error(c(this,A),i?"Invalid command: `".concat(i,"`"):"No command specified");r=c(this,j),a=c(this,_)[r],t.unshift(r)}if(s.help)return this.help(r);if(typeof a.handler!="function")return y.error(c(this,A),"Command has no handler: ".concat(i));e.alias=Object.assign(c(this,_)[L].alias,a.alias,e.alias),e.default=Object.assign(c(this,_)[L].default,a.default,e.default);let l=r.split(" "),d=t.indexOf(l[0]);d!==-1&&t.splice(d,l.length);let u=Ke(t.slice(),e);if(!u||typeof u=="string")return y.error(c(this,A),u||"Parsed unknown option flag(s)!");let h=a.usage.split(/\s+/),f=h.filter(g=>g.charAt(0)==="<"),p=u._.splice(0,f.length);return p.length<f.length?y.error("".concat(c(this,A)," ").concat(r),"Insufficient arguments!"):(h.filter(g=>g.charAt(0)==="[").forEach(g=>{p.push(u._.shift())}),p.push(u),a.handler(...p))}help(t){return console.log(y.help(c(this,A),c(this,_),t||q,c(this,N))),this}},A=new WeakMap,N=new WeakMap,_=new WeakMap,j=new WeakMap,S=new WeakMap,et)});var at=m((on,ot)=>{var rt=xe(),xs=P(),ws=Ce(),bs=$e(),vs=ke(),Ss=Re(),Cs=Ue(),Es=We(),Ps=Ze(),Os=st(),I=X(),nt=require("path"),$s=require("fs"),k,J,G,O,it;ot.exports=(it=class{constructor(t){o(this,"devMode",!1);o(this,"versionApp","0.0.1");o(this,"versionElectron","38.1.0");o(this,"rootPath","");o(this,"config",new rt(null));w(this,k,null);w(this,J,!1);w(this,G,null);w(this,O,{status:{command:"status",description:"Check application status.\n\n@return {boolean} True if app is running, false otherwise.",args:[],options:[],examples:[]},start:{command:"start",description:"Launch application.\nShow relevant binary versions and launched process ID.",args:[],options:[],examples:[]}});o(this,"ipc",()=>{if(c(this,G)===null){let t=this.config.getRpcPort();v(this,G,{diskStorage:new ws(t),session:new bs(t),updater:new vs(t),device:new Ss(t),source:new Cs(t),target:new Es(t),main:new Ps(t)})}return c(this,G)});o(this,"irc",async(t,e=[])=>{let s=null;if(typeof t=="string"&&t.length){let r=new rt(null).getRpcPort();try{let i=await fetch("http://0.0.0.0:".concat(r,"/irc"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({channel:t,args:Array.isArray(e)?e:[]})});s=i.ok?await i.json():new Error(await i.json())}catch(i){s=new Error("".concat(i.message??i))}if(s instanceof Error)throw new Error("".concat(this.devMode?"rpc:".concat(t," "):"").concat(s.message??s))}return s});this.rootPath=t||process.cwd(),this.devMode=nt.basename(this.rootPath).indexOf("-dev")!==-1,xs.devMode=this.devMode,process.on("uncaughtException",r=>{console.log(I.red("".concat(r.message??r))),process.exit(1)}),process.on("unhandledRejection",r=>{console.log(I.red("".concat(r.message??r))),process.exit(1)});let e=async(r,i)=>{try{if(typeof this[r]!="function")throw new Error("Invalid method specified: ".concat(r));let a=await this[r](...i);switch(typeof a){case"undefined":break;case"boolean":console.log(a?I.green(a):I.orange(a));break;case"number":case"bigint":case"symbol":case"object":console.log(a===null?I.orange("null"):I.blue(JSON.stringify(a,null,2)));break;case"function":console.log(I.magenta("".concat(a)));break;default:console.log(a)}}catch(a){console.log(I.red("".concat(a.message??a))),process.exit(1)}finally{process.exit()}},s={};try{s=JSON.parse($s.readFileSync(nt.join(this.rootPath,"package.json")).toString())}catch{}this.versionApp=s.version??"0.0.1",v(this,k,new Os("oglama",this.versionApp));for(let r of Object.keys(c(this,O)))if(typeof c(this,O)[r]=="object"){c(this,k).command(c(this,O)[r].command).describe(c(this,O)[r].description).action(async(...i)=>await e(r,i));for(let i of c(this,O)[r].args)c(this,k).argument(i.key,i.description,i.default);for(let i of c(this,O)[r].options)c(this,k).option(i.key,i.description,i.default);for(let i of c(this,O)[r].examples)c(this,k).example("".concat(r," ").concat(i[0]),i[1])}}async run(){if(!c(this,J)){v(this,J,!0);try{await c(this,k).parse([...process.argv.slice(2)])}catch(t){console.log(I.red("".concat(t.message??t))),process.exit(1)}}process.exit()}},k=new WeakMap,J=new WeakMap,G=new WeakMap,O=new WeakMap,it)});var ht=m((cn,pt)=>{pt.exports=ut;ut.sync=qs;var ct=require("fs");function As(n,t){var e=t.pathExt!==void 0?t.pathExt:process.env.PATHEXT;if(!e||(e=e.split(";"),e.indexOf("")!==-1))return!0;for(var s=0;s<e.length;s++){var r=e[s].toLowerCase();if(r&&n.substr(-r.length).toLowerCase()===r)return!0}return!1}function lt(n,t,e){return!n.isSymbolicLink()&&!n.isFile()?!1:As(t,e)}function ut(n,t,e){ct.stat(n,function(s,r){e(s,s?!1:lt(r,n,t))})}function qs(n,t){return lt(ct.statSync(n),n,t)}});var _t=m((ln,gt)=>{gt.exports=dt;dt.sync=Is;var mt=require("fs");function dt(n,t,e){mt.stat(n,function(s,r){e(s,s?!1:ft(r,t))})}function Is(n,t){return ft(mt.statSync(n),t)}function ft(n,t){return n.isFile()&&ks(n,t)}function ks(n,t){var e=n.mode,s=n.uid,r=n.gid,i=t.uid!==void 0?t.uid:process.getuid&&process.getuid(),a=t.gid!==void 0?t.gid:process.getgid&&process.getgid(),l=parseInt("100",8),d=parseInt("010",8),u=parseInt("001",8),h=l|d,f=e&u||e&d&&r===a||e&l&&s===i||e&h&&i===0;return f}});var xt=m((pn,yt)=>{var un=require("fs"),Z;process.platform==="win32"||global.TESTING_WINDOWS?Z=ht():Z=_t();yt.exports=se;se.sync=Ts;function se(n,t,e){if(typeof t=="function"&&(e=t,t={}),!e){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,r){se(n,t||{},function(i,a){i?r(i):s(a)})})}Z(n,t||{},function(s,r){s&&(s.code==="EACCES"||t&&t.ignoreErrors)&&(s=null,r=!1),e(s,r)})}function Ts(n,t){try{return Z.sync(n,t||{})}catch(e){if(t&&t.ignoreErrors||e.code==="EACCES")return!1;throw e}}});var Pt=m((hn,Et)=>{var H=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",wt=require("path"),Ms=H?";":":",bt=xt(),vt=n=>Object.assign(new Error("not found: ".concat(n)),{code:"ENOENT"}),St=(n,t)=>{let e=t.colon||Ms,s=n.match(/\//)||H&&n.match(/\\/)?[""]:[...H?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(e)],r=H?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=H?r.split(e):[""];return H&&n.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:s,pathExt:i,pathExtExe:r}},Ct=(n,t,e)=>{typeof t=="function"&&(e=t,t={}),t||(t={});let{pathEnv:s,pathExt:r,pathExtExe:i}=St(n,t),a=[],l=u=>new Promise((h,f)=>{if(u===s.length)return t.all&&a.length?h(a):f(vt(n));let p=s[u],g=/^".*"$/.test(p)?p.slice(1,-1):p,b=wt.join(g,n),E=!g&&/^\.[\\\/]/.test(n)?n.slice(0,2)+b:b;h(d(E,u,0))}),d=(u,h,f)=>new Promise((p,g)=>{if(f===r.length)return p(l(h+1));let b=r[f];bt(u+b,{pathExt:i},(E,Q)=>{if(!E&&Q)if(t.all)a.push(u+b);else return p(u+b);return p(d(u,h,f+1))})});return e?l(0).then(u=>e(null,u),e):l(0)},Ds=(n,t)=>{t=t||{};let{pathEnv:e,pathExt:s,pathExtExe:r}=St(n,t),i=[];for(let a=0;a<e.length;a++){let l=e[a],d=/^".*"$/.test(l)?l.slice(1,-1):l,u=wt.join(d,n),h=!d&&/^\.[\\\/]/.test(n)?n.slice(0,2)+u:u;for(let f=0;f<s.length;f++){let p=h+s[f];try{if(bt.sync(p,{pathExt:r}))if(t.all)i.push(p);else return p}catch{}}}if(t.all&&i.length)return i;if(t.nothrow)return null;throw vt(n)};Et.exports=Ct;Ct.sync=Ds});var $t=m((mn,re)=>{"use strict";var Ot=(n={})=>{let t=n.env||process.env;return(n.platform||process.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(s=>s.toUpperCase()==="PATH")||"Path"};re.exports=Ot;re.exports.default=Ot});var kt=m((dn,It)=>{"use strict";var At=require("path"),Rs=Pt(),Ns=$t();function qt(n,t){let e=n.options.env||process.env,s=process.cwd(),r=n.options.cwd!=null,i=r&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(n.options.cwd)}catch{}let a;try{a=Rs.sync(n.command,{path:e[Ns({env:e})],pathExt:t?At.delimiter:void 0})}catch{}finally{i&&process.chdir(s)}return a&&(a=At.resolve(r?n.options.cwd:"",a)),a}function js(n){return qt(n)||qt(n,!0)}It.exports=js});var Tt=m((fn,ie)=>{"use strict";var ne=/([()\][%!^"`<>&|;, *?])/g;function Fs(n){return n=n.replace(ne,"^$1"),n}function Us(n,t){return n="".concat(n),n=n.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),n=n.replace(/(?=(\\+?)?)\1$/,"$1$1"),n='"'.concat(n,'"'),n=n.replace(ne,"^$1"),t&&(n=n.replace(ne,"^$1")),n}ie.exports.command=Fs;ie.exports.argument=Us});var Dt=m((gn,Mt)=>{"use strict";Mt.exports=/^#!(.*)/});var Nt=m((_n,Rt)=>{"use strict";var Ls=Dt();Rt.exports=(n="")=>{let t=n.match(Ls);if(!t)return null;let[e,s]=t[0].replace(/#! ?/,"").split(" "),r=e.split("/").pop();return r==="env"?s:s?"".concat(r," ").concat(s):r}});var Ft=m((yn,jt)=>{"use strict";var oe=require("fs"),Gs=Nt();function Hs(n){let e=Buffer.alloc(150),s;try{s=oe.openSync(n,"r"),oe.readSync(s,e,0,150,0),oe.closeSync(s)}catch{}return Gs(e.toString())}jt.exports=Hs});var Ht=m((xn,Gt)=>{"use strict";var Ws=require("path"),Ut=kt(),Lt=Tt(),Bs=Ft(),Js=process.platform==="win32",zs=/\.(?:com|exe)$/i,Qs=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Ys(n){n.file=Ut(n);let t=n.file&&Bs(n.file);return t?(n.args.unshift(n.file),n.command=t,Ut(n)):n.file}function Vs(n){if(!Js)return n;let t=Ys(n),e=!zs.test(t);if(n.options.forceShell||e){let s=Qs.test(t);n.command=Ws.normalize(n.command),n.command=Lt.command(n.command),n.args=n.args.map(i=>Lt.argument(i,s));let r=[n.command].concat(n.args).join(" ");n.args=["/d","/s","/c",'"'.concat(r,'"')],n.command=process.env.comspec||"cmd.exe",n.options.windowsVerbatimArguments=!0}return n}function Xs(n,t,e){t&&!Array.isArray(t)&&(e=t,t=null),t=t?t.slice(0):[],e=Object.assign({},e);let s={command:n,args:t,options:e,file:void 0,original:{command:n,args:t}};return e.shell?s:Vs(s)}Gt.exports=Xs});var Jt=m((wn,Bt)=>{"use strict";var ae=process.platform==="win32";function ce(n,t){return Object.assign(new Error("".concat(t," ").concat(n.command," ENOENT")),{code:"ENOENT",errno:"ENOENT",syscall:"".concat(t," ").concat(n.command),path:n.command,spawnargs:n.args})}function Zs(n,t){if(!ae)return;let e=n.emit;n.emit=function(s,r){if(s==="exit"){let i=Wt(r,t);if(i)return e.call(n,"error",i)}return e.apply(n,arguments)}}function Wt(n,t){return ae&&n===1&&!t.file?ce(t.original,"spawn"):null}function Ks(n,t){return ae&&n===1&&!t.file?ce(t.original,"spawnSync"):null}Bt.exports={hookChildProcess:Zs,verifyENOENT:Wt,verifyENOENTSync:Ks,notFoundError:ce}});var Yt=m((bn,W)=>{"use strict";var zt=require("child_process"),le=Ht(),ue=Jt();function Qt(n,t,e){let s=le(n,t,e),r=zt.spawn(s.command,s.args,s.options);return ue.hookChildProcess(r,s),r}function er(n,t,e){let s=le(n,t,e),r=zt.spawnSync(s.command,s.args,s.options);return r.error=r.error||ue.verifyENOENTSync(r.status,s),r}W.exports=Qt;W.exports.spawn=Qt;W.exports.sync=er;W.exports._parse=le;W.exports._enoent=ue});var Xt=m((Sn,Vt)=>{var z=X(),tr=at(),K=Yt(),sr=require("path");Vt.exports=class extends tr{constructor(){super(...arguments);o(this,"status",async()=>{let e=!1;try{await this.ipc().main.getDarkMode(),e=!0}catch{}return e});o(this,"start",async()=>{if(this.devMode){await K.sync("npm",["run","dev"],{stdio:"inherit",cwd:this.rootPath});return}console.log("Oglama version: ".concat(z.blue(this.versionApp)));let e=await K.sync("npx",["electron","--version"],{stdio:"pipe",cwd:this.rootPath}),s=e.status===0?"".concat(e.stdout.toString()).trim().replace(/^v/i,""):"";console.log("Electron version: ".concat(s?z.blue(s):z.orange("not installed"))),(e.status!==0||s!==this.versionElectron)&&(console.log("Installing Electron ".concat(z.green("v".concat(this.versionElectron)),"...")),await K.sync("npm",["install","--save-dev","--force","electron@".concat(this.versionElectron)],{stdio:"inherit",cwd:this.rootPath}));let r=K(require("electron"),[sr.join(this.rootPath,"run.js")],{detached:!0,stdio:"ignore",cwd:this.rootPath});r.unref(),console.log("Application PID: ".concat(z.blue(r.pid)))})}}});(async()=>{let n=Xt();await new n(__dirname).run()})();
